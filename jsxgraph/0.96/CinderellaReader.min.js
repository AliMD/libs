/* Version 0.96 */
/* Version 0.96 */
/*
    Copyright 2008-2012
        Matthias Ehmann,
        Michael Gerhaeuser,
        Carsten Miller,
        Bianca Valentin,
        Alfred Wassermann,
        Peter Wilfahrt

    This file is part of JSXGraph.

    JSXGraph is free software dual licensed under the GNU LGPL or MIT License.
    
    You can redistribute it and/or modify it under the terms of the
    
      * GNU Lesser General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version
      OR
      * MIT License: https://github.com/jsxgraph/jsxgraph/blob/master/LICENSE.MIT

    JSXGraph is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Lesser General Public License for more details.

    You should have received a copy of the GNU Lesser General Public License and
    the MIT License along with JSXGraph. If not, see <http://www.gnu.org/licenses/>
    and <http://opensource.org/licenses/MIT/>.
*/
    JXG.CinderellaReader=new function(){this.parseData=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E;t=this.data.split("\n");for(n=0;n<t.length;n++)if(t[n].search(/FreePoint.+/)!=-1){s=t[n].slice(t[n].search(/FreePoint.+/)+11),s=s.split(",");for(r=0;r<s.length;r++)s[r]=s[r].slice(0,s[r].search(/\+i\*/));u=t[n].match(/"[A-Za-z]*"/),u=u[0].slice(1,u[0].length-1),h=this.readPointProperties(t,n),n=h[1],e.create("point",[s[0]/s[2],-1*s[1]/s[2]],{name:u,size:h[0][1],fillColor:h[0][0],strokeColor:h[2],labelColor:h[3]})}else if(t[n].search(/Join\(.+/)!=-1||t[n].search(/Segment\(.+/)!=-1){t[n].search(/Join\(.+/)!=-1?(a=t[n].slice(t[n].search(/Join.+/)+5),f=!1):(a=t[n].slice(t[n].search(/Segment.+/)+8),f=!0),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1);u=t[n].match(/"[A-Za-z]*"/),u=u[0].slice(1,u[0].length-1),h=this.readLineProperties(t,n),n=h[2],e.create("line",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1])],{straightFirst:!f,straightLast:!f,name:u,withLabel:!0,strokeColor:h[0][0],strokeWidth:h[0][2],dash:h[1]})}else if(t[n].search(/CircleMP.+/)!=-1){a=t[n].slice(t[n].search(/CircleMP.+/)+9),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1);u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),h=this.readCircleProperties(t,n),n=h[3],e.create("circle",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1])],{name:u,strokeColor:h[0][0],fillColor:h[1],fillOpacity:h[2],strokeWidth:h[0][2]})}else if(t[n].search(/CircleByFixedRadius.+/)!=-1||t[n].search(/CircleByRadius.+/)!=-1)t[n].search(/CircleByFixedRadius.+/)!=-1?a=t[n].slice(t[n].search(/CircleByFixedRadius.+/)+20):a=t[n].slice(t[n].search(/CircleByRadius.+/)+15),a=a.split(","),o=a[0].match(/"[A-Za-z0-9]*"/)[0],o=o.slice(1,o.length-1),u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),l=a[1].slice(0,a[1].search(/\+i\*/)),h=this.readCircleProperties(t,n),n=h[3],e.create("circle",[JXG.getReference(e,o),Math.sqrt(1*l)],{name:u,strokeColor:h[0][0],fillColor:h[1],fillOpacity:h[2],strokeWidth:h[0][2]});else if(t[n].search(/PointOnCircle.+/)!=-1){a=t[n].split(":="),u=a[0].match(/"[A-Za-z]*"/)[0],u=u.slice(1,u.length-1),o=a[1].match(/"[A-Za-z0-9]*"/)[0],o=o.slice(1,o.length-1),a=a[1].match(/\[.*\]/)[0],a=a.split(",");for(i=0;i<a.length;i++)a[i]=a[i].split("+i*");a[0]=1*a[0][0].slice(1),a[1]=1*a[1][0],t[n][1]=="n"&&(a[0]=-1*a[0],a[1]=-1*a[1]),h=this.readPointProperties(t,n),n=h[1],c=JXG.getReference(e,o),e.create("glider",[c.center.coords.usrCoords[1]+a[0],c.center.coords.usrCoords[2]-a[1],c],{name:u,size:h[0][1],fillColor:h[0][0],strokeColor:h[2],labelColor:h[3]})}else if(t[n].search(/PointOnLine.+/)!=-1){a=t[n].split(":="),u=a[0].match(/"[A-Za-z]*"/)[0],u=u.slice(1,u.length-1),o=a[1].match(/"[A-Za-z0-9]*"/)[0],o=o.slice(1,o.length-1),s=a[1].match(/\[.*\]/)[0],s=s.split(","),s[0]=1*s[0].slice(1,s[0].search(/\+i\*/));for(r=1;r<s.length;r++)s[r]=1*s[r].slice(0,s[r].search(/\+i\*/));h=this.readPointProperties(t,n),n=h[1],e.create("glider",[s[0]/s[2],-1*s[1]/s[2],JXG.getReference(e,o)],{name:u,size:h[0][1],fillColor:h[0][0],strokeColor:h[2],labelColor:h[3]})}else if(t[n].search(/Mid\(.+/)!=-1){a=t[n].slice(t[n].search(/Mid.+/)+4),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1);u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),h=this.readPointProperties(t,n),n=h[1],e.create("midpoint",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1])],{name:u,size:h[0][1],fillColor:h[0][0],strokeColor:h[2],labelColor:h[3]})}else if(t[n].search(/CircleBy3\(.+/)!=-1){a=t[n].slice(t[n].search(/CircleBy3.+/)+10),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1);u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),h=this.readCircleProperties(t,n),n=h[3],c=e.create("circumcircle",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1]),JXG.getReference(e,o[2])],{name:u,strokeColor:h[0][0],fillColor:h[1],fillOpacity:h[2],strokeWidth:h[0][2],point:{name:"",visible:!1}})}else if(t[n].search(/Parallel\(.+/)!=-1){a=t[n].slice(t[n].search(/Parallel.+/)+9),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1);u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),h=this.readLineProperties(t,n),n=h[2],e.create("parallel",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1])],{name:u,withLabel:!0,strokeColor:h[0][0],strokeWidth:h[0][2],dash:h[1]})}else if(t[n].search(/Orthogonal\(.+/)!=-1){a=t[n].slice(t[n].search(/Parallel.+/)+11),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1);u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),h=this.readLineProperties(t,n),n=h[2],e.create("normal",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1])],{name:u,withLabel:!0,strokeColor:h[0][0],strokeWidth:h[0][2],dash:h[1]})}else if(t[n].search(/ConicBy5\(.+/)!=-1){a=t[n].slice(t[n].search(/ConicBy5.+/)+9),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1);u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),h=this.readCircleProperties(t,n),n=h[3],e.create("conic",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1]),JXG.getReference(e,o[2]),JXG.getReference(e,o[3]),JXG.getReference(e,o[4])],{name:u,strokeColor:h[0][0],fillColor:h[1],fillOpacity:h[2],strokeWidth:h[0][2]})}else if(t[n].search(/ConicFoci\(.+/)!=-1||t[n].search(/ConicFociH\(.+/)!=-1){a=t[n].split(":="),u=a[0].match(/"[A-Za-z0-9]*"/)[0],u=u.slice(1,u.length-1),o=a[1].match(/"[A-Za-z0-9]*"/g);for(r=0;r<o.length;r++)o[r]=o[r].slice(1,o[r].length-1);h=this.readCircleProperties(t,n),t[n].search(/ConicFociH\(.+/)!=-1?e.create("hyperbola",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1]),JXG.getReference(e,o[2])],{name:u,strokeColor:h[0][0],fillColor:h[1],fillOpacity:h[2],strokeWidth:h[0][2]}):e.create("ellipse",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1]),JXG.getReference(e,o[2])],{name:u,strokeColor:h[0][0],fillColor:h[1],fillOpacity:h[2],strokeWidth:h[0][2]}),n=h[3]}else if(t[n].search(/ConicParabolaPL\(.+/)!=-1){a=t[n].slice(t[n].search(/ConicParabolaPL.+/)+16),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1);u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),h=this.readCircleProperties(t,n),n=h[3],e.create("parabola",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1])],{name:u,strokeColor:h[0][0],fillColor:h[1],fillOpacity:h[2],strokeWidth:h[0][2]})}else if(t[n].search(/Poly\(.+/)!=-1){a=t[n].slice(t[n].search(/Poly.+/)+5),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1),o[r]=JXG.getReference(e,o[r]);u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),h=this.readCircleProperties(t,n),n=h[3],p=e.create("polygon",o,{name:u}),p.setProperty({fillColor:h[1],fillOpacity:h[2]});for(r=0;r<p.borders.length;r++)p.borders[r].setProperty({strokeColor:h[0][0],strokeWidth:h[0][2]})}else if(t[n].search(/Arc\(.+/)!=-1){a=t[n].slice(t[n].search(/Arc.+/)+4),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1);u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),h=this.readCircleProperties(t,n),n=h[3],p=e.create("circumcirclearc",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1]),JXG.getReference(e,o[2])],{name:u,strokeColor:h[0][0],fillColor:h[1],fillOpacity:h[2],strokeWidth:h[0][2]})}else if(t[n].search(/Through\(.+/)!=-1){a=t[n].slice(t[n].search(/Through.+/)+8),o=a.match(/"[A-Za-z]*"/)[0],o=o.slice(1,o.length-1),s=a.match(/\[.*\]/)[0],s=s.split(","),s[0]=1*s[0].slice(1,s[0].search(/\+i\*/));for(r=1;r<s.length;r++)s[r]=1*s[r].slice(0,s[r].search(/\+i\*/));u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),r=JXG.getReference(e,o),d=e.create("point",[r.coords.usrCoords[1]+1*s[0],r.coords.usrCoords[2]+1*s[1]],{visible:!1}),h=this.readLineProperties(t,n),n=h[2],e.create("line",[r,d],{name:u,withLabel:!0,strokeColor:h[0][0],strokeWidth:h[0][2],dash:h[1]})}else if(t[n].search(/:=Compass\(.+/)!=-1){a=t[n].slice(t[n].search(/Compass.+/)+8),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1);u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),h=this.readCircleProperties(t,n),n=h[3],l=function(e,t){return function(){return JXG.getReference(t,e[0]).Dist(JXG.getReference(t,e[1]))}}(o,e),e.create("circle",[JXG.getReference(e,o[2]),l],{name:u,strokeColor:h[0][0],fillColor:h[1],fillOpacity:h[2],strokeWidth:h[0][2]})}else if(t[n].search(/AngularBisector\(.+/)!=-1)a=t[n].split(":="),a[0]=a[0].split(","),a[0][0]=="{null"?u="":u=a[0][0].slice(2,a[0][0].length-1),a[0][1]=="null"?v="":v=a[0][1].slice(1,a[0][1].length-1),a[1]=a[1].match(/"[A-Za-z0-9]*"/g),o=[],o[0]=a[1][0].slice(1,a[1][0].length-1),o[1]=a[1][1].slice(1,a[1][1].length-1),h=this.readLineProperties(t,n),n=h[2],u!=""&&v!=""&&(m=this.readLineProperties(t,n),n=h[2]),g=e.create("bisectorlines",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1])],{line1:{name:v},line2:{name:u},withLabel:!0}),u==""?(g.line2.setProperty({visible:!1}),g.line1.setProperty({strokeColor:h[0][0],strokeWidth:h[0][2],dash:h[1]})):v==""?(g.line1.setProperty({visible:!1}),g.line2.setProperty({strokeColor:h[0][0],strokeWidth:h[0][2],dash:h[1]})):(g.line1.setProperty({strokeColor:h[0][0],strokeWidth:h[0][2],dash:h[1]}),g.line2.setProperty({strokeColor:m[0][0],strokeWidth:m[0][2],dash:m[1]}));else if(t[n].search(/Meet\(.+/)!=-1){a=t[n].slice(t[n].search(/Meet.+/)+5),a=a.split(","),o=[];for(r=0;r<a.length;r++)o[r]=a[r].match(/"[A-Za-z]*"/)[0],o[r]=o[r].slice(1,o[r].length-1);u=t[n].match(/"[A-Za-z0-9]*"/),u=u[0].slice(1,u[0].length-1),h=this.readPointProperties(t,n),n=h[1],e.create("intersection",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1]),0],{name:u,size:h[0][1],fillColor:h[0][0],strokeColor:h[2],labelColor:h[3]})}else t[n].search(/IntersectionConicLine\(.+/)!=-1||t[n].search(/IntersectionCircleCircle\(.+/)!=-1?(t[n].search(/IntersectionConicLine\(.+/)!=-1?(i=0,r=1):(i=1,r=0),a=t[n].split(":="),a[0]=a[0].split(","),a[0][0]=="{null"?u="":u=a[0][0].slice(2,a[0][0].length-1),a[0][1]=="null"?v="":v=a[0][1].slice(1,a[0][1].length-1),a[1]=a[1].match(/"[A-Za-z0-9]*"/g),o=[],o[0]=a[1][0].slice(1,a[1][0].length-1),o[1]=a[1][1].slice(1,a[1][1].length-1),h=this.readPointProperties(t,n),n=h[1],u!=""&&v!=""&&(m=this.readPointProperties(t,n),n=h[1]),v!=""?(d=e.create("intersection",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1]),r],{name:v,size:h[0][1],fillColor:h[0][0],strokeColor:h[2],labelColor:h[3]}),u!=""&&(y=e.create("otherintersection",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1]),d],{name:u,size:m[0][1],fillColor:m[0][0],strokeColor:m[2],labelColor:m[3]}))):d=e.create("intersection",[JXG.getReference(e,o[0]),JXG.getReference(e,o[1]),i],{name:u,size:h[0][1],fillColor:h[0][0],strokeColor:h[2],labelColor:h[3]})):t[n].search(/setOriginX\(([0-9.]*)\)/)!=-1?b=RegExp.$1:t[n].search(/setOriginY\(([0-9.]*)\)/)!=-1?w=RegExp.$1:t[n].search(/setScale\(([0-9.]*)\)/)!=-1&&(E=1*RegExp.$1/25);return e.zoomX*=E/2.4,e.zoomY*=E/2.4,b=e.origin.scrCoords[1]*e.options.zoom.factorX,w=e.origin.scrCoords[2]*e.options.zoom.factorY,e.origin=new JXG.Coords(JXG.COORDS_BY_SCREEN,[b-150,w+50],e),e.applyZoom(),e},this.calculateColor=function(e){e=parseInt(e);switch(e){case 0:return"white";case 1:return"black";case 2:return"red";case 3:return"blue";case 4:return"green";case 5:return"yellow";case 6:return"#ffafaf";case 7:return"cyan";case 8:return"#ffc800";case 9:return"#199e4e";case 10:return"#b75500";case 11:return"#7700b7";case 12:return"#ff7f00";case 13:return"#03a7bc";case 14:return"#c10000";case 15:return"#808080";case 16:return"#ff4a4a";case 17:return"#faff9e";case 18:return"#b6ffaa";case 19:return"#82f2ff";case 20:return"#d4a3ff";case 21:return"#ffbd77"}},this.readPointProperties=function(e,t){var n,r,i;do t+=1;while(e[t].search(/setAppearance/)==-1);n=e[t].match(/\([A-Za-z,0-9\.]*\)/)[0],n=n.slice(1,n.length-1).split(","),n[0]=this.calculateColor(n[0]);do t+=1;while(e[t].search(/pointborder/)==-1);return e[t].search(/false/)!=-1?(r="none",i=n[0]):(r="black",i="black"),[n,t,r,i]},this.readCircleProperties=function(e,t){var n,r,i;do t+=1;while(e[t].search(/setAppearance/)==-1);n=e[t].match(/\([A-Za-z,0-9\.]*\)/)[0],n=n.slice(1,n.length-1).split(","),n[0]=this.calculateColor(n[0]);do t+=1;while(e[t].search(/colorfill/)==-1);r=e[t].match(/"[0-9]*"/)[0],r=r.slice(1,r.length-1),r=this.calculateColor(r);do t+=1;while(e[t].search(/visibilityfill|fillalpha/)==-1);return i=e[t].match(/"[0-9\.]*"/)[0],i=i.slice(1,i.length-1),e[t].match(/visibilityfill/)?i=1*i/10:i=1*i,[n,r,i,t]},this.readLineProperties=function(e,t){var n,r;do t+=1;while(e[t].search(/setAppearance/)==-1);n=e[t].match(/\([A-Za-z,0-9\.]*\)/)[0],n=n.slice(1,n.length-1).split(","),n[0]=this.calculateColor(n[0]);do t+=1;while(e[t].search(/linedashing/)==-1);return e[t].search(/false/)!=-1?r=0:r=3,[n,r,t]},this.prepareString=function(e){var t,n=[],r;if(e.indexOf("<")!=0){r=e.length;for(t=0;t<r;t++)n[t]=JXG.Util.asciiCharCodeAt(e,t);e=(new JXG.Util.Unzip(n)).unzip()[0][0]}return e},this.readCinderella=function(e,t){this.data=this.prepareString(e),t.suspendUpdate(),this.parseData(t),t.unsuspendUpdate()}};
