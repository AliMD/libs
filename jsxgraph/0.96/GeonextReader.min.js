/* Version 0.96 */
/* Version 0.96 */
/*
    Copyright 2008-2012
        Matthias Ehmann,
        Michael Gerhaeuser,
        Carsten Miller,
        Bianca Valentin,
        Alfred Wassermann,
        Peter Wilfahrt

    This file is part of JSXGraph.

    JSXGraph is free software dual licensed under the GNU LGPL or MIT License.
    
    You can redistribute it and/or modify it under the terms of the
    
      * GNU Lesser General Public License as published by
        the Free Software Foundation, either version 3 of the License, or
        (at your option) any later version
      OR
      * MIT License: https://github.com/jsxgraph/jsxgraph/blob/master/LICENSE.MIT

    JSXGraph is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Lesser General Public License for more details.

    You should have received a copy of the GNU Lesser General Public License and
    the MIT License along with JSXGraph. If not, see <http://www.gnu.org/licenses/>
    and <http://opensource.org/licenses/MIT/>.
*/
    JXG.debug=function(){},JXG.GeonextReader={changeOriginIds:function(e,t){return t=="gOOe0"||t=="gXOe0"||t=="gYOe0"||t=="gXLe0"||t=="gYLe0"?e.id+t:t},gEBTN:function(e,t,n,r){var i;return JXG.exists(e||!e.getElementsByTagName)?(JXG.exists(r)||(r=!0),n=n||0,i=e.getElementsByTagName(t),i.length>0&&(i=i[n],r&&i.firstChild&&(i=i.firstChild.data)),i):""},colorProperties:function(e,t){var n=this.gEBTN(t,"color",0,!1),r;return r=JXG.rgba2rgbo(this.gEBTN(n,"stroke")),e.strokeColor=r[0],e.strokeOpacity=r[1],r=JXG.rgba2rgbo(this.gEBTN(n,"lighting")),e.highlightStrokeColor=r[0],e.highlightStrokeOpacity=r[1],r=JXG.rgba2rgbo(this.gEBTN(n,"fill")),e.fillColor=r[0],e.fillOpacity=r[1],e.highlightFillColor=e.fillColor,e.highlightFillOpacity=e.fillOpacity,e.labelColor=JXG.rgba2rgbo(this.gEBTN(n,"label"))[0],e.colorDraft=JXG.rgba2rgbo(this.gEBTN(n,"draft"))[0],JXG.rgba2rgbo(this.gEBTN(n,"label"))[1]==0?e.withLabel=!1:e.withLabel=!0,e.colorStroke=e.strokeColor,e.colorFill=e.fillColor,e.colorLabel=e.labelColor,e},firstLevelProperties:function(e,t){if(!JXG.exists(t)||!JXG.exists(t.childNodes))return e;var n=t.childNodes,r,i;for(r=0;r<n.length;r++)JXG.exists(n[r].firstChild)&&n[r].nodeName!=="data"&&n[r].nodeName!=="straight"&&(i=n[r].nodeName,i=="width"&&(i="strokewidth"),e[i]=n[r].firstChild.data);return e},defProperties:function(e,t){return t.nodeType==3||t.nodeType==8?null:(e.ident=t.nodeName,e.ident=="text"||e.ident=="intersection"||e.ident=="composition"?e.name="":e.name=this.gEBTN(t,"name"),e.id=this.gEBTN(t,"id"),e)},visualProperties:function(e,t){return e.visible=JXG.str2Bool(this.gEBTN(t,"visible")),e.trace=JXG.str2Bool(this.gEBTN(t,"trace")),e},transformProperties:function(e,t){var n=["cross","cross","cross","circle","circle","circle","circle","square","square","square","plus","plus","plus"],r=[2,3,4,1,2,3,4,2,3,4,2,3,4];return e.strokeWidth=e.strokewidth,e.face=n[parseInt(e.style,10)]||"cross",e.size=r[parseInt(e.style,10)]||3,e.straightFirst=JXG.str2Bool(e.straightFirst),e.straightLast=JXG.str2Bool(e.straightLast),e.visible=JXG.str2Bool(e.visible),e.draft=JXG.str2Bool(e.draft),e.trace=JXG.str2Bool(e.trace),t==="point"&&(e.fillColor=e.strokeColor,e.highlightFillColor=e.highlightStrokeColor,e.fillOpacity=e.strokeOpacity,e.highlightFillOpacity=e.highlightStrokeOpacity),typeof (e.label==="string")&&delete e.label,delete e.color,e},readNodes:function(e,t,n,r){var i=this.gEBTN(t,n,0,!1).childNodes,s,o;for(o=0;o<i.length;o++)i[o].firstChild!=null&&(r!=null?s=r+JXG.capitalize(i[o].nodeName):s=i[o].nodeName,e[s]=i[o].firstChild.data);return e},subtreeToString:function(e){try{return(new XMLSerializer).serializeToString(e)}catch(t){return e.xml}},readImage:function(e){var t="",n=e;if(n!=null){t=n.data;while(n.nextSibling!=null)n=n.nextSibling,t+=n.data}return t},parseImage:function(e,t,n,r,i,s,o,u){var a,f,l,c,h;if(t==null)return null;if(t.getElementsByTagName("src")[0]!=null)a="src";else{if(t.getElementsByTagName("image")[0]==null||this.gEBTN(t,"image")=="null")return null;a="image"}c=this.readImage(this.gEBTN(t,a,0,!1).firstChild);if(c!="")return c="data:image/png;base64,"+c,a=="src"?(r=this.gEBTN(t,"x"),i=this.gEBTN(t,"y"),s=this.gEBTN(t,"width"),o=this.gEBTN(t,"height"),l=e.create("image",[c,[r,i],[s,o]],{anchor:u,layer:n}),l):(h=new Image,h.src=c,f=u.id+"_image",h.onload=function(){var t=this.width,a=this.height,l,h,p,d,v,m;u.elementClass==JXG.OBJECT_CLASS_LINE?(l=function(){return u.point1.X()},p=function(){return u.point1.Dist(u.point2)},d=function(){return p()*a/t},h=function(){return u.point1.Y()-d()*.5},v=e.create("image",[c,[l,h],[p,d]],{layer:n,id:f,anchor:u}),m=e.create("transform",[function(){return Math.atan2(u.point2.Y()-u.point1.Y(),u.point2.X()-u.point1.X())},u.point1],{type:"rotate"}),m.bindTo(v),u.image=v):u.elementClass==JXG.OBJECT_CLASS_POINT?(p=function(){return t/e.unitX},d=function(){return a/e.unitY},l=function(){return u.X()-p()*.5},h=function(){return u.Y()-d()*.5},v=e.create("image",[c,[l,h],[p,d]],{layer:n,id:f,anchor:u}),e.renderer.hide(u.label.content),u.image=v):u.elementClass==JXG.OBJECT_CLASS_CIRCLE?(p=function(){return 2*u.Radius()},d=function(){return p()*a/t},l=function(){return u.center.X()-p()*.5},h=function(){return u.center.Y()-d()*.5},v=e.create("image",[c,[l,h],[p,d]],{layer:n,id:f,anchor:u}),u.image=v):(v=e.create("image",[c,[r,i],[s,o]],{layer:n,id:f,anchor:u}),u.image=v)},l)},readConditions:function(e){var t,n,r,i="";if(JXG.exists(e))for(t=0;t<e.getElementsByTagName("data").length;t++)r=e.getElementsByTagName("data")[t],n=this.subtreeToString(r),i+=n;return i},readViewPort:function(e){var t,n=[];return t=this.gEBTN(e,"viewport",0,!1),t?(n[0]=parseFloat(this.gEBTN(t,"left")),n[1]=parseFloat(this.gEBTN(t,"top")),n[2]=parseFloat(this.gEBTN(t,"right")),n[3]=parseFloat(this.gEBTN(t,"bottom")),n):[]},printDebugMessage:function(e,t,n,r){JXG.debug("* "+r+":  "+n+" "+t.name+" "+t.id+"<br>\n")},readGeonext:function(e,t){var n,r,i,s,o,u,a,f,l,c,h="true",p=this;t.options.layer.sector=t.options.layer.angle,t.options.layer.circle=t.options.layer.angle,t.options.line.label.position="top",u=this.gEBTN(e,"board",0,!1),l=this.readConditions(u.getElementsByTagName("conditions")[0]),t.options.takeSizeFromFile&&t.resizeContainer(this.gEBTN(u,"width"),this.gEBTN(u,"height")),n=this.gEBTN(u,"coordinates",0,!1),c=this.readViewPort(n),c.length==4?t.setBoundingBox(c,!1):(c=this.gEBTN(n,"zoom",0,!1),t.zoomX=parseFloat(this.gEBTN(c,"x")),t.zoomY=parseFloat(this.gEBTN(c,"y")),c=this.gEBTN(n,"origin",0,!1),t.origin={usrCoords:[1,0,0],scrCoords:[1,parseFloat(this.gEBTN(c,"x"))*t.zoomX,parseFloat(this.gEBTN(c,"y"))*t.zoomY]},c=this.gEBTN(n,"unit",0,!1),t.unitX=parseFloat(this.gEBTN(c,"x"))*t.zoomX,t.unitY=parseFloat(this.gEBTN(c,"y"))*t.zoomY),t.options.takeSizeFromFile&&t.resizeContainer(this.gEBTN(u,"width"),this.gEBTN(u,"height")),parseFloat(t.options.text.fontSize)>0||(t.options.text.fontSize=12),t.geonextCompatibilityMode=!0,delete JXG.JSXGraph.boards[t.id],t.id=this.gEBTN(u,"id"),JXG.JSXGraph.boards[t.id]=t,t.initGeonextBoard(),t.renderer.enhancedRendering=!0,this.parseImage(t,this.gEBTN(u,"file",0,!1),t.options.layer.image),t.options.point.snapToGrid=this.gEBTN(this.gEBTN(u,"coordinates",0,false),"snap")==h,t.options.point.snapToGrid&&this.gEBTN(this.gEBTN(u,"grid",1,false),"pointsnap")==h&&(t.options.point.snapToGrid=!1,t.options.point.snapToPoints=!0,t.options.point.attractorDistance=.5),n=this.gEBTN(u,"grid",1,!1),c=this.gEBTN(n,"x"),c&&(t.options.grid.gridX=1/parseFloat(c),t.options.point.snapSizeX=parseFloat(c)),c=this.gEBTN(n,"y"),c&&(t.options.grid.gridY=1/parseFloat(c),t.options.point.snapSizeY=parseFloat(c)),t.options.grid.gridDash=JXG.str2Bool(this.gEBTN(n,"dash")),c=JXG.rgba2rgbo(this.gEBTN(n,"color")),t.options.grid.gridColor=c[0],t.options.grid.gridOpacity=c[1],n=this.gEBTN(u,"coordinates",0,!1),this.gEBTN(n,"grid")==h&&t.create("grid",[]),this.gEBTN(n,"coord")==h&&(t.options.axis.ticks.majorHeight=10,t.options.axis.ticks.minorHeight=4,t.create("axis",[[0,0],[1,0]]),t.create("axis",[[0,0],[0,1]])),c=this.gEBTN(this.gEBTN(u,"background",0,!1),"color"),c.length==8&&(c="#"+c),t.containerObj.style.backgroundColor=JXG.rgba2rgbo(c)[0],r=e.getElementsByTagName("elements")[0].childNodes;for(i=0;i<r.length;i++)(function(e){var i,o={},u,a,f,l,c,h,d,v,m,g;s=r[e],o=p.defProperties(o,s);if(!JXG.exists(o))return;p.printDebugMessage("debug",o,s.nodeName.toLowerCase,"READ:");switch(s.nodeName.toLowerCase()){case"point":o.strokewidth=1,o=p.colorProperties(o,s),o=p.visualProperties(o,s),o=p.firstLevelProperties(o,s),o=p.readNodes(o,s,"data"),o.fixed=JXG.str2Bool(p.gEBTN(s,"fix")),o=p.transformProperties(o,"point"),d=t.create("point",[parseFloat(o.x),parseFloat(o.y)],o);var y=function(){return d.visProp.visible};h=p.parseImage(t,s,t.options.layer.image,0,0,0,0,d),p.printDebugMessage("debug",o,s.nodeName,"OK");break;case"line":o=p.colorProperties(o,s),o=p.visualProperties(o,s),o=p.firstLevelProperties(o,s),o=p.readNodes(o,s,"data"),o=p.readNodes(o,s,"straight","straight"),o=p.transformProperties(o),o.first=p.changeOriginIds(t,o.first),o.last=p.changeOriginIds(t,o.last),u=t.create("line",[o.first,o.last],o),p.parseImage(t,s,t.options.layer.image,0,0,0,0,u),p.printDebugMessage("debug",o,s.nodeName,"OK");break;case"circle":o=p.colorProperties(o,s),o=p.visualProperties(o,s),o=p.firstLevelProperties(o,s),g=p.gEBTN(s,"data",0,!1),o.center=p.changeOriginIds(t,p.gEBTN(g,"midpoint")),g.getElementsByTagName("radius").length>0?o.radius=p.changeOriginIds(t,p.gEBTN(g,"radius")):g.getElementsByTagName("radiusvalue").length>0&&(o.radius=p.gEBTN(g,"radiusvalue")),o=p.transformProperties(o),l=t.create("circle",[o.center,o.radius],o),p.parseImage(t,s,t.options.layer.image,0,0,0,0,l),p.printDebugMessage("debug",o,s.nodeName,"OK");break;case"slider":o.strokewidth=1,o=p.colorProperties(o,s),o=p.visualProperties(o,s),o=p.firstLevelProperties(o,s),o=p.readNodes(o,s,"data"),o.fixed=JXG.str2Bool(p.gEBTN(s,"fix")),o=p.readNodes(o,s,"animate","animate"),o=p.transformProperties(o,"point");try{o.parent=p.changeOriginIds(t,o.parent),d=t.create("glider",[parseFloat(o.x),parseFloat(o.y),o.parent],o),d.onPolygon=JXG.exists(o.onpolygon)&&JXG.str2Bool(o.onpolygon),p.parseImage(t,s,t.options.layer.point,0,0,0,0,d),p.printDebugMessage("debug",o,s.nodeName,"OK")}catch(b){JXG.debug("* <b>Err:</b>  Slider "+o.name+" "+o.id+": "+o.parent+"<br>\n")}break;case"cas":o=p.colorProperties(o,s),o=p.visualProperties(o,s),o=p.firstLevelProperties(o,s),o.fixed=JXG.str2Bool(s.getElementsByTagName("fix")[0].firstChild.data),o=p.readNodes(o,s,"data"),o=p.transformProperties(o,"point"),o.x=JXG.GeonextParser.geonext2JS(o.x,t),o.x=new Function("return "+o.x+";"),o.y=JXG.GeonextParser.geonext2JS(o.y,t),o.y=new Function("return "+o.y+";"),d=t.create("point",[o.x,o.y],o),p.parseImage(t,s,t.options.layer.point,0,0,0,0,d),p.printDebugMessage("debug",o,s.nodeName,"OK");break;case"intersection":o.strokewidth=1,o=p.readNodes(o,s,"data"),n=s.getElementsByTagName("first")[1],o.outFirst={},o.outFirst=p.colorProperties(o.outFirst,n),o.outFirst=p.visualProperties(o.outFirst,n),o.outFirst=p.firstLevelProperties(o.outFirst,n),o.outFirst.fixed=JXG.str2Bool(n.getElementsByTagName("fix")[0].firstChild.data),o.outFirst=p.transformProperties(o.outFirst,"point"),o.first=p.changeOriginIds(t,o.first),o.last=p.changeOriginIds(t,o.last),JXG.getReference(t,o.first).elementClass==JXG.OBJECT_CLASS_LINE&&JXG.getReference(t,o.last).elementClass==JXG.OBJECT_CLASS_LINE?(v=t.create("intersection",[t.objects[o.first],t.objects[o.last],0],o.outFirst),o.outFirst.visible=="false"&&v.hideElement()):(n=s.getElementsByTagName("last")[1],JXG.exists(n)&&(o.outLast={},o.outLast=p.colorProperties(o.outLast,n),o.outLast=p.visualProperties(o.outLast,n),o.outLast=p.firstLevelProperties(o.outLast,n),o.outLast.fixed=JXG.str2Bool(n.getElementsByTagName("fix")[0].firstChild.data),o.outLast=p.transformProperties(o.outLast,"point"),v=t.create("intersection",[t.objects[o.first],t.objects[o.last],0],o.outFirst),v=t.create("intersection",[t.objects[o.first],t.objects[o.last],1],o.outLast))),p.printDebugMessage("debug",o,s.nodeName,"OK");break;case"composition":o=p.readNodes(o,s,"data"),o=p.firstLevelProperties(o,s),o.defEl=[],c=0,n=s.getElementsByTagName("data")[0].getElementsByTagName("input");for(i=0;i<n.length;i++)o.defEl[i]=n[i].firstChild.data,c=i+1;n=s.getElementsByTagName("output")[0],o.out={},o.out=p.colorProperties(o.out,n),o.out=p.visualProperties(o.out,n),o.out=p.firstLevelProperties(o.out,n),o.out=p.transformProperties(o.out),o.defEl[0]=p.changeOriginIds(t,o.defEl[0]),o.defEl[1]=p.changeOriginIds(t,o.defEl[1]),o.defEl[2]=p.changeOriginIds(t,o.defEl[2]);switch(o.type){case"210070":o.out.fixed=p.gEBTN(n,"fix"),n=s.getElementsByTagName("output")[1],o.outPoint={},o.outPoint=p.defProperties(o.outPoint,n),o.outPoint=p.colorProperties(o.outPoint,n),o.outPoint=p.visualProperties(o.outPoint,n),o.outPoint=p.firstLevelProperties(o.outPoint,n),o.outPoint=p.transformProperties(o.outPoint),o.out.point=o.outPoint,t.create("arrowparallel",[o.defEl[1],o.defEl[0]],o.out);break;case"210080":o.out.straightFirst=!1,t.create("bisector",[o.defEl[0],o.defEl[1],o.defEl[2]],o.out);break;case"210090":n=s.getElementsByTagName("output")[1],o.outCircle={},o.outCircle=p.defProperties(o.outCircle,n),o.outCircle=p.colorProperties(o.outCircle,n),o.outCircle=p.visualProperties(o.outCircle,n),o.outCircle=p.firstLevelProperties(o.outCircle,n),o.outCircle=p.transformProperties(o.outCircle),o.outCircle.point=o.out,t.create("circumcircle",[o.defEl[0],o.defEl[1],o.defEl[2]],o.outCircle);break;case"210100":t.create("circumcenter",[o.defEl[0],o.defEl[1],o.defEl[2]],o.out);break;case"210110":t.create("midpoint",o.defEl.slice(0,c),o.out);break;case"210120":t.create("reflection",[o.defEl[1],o.defEl[0]],o.out);break;case"210125":t.create("mirrorpoint",[o.defEl[0],o.defEl[1]],o.out);break;case"210130":t.create("perpendicularsegment",[o.defEl[0],o.defEl[1]],o.out);break;case"210140":d=t.create("parallelpoint",[o.defEl[1],o.defEl[0]],{withLabel:!1,visible:!1,name:"",fixed:!0}),h=t.create("line",[o.defEl[0],d],o.out),h.parallelpoint=d;break;case"210150":t.create("parallelpoint",o.defEl.slice(0,c),o.out);break;case"210160":o.out.fixed=p.gEBTN(n,"fix"),n=s.getElementsByTagName("output")[1],o.outLine={},o.outLine=p.defProperties(o.outLine,n),o.outLine=p.colorProperties(o.outLine,n),o.outLine=p.visualProperties(o.outLine,n),o.outLine=p.firstLevelProperties(o.outLine,n),o.outLine=p.readNodes(o.outLine,n,"straight","straight"),o.outLine=p.transformProperties(o.outLine),o.outLine.point=o.out,t.create("perpendicularsegment",[o.defEl[1],o.defEl[0]],o.outLine);break;case"210170":t.create("perpendicularpoint",[o.defEl[1],o.defEl[0]],o.out);break;case"210180":throw new Error("JSXGraph: Element ROTATION not yet implemented.");case"210190":o.out=p.defProperties(o.out,n),o.out.firstArrow=JXG.str2Bool(p.gEBTN(n,"firstarrow")),o.out.lastArrow=JXG.str2Bool(p.gEBTN(n,"lastarrow"));for(i=0;i<4;i++)n=s.getElementsByTagName("output")[i],o.out=p.defProperties(o.out,n),o.out=p.colorProperties(o.out,n),o.out=p.visualProperties(o.out,n),o.out=p.firstLevelProperties(o.out,n),o.out=p.transformProperties(o.out),i==0?h=t.create("sector",o.defEl,o.out):i==1?d=t.create("point",[function(){var e=JXG.getRef(t,o.defEl[1]),n=JXG.getRef(t,o.defEl[2]);return e.X()+(n.X()-e.X())*h.Radius/e.Dist(n)},function(){var e=JXG.getRef(t,o.defEl[1]),n=JXG.getRef(t,o.defEl[2]);return e.Y()+(n.Y()-e.Y())*h.Radius/e.Dist(n)}],o.out):i==2?h=t.create("segment",[o.defEl[0],o.defEl[1]],o.out):i==3&&(h=t.create("segment",[o.defEl[1],d],o.out));break;default:throw new Error("JSXGraph: GEONExT-Element "+o.type+" not implemented.")}p.printDebugMessage("debug",o,s.nodeName,"OK");break;case"polygon":o=p.colorProperties(o,s),o=p.firstLevelProperties(o,s);var w=[];for(i=0;i<s.getElementsByTagName("data")[0].getElementsByTagName("vertex").length-1;i++)w[i]=s.getElementsByTagName("data")[0].getElementsByTagName("vertex")[i].firstChild.data,w[i]=p.changeOriginIds(t,w[i]);o.border=[],o.borders={ids:[]};for(i=0;i<s.getElementsByTagName("border").length;i++){o.border[i]={},n=s.getElementsByTagName("border")[i],o.border[i].id=n.getElementsByTagName("id")[0].firstChild.data,o.borders.ids.push(o.border[i].id),o.border[i].name=n.getElementsByTagName("name")[0].firstChild.data,o.border[i].straightFirst=JXG.str2Bool(n.getElementsByTagName("straight")[0].getElementsByTagName("first")[0].firstChild.data),o.border[i].straightLast=JXG.str2Bool(n.getElementsByTagName("straight")[0].getElementsByTagName("last")[0].firstChild.data);try{o.border[i].strokeWidth=n.getElementsByTagName("strokewidth")[0].firstChild.data}catch(b){o.border[i].strokeWidth=n.getElementsByTagName("width")[0].firstChild.data}try{o.border[i].dash=JXG.str2Bool(n.getElementsByTagName("dash")[0].firstChild.data)}catch(b){}o.border[i].visible=JXG.str2Bool(n.getElementsByTagName("visible")[0].firstChild.data),o.border[i].draft=JXG.str2Bool(n.getElementsByTagName("draft")[0].firstChild.data),o.border[i].trace=JXG.str2Bool(n.getElementsByTagName("trace")[0].firstChild.data),n=s.getElementsByTagName("border")[i].getElementsByTagName("color")[0],m=JXG.rgba2rgbo(n.getElementsByTagName("stroke")[0].firstChild.data),o.border[i].strokeColor=m[0],o.border[i].strokeOpacity=m[1],m=JXG.rgba2rgbo(n.getElementsByTagName("lighting")[0].firstChild.data),o.border[i].highlightStrokeColor=m[0],o.border[i].highlightStrokeOpacity=m[1],m=JXG.rgba2rgbo(n.getElementsByTagName("fill")[0].firstChild.data),o.border[i].fillColor=m[0],o.border[i].fillOpacity=m[1],o.border[i].highlightFillColor=o.border[i].fillColor,o.border[i].highlightFillOpacity=o.border[i].fillOpacity,o.border[i].labelColor=n.getElementsByTagName("label")[0].firstChild.data,o.border[i].colorDraft=n.getElementsByTagName("draft")[0].firstChild.data}o=p.transformProperties(o),d=t.create("polygon",w,o);for(i=0;i<d.borders.length;i++)d.borders[i].setProperty(o.border[i]);p.printDebugMessage("debug",o,s.nodeName,"OK");break;case"graph":o=p.colorProperties(o,s),o=p.firstLevelProperties(o,s),o.funct=s.getElementsByTagName("data")[0].getElementsByTagName("function")[0].firstChild.data,o.funct=JXG.GeonextParser.geonext2JS(o.funct,t),o.funct=new Function("x","return "+o.funct+";"),l=t.create("curve",["x",o.funct],{id:o.id,name:o.name,strokeColor:o.strokeColor,strokeWidth:o.strokeWidth,fillColor:"none",highlightFillColor:"none",highlightStrokeColor:o.highlightStrokeColor,visible:JXG.str2Bool(o.visible)}),p.printDebugMessage("debug",o,s.nodeName,"OK");break;case"arrow":o=p.colorProperties(o,s),o=p.visualProperties(o,s),o=p.firstLevelProperties(o,s),o=p.readNodes(o,s,"data"),o=p.readNodes(o,s,"straight","straight"),o=p.transformProperties(o),o.first=p.changeOriginIds(t,o.first),o.last=p.changeOriginIds(t,o.last),u=t.create("arrow",[o.first,o.last],o),p.printDebugMessage("debug",u,s.nodeName,"OK");break;case"arc":o=p.colorProperties(o,s),o=p.visualProperties(o,s),o=p.firstLevelProperties(o,s),o=p.readNodes(o,s,"data"),o.firstArrow=JXG.str2Bool(s.getElementsByTagName("lastarrow")[0].firstChild.data),o.lastArrow=JXG.str2Bool(s.getElementsByTagName("firstarrow")[0].firstChild.data),o=p.transformProperties(o),o.center=p.changeOriginIds(t,o.midpoint),o.angle=p.changeOriginIds(t,o.angle),o.radius=p.changeOriginIds(t,o.radius),l=t.create("arc",[o.center,o.radius,o.angle],o),p.printDebugMessage("debug",l,s.nodeName,"OK");break;case"angle":o=p.colorProperties(o,s),o=p.visualProperties(o,s),o=p.firstLevelProperties(o,s),o=p.readNodes(o,s,"data"),o=p.transformProperties(o),g=o.name;try{o.name=s.getElementsByTagName("text")[0].firstChild.data}catch(b){o.name=""}l=t.create("angle",[o.first,o.middle,o.last],o),l.setProperty({name:g}),p.printDebugMessage("debug",o,s.nodeName,"OK");break;case"text":if(o.id.match(/oldVersion/))break;o=p.colorProperties(o,s),o=p.visualProperties(o,s),o=p.firstLevelProperties(o,s),o=p.readNodes(o,s,"data");try{o.mpStr=p.subtreeToString(s.getElementsByTagName("data")[0].getElementsByTagName("mp")[0]),o.mpStr=o.mpStr.replace(/<\/?mp>/g,"")}catch(b){o.mpStr=p.subtreeToString(s.getElementsByTagName("data")[0].getElementsByTagName("content")[0]),o.mpStr=o.mpStr.replace(/<\/?content>/g,"")}o.fixed=!1;try{s.getElementsByTagName("data")[0].getElementsByTagName("parent")[0].firstChild&&(o.parent=s.getElementsByTagName("data")[0].getElementsByTagName("parent")[0].firstChild.data,o.fixed=!0)}catch(b){}try{o.condition=s.getElementsByTagName("condition")[0].firstChild.data}catch(b){o.condition=""}o.content=s.getElementsByTagName("content")[0].firstChild.data;try{o.fixed=s.getElementsByTagName("fix")[0].firstChild.data}catch(b){o.fixed=!1}try{o.autodigits=s.getElementsByTagName("digits")[0].firstChild.data}catch(b){o.autodigits=2}o.parent=p.changeOriginIds(t,o.parent),l=t.create("text",[o.x,o.y,o.mpStr],{anchor:o.parent,id:o.id,name:o.name,digits:o.autodigits,isLabel:!1,strokeColor:o.colorLabel,fixed:o.fixed,visible:JXG.str2Bool(o.visible)});break;case"parametercurve":o=p.colorProperties(o,s),o=p.visualProperties(o,s),o=p.firstLevelProperties(o,s),o=p.transformProperties(o),o.functionx=s.getElementsByTagName("functionx")[0].firstChild.data,o.functiony=s.getElementsByTagName("functiony")[0].firstChild.data,o.min=s.getElementsByTagName("min")[0].firstChild.data,o.max=s.getElementsByTagName("max")[0].firstChild.data,o.fillColor="none",o.highlightFillColor="none",t.create("curve",[new Function("t","return "+JXG.GeonextParser.geonext2JS(o.functionx,t)+";"),new Function("t","return "+JXG.GeonextParser.geonext2JS(o.functiony,t)+";"),new Function("return "+JXG.GeonextParser.geonext2JS(o.min,t)+";"),new Function("return "+JXG.GeonextParser.geonext2JS(o.max,t)+";")],o),p.printDebugMessage("debug",o,s.nodeName,"OK");break;case"tracecurve":o.tracepoint=s.getElementsByTagName("tracepoint")[0].firstChild.data,o.traceslider=s.getElementsByTagName("traceslider")[0].firstChild.data,t.create("tracecurve",[o.traceslider,o.tracepoint],o),p.printDebugMessage("debug",o,s.nodeName,"OK");break;case"group":o=p.colorProperties(o,s),o=p.firstLevelProperties(o,s),o.members=[];for(i=0;i<s.getElementsByTagName("data")[0].getElementsByTagName("member").length;i++)o.members[i]=s.getElementsByTagName("data")[0].getElementsByTagName("member")[i].firstChild.data,o.members[i]=p.changeOriginIds(t,o.members[i]);l=new JXG.Group(t,o.id,o.name,o.members),p.printDebugMessage("debug",o,s.nodeName,"OK");break;default:JXG.debug("* <b>Err:</b> "+s.nodeName+" not yet implemented <br>\n")}delete o})(i);t.addConditions(l)},decodeString:function(e){var t;return e.indexOf("<GEONEXT>")<0?(t=(new JXG.Util.Unzip(JXG.Util.Base64.decodeAsArray(e))).unzip(),t==""?e:t):e},prepareString:function(e){try{e.indexOf("GEONEXT")<0&&(e=this.decodeString(e)[0][0]),e=this.fixXML(e)}catch(t){e=""}return e},fixXML:function(e){var t=["active","angle","animate","animated","arc","area","arrow","author","autodigits","axis","back","background","board","border","bottom","buttonsize","cas","circle","color","comment","composition","condition","conditions","content","continuous","control","coord","coordinates","cross","cs","dash","data","description","digits","direction","draft","editable","elements","event","file","fill","first","firstarrow","fix","fontsize","free","full","function","functionx","functiony","GEONEXT","graph","grid","group","height","id","image","info","information","input","intersection","item","jsf","label","last","lastarrow","left","lefttoolbar","lighting","line","loop","max","maximized","member","middle","midpoint","min","modifier","modus","mp","mpx","multi","name","onpolygon","order","origin","output","overline","parametercurve","parent","point","pointsnap","polygon","position","radius","radiusnum","radiusvalue","right","section","selectedlefttoolbar","showconstruction","showcoord","showinfo","showunit","showx","showy","size","slider","snap","speed","src","start","stop","straight","stroke","strokewidth","style","term","text","top","trace","tracecurve","tracepoint","traceslider","type","unit","value","VERSION","vertex","viewport","visible","width","wot","x","xooy","xval","y","yval","zoom"],n=t.join("|"),r="&lt;(/?("+n+"))&gt;",i=new RegExp(r,"g");return e=JXG.escapeHTML(e),e=e.replace(i,"<$1>"),e=e.replace(/(<content>.*)<arc>(.*<\/content>)/g,"$1&lt;arc&gt;$2"),e=e.replace(/(<mp>.*)<arc>(.*<\/mpx>)/g,"$1&lt;arc&gt;$2"),e=e.replace(/(<mpx>.*)<arc>(.*<\/mpx>)/g,"$1&lt;arc&gt;$2"),e}};
