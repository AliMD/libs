var OpenLayers={VERSION_NUMBER:"Release 2.12",singleFile:!0,_getScriptLocation:function(){for(var e,t=/(^|(.*?\/))(OpenLayers[^\/]*?\.js)(\?|$)/,i=document.getElementsByTagName("script"),n="",r=0,o=i.length;o>r;r++)if((e=i[r].getAttribute("src"))&&(e=e.match(t))){n=e[1];break}return function(){return n}}(),ImgPath:""};OpenLayers.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return-1!=e.indexOf(t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var e=e.split("-"),t=e[0],i=1,n=e.length;n>i;i++)var r=e[i],t=t+(r.charAt(0).toUpperCase()+r.substring(1));return t},format:function(e,t,i){return t||(t=window),e.replace(OpenLayers.String.tokenRegEx,function(e,n){for(var r,o=n.split(/\.+/),s=0;o.length>s;s++)0==s&&(r=t),r=r[o[s]];return"function"==typeof r&&(r=i?r.apply(null,i):r()),r===void 0?"undefined":r})},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e){return OpenLayers.String.isNumeric(e)?parseFloat(e):e}},OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var i=0;return t>0&&(i=parseFloat(e.toPrecision(t))),i},format:function(e,t,i,n){t=t!==void 0?t:0,i=i!==void 0?i:OpenLayers.Number.thousandsSeparator,n=n!==void 0?n:OpenLayers.Number.decimalSeparator,null!=t&&(e=parseFloat(e.toFixed(t)));var r=(""+e).split(".");if(1==r.length&&null==t&&(t=0),e=r[0],i)for(var o=/(-?[0-9]+)([0-9]{3})/;o.test(e);)e=e.replace(o,"$1"+i+"$2");return 0==t?t=e:(i=r.length>1?r[1]:"0",null!=t&&(i+=Array(t-i.length+1).join("0")),t=e+n+i),t}},OpenLayers.Function={bind:function(e,t){var i=Array.prototype.slice.apply(arguments,[2]);return function(){var n=i.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,n)}},bindAsEventListener:function(e,t){return function(i){return e.call(t,i||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}},OpenLayers.Array={filter:function(e,t,i){var n=[];if(Array.prototype.filter)n=e.filter(t,i);else{var r=e.length;if("function"!=typeof t)throw new TypeError;for(var o=0;r>o;o++)if(o in e){var s=e[o];t.call(i,s,o,e)&&n.push(s)}}return n}},OpenLayers.Class=function(){var e=arguments.length,t=arguments[0],i=arguments[e-1],n="function"==typeof i.initialize?i.initialize:function(){t.prototype.initialize.apply(this,arguments)};return e>1?(e=[n,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),i),OpenLayers.inherit.apply(null,e)):n.prototype=i,n},OpenLayers.inherit=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i;var n,r,i=2;for(n=arguments.length;n>i;i++)r=arguments[i],"function"==typeof r&&(r=r.prototype),OpenLayers.Util.extend(e.prototype,r)},OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.extend=function(e,t){if(e=e||{},t){for(var i in t){var n=t[i];void 0!==n&&(e[i]=n)}!("function"==typeof window.Event&&t instanceof window.Event)&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e},OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,i,n){OpenLayers.Util.isArray(e)&&(n=e[3],i=e[2],t=e[1],e=e[0]),null!=e&&(this.left=OpenLayers.Util.toFloat(e)),null!=t&&(this.bottom=OpenLayers.Util.toFloat(t)),null!=i&&(this.right=OpenLayers.Util.toFloat(i)),null!=n&&(this.top=OpenLayers.Util.toFloat(n))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;return null!=e&&(t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom),t},toString:function(){return[this.left,this.bottom,this.right,this.top].join()},toArray:function(e){return!0===e?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var i=Math.pow(10,e),n=Math.round(this.left*i)/i,r=Math.round(this.bottom*i)/i,o=Math.round(this.right*i)/i,i=Math.round(this.top*i)/i;return!0===t?r+","+n+","+i+","+o:n+","+r+","+o+","+i},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){return this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var i,n;return"OpenLayers.LonLat"==t.CLASS_NAME?(i=t.lon,n=t.lat):(i=t.x,n=t.y),new OpenLayers.Bounds((this.left-i)*e+i,(this.bottom-n)*e+n,(this.right-i)*e+i,(this.top-n)*e+n)},add:function(e,t){if(null==e||null==t)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){var t=null;if(e){switch(e.CLASS_NAME){case"OpenLayers.LonLat":t=new OpenLayers.Bounds(e.lon,e.lat,e.lon,e.lat);break;case"OpenLayers.Geometry.Point":t=new OpenLayers.Bounds(e.x,e.y,e.x,e.y);break;case"OpenLayers.Bounds":t=e}t&&(this.centerLonLat=null,(null==this.left||t.left<this.left)&&(this.left=t.left),(null==this.bottom||t.bottom<this.bottom)&&(this.bottom=t.bottom),(null==this.right||t.right>this.right)&&(this.right=t.right),(null==this.top||t.top>this.top)&&(this.top=t.top))}},containsLonLat:function(e,t){"boolean"==typeof t&&(t={inclusive:t});var t=t||{},i=this.contains(e.lon,e.lat,t.inclusive),n=t.worldBounds;return n&&!i&&(i=n.getWidth(),n=Math.round((e.lon-(n.left+n.right)/2)/i),i=this.containsLonLat({lon:e.lon-n*i,lat:e.lat},{inclusive:t.inclusive})),i},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,i){if(null==i&&(i=!0),null==e||null==t)return!1;var e=OpenLayers.Util.toFloat(e),t=OpenLayers.Util.toFloat(t),n=!1;return n=i?e>=this.left&&this.right>=e&&t>=this.bottom&&this.top>=t:e>this.left&&this.right>e&&t>this.bottom&&this.top>t},intersectsBounds:function(e,t){if("boolean"==typeof t&&(t={inclusive:t}),t=t||{},t.worldBounds)var i=this.wrapDateLine(t.worldBounds),e=e.wrapDateLine(t.worldBounds);else i=this;null==t.inclusive&&(t.inclusive=!0);var n=!1,r=i.left==e.right||i.right==e.left||i.top==e.bottom||i.bottom==e.top;if(t.inclusive||!r)var n=e.top>=i.bottom&&e.top<=i.top||i.top>e.bottom&&i.top<e.top,r=e.left>=i.left&&e.left<=i.right||i.left>=e.left&&i.left<=e.right,o=e.right>=i.left&&e.right<=i.right||i.right>=e.left&&i.right<=e.right,n=(e.bottom>=i.bottom&&e.bottom<=i.top||i.bottom>=e.bottom&&i.bottom<=e.top||n)&&(r||o);if(t.worldBounds&&!n){var s=t.worldBounds,r=s.getWidth(),o=!s.containsBounds(i),s=!s.containsBounds(e);o&&!s?(e=e.add(-r,0),n=i.intersectsBounds(e,{inclusive:t.inclusive})):s&&!o&&(i=i.add(-r,0),n=e.intersectsBounds(i,{inclusive:t.inclusive}))}return n},containsBounds:function(e,t,i){null==t&&(t=!1),null==i&&(i=!0);var n=this.contains(e.left,e.bottom,i),r=this.contains(e.right,e.bottom,i),o=this.contains(e.left,e.top,i),e=this.contains(e.right,e.top,i);return t?n||r||o||e:n&&r&&o&&e},determineQuadrant:function(e){var t="",i=this.getCenterLonLat(),t=t+(e.lat<i.lat?"b":"t");return t+=e.lon<i.lon?"l":"r"},transform:function(e,t){this.centerLonLat=null;var i=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),n=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),r=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),o=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);return this.left=Math.min(i.x,r.x),this.bottom=Math.min(i.y,n.y),this.right=Math.max(n.x,o.x),this.top=Math.max(r.y,o.y),this},wrapDateLine:function(e,t){var t=t||{},i=t.leftTolerance||0,n=t.rightTolerance||0,r=this.clone();if(e){for(var o=e.getWidth();r.left<e.left&&r.right-n<=e.left;)r=r.add(o,0);for(;r.left+i>=e.right&&r.right>e.right;)r=r.add(-o,0);i=r.left+i,e.right>i&&i>e.left&&r.right-n>e.right&&(r=r.add(-o,0))}return r},CLASS_NAME:"OpenLayers.Bounds"}),OpenLayers.Bounds.fromString=function(e,t){var i=e.split(",");return OpenLayers.Bounds.fromArray(i,t)},OpenLayers.Bounds.fromArray=function(e,t){return!0===t?new OpenLayers.Bounds(e[1],e[0],e[3],e[2]):new OpenLayers.Bounds(e[0],e[1],e[2],e[3])},OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)},OpenLayers.Bounds.oppositeQuadrant=function(e){var t;return t=""+("t"==e.charAt(0)?"b":"t"),t+="l"==e.charAt(1)?"r":"l"},OpenLayers.Element={visible:function(e){return"none"!=OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;t>e;e++){var i=OpenLayers.Util.getElement(arguments[e]),n=OpenLayers.Element.visible(i)?"none":"";i.style.display=n}},remove:function(e){e=OpenLayers.Util.getElement(e),e.parentNode.removeChild(e)},getHeight:function(e){return e=OpenLayers.Util.getElement(e),e.offsetHeight},hasClass:function(e,t){var i=e.className;return!!i&&RegExp("(^|\\s)"+t+"(\\s|$)").test(i)},addClass:function(e,t){return OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t),e},removeClass:function(e,t){var i=e.className;return i&&(e.className=OpenLayers.String.trim(i.replace(RegExp("(^|\\s+)"+t+"(\\s+|$)")," "))),e},toggleClass:function(e,t){return OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t),e},getStyle:function(e,t){var e=OpenLayers.Util.getElement(e),i=null;if(e&&e.style){i=e.style[OpenLayers.String.camelize(t)],i||(document.defaultView&&document.defaultView.getComputedStyle?i=(i=document.defaultView.getComputedStyle(e,null))?i.getPropertyValue(t):null:e.currentStyle&&(i=e.currentStyle[OpenLayers.String.camelize(t)]));var n=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(n,t)&&"static"==OpenLayers.Element.getStyle(e,"position")&&(i="auto")}return"auto"==i?null:i}},OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){OpenLayers.Util.isArray(e)&&(t=e[1],e=e[0]),this.lon=OpenLayers.Util.toFloat(e),this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;return null!=e&&(t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat)),t},transform:function(e,t){var i=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);return this.lon=i.x,this.lat=i.y,this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"}),OpenLayers.LonLat.fromString=function(e){return e=e.split(","),new OpenLayers.LonLat(e[0],e[1])},OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e);return new OpenLayers.LonLat(t&&e[0],t&&e[1])},OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e),this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();return e&&(t=this.add(e.x,e.y)),t},CLASS_NAME:"OpenLayers.Pixel"}),OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e),this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;return null!=e&&(t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h)),t},CLASS_NAME:"OpenLayers.Size"}),OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"},function(){for(var e=document.getElementsByTagName("script"),t=0,i=e.length;i>t;++t)if(-1!=e[t].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}(),OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){return OpenLayers.Lang.code||OpenLayers.Lang.setCode(),OpenLayers.Lang.code},setCode:function(e){var t;if(e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language),e=e.split("-"),e[0]=e[0].toLowerCase(),"object"==typeof OpenLayers.Lang[e[0]]&&(t=e[0]),e[1]){var i=e[0]+"-"+e[1].toUpperCase();"object"==typeof OpenLayers.Lang[i]&&(t=i)}t||(OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+e.join("-")+" dictionary, falling back to default language"),t=OpenLayers.Lang.defaultCode),OpenLayers.Lang.code=t},translate:function(e,t){var i=OpenLayers.Lang[OpenLayers.Lang.getCode()];return(i=i&&i[e])||(i=e),t&&(i=OpenLayers.String.format(i,t)),i}},OpenLayers.i18n=OpenLayers.Lang.translate,OpenLayers.Util=OpenLayers.Util||{},OpenLayers.Util.getElement=function(){for(var e=[],t=0,i=arguments.length;i>t;t++){var n=arguments[t];if("string"==typeof n&&(n=document.getElementById(n)),1==arguments.length)return n;e.push(n)}return e},OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)},OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},window.$===void 0&&(window.$=OpenLayers.Util.getElement),OpenLayers.Util.removeItem=function(e,t){for(var i=e.length-1;i>=0;i--)e[i]==t&&e.splice(i,1);return e},OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;n>i;i++)if(e[i]==t)return i;return-1},OpenLayers.Util.modifyDOMElement=function(e,t,i,n,r,o,s,a){t&&(e.id=t),i&&(e.style.left=i.x+"px",e.style.top=i.y+"px"),n&&(e.style.width=n.w+"px",e.style.height=n.h+"px"),r&&(e.style.position=r),o&&(e.style.border=o),s&&(e.style.overflow=s),parseFloat(a)>=0&&1>parseFloat(a)?(e.style.filter="alpha(opacity="+100*a+")",e.style.opacity=a):1==parseFloat(a)&&(e.style.filter="",e.style.opacity="")},OpenLayers.Util.createDiv=function(e,t,i,n,r,o,s,a){var l=document.createElement("div");return n&&(l.style.backgroundImage="url("+n+")"),e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),r||(r="absolute"),OpenLayers.Util.modifyDOMElement(l,e,t,i,r,o,s,a),l},OpenLayers.Util.createImage=function(e,t,i,n,r,o,s,a){var l=document.createElement("img");return e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv")),r||(r="relative"),OpenLayers.Util.modifyDOMElement(l,e,t,i,r,o,null,s),a&&(l.style.display="none",t=function(){l.style.display="",OpenLayers.Event.stopObservingElement(l)},OpenLayers.Event.observe(l,"load",t),OpenLayers.Event.observe(l,"error",t)),l.style.alt=e,l.galleryImg="no",n&&(l.src=n),l},OpenLayers.IMAGE_RELOAD_ATTEMPTS=0,OpenLayers.Util.alphaHackNeeded=null,OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),e=parseFloat(e[1]),t=!1;try{t=!!document.body.filters}catch(i){}OpenLayers.Util.alphaHackNeeded=t&&e>=5.5&&7>e}return OpenLayers.Util.alphaHackNeeded},OpenLayers.Util.modifyAlphaImageDiv=function(e,t,i,n,r,o,s,a,l){OpenLayers.Util.modifyDOMElement(e,t,i,n,o,null,null,l),t=e.childNodes[0],r&&(t.src=r),OpenLayers.Util.modifyDOMElement(t,e.id+"_innerImage",null,n,"relative",s),OpenLayers.Util.alphaHack()&&("none"!=e.style.display&&(e.style.display="inline-block"),null==a&&(a="scale"),e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+t.src+"', sizingMethod='"+a+"')",parseFloat(e.style.opacity)>=0&&1>parseFloat(e.style.opacity)&&(e.style.filter=e.style.filter+(" alpha(opacity="+100*e.style.opacity+")")),t.style.filter="alpha(opacity=0)")},OpenLayers.Util.createAlphaImageDiv=function(e,t,i,n,r,o,s,a,l){var h=OpenLayers.Util.createDiv(),l=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l);return l.className="olAlphaImg",h.appendChild(l),OpenLayers.Util.modifyAlphaImageDiv(h,e,t,i,n,r,o,s,a),h},OpenLayers.Util.upperCaseObject=function(e){var t,i={};for(t in e)i[t.toUpperCase()]=e[t];return i},OpenLayers.Util.applyDefaults=function(e,t){var i,e=e||{},n="function"==typeof window.Event&&t instanceof window.Event;for(i in t)(void 0===e[i]||!n&&t.hasOwnProperty&&t.hasOwnProperty(i)&&!e.hasOwnProperty(i))&&(e[i]=t[i]);return!n&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e},OpenLayers.Util.getParameterString=function(e){var t,i=[];for(t in e){var n=e[t];if(null!=n&&"function"!=typeof n){if("object"==typeof n&&n.constructor==Array){for(var r,o=[],s=0,a=n.length;a>s;s++)r=n[s],o.push(encodeURIComponent(null===r||void 0===r?"":r));n=o.join(",")}else n=encodeURIComponent(n);i.push(encodeURIComponent(t)+"="+n)}}return i.join("&")},OpenLayers.Util.urlAppend=function(e,t){var i=e;if(t)var n=(e+" ").split(/[?&]/),i=i+(" "===n.pop()?t:n.length?"&"+t:"?"+t);return i},OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"},OpenLayers.Util.getImageLocation=function(e){return OpenLayers.Util.getImagesLocation()+e},OpenLayers.Util.Try=function(){for(var e=null,t=0,i=arguments.length;i>t;t++){var n=arguments[t];try{e=n();break}catch(r){}}return e},OpenLayers.Util.getXmlNodeValue=function(e){var t=null;return OpenLayers.Util.Try(function(){t=e.text,t||(t=e.textContent),t||(t=e.firstChild.nodeValue)},function(){t=e.textContent}),t},OpenLayers.Util.mouseLeft=function(e,t){for(var i=e.relatedTarget?e.relatedTarget:e.toElement;i!=t&&null!=i;)i=i.parentNode;return i!=t},OpenLayers.Util.DEFAULT_PRECISION=14,OpenLayers.Util.toFloat=function(e,t){return null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION),"number"!=typeof e&&(e=parseFloat(e)),0===t?e:parseFloat(e.toPrecision(t))},OpenLayers.Util.rad=function(e){return e*Math.PI/180},OpenLayers.Util.deg=function(e){return 180*e/Math.PI},OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563},OpenLayers.Util.distVincenty=function(e,t){for(var i=OpenLayers.Util.VincentyConstants,n=i.a,r=i.b,i=i.f,o=OpenLayers.Util.rad(t.lon-e.lon),s=Math.atan((1-i)*Math.tan(OpenLayers.Util.rad(e.lat))),a=Math.atan((1-i)*Math.tan(OpenLayers.Util.rad(t.lat))),l=Math.sin(s),s=Math.cos(s),h=Math.sin(a),a=Math.cos(a),c=o,u=2*Math.PI,d=20;Math.abs(c-u)>1e-12&&--d>0;){var p=Math.sin(c),f=Math.cos(c),m=Math.sqrt(a*p*a*p+(s*h-l*a*f)*(s*h-l*a*f));if(0==m)return 0;var f=l*h+s*a*f,g=Math.atan2(m,f),y=Math.asin(s*a*p/m),v=Math.cos(y)*Math.cos(y),p=f-2*l*h/v,b=i/16*v*(4+i*(4-3*v)),u=c,c=o+(1-b)*i*Math.sin(y)*(g+b*m*(p+b*f*(-1+2*p*p)))}return 0==d?0/0:(n=v*(n*n-r*r)/(r*r),i=n/1024*(256+n*(-128+n*(74-47*n))),(r*(1+n/16384*(4096+n*(-768+n*(320-175*n))))*(g-i*m*(p+i/4*(f*(-1+2*p*p)-i/6*p*(-3+4*m*m)*(-3+4*p*p))))).toFixed(3)/1e3)},OpenLayers.Util.destinationVincenty=function(e,t,i){for(var n=OpenLayers.Util,r=n.VincentyConstants,o=r.a,s=r.b,a=r.f,r=e.lon,e=e.lat,l=n.rad(t),t=Math.sin(l),l=Math.cos(l),e=(1-a)*Math.tan(n.rad(e)),h=1/Math.sqrt(1+e*e),c=e*h,u=Math.atan2(e,l),e=h*t,d=1-e*e,o=d*(o*o-s*s)/(s*s),p=1+o/16384*(4096+o*(-768+o*(320-175*o))),f=o/1024*(256+o*(-128+o*(74-47*o))),o=i/(s*p),m=2*Math.PI;Math.abs(o-m)>1e-12;)var g=Math.cos(2*u+o),y=Math.sin(o),v=Math.cos(o),b=f*y*(g+f/4*(v*(-1+2*g*g)-f/6*g*(-3+4*y*y)*(-3+4*g*g))),m=o,o=i/(s*p)+b;return i=c*y-h*v*l,s=Math.atan2(c*v+h*y*l,(1-a)*Math.sqrt(e*e+i*i)),t=Math.atan2(y*t,h*v-c*y*l),l=a/16*d*(4+a*(4-3*d)),g=t-(1-l)*a*e*(o+l*y*(g+l*v*(-1+2*g*g))),Math.atan2(e,-i),new OpenLayers.LonLat(r+n.deg(g),n.deg(s))},OpenLayers.Util.getParameters=function(e){var e=null===e||void 0===e?window.location.href:e,t="";if(OpenLayers.String.contains(e,"?"))var t=e.indexOf("?")+1,i=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length,t=e.substring(t,i);for(var e={},t=t.split(/[&;]/),i=0,n=t.length;n>i;++i){var r=t[i].split("=");if(r[0]){var o=r[0];try{o=decodeURIComponent(o)}catch(s){o=unescape(o)}r=(r[1]||"").replace(/\+/g," ");try{r=decodeURIComponent(r)}catch(a){r=unescape(r)}r=r.split(","),1==r.length&&(r=r[0]),e[o]=r}}return e},OpenLayers.Util.lastSeqID=0,OpenLayers.Util.createUniqueID=function(e){return null==e&&(e="id_"),OpenLayers.Util.lastSeqID=OpenLayers.Util.lastSeqID+1,e+OpenLayers.Util.lastSeqID},OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36},OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches,OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd,OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m,OpenLayers.METERS_PER_INCH=.0254000508001016,OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH}),OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH}),OpenLayers.DOTS_PER_INCH=72,OpenLayers.Util.normalizeScale=function(e){return e>1?1/e:e},OpenLayers.Util.getResolutionFromScale=function(e,t){var i;return e&&(null==t&&(t="degrees"),i=1/(OpenLayers.Util.normalizeScale(e)*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)),i},OpenLayers.Util.getScaleFromResolution=function(e,t){return null==t&&(t="degrees"),e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH},OpenLayers.Util.pagePosition=function(e){var t=[0,0],i=OpenLayers.Util.getViewportElement();if(!e||e==window||e==i)return t;var n=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),r=null;if(e.getBoundingClientRect)e=e.getBoundingClientRect(),r=i.scrollTop,t[0]=e.left+i.scrollLeft,t[1]=e.top+r;else if(document.getBoxObjectFor&&!n)e=document.getBoxObjectFor(e),i=document.getBoxObjectFor(i),t[0]=e.screenX-i.screenX,t[1]=e.screenY-i.screenY;else{if(t[0]=e.offsetLeft,t[1]=e.offsetTop,r=e.offsetParent,r!=e)for(;r;)t[0]=t[0]+r.offsetLeft,t[1]=t[1]+r.offsetTop,r=r.offsetParent;for(i=OpenLayers.BROWSER_NAME,("opera"==i||"safari"==i&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]=t[1]-document.body.offsetTop),r=e.offsetParent;r&&r!=document.body;)t[0]=t[0]-r.scrollLeft,("opera"!=i||"TR"!=r.tagName)&&(t[1]=t[1]-r.scrollTop),r=r.offsetParent}return t},OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;return void 0==e&&(e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement,arguments.callee.viewportElement=e),e},OpenLayers.Util.isEquivalentUrl=function(e,t,i){i=i||{},OpenLayers.Util.applyDefaults(i,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0});var n,e=OpenLayers.Util.createUrlObject(e,i),t=OpenLayers.Util.createUrlObject(t,i);for(n in e)if("args"!==n&&e[n]!=t[n])return!1;for(n in e.args){if(e.args[n]!=t.args[n])return!1;delete t.args[n]}for(n in t.args)return!1;return!0},OpenLayers.Util.createUrlObject=function(e,t){if(t=t||{},!/^\w+:\/\//.test(e)){var i=window.location,n=i.port?":"+i.port:"",n=i.protocol+"//"+i.host.split(":").shift()+n;0===e.indexOf("/")?e=n+e:(i=i.pathname.split("/"),i.pop(),e=n+i.join("/")+"/"+e)}t.ignoreCase&&(e=e.toLowerCase()),i=document.createElement("a"),i.href=e,n={},n.host=i.host.split(":").shift(),n.protocol=i.protocol,n.port=t.ignorePort80?"80"==i.port||"0"==i.port?"":i.port:""==i.port||"0"==i.port?"80":i.port,n.hash=t.ignoreHash||"#"===i.hash?"":i.hash;var r=i.search;return r||(r=e.indexOf("?"),r=-1!=r?e.substr(r):""),n.args=OpenLayers.Util.getParameters(r),n.pathname="/"==i.pathname.charAt(0)?i.pathname:"/"+i.pathname,n},OpenLayers.Util.removeTail=function(e){var t=null,t=e.indexOf("?"),i=e.indexOf("#");return t=-1==t?-1!=i?e.substr(0,i):e:-1!=i?e.substr(0,Math.min(t,i)):e.substr(0,t)},OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("webkit")&&-1!=e.indexOf("gecko")}(),OpenLayers.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();return-1!=t.indexOf("opera")?e="opera":-1!=t.indexOf("msie")?e="msie":-1!=t.indexOf("safari")?e="safari":-1!=t.indexOf("mozilla")&&(e=-1!=t.indexOf("firefox")?"firefox":"mozilla"),e}(),OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME},OpenLayers.Util.getRenderedDimensions=function(e,t,i){var n,r,o=document.createElement("div");o.style.visibility="hidden";for(var s=i&&i.containerElement?i.containerElement:document.body,a=!1,l=null,h=s;h&&"body"!=h.tagName.toLowerCase();){var c=OpenLayers.Element.getStyle(h,"position");if("absolute"==c){a=!0;break}if(c&&"static"!=c)break;h=h.parentNode}if(!a||0!==s.clientHeight&&0!==s.clientWidth||(l=document.createElement("div"),l.style.visibility="hidden",l.style.position="absolute",l.style.overflow="visible",l.style.width=document.body.clientWidth+"px",l.style.height=document.body.clientHeight+"px",l.appendChild(o)),o.style.position="absolute",t&&(t.w?(n=t.w,o.style.width=n+"px"):t.h&&(r=t.h,o.style.height=r+"px")),i&&i.displayClass&&(o.className=i.displayClass),t=document.createElement("div"),t.innerHTML=e,t.style.overflow="visible",t.childNodes)for(e=0,i=t.childNodes.length;i>e;e++)t.childNodes[e].style&&(t.childNodes[e].style.overflow="visible");return o.appendChild(t),l?s.appendChild(l):s.appendChild(o),n||(n=parseInt(t.scrollWidth),o.style.width=n+"px"),r||(r=parseInt(t.scrollHeight)),o.removeChild(t),l?(l.removeChild(o),s.removeChild(l)):s.removeChild(o),new OpenLayers.Size(n,r)},OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t=null,i=null,t=e=0,t=document.createElement("div");t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.width="100px",t.style.height="50px",t.style.overflow="hidden",i=document.createElement("div"),i.style.width="100%",i.style.height="200px",t.appendChild(i),document.body.appendChild(t),e=i.offsetWidth,t.style.overflow="scroll",t=i.offsetWidth,document.body.removeChild(document.body.lastChild),OpenLayers.Util._scrollbarWidth=e-t,e=OpenLayers.Util._scrollbarWidth}return e},OpenLayers.Util.getFormattedLonLat=function(e,t,i){i||(i="dms");var e=(e+540)%360-180,n=Math.abs(e),r=Math.floor(n),o=n=(n-r)/(1/60),n=Math.floor(n),o=Math.round(10*((o-n)/(1/60))),o=o/10;return o>=60&&(o-=60,n+=1,n>=60&&(n-=60,r+=1)),10>r&&(r="0"+r),r+="°",i.indexOf("dm")>=0&&(10>n&&(n="0"+n),r+=n+"'",i.indexOf("dms")>=0&&(10>o&&(o="0"+o),r+=o+'"')),r="lon"==t?r+(0>e?OpenLayers.i18n("W"):OpenLayers.i18n("E")):r+(0>e?OpenLayers.i18n("S"):OpenLayers.i18n("N"))},OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1==e.touches.length},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},isRightClick:function(e){return e.which&&3==e.which||e.button&&2==e.button},stop:function(e,t){t||(e.preventDefault?e.preventDefault():e.returnValue=!1),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},findElement:function(e,t){for(var i=OpenLayers.Event.element(e);i.parentNode&&(!i.tagName||i.tagName.toUpperCase()!=t.toUpperCase());)i=i.parentNode;return i},observe:function(e,t,i,n){if(e=OpenLayers.Util.getElement(e),n=n||!1,"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.attachEvent)&&(t="keydown"),this.observers||(this.observers={}),!e._eventCacheID){var r="eventCacheID_";e.id&&(r=e.id+"_"+r),e._eventCacheID=OpenLayers.Util.createUniqueID(r)}r=e._eventCacheID,this.observers[r]||(this.observers[r]=[]),this.observers[r].push({element:e,name:t,observer:i,useCapture:n}),e.addEventListener?e.addEventListener(t,i,n):e.attachEvent&&e.attachEvent("on"+t,i)
},stopObservingElement:function(e){e=OpenLayers.Util.getElement(e)._eventCacheID,this._removeElementObservers(OpenLayers.Event.observers[e])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--){var i=e[t];OpenLayers.Event.stopObserving.apply(this,[i.element,i.name,i.observer,i.useCapture])}},stopObserving:function(e,t,i,n){var n=n||!1,e=OpenLayers.Util.getElement(e),r=e._eventCacheID;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||e.detachEvent)&&(t="keydown");var o=!1,s=OpenLayers.Event.observers[r];if(s)for(var a=0;!o&&s.length>a;){var l=s[a];if(l.name==t&&l.observer==i&&l.useCapture==n){s.splice(a,1),0==s.length&&delete OpenLayers.Event.observers[r],o=!0;break}a++}return o&&(e.removeEventListener?e.removeEventListener(t,i,n):e&&e.detachEvent&&e.detachEvent("on"+t,i)),o},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers)OpenLayers.Event._removeElementObservers.apply(this,[OpenLayers.Event.observers[e]]);OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"},OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1),OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:"mouseover mouseout mousedown mouseup mousemove click dblclick rightclick dblrightclick resize focus blur touchstart touchmove touchend keydown".split(" "),listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,i,n,r){OpenLayers.Util.extend(this,r),this.object=e,this.fallThrough=n,this.listeners={},this.extensions={},this.extensionCount={},null!=t&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null,this.element&&(OpenLayers.Event.stopObservingElement(this.element),this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)),this.eventHandler=this.fallThrough=this.object=this.listeners=this.element=null},addEventType:function(){},attachToElement:function(e){this.element?OpenLayers.Event.stopObservingElement(this.element):(this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this),this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)),this.element=e;for(var t=0,i=this.BROWSER_EVENTS.length;i>t;t++)OpenLayers.Event.observe(e,this.BROWSER_EVENTS[t],this.eventHandler);OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,i,n){if(e in OpenLayers.Events&&!this.extensions[e]&&(this.extensions[e]=new OpenLayers.Events[e](this)),null!=i){null==t&&(t=this.object);var r=this.listeners[e];r||(r=[],this.listeners[e]=r,this.extensionCount[e]=0),t={obj:t,func:i},n?(r.splice(this.extensionCount[e],0,t),"object"==typeof n&&n.extension&&this.extensionCount[e]++):r.push(t)}},registerPriority:function(e,t,i){this.register(e,t,i,!0)},un:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,i){if(null==t&&(t=this.object),e=this.listeners[e],null!=e)for(var n=0,r=e.length;r>n;n++)if(e[n].obj==t&&e[n].func==i){e.splice(n,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var i=this.listeners[e];if(i&&0!=i.length){null==t&&(t={}),t.object=this.object,t.element=this.element,t.type||(t.type=e);for(var n,i=i.slice(),r=0,o=i.length;o>r&&(n=i[r],n=n.func.apply(n.obj,[t]),!(void 0!=n&&!1==n));r++);return this.fallThrough||OpenLayers.Event.stop(t,!0),n}},handleBrowserEvent:function(e){var t=e.type,i=this.listeners[t];if(i&&0!=i.length){if((i=e.touches)&&i[0]){for(var n,r=0,o=0,s=i.length,a=0;s>a;++a)n=i[a],r+=n.clientX,o+=n.clientY;e.clientX=r/s,e.clientY=o/s}this.includeXY&&(e.xy=this.getMousePosition(e)),this.triggerEvent(t,e)}},clearMouseCache:function(){this.element.scrolls=null,this.element.lefttop=null;var e=document.body;e&&(0==e.scrollTop&&0==e.scrollLeft||!navigator.userAgent.match(/iPhone/i))&&(this.element.offsets=null)},getMousePosition:function(e){if(this.includeXY?this.element.hasScrollEvent||(OpenLayers.Event.observe(window,"scroll",this.clearMouseListener),this.element.hasScrollEvent=!0):this.clearMouseCache(),!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[t.scrollLeft,t.scrollTop]}return this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]),this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element)),new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},CLASS_NAME:"OpenLayers.Events"}),OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:"mousedown mouseup click dblclick touchstart touchmove touchend keydown".split(" "),startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(e){for(this.target=e,e=this.events.length-1;e>=0;--e)this.target.register(this.events[e],this,this.buttonClick,{extension:!0})},destroy:function(){for(var e=this.events.length-1;e>=0;--e)this.target.unregister(this.events[e],this,this.buttonClick);delete this.target},getPressedButton:function(e){var t,i=3;do{if(OpenLayers.Element.hasClass(e,"olButton")){t=e;break}e=e.parentNode}while(--i>0&&e);return t},buttonClick:function(e){var t=!0,i=OpenLayers.Event.element(e);if(i&&(OpenLayers.Event.isLeftClick(e)||!~e.type.indexOf("mouse")))if(i=this.getPressedButton(i)){if("keydown"===e.type)switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:i}),OpenLayers.Event.stop(e),t=!1}else this.startEvt&&(this.completeRegEx.test(e.type)&&(t=OpenLayers.Util.pagePosition(i),this.target.triggerEvent("buttonclick",{buttonElement:i,buttonXY:{x:this.startEvt.clientX-t[0],y:this.startEvt.clientY-t[1]}})),this.cancelRegEx.test(e.type)&&delete this.startEvt,OpenLayers.Event.stop(e),t=!1);this.startRegEx.test(e.type)&&(this.startEvt=e,OpenLayers.Event.stop(e),t=!1)}else delete this.startEvt;return t}}),OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handler:null,eventListeners:null,events:null,initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,""),OpenLayers.Util.extend(this,e),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null),this.eventListeners=null,this.handler&&(this.handler.destroy(),this.handler=null),this.handlers){for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&"function"==typeof this.handlers[e].destroy&&this.handlers[e].destroy();this.handlers=null}this.map&&(this.map.removeControl(this),this.map=null),this.div=null},setMap:function(e){this.map=e,this.handler&&this.handler.setMap(e)},draw:function(e){return null==this.div&&(this.div=OpenLayers.Util.createDiv(this.id),this.div.className=this.displayClass,this.allowSelection||(this.div.className+=" olControlNoSelect",this.div.setAttribute("unselectable","on",0),this.div.onselectstart=OpenLayers.Function.False),""!=this.title)&&(this.div.title=this.title),null!=e&&(this.position=e.clone()),this.moveTo(this.position),this.div},moveTo:function(e){null!=e&&null!=this.div&&(this.div.style.left=e.x+"px",this.div.style.top=e.y+"px")},activate:function(){return this.active?!1:(this.handler&&this.handler.activate(),this.active=!0,this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("activate"),!0)},deactivate:function(){return this.active?(this.handler&&this.handler.deactivate(),this.active=!1,this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active"),this.events.triggerEvent("deactivate"),!0):!1},CLASS_NAME:"OpenLayers.Control"}),OpenLayers.Control.TYPE_BUTTON=1,OpenLayers.Control.TYPE_TOGGLE=2,OpenLayers.Control.TYPE_TOOL=3,OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.bounds=this.id=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null,this.parent&&this.parent.clearBounds()},extendBounds:function(e){this.getBounds()?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){return null==this.bounds&&this.calculateBounds(),this.bounds},calculateBounds:function(){},distanceTo:function(){},getVertices:function(){},atPoint:function(e,t,i){var n=!1;return null!=this.getBounds()&&null!=e&&(t=null!=t?t:0,i=null!=i?i:0,n=new OpenLayers.Bounds(this.bounds.left-t,this.bounds.bottom-i,this.bounds.right+t,this.bounds.top+i).containsLonLat(e)),n},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Geometry"}),OpenLayers.Geometry.fromWKT=function(e){var t;if(OpenLayers.Format&&OpenLayers.Format.WKT){var i=OpenLayers.Geometry.fromWKT.format;if(i||(i=new OpenLayers.Format.WKT,OpenLayers.Geometry.fromWKT.format=i),e=i.read(e),e instanceof OpenLayers.Feature.Vector)t=e.geometry;else if(OpenLayers.Util.isArray(e)){t=e.length;for(var i=Array(t),n=0;t>n;++n)i[n]=e[n].geometry;t=new OpenLayers.Geometry.Collection(i)}}return t},OpenLayers.Geometry.segmentsIntersect=function(e,t,i){var n=i&&i.point,i=i&&i.tolerance,r=!1,o=e.x1-t.x1,s=e.y1-t.y1,a=e.x2-e.x1,l=e.y2-e.y1,h=t.y2-t.y1,c=t.x2-t.x1,u=h*a-c*l,h=c*s-h*o,s=a*s-l*o;if(0==u?0==h&&0==s&&(r=!0):(o=h/u,u=s/u,o>=0&&1>=o&&u>=0&&1>=u&&(n?(a=e.x1+o*a,u=e.y1+o*l,r=new OpenLayers.Geometry.Point(a,u)):r=!0)),i)if(r){if(n){e=[e,t],t=0;e:for(;2>t;++t)for(o=e[t],l=1;3>l;++l)if(a=o["x"+l],u=o["y"+l],n=Math.sqrt(Math.pow(a-r.x,2)+Math.pow(u-r.y,2)),i>n){r.x=a,r.y=u;break e}}}else{e=[e,t],t=0;e:for(;2>t;++t)for(a=e[t],u=e[(t+1)%2],l=1;3>l;++l)if(o={x:a["x"+l],y:a["y"+l]},s=OpenLayers.Geometry.distanceToSegment(o,u),i>s.distance){r=n?new OpenLayers.Geometry.Point(o.x,o.y):!0;break e}}return r},OpenLayers.Geometry.distanceToSegment=function(e,t){var i=e.x,n=e.y,r=t.x1,o=t.y1,s=t.x2,a=t.y2,l=s-r,h=a-o,c=(l*(i-r)+h*(n-o))/(Math.pow(l,2)+Math.pow(h,2));return 0>=c||(c>=1?(r=s,o=a):(r+=c*l,o+=c*h)),{distance:Math.sqrt(Math.pow(r-i,2)+Math.pow(o-n,2)),x:r,y:o}},OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.components=[],null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0,this.components=null,OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var a=eval("new "+this.CLASS_NAME+"()"),b=0,c=this.components.length;c>b;b++)a.addComponent(this.components[b].clone());return OpenLayers.Util.applyDefaults(a,this),a},getComponentsString:function(){for(var e=[],t=0,i=this.components.length;i>t;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var i=0,n=t.length;n>i;i++)e.extend(t[i].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;i>t;t++)this.addComponent(e[t])},addComponent:function(e,t){var i=!1;if(e&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1)){if(null!=t&&this.components.length>t){var i=this.components.slice(0,t),n=this.components.slice(t,this.components.length);i.push(e),this.components=i.concat(n)}else this.components.push(e);e.parent=this,this.clearBounds(),i=!0}return i},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var i=e.length-1;i>=0;--i)t=this.removeComponent(e[i])||t;return t},removeComponent:function(e){return OpenLayers.Util.removeItem(this.components,e),this.clearBounds(),!0},getLength:function(){for(var e=0,t=0,i=this.components.length;i>t;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,i=this.components.length;i>t;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,i=0,n=this.components.length;n>i;i++)t+=this.components[i].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();if(e=this.components.length,!e)return!1;for(var t,i=[],n=[],r=0,o=Number.MAX_VALUE,s=0;e>s;++s){t=this.components[s];var a=t.getArea();t=t.getCentroid(!0),!isNaN(a)&&!isNaN(t.x)&&!isNaN(t.y)&&(i.push(a),r+=a,o=o>a&&a>0?a:o,n.push(t))}if(e=i.length,0===r){for(s=0;e>s;++s)i[s]=1;r=i.length}else{for(s=0;e>s;++s)i[s]/=o;r/=o}for(var l=o=0,s=0;e>s;++s)t=n[s],a=i[s],o+=t.x*a,l+=t.y*a;return new OpenLayers.Geometry.Point(o/r,l/r)},getGeodesicLength:function(e){for(var t=0,i=0,n=this.components.length;n>i;i++)t+=this.components[i].getGeodesicLength(e);return t},move:function(e,t){for(var i=0,n=this.components.length;n>i;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;n>i;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0;this.components.length>n;++n)this.components[n].resize(e,t,i);return this},distanceTo:function(e,t){for(var i,n,r,o=!(t&&!1===t.edge)&&t&&t.details,s=Number.POSITIVE_INFINITY,a=0,l=this.components.length;l>a&&(i=this.components[a].distanceTo(e,t),r=o?i.distance:i,!(s>r&&(s=r,n=i,0==s)));++a);return n},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var i=0,n=this.components.length;n>i;++i)if(!this.components[i].equals(e.components[i])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;n>i;i++)this.components[i].transform(e,t);this.bounds=null}return this},intersects:function(e){for(var t=!1,i=0,n=this.components.length;n>i&&!(t=e.intersects(this.components[i]));++i);return t},getVertices:function(e){for(var t=[],i=0,n=this.components.length;n>i;++i)Array.prototype.push.apply(t,this.components[i].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"}),OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments),this.x=parseFloat(e),this.y=parseFloat(t)},clone:function(e){return null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y)),OpenLayers.Util.applyDefaults(e,this),e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var i,n,r,o,s,a=!(t&&!1===t.edge)&&t&&t.details;return e instanceof OpenLayers.Geometry.Point?(n=this.x,r=this.y,o=e.x,s=e.y,i=Math.sqrt(Math.pow(n-o,2)+Math.pow(r-s,2)),i=a?{x0:n,y0:r,x1:o,y1:s,distance:i}:i):(i=e.distanceTo(this,t),a&&(i={x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0,distance:i.distance})),i},equals:function(e){var t=!1;return null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y)),t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x+=e,this.y+=t,this.clearBounds()},rotate:function(e,t){var e=e*(Math.PI/180),i=this.distanceTo(t),n=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+i*Math.cos(n),this.y=t.y+i*Math.sin(n),this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,i){return this.x=t.x+e*(void 0==i?1:i)*(this.x-t.x),this.y=t.y+e*(this.y-t.y),this.clearBounds(),this},intersects:function(e){var t=!1;return t="OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this)},transform:function(e,t){return e&&t&&(OpenLayers.Projection.transform(this,e,t),this.bounds=null),this},getVertices:function(){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"}),OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"}),OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&this.components.length>1)for(var t=1,i=this.components.length;i>t;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}if(e=0,t.components&&t.components.length>1)for(var n,r=1,o=t.components.length;o>r;r++)i=t.components[r-1],n=t.components[r],e+=OpenLayers.Util.distVincenty({lon:i.x,lat:i.y},{lon:n.x,lat:n.y});return 1e3*e},CLASS_NAME:"OpenLayers.Geometry.Curve"}),OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(){var e=this.components&&this.components.length>2;return e&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),e},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==i||"OpenLayers.Geometry.LinearRing"==i||"OpenLayers.Geometry.Point"==i){var n,r,o,s,a,l,h,c=this.getSortedSegments(),e="OpenLayers.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments(),u=0,d=c.length;e:for(;d>u;++u){i=c[u],n=i.x1,r=i.x2,o=i.y1,s=i.y2;for(var p=0,f=e.length;f>p&&(a=e[p],!(a.x1>r));++p)if(!(n>a.x2||(l=a.y1,h=a.y2,Math.min(l,h)>Math.max(o,s)||Math.max(l,h)<Math.min(o,s)||!OpenLayers.Geometry.segmentsIntersect(i,a)))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){for(var e,t,i=this.components.length-1,n=Array(i),r=0;i>r;++r)e=this.components[r],t=this.components[r+1],n[r]=e.x<t.x?{x1:e.x,y1:e.y,x2:t.x,y2:t.y}:{x1:t.x,y1:t.y,x2:e.x,y2:e.y};return n.sort(function(e,t){return e.x1-t.x1})},splitWithSegment:function(e,t){for(var i,n,r,o=!(t&&!1===t.edge),s=t&&t.tolerance,a=[],l=this.getVertices(),h=[],c=[],u=!1,d={point:!0,tolerance:s},p=null,f=0,m=l.length-2;m>=f;++f)s=l[f],h.push(s.clone()),i=l[f+1],n={x1:s.x,y1:s.y,x2:i.x,y2:i.y},n=OpenLayers.Geometry.segmentsIntersect(e,n,d),n instanceof OpenLayers.Geometry.Point&&((r=n.x===e.x1&&n.y===e.y1||n.x===e.x2&&n.y===e.y2||n.equals(s)||n.equals(i)?!0:!1)||o)&&(n.equals(c[c.length-1])||c.push(n.clone()),!(0===f&&n.equals(s))&&!n.equals(i)&&(u=!0,n.equals(s)||h.push(n),a.push(new OpenLayers.Geometry.LineString(h)),h=[n.clone()]));if(u&&(h.push(i.clone()),a.push(new OpenLayers.Geometry.LineString(h))),c.length>0)var g=e.x1<e.x2?1:-1,y=e.y1<e.y2?1:-1,p={lines:a,points:c.sort(function(e,t){return g*e.x-g*t.x||y*e.y-y*t.y})};return p},split:function(e,t){var i,n,r,o,s=null,a=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,h,c,u,d,p=this.getVertices(),f=[];r=[];for(var m=0,g=p.length-2;g>=m;++m){l=p[m],h=p[m+1],c={x1:l.x,y1:l.y,x2:h.x,y2:h.y},o=o||[e],a&&f.push(l.clone());for(var y=0;o.length>y;++y)if((u=o[y].splitWithSegment(c,t))&&(d=u.lines,d.length>0&&(d.unshift(y,1),Array.prototype.splice.apply(o,d),y+=d.length-2),a))for(var v=0,b=u.points.length;b>v;++v)d=u.points[v],d.equals(l)||(f.push(d),r.push(new OpenLayers.Geometry.LineString(f)),f=d.equals(h)?[]:[d.clone()])}a&&r.length>0&&f.length>0&&(f.push(h.clone()),r.push(new OpenLayers.Geometry.LineString(f)))}else s=e.splitWith(this,t);return o&&o.length>1?n=!0:o=[],r&&r.length>1?i=!0:r=[],(n||i)&&(s=a?[r,o]:o),s},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){return!0===e?[this.components[0],this.components[this.components.length-1]]:!1===e?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var i,n=!(t&&!1===t.edge)&&t&&t.details,r={},o=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var s,a=this.getSortedSegments(),l=e.x,h=e.y,c=0,u=a.length;u>c;++c)if(s=a[c],i=OpenLayers.Geometry.distanceToSegment(e,s),o>i.distance){if(o=i.distance,r=i,0===o)break}else if(s.x2>l&&(h>s.y1&&s.y2>h||s.y1>h&&h>s.y2))break;r=n?{distance:r.distance,x0:r.x,y0:r.y,x1:l,y1:h}:r.distance}else if(e instanceof OpenLayers.Geometry.LineString){var d,p,a=this.getSortedSegments(),l=e.getSortedSegments(),f=l.length,m={point:!0},c=0,u=a.length;e:for(;u>c;++c){h=a[c],s=h.x1,p=h.y1;for(var g=0;f>g;++g){if(i=l[g],d=OpenLayers.Geometry.segmentsIntersect(h,i,m)){o=0,r={distance:0,x0:d.x,y0:d.y,x1:d.x,y1:d.y};break e}i=OpenLayers.Geometry.distanceToSegment({x:s,y:p},i),o>i.distance&&(o=i.distance,r={distance:o,x0:s,y0:p,x1:i.x,y1:i.y})}}n||(r=r.distance),0!==o&&h&&(i=e.distanceTo(new OpenLayers.Geometry.Point(h.x2,h.y2),t),c=n?i.distance:i,o>c&&(r=n?{distance:o,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:c))}else r=e.distanceTo(this,t),n&&(r={distance:r.distance,x0:r.x1,y0:r.y1,x1:r.x0,y1:r.y0});return r},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(3>t.length)return this;var i=function(e,t,n,o){for(var s,a=0,l=0,h=t;n>h;h++){s=e[t];var c=e[n],u=e[h],u=Math.abs(.5*(s.x*c.y+c.x*u.y+u.x*s.y-c.x*s.y-u.x*c.y-s.x*u.y));s=Math.sqrt(Math.pow(s.x-c.x,2)+Math.pow(s.y-c.y,2)),s=2*(u/s),s>a&&(a=s,l=h)}a>o&&l!=t&&(r.push(l),i(e,t,l,o),i(e,l,n,o))},n=t.length-1,r=[];for(r.push(0),r.push(n);t[0].equals(t[n]);)n--,r.push(n);for(i(t,0,n,e),e=[],r.sort(function(e,t){return e-t}),n=0;r.length>n;n++)e.push(t[r[n]]);return new OpenLayers.Geometry.LineString(e)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"}),OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var i=!1,n=this.components.pop();return null==t&&e.equals(n)||(i=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments)),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]]),i},removeComponent:function(){var e=this.components&&this.components.length>3;return e&&(this.components.pop(),OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[this.components[0]])),e},move:function(e,t){for(var i=0,n=this.components.length;n-1>i;i++)this.components[i].move(e,t)},rotate:function(e,t){for(var i=0,n=this.components.length;n-1>i;++i)this.components[i].rotate(e,t)},resize:function(e,t,i){for(var n=0,r=this.components.length;r-1>n;++n)this.components[n].resize(e,t,i);return this},transform:function(e,t){if(e&&t){for(var i=0,n=this.components.length;n-1>i;i++)this.components[i].transform(e,t);this.bounds=null}return this},getCentroid:function(){if(this.components&&this.components.length>2){for(var e=0,t=0,i=0;this.components.length-1>i;i++)var n=this.components[i],r=this.components[i+1],e=e+(n.x+r.x)*(n.x*r.y-r.x*n.y),t=t+(n.y+r.y)*(n.x*r.y-r.x*n.y);return i=-1*this.getArea(),new OpenLayers.Geometry.Point(e/(6*i),t/(6*i))}return null},getArea:function(){var e=0;if(this.components&&this.components.length>2){for(var t=e=0,i=this.components.length;i-1>t;t++)var n=this.components[t],r=this.components[t+1],e=e+(n.x+r.x)*(r.y-n.y);e=-e/2}return e},getGeodesicArea:function(e){var t=this;if(e){var i=new OpenLayers.Projection("EPSG:4326");i.equals(e)||(t=this.clone().transform(e,i))}if(e=0,i=t.components&&t.components.length,i>2){for(var n,r,o=0;i-1>o;o++)n=t.components[o],r=t.components[o+1],e+=OpenLayers.Util.rad(r.x-n.x)*(2+Math.sin(OpenLayers.Util.rad(n.y))+Math.sin(OpenLayers.Util.rad(r.y)));e=40680631590769*e/2}return e},containsPoint:function(e){for(var t,i,n,r,o,s=OpenLayers.Number.limitSigDigs,a=s(e.x,14),e=s(e.y,14),l=this.components.length-1,h=0,c=0;l>c;++c)if(t=this.components[c],n=s(t.x,14),t=s(t.y,14),i=this.components[c+1],r=s(i.x,14),i=s(i.y,14),t==i){if(e==t&&(r>=n&&a>=n&&r>=a||n>=r&&n>=a&&a>=r)){h=-1;break}}else{if(o=s((e-i)*((r-n)/(i-t))+r,14),o==a&&(i>t&&e>=t&&i>=e||t>i&&t>=e&&e>=i)){h=-1;break}a>=o||n!=r&&(Math.min(n,r)>o||o>Math.max(n,r))||(i>t&&e>=t&&i>e||t>i&&t>e&&e>=i)&&++h}return-1==h?1:!!(1&h)},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var i=0,n=e.components.length;n>i&&!(t=e.components[i].intersects(this));++i);return t},getVertices:function(e){return!0===e?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"}),OpenLayers.Animation=function(e){var t=!!(e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame),i=function(){var t=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){e.setTimeout(t,16)};return function(i,n){t.apply(e,[i,n])}}(),n=0,r={};return{isNative:t,requestFrame:i,start:function(e,t,o){var t=t>0?t:Number.POSITIVE_INFINITY,s=++n,a=+new Date;return r[s]=function(){r[s]&&t>=+new Date-a?(e(),r[s]&&i(r[s],o)):delete r[s]},i(r[s],o),s},stop:function(e){delete r[e]}}}(window),OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,animationId:null,playing:!1,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,i,n){this.playing=!0,this.begin=e,this.finish=t,this.duration=i,this.callbacks=n.callbacks,this.time=0,OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin),this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){this.playing&&(this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish),OpenLayers.Animation.stop(this.animationId),this.animationId=null,this.playing=!1)},play:function(){var e,t={};for(e in this.begin){var i=this.begin[e],n=this.finish[e];if(null==i||null==n||isNaN(i)||isNaN(n))throw new TypeError("invalid value for Tween");t[e]=this.easing.apply(this,[this.time,i,n-i,this.duration])}this.time++,this.callbacks&&this.callbacks.eachStep&&this.callbacks.eachStep.call(this,t),this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"}),OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"},OpenLayers.Easing.Linear={easeIn:function(e,t,i,n){return i*e/n+t},easeOut:function(e,t,i,n){return i*e/n+t},easeInOut:function(e,t,i,n){return i*e/n+t},CLASS_NAME:"OpenLayers.Easing.Linear"},OpenLayers.Easing.Expo={easeIn:function(e,t,i,n){return 0==e?t:i*Math.pow(2,10*(e/n-1))+t},easeOut:function(e,t,i,n){return e==n?t+i:i*(-Math.pow(2,-10*e/n)+1)+t},easeInOut:function(e,t,i,n){return 0==e?t:e==n?t+i:1>(e/=n/2)?i/2*Math.pow(2,10*(e-1))+t:i/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"},OpenLayers.Easing.Quad={easeIn:function(e,t,i,n){return i*(e/=n)*e+t},easeOut:function(e,t,i,n){return-i*(e/=n)*(e-2)+t},easeInOut:function(e,t,i,n){return 1>(e/=n/2)?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"},OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.projCode=e,window.Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=!1;return e&&(e instanceof OpenLayers.Projection||(e=new OpenLayers.Projection(e)),window.Proj4js&&this.proj.defData&&e.proj.defData?t=this.proj.defData.replace(this.titleRegEx,"")==e.proj.defData.replace(this.titleRegEx,""):e.getCode&&(t=this.getCode(),e=e.getCode(),t=t==e||!!OpenLayers.Projection.transforms[t]&&OpenLayers.Projection.transforms[t][e]===OpenLayers.Projection.nullTransform)),t},destroy:function(){delete this.proj,delete this.projCode},CLASS_NAME:"OpenLayers.Projection"}),OpenLayers.Projection.transforms={},OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}},OpenLayers.Projection.addTransform=function(e,t,i){if(i===OpenLayers.Projection.nullTransform){var n=OpenLayers.Projection.defaults[e];n&&!OpenLayers.Projection.defaults[t]&&(OpenLayers.Projection.defaults[t]=n)}OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={}),OpenLayers.Projection.transforms[e][t]=i},OpenLayers.Projection.transform=function(e,t,i){if(t&&i)if(t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t)),i instanceof OpenLayers.Projection||(i=new OpenLayers.Projection(i)),t.proj&&i.proj)e=Proj4js.transform(t.proj,i.proj,e);else{var t=t.getCode(),i=i.getCode(),n=OpenLayers.Projection.transforms;n[t]&&n[t][i]&&n[t][i](e)}return e},OpenLayers.Projection.nullTransform=function(e){return e},function(){function e(e){return e.x=180*e.x/r,e.y=180/Math.PI*(2*Math.atan(Math.exp(e.y/r*Math.PI))-Math.PI/2),e}function t(e){return e.x=e.x*r/180,e.y=Math.log(Math.tan((90+e.y)*Math.PI/360))/Math.PI*r,e}function i(i,n){var r,o,s,a,l,h=OpenLayers.Projection.addTransform,c=OpenLayers.Projection.nullTransform;for(r=0,o=n.length;o>r;++r)for(s=n[r],h(i,s,t),h(s,i,e),l=r+1;o>l;++l)a=n[l],h(s,a,c),h(a,s,c)}var n,r=20037508.34,o=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],s=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(n=o.length-1;n>=0;--n)i(o[n],s);for(n=s.length-1;n>=0;--n)i(s[n],o)}(),OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!0,panTween:null,eventListeners:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,paddingForPopups:null,minPx:null,maxPx:null,initialize:function(e,t){1===arguments.length&&"object"==typeof e&&(e=(t=e)&&t.div),this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT),this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15),this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css",this.options=OpenLayers.Util.extend({},t),OpenLayers.Util.extend(this,t),OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection]),this.maxExtent&&!(this.maxExtent instanceof OpenLayers.Bounds)&&(this.maxExtent=new OpenLayers.Bounds(this.maxExtent)),this.minExtent&&!(this.minExtent instanceof OpenLayers.Bounds)&&(this.minExtent=new OpenLayers.Bounds(this.minExtent)),this.restrictedExtent&&!(this.restrictedExtent instanceof OpenLayers.Bounds)&&(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent)),this.center&&!(this.center instanceof OpenLayers.LonLat)&&(this.center=new OpenLayers.LonLat(this.center)),this.layers=[],this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_"),this.div=OpenLayers.Util.getElement(e),this.div||(this.div=document.createElement("div"),this.div.style.height="1px",this.div.style.width="1px"),OpenLayers.Element.addClass(this.div,"olMap");
var i=this.id+"_OpenLayers_ViewPort";if(this.viewPortDiv=OpenLayers.Util.createDiv(i,null,null,null,"relative",null,"hidden"),this.viewPortDiv.style.width="100%",this.viewPortDiv.style.height="100%",this.viewPortDiv.className="olMapViewport",this.div.appendChild(this.viewPortDiv),this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0}),i=this.id+"_OpenLayers_Container",this.layerContainerDiv=OpenLayers.Util.createDiv(i),this.layerContainerDiv.style.width="100px",this.layerContainerDiv.style.height="100px",this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1,this.viewPortDiv.appendChild(this.layerContainerDiv),this.updateSize(),this.eventListeners instanceof Object&&this.events.on(this.eventListeners),9>parseFloat(navigator.appVersion.split("MSIE")[1])?this.events.register("resize",this,this.updateSize):(this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this),OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)),this.theme){for(var i=!0,n=document.getElementsByTagName("link"),r=0,o=n.length;o>r;++r)if(OpenLayers.Util.isEquivalentUrl(n.item(r).href,this.theme)){i=!1;break}i&&(i=document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",this.theme),document.getElementsByTagName("head")[0].appendChild(i))}for(null==this.controls&&(this.controls=[],null!=OpenLayers.Control&&(OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation),OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom),OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser),OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution))),r=0,o=this.controls.length;o>r;r++)this.addControlToMap(this.controls[r]);this.popups=[],this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this),OpenLayers.Event.observe(window,"unload",this.unloadDestroy),t&&t.layers&&(delete this.center,this.addLayers(t.layers),t.center&&!this.getCenter()&&this.setCenter(t.center,t.zoom))},getViewport:function(){return this.viewPortDiv},render:function(e){this.div=OpenLayers.Util.getElement(e),OpenLayers.Element.addClass(this.div,"olMap"),this.viewPortDiv.parentNode.removeChild(this.viewPortDiv),this.div.appendChild(this.viewPortDiv),this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween&&(this.panTween.stop(),this.panTween=null),OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy),this.unloadDestroy=null,this.updateSizeDestroy?OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy):this.events.unregister("resize",this,this.updateSize),this.paddingForPopups=null,null!=this.controls){for(var e=this.controls.length-1;e>=0;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(e=this.layers.length-1;e>=0;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.div.removeChild(this.viewPortDiv),this.viewPortDiv=null,this.eventListeners&&(this.events.un(this.eventListeners),this.eventListeners=null),this.events.destroy(),this.options=this.events=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e),t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,t,i){var n="function"==typeof i.test;return OpenLayers.Array.filter(this[e],function(e){return e[t]==i||n&&i.test(e[t])})},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){for(var t=null,i=0,n=this.layers.length;n>i;i++){var r=this.layers[i];if(r.id==e){t=r;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;t>e;e++)this.setLayerZIndex(this.layers[e],e)},addLayer:function(e){for(var t=0,i=this.layers.length;i>t;t++)if(this.layers[t]==e)return!1;return!1===this.events.triggerEvent("preaddlayer",{layer:e})?!1:(this.allOverlays&&(e.isBaseLayer=!1),e.div.className="olLayerDiv",e.div.style.overflow="",this.setLayerZIndex(e,this.layers.length),e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div),this.layers.push(e),e.setMap(this),e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw(),this.events.triggerEvent("addlayer",{layer:e}),e.events.triggerEvent("added",{map:this,layer:e}),e.afterAdd(),!0)},addLayers:function(e){for(var t=0,i=e.length;i>t;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(!1!==this.events.triggerEvent("preremovelayer",{layer:e})){if(null==t&&(t=!0),e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.layers,e),e.removeMap(this),e.map=null,this.baseLayer==e&&(this.baseLayer=null,t))for(var i=0,n=this.layers.length;n>i;i++){var r=this.layers[i];if(r.isBaseLayer||this.allOverlays){this.setBaseLayer(r);break}}this.resetLayersZIndex(),this.events.triggerEvent("removelayer",{layer:e}),e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var i=this.getLayerIndex(e);if(0>t?t=0:t>this.layers.length&&(t=this.layers.length),i!=t){this.layers.splice(i,1),this.layers.splice(t,0,e);for(var i=0,n=this.layers.length;n>i;i++)this.setLayerZIndex(this.layers[i],i);this.events.triggerEvent("changelayer",{layer:e,property:"order"}),this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var i=this.getLayerIndex(e)+t;this.setLayerIndex(e,i)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var t=this.getCachedCenter(),i=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);null!=this.baseLayer&&!this.allOverlays&&this.baseLayer.setVisibility(!1),this.baseLayer=e,(!this.allOverlays||this.baseLayer.visibility)&&(this.baseLayer.setVisibility(!0),!1===this.baseLayer.inRange&&this.baseLayer.redraw()),null!=t&&(e=this.getZoomForResolution(i||this.resolution,!0),this.setCenter(t,e,!1,!0)),this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e),this.addControlToMap(e,t)},addControls:function(e,t){for(var i=1===arguments.length?[]:t,n=0,r=e.length;r>n;n++)this.addControl(e[n],i[n]?i[n]:null)},addControlToMap:function(e,t){e.outsideViewport=null!=e.div,this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection),e.setMap(this);var i=e.draw(t);i&&!e.outsideViewport&&(i.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length,this.viewPortDiv.appendChild(i)),e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,i=0,n=this.controls.length;n>i;i++){var r=this.controls[i];if(r.id==e){t=r;break}}return t},removeControl:function(e){e&&e==this.getControl(e.id)&&(e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div),OpenLayers.Util.removeItem(this.controls,e))},addPopup:function(e,t){if(t)for(var i=this.popups.length-1;i>=0;--i)this.removePopup(this.popups[i]);e.map=this,this.popups.push(e),(i=e.draw())&&(i.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length,this.layerContainerDiv.appendChild(i))},removePopup:function(e){if(OpenLayers.Util.removeItem(this.popups,e),e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(t){}e.map=null},getSize:function(){var e=null;return null!=this.size&&(e=this.size.clone()),e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();if(null==t&&(this.size=t=e),!e.equals(t)){for(this.size=e,e=0,t=this.layers.length;t>e;e++)this.layers[e].onMapResize();e=this.getCachedCenter(),null!=this.baseLayer&&null!=e&&(t=this.getZoom(),this.zoom=null,this.setCenter(e,t))}}},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);return(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=this.div.offsetWidth,e.h=this.div.offsetHeight),(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h))&&(e.w=parseInt(this.div.style.width),e.h=parseInt(this.div.style.height)),e},calculateBounds:function(e,t){var i=null;if(null==e&&(e=this.getCachedCenter()),null==t&&(t=this.getResolution()),null!=e&&null!=t)var i=this.size.w*t/2,n=this.size.h*t/2,i=new OpenLayers.Bounds(e.lon-i,e.lat-n,e.lon+i,e.lat+n);return i},getCenter:function(){var e=null,t=this.getCachedCenter();return t&&(e=t.clone()),e},getCachedCenter:function(){return!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2})),this.center},getZoom:function(){return this.zoom},pan:function(e,t,i){if(i=OpenLayers.Util.applyDefaults(i,{animate:!0,dragging:!1}),i.dragging)(0!=e||0!=t)&&this.moveByPx(e,t);else{var n=this.getViewPortPxFromLonLat(this.getCachedCenter()),e=n.add(e,t);(this.dragging||!e.equals(n))&&(n=this.getLonLatFromViewPortPx(e),i.animate?this.panTo(n):(this.moveTo(n),this.dragging&&(this.dragging=!1,this.events.triggerEvent("moveend"))))}},panTo:function(e){if(this.panMethod&&this.getExtent().scale(this.panRatio).containsLonLat(e)){this.panTween||(this.panTween=new OpenLayers.Tween(this.panMethod));var t=this.getCachedCenter();if(!e.equals(t)){var t=this.getPixelFromLonLat(t),i=this.getPixelFromLonLat(e),n=0,r=0;this.panTween.start({x:0,y:0},{x:i.x-t.x,y:i.y-t.y},this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){this.moveByPx(e.x-n,e.y-r),n=Math.round(e.x),r=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(){this.moveTo(e),this.dragging=!1,this.events.triggerEvent("moveend")},this)}})}}else this.setCenter(e)},setCenter:function(e,t,i,n){this.panTween&&this.panTween.stop(),this.moveTo(e,t,{dragging:i,forceZoomChange:n})},moveByPx:function(e,t){var i=this.size.w/2,n=this.size.h/2,r=i+e,o=n+t,s=this.baseLayer.wrapDateLine,a=0,l=0;if(this.restrictedExtent&&(a=i,l=n,s=!1),e=s||this.maxPx.x-a>=r&&r>=this.minPx.x+a?Math.round(e):0,t=this.maxPx.y-l>=o&&o>=this.minPx.y+l?Math.round(t):0,e||t){for(this.dragging||(this.dragging=!0,this.events.triggerEvent("movestart")),this.center=null,e&&(this.layerContainerDiv.style.left=parseInt(this.layerContainerDiv.style.left)-e+"px",this.minPx.x-=e,this.maxPx.x-=e),t&&(this.layerContainerDiv.style.top=parseInt(this.layerContainerDiv.style.top)-t+"px",this.minPx.y-=t,this.maxPx.y-=t),n=0,r=this.layers.length;r>n;++n)i=this.layers[n],i.visibility&&(i===this.baseLayer||i.inRange)&&(i.moveByPx(e,t),i.events.triggerEvent("move"));this.events.triggerEvent("move")}},adjustZoom:function(e){var t=this.baseLayer.resolutions,i=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(e)>i)for(var n=0|e,r=t.length;r>n;++n)if(i>=t[n]){e=n;break}return e},moveTo:function(e,t,i){if(null!=e&&!(e instanceof OpenLayers.LonLat)&&(e=new OpenLayers.LonLat(e)),i||(i={}),null!=t&&(t=parseFloat(t),this.fractionalZoom||(t=Math.round(t))),this.baseLayer.wrapDateLine){var n=t,t=this.adjustZoom(t);t!==n&&(e=this.getCenter())}var n=i.dragging||this.dragging,r=i.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(e)&&(e=this.maxExtent.getCenterLonLat(),this.center=e.clone()),null!=this.restrictedExtent){null==e&&(e=this.center),null==t&&(t=this.getZoom());var o=this.getResolutionForZoom(t),o=this.calculateBounds(e,o);if(!this.restrictedExtent.containsBounds(o)){var s=this.restrictedExtent.getCenterLonLat();o.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(s.lon,e.lat):o.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-o.left,0):o.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-o.right,0)),o.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,s.lat):o.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-o.bottom):o.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-o.top))}}if(r=r||this.isValidZoomLevel(t)&&t!=this.getZoom(),o=this.isValidLonLat(e)&&!e.equals(this.center),r||o||n){if(n||this.events.triggerEvent("movestart"),o&&(!r&&this.center&&this.centerLayerContainer(e),this.center=e.clone()),e=r?this.getResolutionForZoom(t):this.getResolution(),r||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter(),this.layerContainerDiv.style.left="0px",this.layerContainerDiv.style.top="0px";var o=this.getMaxExtent({restricted:!0}),a=o.getCenterLonLat(),s=this.center.lon-a.lon,a=a.lat-this.center.lat,l=Math.round(o.getWidth()/e),h=Math.round(o.getHeight()/e);this.minPx={x:(this.size.w-l)/2-s/e,y:(this.size.h-h)/2-a/e},this.maxPx={x:this.minPx.x+Math.round(o.getWidth()/e),y:this.minPx.y+Math.round(o.getHeight()/e)}}for(r&&(this.zoom=t,this.resolution=e),e=this.getExtent(),this.baseLayer.visibility&&(this.baseLayer.moveTo(e,r,i.dragging),i.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:r})),e=this.baseLayer.getExtent(),t=this.layers.length-1;t>=0;--t)o=this.layers[t],o!==this.baseLayer&&!o.isBaseLayer&&(s=o.calculateInRange(),o.inRange!=s&&((o.inRange=s)||o.display(!1),this.events.triggerEvent("changelayer",{layer:o,property:"visibility"})),s&&o.visibility)&&(o.moveTo(e,r,i.dragging),i.dragging||o.events.triggerEvent("moveend",{zoomChanged:r}));if(this.events.triggerEvent("move"),n||this.events.triggerEvent("moveend"),r){for(t=0,i=this.popups.length;i>t;t++)this.popups[t].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),i=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=i){var n=parseInt(this.layerContainerDiv.style.left),e=parseInt(this.layerContainerDiv.style.top),r=Math.round(t.x-i.x),t=Math.round(t.y-i.y);this.layerContainerDiv.style.left=r+"px",this.layerContainerDiv.style.top=t+"px",n-=r,e-=t,this.minPx.x-=n,this.maxPx.x-=n,this.minPx.y-=e,this.maxPx.y-=e}},isValidZoomLevel:function(e){return null!=e&&e>=0&&this.getNumZoomLevels()>e},isValidLonLat:function(e){var t=!1;return null!=e&&(t=this.getMaxExtent(),t=t.containsLonLat(e,{worldBounds:this.baseLayer.wrapDateLine&&t})),t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.projection),e},getMaxResolution:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.maxResolution),e},getMaxExtent:function(e){var t=null;return e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent),t},getNumZoomLevels:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels),e},getExtent:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.getExtent()),e},getResolution:function(){var e=null;return null!=this.baseLayer?e=this.baseLayer.getResolution():!0===this.allOverlays&&this.layers.length>0&&(e=this.layers[0].getResolution()),e},getUnits:function(){var e=null;return null!=this.baseLayer&&(e=this.baseLayer.units),e},getScale:function(){var e=null;return null!=this.baseLayer&&(e=this.getResolution(),e=OpenLayers.Util.getScaleFromResolution(e,this.baseLayer.units)),e},getZoomForExtent:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForExtent(e,t)),i},getResolutionForZoom:function(e){var t=null;return this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e)),t},getZoomForResolution:function(e,t){var i=null;return null!=this.baseLayer&&(i=this.baseLayer.getZoomForResolution(e,t)),i},zoomTo:function(e){this.isValidZoomLevel(e)&&this.setCenter(null,e)},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var i=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){for(i=this.getMaxExtent(),e=e.clone();e.right<e.left;)e.right+=i.getWidth();i=e.getCenterLonLat().wrapDateLine(i)}this.setCenter(i,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){this.zoomToExtent(this.getMaxExtent({restricted:e?e.restricted:!0}))},zoomToScale:function(e,t){var i=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),n=this.size.w*i/2,i=this.size.h*i/2,r=this.getCachedCenter();this.zoomToExtent(new OpenLayers.Bounds(r.lon-n,r.lat-i,r.lon+n,r.lat+i),t)},getLonLatFromViewPortPx:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e)),t},getViewPortPxFromLonLat:function(e){var t=null;return null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e)),t},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){return e=this.getViewPortPxFromLonLat(e),e.x=Math.round(e.x),e.y=Math.round(e.y),e},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),i=this.getResolution(),e=t.add(-i/2,0),n=t.add(i/2,0),r=t.add(0,-i/2),t=t.add(0,i/2),i=new OpenLayers.Projection("EPSG:4326"),o=this.getProjectionObject()||i;return o.equals(i)||(e.transform(o,i),n.transform(o,i),r.transform(o,i),t.transform(o,i)),new OpenLayers.Size(OpenLayers.Util.distVincenty(e,n),OpenLayers.Util.distVincenty(r,t))},getViewPortPxFromLayerPx:function(e){var t=null;if(null!=e)var t=parseInt(this.layerContainerDiv.style.left),i=parseInt(this.layerContainerDiv.style.top),t=e.add(t,i);return t},getLayerPxFromViewPortPx:function(e){var t=null;if(null!=e){var t=-parseInt(this.layerContainerDiv.style.left),i=-parseInt(this.layerContainerDiv.style.top),t=e.add(t,i);(isNaN(t.x)||isNaN(t.y))&&(t=null)}return t},getLonLatFromLayerPx:function(e){return e=this.getViewPortPxFromLayerPx(e),this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){return this.getLayerPxFromViewPortPx(this.getPixelFromLonLat(e))},CLASS_NAME:"OpenLayers.Map"}),OpenLayers.Map.TILE_WIDTH=256,OpenLayers.Map.TILE_HEIGHT=256,OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:"scales resolutions maxScale minScale maxResolution minResolution numZoomLevels maxZoomLevel".split(" "),events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(e,t){this.metadata={},this.addOptions(t),this.name=e,null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.div=OpenLayers.Util.createDiv(this.id),this.div.style.width="100%",this.div.style.height="100%",this.div.dir="ltr",this.events=new OpenLayers.Events(this,this.div),this.eventListeners instanceof Object)&&this.events.on(this.eventListeners)},destroy:function(e){null==e&&(e=!0),null!=this.map&&this.map.removeLayer(this,e),this.options=this.div=this.name=this.map=this.projection=null,this.events&&(this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy()),this.events=this.eventListeners=null},clone:function(e){return null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions())),OpenLayers.Util.applyDefaults(e,this),e.map=null,e},getOptions:function(){var e,t={};for(e in this.options)t[e]=this[e];return t},setName:function(e){e!=this.name&&(this.name=e,null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"}))},addOptions:function(e,t){if(null==this.options&&(this.options={}),!e||("string"==typeof e.projection&&(e.projection=new OpenLayers.Projection(e.projection)),e.projection&&OpenLayers.Util.applyDefaults(e,OpenLayers.Projection.defaults[e.projection.getCode()]),e.maxExtent&&!(e.maxExtent instanceof OpenLayers.Bounds)&&(e.maxExtent=new OpenLayers.Bounds(e.maxExtent)),!e.minExtent||e.minExtent instanceof OpenLayers.Bounds)||(e.minExtent=new OpenLayers.Bounds(e.minExtent)),OpenLayers.Util.extend(this.options,e),OpenLayers.Util.extend(this,e),this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits()),this.map){var i,n=this.map.getResolution(),r=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(i in e)if(e.hasOwnProperty(i)&&OpenLayers.Util.indexOf(r,i)>=0){this.initResolutions(),t&&this.map.baseLayer===this&&(this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(n),!1,!0),this.map.events.triggerEvent("changebaselayer",{layer:this}));break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();t&&this.inRange&&this.visibility&&(this.moveTo(t,!0,!1),this.events.triggerEvent("moveend",{zoomChanged:!0}),e=!0)}return e},moveTo:function(){var e=this.visibility;this.isBaseLayer||(e=e&&this.inRange),this.display(e)},moveByPx:function(){},setMap:function(e){null==this.map&&(this.map=e,this.maxExtent=this.maxExtent||this.map.maxExtent,this.minExtent=this.minExtent||this.map.minExtent,this.projection=this.projection||this.map.projection,"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection)),this.units=this.projection.getUnits()||this.units||this.map.units,this.initResolutions(),this.isBaseLayer||(this.inRange=this.calculateInRange(),this.div.style.display=this.visibility&&this.inRange?"":"none"),this.setTileSize())},afterAdd:function(){},removeMap:function(){},getImageSize:function(){return this.imageSize||this.tileSize},setTileSize:function(e){this.tileSize=e=e?e:this.tileSize?this.tileSize:this.map.getTileSize(),this.gutter&&(this.imageSize=new OpenLayers.Size(e.w+2*this.gutter,e.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){e!=this.visibility&&(this.visibility=e,this.display(e),this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"}),this.events.triggerEvent("visibilitychanged"))},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var e=!1;return this.alwaysInRange?e=!0:this.map&&(e=this.map.getResolution(),e=e>=this.minResolution&&this.maxResolution>=e),e},setIsBaseLayer:function(e){e!=this.isBaseLayer&&(this.isBaseLayer=e,null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this}))},initResolutions:function(){var e,t,i,n={},r=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=this.options[i],r&&this.options[i]&&(r=!1);if(null==this.alwaysInRange&&(this.alwaysInRange=r),null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n)),null==n.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++)i=this.RESOLUTION_PROPERTIES[e],n[i]=null!=this.options[i]?this.options[i]:this.map[i];null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales)),null==n.resolutions&&(n.resolutions=this.calculateResolutions(n))}var o;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(o=this.options.maxResolution),this.options.minScale&&(o=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var s;if(this.options.minResolution&&"auto"!==this.options.minResolution&&(s=this.options.minResolution),this.options.maxScale&&(s=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units)),n.resolutions&&(n.resolutions.sort(function(e,t){return t-e}),o||(o=n.resolutions[0]),s||(s=n.resolutions[n.resolutions.length-1])),this.resolutions=n.resolutions){for(t=this.resolutions.length,this.scales=Array(t),e=0;t>e;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}(this.minResolution=s)&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(s,this.units)),(this.maxResolution=o)&&(this.minScale=OpenLayers.Util.getScaleFromResolution(o,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,i,n;for(n=e.length,t=Array(n),i=0;n>i;i++)t[i]=OpenLayers.Util.getResolutionFromScale(e[i],this.units);return t}},calculateResolutions:function(e){var t,i,n=e.maxResolution;if(null!=e.minScale?n=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units):"auto"==n&&null!=this.maxExtent&&(t=this.map.getSize(),i=this.maxExtent.getWidth()/t.w,t=this.maxExtent.getHeight()/t.h,n=Math.max(i,t)),i=e.minResolution,null!=e.maxScale?i=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units):"auto"==e.minResolution&&null!=this.minExtent&&(t=this.map.getSize(),i=this.minExtent.getWidth()/t.w,t=this.minExtent.getHeight()/t.h,i=Math.max(i,t)),"number"!=typeof n&&"number"!=typeof i&&null!=this.maxExtent&&(n=this.map.getTileSize(),n=Math.max(this.maxExtent.getWidth()/n.w,this.maxExtent.getHeight()/n.h)),t=e.maxZoomLevel,e=e.numZoomLevels,"number"==typeof i&&"number"==typeof n&&void 0===e?e=Math.floor(Math.log(n/i)/Math.log(2))+1:void 0===e&&null!=t&&(e=t+1),!("number"!=typeof e||0>=e||"number"!=typeof n&&"number"!=typeof i)){t=Array(e);var r=2;"number"==typeof i&&"number"==typeof n&&(r=Math.pow(n/i,1/(e-1)));var o;if("number"==typeof n)for(o=0;e>o;o++)t[o]=n/Math.pow(r,o);else for(o=0;e>o;o++)t[e-1-o]=i*Math.pow(r,o);return t}},getResolution:function(){return this.getResolutionForZoom(this.map.getZoom())},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var i=this.map.getSize();return this.getZoomForResolution(Math.max(e.getWidth()/i.w,e.getHeight()/i.h),t)},getDataExtent:function(){},getResolutionForZoom:function(e){if(e=Math.max(0,Math.min(e,this.resolutions.length-1)),this.map.fractionalZoom)var t=Math.floor(e),i=Math.ceil(e),e=this.resolutions[t]-(e-t)*(this.resolutions[t]-this.resolutions[i]);else e=this.resolutions[Math.round(e)];return e},getZoomForResolution:function(e,t){var i,n;if(this.map.fractionalZoom){var r,o=0,s=this.resolutions[o],a=this.resolutions[this.resolutions.length-1];for(i=0,n=this.resolutions.length;n>i;++i)if(r=this.resolutions[i],r>=e&&(s=r,o=i),e>=r){a=r;break}i=s-a,i=i>0?o+(s-e)/i:o}else{for(s=Number.POSITIVE_INFINITY,i=0,n=this.resolutions.length;n>i;i++)if(t){if(o=Math.abs(this.resolutions[i]-e),o>s)break;s=o}else if(e>this.resolutions[i])break;i=Math.max(0,i-1)}return i},getLonLatFromViewPortPx:function(e){var t=null,i=this.map;if(null!=e&&i.minPx){var t=i.getResolution(),n=i.getMaxExtent({restricted:!0}),t=new OpenLayers.LonLat((e.x-i.minPx.x)*t+n.left,(i.minPx.y-e.y)*t+n.top);this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e,t){var i=null;return null!=e&&(t=t||this.map.getResolution(),i=this.map.calculateBounds(null,t),i=new OpenLayers.Pixel(1/t*(e.lon-i.left),1/t*(i.top-e.lat))),i},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=this.div.childNodes,i=0,n=t.length;n>i;++i){var r=t[i].firstChild||t[i],o=t[i].lastChild;o&&"iframe"===o.nodeName.toLowerCase()&&(r=o.parentNode),OpenLayers.Util.modifyDOMElement(r,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter)var t=this.gutter*this.map.getResolution(),e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t);return this.wrapDateLine&&(t={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()},e=e.wrapDateLine(this.maxExtent,t)),e},CLASS_NAME:"OpenLayers.Layer"}),OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,i,n){OpenLayers.Layer.prototype.initialize.apply(this,[e,n]),this.url=t,this.params||(this.params=OpenLayers.Util.extend({},i))},destroy:function(){this.params=this.url=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.prototype.clone.apply(this,[e])},setUrl:function(e){this.url=e},mergeNewParams:function(e){return this.params=OpenLayers.Util.extend(this.params,e),e=this.redraw(),null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"}),e},redraw:function(e){return e?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var i=1,n=0,r=e.length;r>n;n++)i*=e.charCodeAt(n)*this.URL_HASH_FACTOR,i-=Math.floor(i);return t[Math.floor(i*t.length)]},getFullRequestString:function(e,t){var i=t||this.url,n=OpenLayers.Util.extend({},this.params),n=OpenLayers.Util.extend(n,e),r=OpenLayers.Util.getParameterString(n);OpenLayers.Util.isArray(i)&&(i=this.selectUrl(r,i));var o,r=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(i));for(o in n)o.toUpperCase()in r&&delete n[o];return r=OpenLayers.Util.getParameterString(n),OpenLayers.Util.urlAppend(i,r)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"}),OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,i,n,r,o){this.layer=e,this.position=t.clone(),this.setBounds(i),this.url=n,r&&(this.size=r.clone()),this.id=OpenLayers.Util.createUniqueID("Tile_"),OpenLayers.Util.extend(this,o),this.events=new OpenLayers.Events(this),this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){this.isLoading&&(this.isLoading=!1,this.events.triggerEvent("unload"))},destroy:function(){this.position=this.size=this.bounds=this.layer=null,this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=this.eventListeners=null},draw:function(e){e||this.clear();var t=this.shouldDraw();return t&&!e&&(t=!1!==this.events.triggerEvent("beforedraw")),t},shouldDraw:function(){var e=!1,t=this.layer.maxExtent;if(t){var i=this.layer.map,i=i.baseLayer.wrapDateLine&&i.getMaxExtent();this.bounds.intersectsBounds(t,{inclusive:!1,worldBounds:i})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){if(e=e.clone(),this.layer.map.baseLayer.wrapDateLine)var t=this.layer.map.getMaxExtent(),i=this.layer.map.getResolution(),e=e.wrapDateLine(t,{leftTolerance:i,rightTolerance:i});this.bounds=e},moveTo:function(e,t,i){null==i&&(i=!0),this.setBounds(e),this.position=t.clone(),i&&this.draw()},clear:function(){},CLASS_NAME:"OpenLayers.Tile"}),OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,blankImageUrl:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7",maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(e,t,i,n){OpenLayers.Tile.prototype.initialize.apply(this,arguments),this.url=n,this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack(),(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack)&&(this.frame=document.createElement("div"),this.frame.style.position="absolute",this.frame.style.overflow="hidden"),null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)
},destroy:function(){this.imgDiv&&(this.clear(),this.frame=this.imgDiv=null),this.asyncRequestId=null,OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);return e?(this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position)),this.isLoading?this._loadEvent="reload":(this.isLoading=!0,this._loadEvent="loadstart"),this.positionTile(),this.renderTile()):this.unload(),e},renderTile:function(){if(this.layer.div.appendChild(this.getTile()),this.layer.async){var e=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(t){e==this.asyncRequestId&&(this.url=t,this.initImage())},this)}else this.url=this.layer.getURL(this.bounds),this.initImage()},positionTile:function(){var e=this.getTile().style,t=this.frame?this.size:this.layer.getImageSize(this.bounds);e.left=this.position.x+"%",e.top=this.position.y+"%",e.width=t.w+"%",e.height=t.h+"%"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){OpenLayers.Event.stopObservingElement(e);var t=this.getTile();t.parentNode===this.layer.div&&this.layer.div.removeChild(t),this.setImgSrc(),!0===this.layerAlphaHack&&(e.style.filter=""),OpenLayers.Element.removeClass(e,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=document.createElement("img"),this.imgDiv.className="olTileImage",this.imgDiv.galleryImg="no";var e=this.imgDiv.style;if(this.frame){var t=0,i=0;this.layer.gutter&&(t=100*(this.layer.gutter/this.layer.tileSize.w),i=100*(this.layer.gutter/this.layer.tileSize.h)),e.left=-t+"%",e.top=-i+"%",e.width=2*t+100+"%",e.height=2*i+100+"%"}e.visibility="hidden",e.opacity=0,1>this.layer.opacity&&(e.filter="alpha(opacity="+100*this.layer.opacity+")"),e.position="absolute",this.layerAlphaHack&&(e.paddingTop=e.height,e.height="0",e.width="100%"),this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},initImage:function(){this.events.triggerEvent(this._loadEvent);var e=this.getImage();if(this.url&&e.getAttribute("src")==this.url)this.onImageLoad();else{var t=OpenLayers.Function.bind(function(){OpenLayers.Event.stopObservingElement(e),OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(this.onImageLoad,this)),OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(this.onImageError,this)),this.imageReloadAttempts=0,this.setImgSrc(this.url)},this);e.getAttribute("src")==this.blankImageUrl?t():(OpenLayers.Event.observe(e,"load",t),OpenLayers.Event.observe(e,"error",t),this.crossOriginKeyword&&e.removeAttribute("crossorigin"),e.src=this.blankImageUrl)}},setImgSrc:function(e){var t=this.imgDiv;t.style.visibility="hidden",t.style.opacity=0,e&&(this.crossOriginKeyword&&("data:"!==e.substr(0,5)?t.setAttribute("crossorigin",this.crossOriginKeyword):t.removeAttribute("crossorigin")),t.src=e)},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var e;return this.frame?(e=this.frame.cloneNode(!1),e.appendChild(this.imgDiv)):e=this.imgDiv,this.imgDiv=null,e}},onImageLoad:function(){var e=this.imgDiv;if(OpenLayers.Event.stopObservingElement(e),e.style.visibility="inherit",e.style.opacity=this.layer.opacity,this.isLoading=!1,this.canvasContext=null,this.events.triggerEvent("loadend"),7>parseFloat(navigator.appVersion.split("MSIE")[1])&&this.layer&&this.layer.div){var t=document.createElement("span");t.style.display="none";var i=this.layer.div;i.appendChild(t),window.setTimeout(function(){t.parentNode===i&&t.parentNode.removeChild(t)},0)}!0===this.layerAlphaHack&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var e=this.imgDiv;null!=e.src&&(this.imageReloadAttempts++,this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS?this.setImgSrc(this.layer.getURL(this.bounds)):(OpenLayers.Element.addClass(e,"olImageLoadError"),this.events.triggerEvent("loaderror"),this.onImageLoad()))},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var e=document.createElement("canvas");e.width=this.size.w,e.height=this.size.h,this.canvasContext=e.getContext("2d"),this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"}),OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:null,numLoadingTiles:0,tileLoadingDelay:85,serverResolutions:null,moveTimerId:null,deferMoveGriddedTiles:null,tileQueueId:null,tileQueue:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,initialize:function(){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments),this.grid=[],this.tileQueue=[],null===this.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500),null===this.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid"),OpenLayers.Animation.isNative||(this.deferMoveGriddedTiles=OpenLayers.Function.bind(function(){this.moveGriddedTiles(!0),this.moveTimerId=null},this))},setMap:function(e){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,e),OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(){null!==this.moveTimerId&&(window.clearTimeout(this.moveTimerId),this.moveTimerId=null),this.clearTileQueue(),null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null)},destroy:function(){this.removeBackBuffer(),this.clearGrid(),this.tileSize=this.grid=null,OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.clearTileQueue(),this.grid){for(var e=0,t=this.grid.length;t>e;e++)for(var i=this.grid[e],n=0,r=i.length;r>n;n++)this.destroyTile(i[n]);this.grid=[],this.gridResolution=null}},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e.gridResolution=null,e.backBuffer=null,e.backBufferTimerId=null,e.tileQueue=[],e.tileQueueId=null,e.loading=!1,e.moveTimerId=null,e},moveTo:function(e,t,i){if(OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments),e=e||this.map.getExtent(),null!=e){var n=!this.grid.length||t,r=this.getTilesBounds(),o=this.map.getResolution(),s=this.getServerResolution(o);this.singleTile?(n||!i&&!r.containsBounds(e))&&(t&&"resize"!==this.transitionEffect&&this.removeBackBuffer(),(!t||"resize"===this.transitionEffect)&&this.applyBackBuffer(s),this.initSingleTile(e)):(n=n||!r.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()}),o!==s?(e=this.map.calculateBounds(null,s),n&&this.transformDiv(s/o)):(this.div.style.width="100%",this.div.style.height="100%",this.div.style.left="0%",this.div.style.top="0%"),n?(t&&"resize"===this.transitionEffect&&this.applyBackBuffer(s),this.initGriddedTiles(e)):this.moveGriddedTiles())}},getTileData:function(e){var t=null,i=e.lon,n=e.lat,r=this.grid.length;if(this.map&&r){var o=this.map.getResolution(),e=this.tileSize.w,s=this.tileSize.h,a=this.grid[0][0].bounds,l=a.left,a=a.top;if(l>i&&this.map.baseLayer.wrapDateLine)var h=this.map.getMaxExtent().getWidth(),c=Math.ceil((l-i)/h),i=i+h*c;i=(i-l)/(o*e),n=(a-n)/(o*s),o=Math.floor(i),l=Math.floor(n),l>=0&&r>l&&(r=this.grid[l][o])&&(t={tile:r,i:Math.floor((i-o)*e),j:Math.floor((n-l)*s)})}return t},queueTileDraw:function(e){return e=e.object,~OpenLayers.Util.indexOf(this.tileQueue,e)||this.tileQueue.push(e),this.tileQueueId||(this.tileQueueId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.drawTileFromQueue,this),null,this.div)),!1},drawTileFromQueue:function(){0===this.tileQueue.length?this.clearTileQueue():this.tileQueue.shift().draw(!0)},clearTileQueue:function(){OpenLayers.Animation.stop(this.tileQueueId),this.tileQueueId=null,this.tileQueue=[]},destroyTile:function(e){this.removeTileMonitoringHooks(e),e.destroy()},getServerResolution:function(e){if(e=e||this.map.getResolution(),this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,e)){var t,i;for(t=this.serverResolutions.length-1;t>=0;t--)if(i=this.serverResolutions[t],i>e){e=i;break}if(-1===t)throw"no appropriate resolution in serverResolutions"}return e},getServerZoom:function(){var e=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,e):this.map.getZoomForResolution(e)+(this.zoomOffset||0)},transformDiv:function(e){this.div.style.width=100*e+"%",this.div.style.height=100*e+"%";var t=this.map.getSize(),i=parseInt(this.map.layerContainerDiv.style.left,10),n=(parseInt(this.map.layerContainerDiv.style.top,10)-t.h/2)*(e-1);this.div.style.left=(i-t.w/2)*(e-1)+"%",this.div.style.top=n+"%"},getResolutionScale:function(){return parseInt(this.div.style.width,10)/100},applyBackBuffer:function(e){null!==this.backBufferTimerId&&this.removeBackBuffer();var t=this.backBuffer;if(!t){if(t=this.createBackBuffer(),!t)return;this.div.insertBefore(t,this.div.firstChild),this.backBuffer=t;var i=this.grid[0][0].bounds;this.backBufferLonLat={lon:i.left,lat:i.top},this.backBufferResolution=this.gridResolution}var i=t.style,n=this.backBufferResolution/e;i.width=100*n+"%",i.height=100*n+"%",e=this.getViewPortPxFromLonLat(this.backBufferLonLat,e),i=parseInt(this.map.layerContainerDiv.style.left,10),n=parseInt(this.map.layerContainerDiv.style.top,10),t.style.left=Math.round(e.x-i)+"%",t.style.top=Math.round(e.y-n)+"%"},createBackBuffer:function(){var e;if(this.grid.length>0){e=document.createElement("div"),e.id=this.div.id+"_bb",e.className="olBackBuffer",e.style.position="absolute",e.style.width="100%",e.style.height="100%";for(var t=0,i=this.grid.length;i>t;t++)for(var n=0,r=this.grid[t].length;r>n;n++){var o=this.grid[t][n].createBackBuffer();o&&(o.style.top=t*this.tileSize.h+"%",o.style.left=n*this.tileSize.w+"%",e.appendChild(o))}}return e},removeBackBuffer:function(){this.backBuffer&&(this.div.removeChild(this.backBuffer),this.backBufferResolution=this.backBuffer=null,null!==this.backBufferTimerId&&(window.clearTimeout(this.backBufferTimerId),this.backBufferTimerId=null))},moveByPx:function(){this.singleTile||this.moveGriddedTiles()},setTileSize:function(e){this.singleTile&&(e=this.map.getSize(),e.h=parseInt(e.h*this.ratio),e.w=parseInt(e.w*this.ratio)),OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getTilesBounds:function(){var e=null,t=this.grid.length;if(t)var e=this.grid[t-1][0].bounds,t=this.grid[0].length*e.getWidth(),i=this.grid.length*e.getHeight(),e=new OpenLayers.Bounds(e.left,e.bottom,e.left+t,e.bottom+i);return e},initSingleTile:function(e){this.clearTileQueue();var t=e.getCenterLonLat(),i=e.getWidth()*this.ratio,e=e.getHeight()*this.ratio,t=new OpenLayers.Bounds(t.lon-i/2,t.lat-e/2,t.lon+i/2,t.lat+e/2),i=this.map.getLayerPxFromLonLat({lon:t.left,lat:t.top});this.grid.length||(this.grid[0]=[]),(e=this.grid[0][0])?e.moveTo(t,i):(e=this.addTile(t,i),this.addTileMonitoringHooks(e),e.draw(),this.grid[0][0]=e),this.removeExcessTiles(1,1),this.gridResolution=this.getServerResolution()},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w,i=i*this.tileSize.h,r=e.left-t.lon,o=Math.floor(r/n)-this.buffer,r=-(r/n-o)*this.tileSize.w,o=t.lon+o*n,e=e.top-(t.lat+i),s=Math.ceil(e/i)+this.buffer;return{tilelon:n,tilelat:i,tileoffsetlon:o,tileoffsetlat:t.lat+s*i,tileoffsetx:r,tileoffsety:-(s-e/i)*this.tileSize.h}},getTileOrigin:function(){var e=this.tileOrigin;if(!e)var e=this.getMaxExtent(),t={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner],e=new OpenLayers.LonLat(e[t[0]],e[t[1]]);return e},initGriddedTiles:function(e){this.clearTileQueue();var t=this.map.getSize(),i=Math.ceil(t.h/this.tileSize.h)+Math.max(1,2*this.buffer),t=Math.ceil(t.w/this.tileSize.w)+Math.max(1,2*this.buffer),n=this.getTileOrigin(),r=this.getServerResolution(),n=this.calculateGridLayout(e,n,r),r=Math.round(n.tileoffsetx),o=Math.round(n.tileoffsety),s=n.tileoffsetlon,a=n.tileoffsetlat,l=n.tilelon,h=n.tilelat,c=r,u=s,d=0,p=parseInt(this.map.layerContainerDiv.style.left),f=parseInt(this.map.layerContainerDiv.style.top),n=[],m=this.map.getCenter();do{var g=this.grid[d++];g||(g=[],this.grid.push(g));var s=u,r=c,y=0;do{var v=new OpenLayers.Bounds(s,a,s+l,a+h),b=r,b=b-p,L=o,L=L-f,L=new OpenLayers.Pixel(b,L);(b=g[y++])?b.moveTo(v,L,!1):(b=this.addTile(v,L),this.addTileMonitoringHooks(b),g.push(b)),v=v.getCenterLonLat(),n.push({tile:b,distance:Math.pow(v.lon-m.lon,2)+Math.pow(v.lat-m.lat,2)}),s+=l,r+=this.tileSize.w}while(e.right+l*this.buffer>=s||t>y);a-=h,o+=this.tileSize.h}while(a>=e.bottom-h*this.buffer||i>d);for(this.removeExcessTiles(d,y),this.gridResolution=this.getServerResolution(),n.sort(function(e,t){return e.distance-t.distance}),e=0,i=n.length;i>e;++e)n[e].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(e,t){var i=new this.tileClass(this,t,e,null,this.tileSize,this.tileOptions);return i.events.register("beforedraw",this,this.queueTileDraw),i},addTileMonitoringHooks:function(e){e.onLoadStart=function(){!1===this.loading&&(this.loading=!0,this.events.triggerEvent("loadstart")),this.events.triggerEvent("tileloadstart",{tile:e}),this.numLoadingTiles++},e.onLoadEnd=function(){this.numLoadingTiles--,this.events.triggerEvent("tileloaded",{tile:e}),0===this.tileQueue.length&&0===this.numLoadingTiles&&(this.loading=!1,this.events.triggerEvent("loadend"),this.backBuffer&&(this.backBufferTimerId=window.setTimeout(OpenLayers.Function.bind(this.removeBackBuffer,this),this.removeBackBufferDelay)))},e.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:e})},e.events.on({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},removeTileMonitoringHooks:function(e){e.unload(),e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},moveGriddedTiles:function(e){if(e||OpenLayers.Animation.isNative)for(var e=this.buffer||1,t=this.getResolutionScale();;){var i=this.grid[0][0].position.x*t+parseInt(this.div.style.left,10)+parseInt(this.map.layerContainerDiv.style.left),n=this.grid[0][0].position.y*t+parseInt(this.div.style.top,10)+parseInt(this.map.layerContainerDiv.style.top),r=this.tileSize.w*t,o=this.tileSize.h*t;if(i>-r*(e-1))this.shiftColumn(!0);else if(-r*e>i)this.shiftColumn(!1);else if(n>-o*(e-1))this.shiftRow(!0);else{if(!(-o*e>n))break;this.shiftRow(!1)}}else null!=this.moveTimerId&&window.clearTimeout(this.moveTimerId),this.moveTimerId=window.setTimeout(this.deferMoveGriddedTiles,this.tileLoadingDelay)},shiftRow:function(e){for(var t=this.grid,i=t[e?0:this.grid.length-1],n=this.getServerResolution(),r=e?-this.tileSize.h:this.tileSize.h,n=n*-r,o=e?t.pop():t.shift(),s=0,a=i.length;a>s;s++){var l=i[s],h=l.bounds.clone(),l=l.position.clone();h.bottom+=n,h.top+=n,l.y+=r,o[s].moveTo(h,l)}e?t.unshift(o):t.push(o)},shiftColumn:function(e){for(var t=e?-this.tileSize.w:this.tileSize.w,i=this.getServerResolution()*t,n=0,r=this.grid.length;r>n;n++){var o=this.grid[n],s=o[e?0:o.length-1],a=s.bounds.clone(),s=s.position.clone();a.left+=i,a.right+=i,s.x+=t;var l=e?this.grid[n].pop():this.grid[n].shift();l.moveTo(a,s),e?o.unshift(l):o.push(l)}},removeExcessTiles:function(e,t){for(var i,n;this.grid.length>e;){var r=this.grid.pop();for(i=0,n=r.length;n>i;i++){var o=r[i];this.destroyTile(o)}}for(i=0,n=this.grid.length;n>i;i++)for(;this.grid[i].length>t;)r=this.grid[i],o=r.pop(),this.destroyTile(o)},onMapResize:function(){this.singleTile&&(this.clearGrid(),this.setTileSize())},getTileBounds:function(e){var t=this.maxExtent,i=this.getResolution(),n=i*this.tileSize.w,i=i*this.tileSize.h,r=this.getLonLatFromViewPortPx(e),e=t.left+n*Math.floor((r.lon-t.left)/n),t=t.bottom+i*Math.floor((r.lat-t.bottom)/i);return new OpenLayers.Bounds(e,t,e+n,t+i)},CLASS_NAME:"OpenLayers.Layer.Grid"}),OpenLayers.Layer.XYZ=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,sphericalMercator:!1,zoomOffset:0,serverResolutions:null,initialize:function(e,t,i){(i&&i.sphericalMercator||this.sphericalMercator)&&(i=OpenLayers.Util.extend({projection:"EPSG:900913",numZoomLevels:19},i)),OpenLayers.Layer.Grid.prototype.initialize.apply(this,[e||this.name,t||this.url,{},i])},clone:function(e){return null==e&&(e=new OpenLayers.Layer.XYZ(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},getURL:function(e){var e=this.getXYZ(e),t=this.url;return OpenLayers.Util.isArray(t)&&(t=this.selectUrl(""+e.x+e.y+e.z,t)),OpenLayers.String.format(t,e)},getXYZ:function(e){var t=this.getServerResolution(),i=Math.round((e.left-this.maxExtent.left)/(t*this.tileSize.w)),e=Math.round((this.maxExtent.top-e.top)/(t*this.tileSize.h)),t=this.getServerZoom();if(this.wrapDateLine)var n=Math.pow(2,t),i=(i%n+n)%n;return{x:i,y:e,z:t}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments),this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.bottom))},CLASS_NAME:"OpenLayers.Layer.XYZ"}),OpenLayers.Layer.OSM=OpenLayers.Class(OpenLayers.Layer.XYZ,{name:"OpenStreetMap",url:["http://a.tile.openstreetmap.org/${z}/${x}/${y}.png","http://b.tile.openstreetmap.org/${z}/${x}/${y}.png","http://c.tile.openstreetmap.org/${z}/${x}/${y}.png"],attribution:"Data CC-By-SA by <a href='http://openstreetmap.org/'>OpenStreetMap</a>",sphericalMercator:!0,wrapDateLine:!0,tileOptions:null,initialize:function(){OpenLayers.Layer.XYZ.prototype.initialize.apply(this,arguments),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options&&this.options.tileOptions)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.OSM(this.name,this.url,this.getOptions())),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},CLASS_NAME:"OpenLayers.Layer.OSM"}),OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e),OpenLayers.Util.extend(this,t)},destroy:function(){this.map=this.resolution=this.size=this.extent=this.container=null},supported:function(){return!1},setExtent:function(e,t){if(this.extent=e.clone(),this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var i=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/i);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(i)}return t&&(this.resolution=null),!0},setSize:function(e){this.size=e.clone(),this.resolution=null},getResolution:function(){return this.resolution=this.resolution||this.map.getResolution()},drawFeature:function(e,t){if(null==t&&(t=e.style),e.geometry){var i=e.geometry.getBounds();if(i){var n;if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent()),i.intersectsBounds(this.extent,{worldBounds:n})?this.calculateFeatureDx(i,n):t={display:"none"},i=this.drawGeometry(e.geometry,t,e.id),"none"!=t.display&&t.label&&!1!==i){if(n=e.geometry.getCentroid(),t.labelXOffset||t.labelYOffset){var r=isNaN(t.labelXOffset)?0:t.labelXOffset,o=isNaN(t.labelYOffset)?0:t.labelYOffset,s=this.getResolution();n.move(r*s,o*s)}this.drawText(e.id,t,n)}else this.removeText(e.id);return i}}},calculateFeatureDx:function(e,t){if(this.featureDx=0,t){var i=t.getWidth();this.featureDx=Math.round(((e.left+e.right)/2-(this.extent.left+this.extent.right)/2)/i)*i}},drawGeometry:function(){},drawText:function(){},removeText:function(){},clear:function(){},getFeatureIdFromEvent:function(){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,i=e.length;i>t;++t){var n=e[t];this.eraseGeometry(n.geometry,n.id),this.removeText(n.id)}},eraseGeometry:function(){},moveRoot:function(){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);return!1===e.stroke&&(delete t.strokeWidth,delete t.strokeColor),!1===e.fill&&delete t.fillColor,OpenLayers.Util.extend(t,e),t},CLASS_NAME:"OpenLayers.Renderer"}),OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"},OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]},OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.root=document.createElement("canvas"),this.container.appendChild(this.root),this.canvas=this.root.getContext("2d"),this.features={},this.hitDetection&&(this.hitCanvas=document.createElement("canvas"),this.hitContext=this.hitCanvas.getContext("2d"))},setExtent:function(){return OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),!1},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(e){this.size=e.clone();var t=this.root;t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h,this.resolution=null,this.hitDetection&&(t=this.hitCanvas,t.style.width=e.w+"px",t.style.height=e.h+"px",t.width=e.w,t.height=e.h)},drawFeature:function(e,t){var i;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style),i=e.geometry.getBounds();var n;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent()),n=i&&i.intersectsBounds(this.extent,{worldBounds:n}),(i="none"!==t.display&&!!i&&n)?this.features[e.id]=[e,t]:delete this.features[e.id],this.pendingRedraw=!0}return this.pendingRedraw&&!this.locked&&(this.redraw(),this.pendingRedraw=!1),i},drawGeometry:function(e,t,i){var n=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"==n||"OpenLayers.Geometry.MultiPoint"==n||"OpenLayers.Geometry.MultiLineString"==n||"OpenLayers.Geometry.MultiPolygon"==n)for(n=0;e.components.length>n;n++)this.drawGeometry(e.components[n],t,i);else switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,i);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,i);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,i);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,i)}},drawExternalGraphic:function(e,t,i){var n=new Image;t.graphicTitle&&(n.title=t.graphicTitle);var r=t.graphicWidth||t.graphicHeight,o=t.graphicHeight||t.graphicWidth,r=r?r:2*t.pointRadius,o=o?o:2*t.pointRadius,s=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*r),a=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*o),l=t.graphicOpacity||t.fillOpacity;n.onload=OpenLayers.Function.bind(function(){if(this.features[i]){var t=this.getLocalXY(e),h=t[0],t=t[1];if(!isNaN(h)&&!isNaN(t)){var h=0|h+s,t=0|t+a,c=this.canvas;c.globalAlpha=l;var u=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);c.drawImage(n,h*u,t*u,r*u,o*u),this.hitDetection&&(this.setHitContextStyle("fill",i),this.hitContext.fillRect(h,t,r,o))}}},this),n.src=t.externalGraphic},drawNamedSymbol:function(e,t,i){var n,r,o,s;o=Math.PI/180;var a=OpenLayers.Renderer.symbol[t.graphicName];if(!a)throw Error(t.graphicName+" is not a valid symbol name");if(!(!a.length||2>a.length||(e=this.getLocalXY(e),r=e[0],s=e[1],isNaN(r)||isNaN(s)))){if(this.canvas.lineCap="round",this.canvas.lineJoin="round",this.hitDetection&&(this.hitContext.lineCap="round",this.hitContext.lineJoin="round"),t.graphicName in this.cachedSymbolBounds)n=this.cachedSymbolBounds[t.graphicName];else{for(n=new OpenLayers.Bounds,e=0;a.length>e;e+=2)n.extend(new OpenLayers.LonLat(a[e],a[e+1]));this.cachedSymbolBounds[t.graphicName]=n}if(this.canvas.save(),this.hitDetection&&this.hitContext.save(),this.canvas.translate(r,s),this.hitDetection&&this.hitContext.translate(r,s),e=o*t.rotation,isNaN(e)||(this.canvas.rotate(e),this.hitDetection&&this.hitContext.rotate(e)),o=2*t.pointRadius/Math.max(n.getWidth(),n.getHeight()),this.canvas.scale(o,o),this.hitDetection&&this.hitContext.scale(o,o),e=n.getCenterLonLat().lon,n=n.getCenterLonLat().lat,this.canvas.translate(-e,-n),this.hitDetection&&this.hitContext.translate(-e,-n),s=t.strokeWidth,t.strokeWidth=s/o,!1!==t.fill){for(this.setCanvasStyle("fill",t),this.canvas.beginPath(),e=0;a.length>e;e+=2)n=a[e],r=a[e+1],0==e&&this.canvas.moveTo(n,r),this.canvas.lineTo(n,r);if(this.canvas.closePath(),this.canvas.fill(),this.hitDetection){for(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),e=0;a.length>e;e+=2)n=a[e],r=a[e+1],0==e&&this.canvas.moveTo(n,r),this.hitContext.lineTo(n,r);this.hitContext.closePath(),this.hitContext.fill()}}if(!1!==t.stroke){for(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),e=0;a.length>e;e+=2)n=a[e],r=a[e+1],0==e&&this.canvas.moveTo(n,r),this.canvas.lineTo(n,r);if(this.canvas.closePath(),this.canvas.stroke(),this.hitDetection){for(this.setHitContextStyle("stroke",i,t,o),this.hitContext.beginPath(),e=0;a.length>e;e+=2)n=a[e],r=a[e+1],0==e&&this.hitContext.moveTo(n,r),this.hitContext.lineTo(n,r);this.hitContext.closePath(),this.hitContext.stroke()}}t.strokeWidth=s,this.canvas.restore(),this.hitDetection&&this.hitContext.restore(),this.setCanvasStyle("reset")}},setCanvasStyle:function(e,t){"fill"===e?(this.canvas.globalAlpha=t.fillOpacity,this.canvas.fillStyle=t.fillColor):"stroke"===e?(this.canvas.globalAlpha=t.strokeOpacity,this.canvas.strokeStyle=t.strokeColor,this.canvas.lineWidth=t.strokeWidth):(this.canvas.globalAlpha=0,this.canvas.lineWidth=1)},featureIdToHex:function(e){e=Number(e.split("_").pop())+1,e>=16777216&&(this.hitOverflow=e-16777215,e=e%16777216+1);var e="000000"+e.toString(16),t=e.length;return e="#"+e.substring(t-6,t)},setHitContextStyle:function(e,t,i,n){t=this.featureIdToHex(t),"fill"==e?(this.hitContext.globalAlpha=1,this.hitContext.fillStyle=t):"stroke"==e?(this.hitContext.globalAlpha=1,this.hitContext.strokeStyle=t,n===void 0?this.hitContext.lineWidth=i.strokeWidth+2:isNaN(n)||(this.hitContext.lineWidth=i.strokeWidth+2/n)):(this.hitContext.globalAlpha=0,this.hitContext.lineWidth=1)},drawPoint:function(e,t,i){if(!1!==t.graphic)if(t.externalGraphic)this.drawExternalGraphic(e,t,i);else if(t.graphicName&&"circle"!=t.graphicName)this.drawNamedSymbol(e,t,i);else{var n=this.getLocalXY(e),e=n[0],n=n[1];if(!isNaN(e)&&!isNaN(n)){var r=2*Math.PI,o=t.pointRadius;!1!==t.fill&&(this.setCanvasStyle("fill",t),this.canvas.beginPath(),this.canvas.arc(e,n,o,0,r,!0),this.canvas.fill(),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.hitContext.beginPath(),this.hitContext.arc(e,n,o,0,r,!0),this.hitContext.fill())),!1!==t.stroke&&(this.setCanvasStyle("stroke",t),this.canvas.beginPath(),this.canvas.arc(e,n,o,0,r,!0),this.canvas.stroke(),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.hitContext.beginPath(),this.hitContext.arc(e,n,o,0,r,!0),this.hitContext.stroke()),this.setCanvasStyle("reset"))}}},drawLineString:function(e,t,i){t=OpenLayers.Util.applyDefaults({fill:!1},t),this.drawLinearRing(e,t,i)},drawLinearRing:function(e,t,i){!1!==t.fill&&(this.setCanvasStyle("fill",t),this.renderPath(this.canvas,e,t,i,"fill"),this.hitDetection&&(this.setHitContextStyle("fill",i,t),this.renderPath(this.hitContext,e,t,i,"fill"))),!1!==t.stroke&&(this.setCanvasStyle("stroke",t),this.renderPath(this.canvas,e,t,i,"stroke"),this.hitDetection&&(this.setHitContextStyle("stroke",i,t),this.renderPath(this.hitContext,e,t,i,"stroke"))),this.setCanvasStyle("reset")},renderPath:function(e,t,i,n,r){t=t.components,i=t.length,e.beginPath();var n=this.getLocalXY(t[0]),o=n[1];if(!isNaN(n[0])&&!isNaN(o)){for(e.moveTo(n[0],n[1]),n=1;i>n;++n)o=this.getLocalXY(t[n]),e.lineTo(o[0],o[1]);"fill"===r?e.fill():e.stroke()}},drawPolygon:function(e,t,i){var e=e.components,n=e.length;this.drawLinearRing(e[0],t,i);for(var r=1;n>r;++r)this.canvas.globalCompositeOperation="destination-out",this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out"),this.drawLinearRing(e[r],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),i),this.canvas.globalCompositeOperation="source-over",this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over"),this.drawLinearRing(e[r],OpenLayers.Util.applyDefaults({fill:!1},t),i)},drawText:function(e,t){var i=this.getLocalXY(e);this.setCanvasStyle("reset"),this.canvas.fillStyle=t.fontColor,this.canvas.globalAlpha=t.fontOpacity||1;var n=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),r=t.label.split("\n"),o=r.length;if(this.canvas.fillText){this.canvas.font=n,this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center",this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];for(null==s&&(s=-.5),n=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width,i[1]+=n*s*(o-1),s=0;o>s;s++)t.labelOutlineWidth&&(this.canvas.save(),this.canvas.strokeStyle=t.labelOutlineColor,this.canvas.lineWidth=t.labelOutlineWidth,this.canvas.strokeText(r[s],i[0],i[1]+n*s+1),this.canvas.restore()),this.canvas.fillText(r[s],i[0],i[1]+n*s)}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=n;var a=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];for(null==a&&(a=-.5),s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]],null==s&&(s=-.5),n=this.canvas.mozMeasureText("xx"),i[1]+=n*(1+s*o),s=0;o>s;s++){var l=i[0]+a*this.canvas.mozMeasureText(r[s]),h=i[1]+s*n;this.canvas.translate(l,h),this.canvas.mozDrawText(r[s]),this.canvas.translate(-l,-h)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),i=this.extent;return[(e.x-this.featureDx)/t+-i.left/t,i.top/t-e.y/t]},clear:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.features={},this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging&&(e=e.xy,e=this.hitContext.getImageData(0|e.x,0|e.y,1,1).data,255===e[3]&&(e=e[2]+256*(e[1]+256*e[0])))){e="OpenLayers.Feature.Vector_"+(e-1+this.hitOverflow);try{t=this.features[e][0]}catch(i){}}return t},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;e.length>t;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e),this.hitDetection&&this.hitContext.clearRect(0,0,t,e);var i,n,r,e=[],o=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(r in this.features)this.features.hasOwnProperty(r)&&(t=this.features[r][0],i=t.geometry,this.calculateFeatureDx(i.getBounds(),o),n=this.features[r][1],this.drawGeometry(i,n,t.id),n.label&&e.push([t,n]));for(t=0,i=e.length;i>t;++t)r=e[t],this.drawText(r[0].geometry.getCentroid(),r[1])}},CLASS_NAME:"OpenLayers.Renderer.Canvas"}),OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"},OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1},OpenLayers.Renderer.Canvas.drawImageScaleFactor=null,OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,initialize:function(e,t,i){OpenLayers.Util.extend(this,i),this.control=e,this.callbacks=t,(e=this.map||e.map)&&this.setMap(e),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")
},setMap:function(e){this.map=e},checkModifiers:function(e){return null==this.keyMask?!0:((e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0))==this.keyMask},activate:function(){if(this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;i>t;t++)this[e[t]]&&this.register(e[t],this[e[t]]);return this.active=!0},deactivate:function(){if(!this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,i=e.length;i>t;t++)this[e[t]]&&this.unregister(e[t],this[e[t]]);return this.active=!1,!0},callback:function(e,t){e&&this.callbacks[e]&&this.callbacks[e].apply(this.control,t)},register:function(e,t){this.map.events.registerPriority(e,this,t),this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t),this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){return this.evt=e,!0},destroy:function(){this.deactivate(),this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"}),OpenLayers.Handler.MOD_NONE=0,OpenLayers.Handler.MOD_SHIFT=1,OpenLayers.Handler.MOD_CTRL=2,OpenLayers.Handler.MOD_ALT=4,OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,touch:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(){if(OpenLayers.Handler.prototype.initialize.apply(this,arguments),!0===this.documentDrag){var e=this;this._docMove=function(t){e.mousemove({xy:{x:t.clientX,y:t.clientY},element:document})},this._docUp=function(t){e.mouseup({xy:{x:t.clientX,y:t.clientY}})}}},dragstart:function(e){var t=!0;return this.dragging=!1,this.checkModifiers(e)&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))?(this.started=!0,this.last=this.start=e.xy,OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown"),this.down(e),this.callback("down",[e.xy]),OpenLayers.Event.stop(e),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True),document.onselectstart=OpenLayers.Function.False,t=!this.stopDown):(this.started=!1,this.last=this.start=null),t},dragmove:function(e){return this.lastMoveEvt=e,!this.started||this.timeoutId||e.xy.x==this.last.x&&e.xy.y==this.last.y||(!0===this.documentDrag&&this.documentEvents&&(e.element===document?(this.adjustXY(e),this.setEvent(e)):this.removeDocumentEvents()),this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval)),this.dragging=!0,this.move(e),this.callback("move",[e.xy]),this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart,document.onselectstart=OpenLayers.Function.False),this.last=e.xy),!0},dragend:function(e){if(this.started){!0===this.documentDrag&&this.documentEvents&&(this.adjustXY(e),this.removeDocumentEvents());var t=this.start!=this.last;this.dragging=this.started=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.up(e),this.callback("up",[e.xy]),t&&this.callback("done",[e.xy]),document.onselectstart=this.oldOnselectstart}return!0},down:function(){},move:function(){},up:function(){},out:function(){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,scope:this})),this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null,this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(e){return this.dragend(e)},touchend:function(e){return e.xy=this.last,this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv))if(!0===this.documentDrag)this.addDocumentEvents();else{var t=this.start!=this.last;this.dragging=this.started=!1,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown"),this.out(e),this.callback("out",[]),t&&this.callback("done",[e.xy]),document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(){return this.start==this.last},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.dragging=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.dragging=this.started=this.touch=!1,this.last=this.start=null,e=!0,OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")),e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0],e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown"),this.documentEvents=!0,OpenLayers.Event.observe(document,"mousemove",this._docMove),OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown"),this.documentEvents=!1,OpenLayers.Event.stopObserving(document,"mousemove",this._docMove),OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"}),OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,touch:!1,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,t,i,n){OpenLayers.Handler.prototype.initialize.apply(this,[e,i,n]),this.layer=t},touchstart:function(e){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),OpenLayers.Event.isMultiTouch(e)?!0:this.mousedown(e)},touchmove:function(e){OpenLayers.Event.stop(e)},mousedown:function(e){return(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.down=e.xy),this.handle(e)?!this.stopDown:!0},mouseup:function(e){return this.up=e.xy,this.handle(e)?!this.stopUp:!0},click:function(e){return this.handle(e)?!this.stopClick:!0},mousemove:function(e){return this.callbacks.over||this.callbacks.out?(this.handle(e),!0):!0},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,i=!1,n=!!this.feature,r="click"==t||"dblclick"==t||"touchstart"==t;return(this.feature=this.layer.getFeatureFromEvent(e))&&!this.feature.layer&&(this.feature=null),this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null),this.feature?("touchstart"===t&&OpenLayers.Event.stop(e),e=this.feature!=this.lastFeature,this.geometryTypeMatches(this.feature)?(n&&e?(this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]),this.triggerCallback(t,"in",[this.feature])):(!n||r)&&this.triggerCallback(t,"in",[this.feature]),this.lastFeature=this.feature,i=!0):(this.lastFeature&&(n&&e||r)&&this.triggerCallback(t,"out",[this.lastFeature]),this.feature=null)):this.lastFeature&&(n||r)&&this.triggerCallback(t,"out",[this.lastFeature]),i},triggerCallback:function(e,t,i){(t=this.EVENTMAP[e][t])&&("click"==e&&this.up&&this.down?Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2))<=this.clickTolerance&&this.callback(t,i):this.callback(t,i))},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.moveLayerToTop(),this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.moveLayerBack(),this.up=this.down=this.lastFeature=this.feature=null,this.touch=!1,this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this}),e=!0),e},handleMapEvents:function(e){("removelayer"==e.type||"order"==e.property)&&this.moveLayerToTop()},moveLayerToTop:function(){this.layer.setZIndex(Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"}),OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(){},onDrag:function(){},onComplete:function(){},onEnter:function(){},onLeave:function(){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),this.layer=e,this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(e){this.handlers.feature.touch&&!this.over&&this.overFeature(e)&&(this.handlers.drag.dragstart(this.handlers.feature.evt),this.handlers.drag.stopDown=!1)},clickoutFeature:function(e){this.handlers.feature.touch&&this.over&&(this.outFeature(e),this.handlers.drag.stopDown=!0)},destroy:function(){this.layer=null,OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.handlers.drag.deactivate(),this.handlers.feature.deactivate(),this.feature=null,this.dragging=!1,this.lastPixel=null,OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(e){var t=!1;return this.handlers.drag.dragging?this.over=this.feature.id==e.id?!0:!1:(this.feature=e,this.handlers.drag.activate(),this.over=t=!0,OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onEnter(e)),t},downFeature:function(e){this.lastPixel=e,this.onStart(this.feature,e)},moveFeature:function(e){var t=this.map.getResolution();this.feature.geometry.move(t*(e.x-this.lastPixel.x),t*(this.lastPixel.y-e.y)),this.layer.drawFeature(this.feature),this.lastPixel=e,this.onDrag(this.feature,e)},upFeature:function(){this.over||this.handlers.drag.deactivate()},doneDragging:function(e){this.onComplete(this.feature,e)},outFeature:function(e){this.handlers.drag.dragging?this.feature.id==e.id&&(this.over=!1):(this.over=!1,this.handlers.drag.deactivate(),OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over"),this.onLeave(e),this.feature=null)},cancel:function(){this.handlers.drag.deactivate(),this.over=!1},setMap:function(e){this.handlers.drag.setMap(e),this.handlers.feature.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.DragFeature"}),OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,i){this.layer=e,this.lonlat=t,this.data=null!=i?i:{},this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup),null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker),this.data=this.lonlat=this.id=this.layer=null,null!=this.marker&&(this.destroyMarker(this.marker),this.marker=null),null!=this.popup&&(this.destroyPopup(this.popup),this.popup=null)},onScreen:function(){var e=!1;return null!=this.layer&&null!=this.layer.map&&(e=this.layer.map.getExtent().containsLonLat(this.lonlat)),e},createMarker:function(){return null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon)),this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){return null!=this.lonlat&&(this.popup||(this.popup=new(this.popupClass?this.popupClass:OpenLayers.Popup.Anchored)(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,this.marker?this.marker.icon:null,e)),null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow),this.popup.feature=this),this.popup},destroyPopup:function(){this.popup&&(this.popup.feature=null,this.popup.destroy(),this.popup=null)},CLASS_NAME:"OpenLayers.Feature"}),OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,i){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]),this.lonlat=null,this.geometry=e?e:null,this.state=null,this.attributes={},t&&(this.attributes=OpenLayers.Util.extend(this.attributes,t)),this.style=i?i:null},destroy:function(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.modified=this.geometry=null,OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;return this.layer&&this.layer.map&&(t=this.layer.map.getExtent(),e?(e=this.geometry.getBounds(),t=t.intersectsBounds(e)):t=t.toGeometry().intersects(this.geometry)),t},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,i){var n=!1;return this.geometry&&(n=this.geometry.atPoint(e,t,i)),n},destroyPopup:function(){},move:function(e){if(this.layer&&this.geometry.move){var e="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e,t=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),i=this.layer.map.getResolution();return this.geometry.move(i*(e.x-t.x),i*(t.y-e.y)),this.layer.drawFeature(this),t}},toState:function(e){if(e==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e}else if(e==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e==OpenLayers.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"OpenLayers.Feature.Vector"}),OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}},OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t),this.rules=[],t&&t.rules&&this.addRules(t.rules),this.setDefaultStyle(e||OpenLayers.Feature.Vector.style["default"]),this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;t>e;e++)this.rules[e].destroy(),this.rules[e]=null;this.defaultStyle=this.rules=null},createSymbolizer:function(e){for(var t,i=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),n=this.rules,r=[],o=!1,s=0,a=n.length;a>s;s++)t=n[s],t.evaluate(e)&&(t instanceof OpenLayers.Rule&&t.elseFilter?r.push(t):(o=!0,this.applySymbolizer(t,i,e)));if(!1==o&&r.length>0)for(o=!0,s=0,a=r.length;a>s;s++)this.applySymbolizer(r[s],i,e);return n.length>0&&!1==o&&(i.display="none"),null!=i.label&&"string"!=typeof i.label&&(i.label=""+i.label),i},applySymbolizer:function(e,t,i){var n=i.geometry?this.getSymbolizerPrefix(i.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],e=e.symbolizer[n]||e.symbolizer;return!0===this.defaultsPerSymbolizer&&(n=this.defaultStyle,OpenLayers.Util.applyDefaults(e,{pointRadius:n.pointRadius}),(!0===e.stroke||!0===e.graphic)&&OpenLayers.Util.applyDefaults(e,{strokeWidth:n.strokeWidth,strokeColor:n.strokeColor,strokeOpacity:n.strokeOpacity,strokeDashstyle:n.strokeDashstyle,strokeLinecap:n.strokeLinecap}),(!0===e.fill||!0===e.graphic)&&OpenLayers.Util.applyDefaults(e,{fillColor:n.fillColor,fillOpacity:n.fillOpacity}),!0===e.graphic&&OpenLayers.Util.applyDefaults(e,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})),this.createLiterals(OpenLayers.Util.extend(t,e),i)},createLiterals:function(e,t){var i=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(i,this.context);for(var n in this.propertyStyles)e[n]=OpenLayers.Style.createLiteral(e[n],i,t,n);return e},findPropertyStyles:function(){var e={};this.addPropertyStyles(e,this.defaultStyle);for(var t,i,n=this.rules,r=0,o=n.length;o>r;r++){t=n[r].symbolizer;for(var s in t){if(i=t[s],"object"!=typeof i){this.addPropertyStyles(e,t);break}this.addPropertyStyles(e,i)}}return e},addPropertyStyles:function(e,t){var i,n;for(n in t)i=t[n],"string"==typeof i&&i.match(/\$\{\w+\}/)&&(e[n]=!0);return e},addRules:function(e){Array.prototype.push.apply(this.rules,e),this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e,this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,i=0,n=t.length;n>i;i++)if(-1!=e.CLASS_NAME.indexOf(t[i]))return t[i]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,i=this.rules.length;i>t;++t)e.rules.push(this.rules[t].clone())}return e.context=this.context&&OpenLayers.Util.extend({},this.context),t=OpenLayers.Util.extend({},this.defaultStyle),new OpenLayers.Style(t,e)},CLASS_NAME:"OpenLayers.Style"}),OpenLayers.Style.createLiteral=function(e,t,i,n){return"string"==typeof e&&-1!=e.indexOf("${")&&(e=OpenLayers.String.format(e,t,[i,n]),e=isNaN(e)||!e?e:parseFloat(e)),e},OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"],OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){if(this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])},e instanceof OpenLayers.Style)this.styles["default"]=e,this.styles.select=e,this.styles.temporary=e,this.styles["delete"]=e;else if("object"==typeof e)for(var i in e)if(e[i]instanceof OpenLayers.Style)this.styles[i]=e[i];else{if("object"!=typeof e[i]){this.styles["default"]=new OpenLayers.Style(e),this.styles.select=new OpenLayers.Style(e),this.styles.temporary=new OpenLayers.Style(e),this.styles["delete"]=new OpenLayers.Style(e);break}this.styles[i]=new OpenLayers.Style(e[i])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector),this.styles[t]||(t="default"),e.renderIntent=t;var i={};return this.extendDefault&&"default"!=t&&(i=this.styles["default"].createSymbolizer(e)),OpenLayers.Util.extend(i,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,i,n){var r,o=[];for(r in i)o.push(new OpenLayers.Rule({symbolizer:i[r],context:n,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:r})}));this.styles[e].addRules(o)},CLASS_NAME:"OpenLayers.StyleMap"}),OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(){if(OpenLayers.Layer.prototype.initialize.apply(this,arguments),(!this.renderer||!this.renderer.supported())&&this.assignRenderer(),this.renderer&&this.renderer.supported()||(this.renderer=null,this.displayError()),this.styleMap||(this.styleMap=new OpenLayers.StyleMap),this.features=[],this.selectedFeatures=[],this.unrenderedFeatures={},this.strategies)for(var e=0,t=this.strategies.length;t>e;e++)this.strategies[e].setLayer(this)},destroy:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoDestroy&&e.destroy();this.strategies=null}this.protocol&&(this.protocol.autoDestroy&&this.protocol.destroy(),this.protocol=null),this.destroyFeatures(),this.unrenderedFeatures=this.selectedFeatures=this.features=null,this.renderer&&this.renderer.destroy(),this.drawn=this.geometryType=this.renderer=null,OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions()));for(var e=OpenLayers.Layer.prototype.clone.apply(this,[e]),t=this.features,i=t.length,n=Array(i),r=0;i>r;++r)n[r]=t[r].clone();return e.features=n,e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e)},assignRenderer:function(){for(var e=0,t=this.renderers.length;t>e;e++){var i=this.renderers[e];if((i="function"==typeof i?i:OpenLayers.Renderer[i])&&i.prototype.supported()){this.renderer=new i(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(){if(OpenLayers.Layer.prototype.setMap.apply(this,arguments),this.renderer){this.renderer.map=this.map;var e=this.map.getSize();e.w*=this.ratio,e.h*=this.ratio,this.renderer.setSize(e)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoActivate&&e.activate()}},removeMap:function(){if(this.drawn=!1,this.strategies){var e,t,i;for(t=0,i=this.strategies.length;i>t;t++)e=this.strategies[t],e.autoActivate&&e.deactivate()}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var e=this.map.getSize();e.w*=this.ratio,e.h*=this.ratio,this.renderer.setSize(e)},moveTo:function(e,t,i){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var n=!0;if(!i){this.renderer.root.style.visibility="hidden";var n=this.map.getSize(),r=n.w,n=n.h,r=r/2*this.ratio-r/2,n=n/2*this.ratio-n/2,r=r+parseInt(this.map.layerContainerDiv.style.left,10),r=-Math.round(r),n=n+parseInt(this.map.layerContainerDiv.style.top,10),n=-Math.round(n);if(this.div.style.left=r+"px",this.div.style.top=n+"px",n=this.renderer.setExtent(this.map.getExtent().scale(this.ratio),t),this.renderer.root.style.visibility="visible",!0===OpenLayers.IS_GECKO&&(this.div.scrollLeft=this.div.scrollLeft),!t&&n)for(var o in this.unrenderedFeatures)r=this.unrenderedFeatures[o],this.drawFeature(r)}if(!this.drawn||t||!n)for(this.drawn=!0,o=0,n=this.features.length;n>o;o++)this.renderer.locked=o!==n-1,r=this.features[o],this.drawFeature(r)},display:function(){OpenLayers.Layer.prototype.display.apply(this,arguments);var e=this.div.style.display;e!=this.renderer.root.style.display&&(this.renderer.root.style.display=e)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var i=!t||!t.silent;if(i){var n={features:e};if(!1===this.events.triggerEvent("beforefeaturesadded",n))return;e=n.features}for(var n=[],r=0,o=e.length;o>r;r++){this.renderer.locked=r!=e.length-1?!0:!1;var s=e[r];if(this.geometryType&&!(s.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);if(s.layer=this,!s.style&&this.style&&(s.style=OpenLayers.Util.extend({},this.style)),i){if(!1===this.events.triggerEvent("beforefeatureadded",{feature:s}))continue;this.preFeatureInsert(s)}n.push(s),this.features.push(s),this.drawFeature(s),i&&(this.events.triggerEvent("featureadded",{feature:s}),this.onFeatureInsert(s))}i&&this.events.triggerEvent("featuresadded",{features:n})},removeFeatures:function(e,t){if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]),e===this.selectedFeatures&&(e=e.slice());var i=!t||!t.silent;i&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var n=e.length-1;n>=0;n--){this.renderer.locked=0!=n&&e[n-1].geometry?!0:!1;var r=e[n];delete this.unrenderedFeatures[r.id],i&&this.events.triggerEvent("beforefeatureremoved",{feature:r}),this.features=OpenLayers.Util.removeItem(this.features,r),r.layer=null,r.geometry&&this.renderer.eraseFeatures(r),-1!=OpenLayers.Util.indexOf(this.selectedFeatures,r)&&OpenLayers.Util.removeItem(this.selectedFeatures,r),i&&this.events.triggerEvent("featureremoved",{feature:r})}i&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){var e=!e||!e.silent,t=this.features;e&&this.events.triggerEvent("beforefeaturesremoved",{features:t});for(var i,n=t.length-1;n>=0;n--)i=t[n],e&&this.events.triggerEvent("beforefeatureremoved",{feature:i}),i.layer=null,e&&this.events.triggerEvent("featureremoved",{feature:i});this.renderer.clear(),this.features=[],this.unrenderedFeatures={},this.selectedFeatures=[],e&&this.events.triggerEvent("featuresremoved",{features:t})},destroyFeatures:function(e,t){if(void 0==e&&(e=this.features),e){this.removeFeatures(e,t);for(var i=e.length-1;i>=0;i--)e[i].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){!t&&e.state===OpenLayers.State.DELETE&&(t="delete");var i=t||e.renderIntent;(t=e.style||this.style)||(t=this.styleMap.createSymbolizer(e,i))}i=this.renderer.drawFeature(e,t),!1===i||null===i?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)throw Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var t=null;return(e=this.renderer.getFeatureIdFromEvent(e))&&(t="string"==typeof e?this.getFeatureById(e):e),t},getFeatureBy:function(e,t){for(var i=null,n=0,r=this.features.length;r>n;++n)if(this.features[n][e]==t){i=this.features[n];break}return i},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var i,n,r=this.features.length,o=[];for(i=0;r>i;i++)(n=this.features[i])&&n.attributes&&n.attributes[e]===t&&o.push(n);return o},onFeatureInsert:function(){},preFeatureInsert:function(){},getDataExtent:function(){var e=null,t=this.features;if(t&&t.length>0)for(var i=null,n=0,r=t.length;r>n;n++)(i=t[n].geometry)&&(null===e&&(e=new OpenLayers.Bounds),e.extend(i.getBounds()));return e},CLASS_NAME:"OpenLayers.Layer.Vector"}),OpenLayers.Layer.Vector.RootContainer=OpenLayers.Class(OpenLayers.Layer.Vector,{displayInLayerSwitcher:!1,layers:null,display:function(){},getFeatureFromEvent:function(e){for(var t,i=this.layers,n=0;i.length>n;n++)if(t=i[n].getFeatureFromEvent(e))return t},setMap:function(e){OpenLayers.Layer.Vector.prototype.setMap.apply(this,arguments),this.collectRoots(),e.events.register("changelayer",this,this.handleChangeLayer)},removeMap:function(e){e.events.unregister("changelayer",this,this.handleChangeLayer),this.resetRoots(),OpenLayers.Layer.Vector.prototype.removeMap.apply(this,arguments)},collectRoots:function(){for(var e,t=0;this.map.layers.length>t;++t)e=this.map.layers[t],-1!=OpenLayers.Util.indexOf(this.layers,e)&&e.renderer.moveRoot(this.renderer)},resetRoots:function(){for(var e,t=0;this.layers.length>t;++t)e=this.layers[t],this.renderer&&e.renderer.getRenderLayerId()==this.id&&this.renderer.moveRoot(e.renderer)},handleChangeLayer:function(e){var t=e.layer;"order"==e.property&&-1!=OpenLayers.Util.indexOf(this.layers,t)&&(this.resetRoots(),this.collectRoots())},CLASS_NAME:"OpenLayers.Layer.Vector.RootContainer"}),OpenLayers.Control.SelectFeature=OpenLayers.Class(OpenLayers.Control,{multipleKey:null,toggleKey:null,multiple:!1,clickout:!0,toggle:!1,hover:!1,highlightOnly:!1,box:!1,onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},scope:null,geometryTypes:null,layer:null,layers:null,callbacks:null,selectStyle:null,renderIntent:"select",handlers:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]),null===this.scope&&(this.scope=this),this.initLayer(e);var i={click:this.clickFeature,clickout:this.clickoutFeature};this.hover&&(i.over=this.overFeature,i.out=this.outFeature),this.callbacks=OpenLayers.Util.extend(i,this.callbacks),this.handlers={feature:new OpenLayers.Handler.Feature(this,this.layer,this.callbacks,{geometryTypes:this.geometryTypes})},this.box&&(this.handlers.box=new OpenLayers.Handler.Box(this,{done:this.selectBox},{boxDivClassName:"olHandlerBoxSelectFeature"}))},initLayer:function(e){OpenLayers.Util.isArray(e)?(this.layers=e,this.layer=new OpenLayers.Layer.Vector.RootContainer(this.id+"_container",{layers:e})):this.layer=e},destroy:function(){this.active&&this.layers&&this.map.removeLayer(this.layer),OpenLayers.Control.prototype.destroy.apply(this,arguments),this.layers&&this.layer.destroy()},activate:function(){return this.active||(this.layers&&this.map.addLayer(this.layer),this.handlers.feature.activate(),this.box&&this.handlers.box&&this.handlers.box.activate()),OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){return this.active&&(this.handlers.feature.deactivate(),this.handlers.box&&this.handlers.box.deactivate(),this.layers&&this.map.removeLayer(this.layer)),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},unselectAll:function(e){for(var t,i,n=this.layers||[this.layer],r=0;n.length>r;++r){t=n[r];
for(var o=t.selectedFeatures.length-1;o>=0;--o)i=t.selectedFeatures[o],(!e||e.except!=i)&&this.unselect(i)}},clickFeature:function(e){this.hover||(OpenLayers.Util.indexOf(e.layer.selectedFeatures,e)>-1?this.toggleSelect()?this.unselect(e):this.multipleSelect()||this.unselectAll({except:e}):(this.multipleSelect()||this.unselectAll({except:e}),this.select(e)))},multipleSelect:function(){return this.multiple||this.handlers.feature.evt&&this.handlers.feature.evt[this.multipleKey]},toggleSelect:function(){return this.toggle||this.handlers.feature.evt&&this.handlers.feature.evt[this.toggleKey]},clickoutFeature:function(){!this.hover&&this.clickout&&this.unselectAll()},overFeature:function(e){var t=e.layer;this.hover&&(this.highlightOnly?this.highlight(e):-1==OpenLayers.Util.indexOf(t.selectedFeatures,e)&&this.select(e))},outFeature:function(e){if(this.hover)if(this.highlightOnly){if(e._lastHighlighter==this.id)if(e._prevHighlighter&&e._prevHighlighter!=this.id){delete e._lastHighlighter;var t=this.map.getControl(e._prevHighlighter);t&&t.highlight(e)}else this.unhighlight(e)}else this.unselect(e)},highlight:function(e){var t=e.layer;!1!==this.events.triggerEvent("beforefeaturehighlighted",{feature:e})&&(e._prevHighlighter=e._lastHighlighter,e._lastHighlighter=this.id,t.drawFeature(e,this.selectStyle||this.renderIntent),this.events.triggerEvent("featurehighlighted",{feature:e}))},unhighlight:function(e){var t=e.layer;void 0==e._prevHighlighter?delete e._lastHighlighter:(e._prevHighlighter!=this.id&&(e._lastHighlighter=e._prevHighlighter),delete e._prevHighlighter),t.drawFeature(e,e.style||e.layer.style||"default"),this.events.triggerEvent("featureunhighlighted",{feature:e})},select:function(e){var t=this.onBeforeSelect.call(this.scope,e),i=e.layer;!1!==t&&(t=i.events.triggerEvent("beforefeatureselected",{feature:e}),!1!==t&&(i.selectedFeatures.push(e),this.highlight(e),this.handlers.feature.lastFeature||(this.handlers.feature.lastFeature=i.selectedFeatures[0]),i.events.triggerEvent("featureselected",{feature:e}),this.onSelect.call(this.scope,e)))},unselect:function(e){var t=e.layer;this.unhighlight(e),OpenLayers.Util.removeItem(t.selectedFeatures,e),t.events.triggerEvent("featureunselected",{feature:e}),this.onUnselect.call(this.scope,e)},selectBox:function(e){if(e instanceof OpenLayers.Bounds){var t=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),e=this.map.getLonLatFromPixel({x:e.right,y:e.top}),t=new OpenLayers.Bounds(t.lon,t.lat,e.lon,e.lat);this.multipleSelect()||this.unselectAll(),e=this.multiple,this.multiple=!0;var i=this.layers||[this.layer];this.events.triggerEvent("boxselectionstart",{layers:i});for(var n,r=0;i.length>r;++r){n=i[r];for(var o=0,s=n.features.length;s>o;++o){var a=n.features[o];a.getVisibility()&&(null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,a.geometry.CLASS_NAME)>-1)&&t.toGeometry().intersects(a.geometry)&&-1==OpenLayers.Util.indexOf(n.selectedFeatures,a)&&this.select(a)}}this.multiple=e,this.events.triggerEvent("boxselectionend",{layers:i})}},setMap:function(e){this.handlers.feature.setMap(e),this.box&&this.handlers.box.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},setLayer:function(e){var t=this.active;this.unselectAll(),this.deactivate(),this.layers&&(this.layer.destroy(),this.layers=null),this.initLayer(e),this.handlers.feature.layer=this.layer,t&&this.activate()},CLASS_NAME:"OpenLayers.Control.SelectFeature"}),OpenLayers.Handler.Keyboard=OpenLayers.Class(OpenLayers.Handler,{KEY_EVENTS:["keydown","keyup"],eventListener:null,observeElement:null,initialize:function(){OpenLayers.Handler.prototype.initialize.apply(this,arguments),this.eventListener=OpenLayers.Function.bindAsEventListener(this.handleKeyEvent,this)},destroy:function(){this.deactivate(),this.eventListener=null,OpenLayers.Handler.prototype.destroy.apply(this,arguments)},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.observeElement=this.observeElement||document;for(var e=0,t=this.KEY_EVENTS.length;t>e;e++)OpenLayers.Event.observe(this.observeElement,this.KEY_EVENTS[e],this.eventListener);return!0}return!1},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){for(var e=0,t=this.KEY_EVENTS.length;t>e;e++)OpenLayers.Event.stopObserving(this.observeElement,this.KEY_EVENTS[e],this.eventListener);e=!0}return e},handleKeyEvent:function(e){this.checkModifiers(e)&&this.callback(e.type,[e])},CLASS_NAME:"OpenLayers.Handler.Keyboard"}),OpenLayers.Control.ModifyFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,clickout:!0,toggle:!0,standalone:!1,layer:null,feature:null,vertices:null,virtualVertices:null,selectControl:null,dragControl:null,handlers:null,deleteCodes:null,virtualStyle:null,vertexRenderIntent:null,mode:null,createVertices:!0,modified:!1,radiusHandle:null,dragHandle:null,onModificationStart:function(){},onModification:function(){},onModificationEnd:function(){},initialize:function(e,t){t=t||{},this.layer=e,this.vertices=[],this.virtualVertices=[],this.virtualStyle=OpenLayers.Util.extend({},this.layer.style||this.layer.styleMap.createSymbolizer(null,t.vertexRenderIntent)),this.virtualStyle.fillOpacity=.3,this.virtualStyle.strokeOpacity=.3,this.deleteCodes=[46,68],this.mode=OpenLayers.Control.ModifyFeature.RESHAPE,OpenLayers.Control.prototype.initialize.apply(this,[t]),OpenLayers.Util.isArray(this.deleteCodes)||(this.deleteCodes=[this.deleteCodes]);var i=this,n={geometryTypes:this.geometryTypes,clickout:this.clickout,toggle:this.toggle,onBeforeSelect:this.beforeSelectFeature,onSelect:this.selectFeature,onUnselect:this.unselectFeature,scope:this};!1===this.standalone&&(this.selectControl=new OpenLayers.Control.SelectFeature(e,n)),this.dragControl=new OpenLayers.Control.DragFeature(e,{geometryTypes:["OpenLayers.Geometry.Point"],onStart:function(e,t){i.dragStart.apply(i,[e,t])},onDrag:function(e,t){i.dragVertex.apply(i,[e,t])},onComplete:function(e){i.dragComplete.apply(i,[e])},featureCallbacks:{over:function(e){(i.standalone!==!0||e._sketch||i.feature===e)&&i.dragControl.overFeature.apply(i.dragControl,[e])}}}),this.handlers={keyboard:new OpenLayers.Handler.Keyboard(this,{keydown:this.handleKeypress})}},destroy:function(){this.layer=null,this.standalone||this.selectControl.destroy(),this.dragControl.destroy(),OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return(this.standalone||this.selectControl.activate())&&this.handlers.keyboard.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){var e=!1;if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){this.layer.removeFeatures(this.vertices,{silent:!0}),this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.vertices=[],this.dragControl.deactivate();var t=(e=this.feature)&&e.geometry&&e.layer;!1===this.standalone?(t&&this.selectControl.unselect.apply(this.selectControl,[e]),this.selectControl.deactivate()):t&&this.unselectFeature(e),this.handlers.keyboard.deactivate(),e=!0}return e},beforeSelectFeature:function(e){return this.layer.events.triggerEvent("beforefeaturemodified",{feature:e})},selectFeature:function(e){this.standalone&&!1===this.beforeSelectFeature(e)||(this.feature=e,this.modified=!1,this.resetVertices(),this.dragControl.activate(),this.onModificationStart(this.feature));var t=e.modified;!e.geometry||t&&t.geometry||(this._originalGeometry=e.geometry.clone())},unselectFeature:function(e){this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[],this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),delete this.dragHandle),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),delete this.radiusHandle),this.feature=null,this.dragControl.deactivate(),this.onModificationEnd(e),this.layer.events.triggerEvent("afterfeaturemodified",{feature:e,modified:this.modified}),this.modified=!1},dragStart:function(e,t){e==this.feature||e.geometry.parent||e==this.dragHandle||e==this.radiusHandle||(!1===this.standalone&&this.feature&&this.selectControl.clickFeature.apply(this.selectControl,[this.feature]),null!=this.geometryTypes&&-1==OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME))||(this.standalone||this.selectControl.clickFeature.apply(this.selectControl,[e]),this.dragControl.overFeature.apply(this.dragControl,[e]),this.dragControl.lastPixel=t,this.dragControl.handlers.drag.started=!0,this.dragControl.handlers.drag.start=t,this.dragControl.handlers.drag.last=t)},dragVertex:function(e,t){this.modified=!0,"OpenLayers.Geometry.Point"==this.feature.geometry.CLASS_NAME?(this.feature!=e&&(this.feature=e),this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t})):(e._index?(e.geometry.parent.addComponent(e.geometry,e._index),delete e._index,OpenLayers.Util.removeItem(this.virtualVertices,e),this.vertices.push(e)):e==this.dragHandle?(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[],this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null)):e!==this.radiusHandle&&this.layer.events.triggerEvent("vertexmodified",{vertex:e.geometry,feature:this.feature,pixel:t}),this.virtualVertices.length>0&&(this.layer.destroyFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent)),this.layer.drawFeature(e)},dragComplete:function(){this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature})},setFeatureState:function(){if(this.feature.state!=OpenLayers.State.INSERT&&this.feature.state!=OpenLayers.State.DELETE&&(this.feature.state=OpenLayers.State.UPDATE,this.modified&&this._originalGeometry)){var e=this.feature;e.modified=OpenLayers.Util.extend(e.modified,{geometry:this._originalGeometry}),delete this._originalGeometry}},resetVertices:function(){this.dragControl.feature&&this.dragControl.outFeature(this.dragControl.feature),this.vertices.length>0&&(this.layer.removeFeatures(this.vertices,{silent:!0}),this.vertices=[]),this.virtualVertices.length>0&&(this.layer.removeFeatures(this.virtualVertices,{silent:!0}),this.virtualVertices=[]),this.dragHandle&&(this.layer.destroyFeatures([this.dragHandle],{silent:!0}),this.dragHandle=null),this.radiusHandle&&(this.layer.destroyFeatures([this.radiusHandle],{silent:!0}),this.radiusHandle=null),this.feature&&"OpenLayers.Geometry.Point"!=this.feature.geometry.CLASS_NAME&&(this.mode&OpenLayers.Control.ModifyFeature.DRAG&&this.collectDragHandle(),this.mode&(OpenLayers.Control.ModifyFeature.ROTATE|OpenLayers.Control.ModifyFeature.RESIZE)&&this.collectRadiusHandle(),this.mode&OpenLayers.Control.ModifyFeature.RESHAPE&&(this.mode&OpenLayers.Control.ModifyFeature.RESIZE||this.collectVertices()))},handleKeypress:function(e){var t=e.keyCode;this.feature&&-1!=OpenLayers.Util.indexOf(this.deleteCodes,t)&&(t=this.dragControl.feature)&&-1!=OpenLayers.Util.indexOf(this.vertices,t)&&!this.dragControl.handlers.drag.dragging&&t.geometry.parent&&(t.geometry.parent.removeComponent(t.geometry),this.layer.events.triggerEvent("vertexremoved",{vertex:t.geometry,feature:this.feature,pixel:e.xy}),this.layer.drawFeature(this.feature,this.standalone?void 0:this.selectControl.renderIntent),this.modified=!0,this.resetVertices(),this.setFeatureState(),this.onModification(this.feature),this.layer.events.triggerEvent("featuremodified",{feature:this.feature}))},collectVertices:function(){function e(i){var n,r,o;if("OpenLayers.Geometry.Point"==i.CLASS_NAME)r=new OpenLayers.Feature.Vector(i),r._sketch=!0,r.renderIntent=t.vertexRenderIntent,t.vertices.push(r);else{for(o=i.components.length,"OpenLayers.Geometry.LinearRing"==i.CLASS_NAME&&(o-=1),n=0;o>n;++n)r=i.components[n],"OpenLayers.Geometry.Point"==r.CLASS_NAME?(r=new OpenLayers.Feature.Vector(r),r._sketch=!0,r.renderIntent=t.vertexRenderIntent,t.vertices.push(r)):e(r);if(t.createVertices&&"OpenLayers.Geometry.MultiPoint"!=i.CLASS_NAME)for(n=0,o=i.components.length;o-1>n;++n){r=i.components[n];var s=i.components[n+1];"OpenLayers.Geometry.Point"==r.CLASS_NAME&&"OpenLayers.Geometry.Point"==s.CLASS_NAME&&(r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point((r.x+s.x)/2,(r.y+s.y)/2),null,t.virtualStyle),r.geometry.parent=i,r._index=n+1,r._sketch=!0,t.virtualVertices.push(r))}}}this.vertices=[],this.virtualVertices=[];var t=this;e.call(this,this.feature.geometry),this.layer.addFeatures(this.virtualVertices,{silent:!0}),this.layer.addFeatures(this.vertices,{silent:!0})},collectDragHandle:function(){var e=this.feature.geometry,t=e.getBounds().getCenterLonLat(),t=new OpenLayers.Geometry.Point(t.lon,t.lat),i=new OpenLayers.Feature.Vector(t);t.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i),e.move(t,i)},i._sketch=!0,this.dragHandle=i,this.dragHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.dragHandle],{silent:!0})},collectRadiusHandle:function(){var e=this.feature.geometry,t=e.getBounds(),i=t.getCenterLonLat(),n=new OpenLayers.Geometry.Point(i.lon,i.lat),t=new OpenLayers.Geometry.Point(t.right,t.bottom),i=new OpenLayers.Feature.Vector(t),r=this.mode&OpenLayers.Control.ModifyFeature.RESIZE,o=this.mode&OpenLayers.Control.ModifyFeature.RESHAPE,s=this.mode&OpenLayers.Control.ModifyFeature.ROTATE;t.move=function(t,i){OpenLayers.Geometry.Point.prototype.move.call(this,t,i);var a=this.x-n.x,l=this.y-n.y,h=a-t,c=l-i;if(s){var u=Math.atan2(c,h),u=Math.atan2(l,a)-u,u=u*(180/Math.PI);e.rotate(u,n)}if(r){var d;o?(l/=c,d=a/h/l):(h=Math.sqrt(h*h+c*c),l=Math.sqrt(a*a+l*l)/h),e.resize(l,n,d)}},i._sketch=!0,this.radiusHandle=i,this.radiusHandle.renderIntent=this.vertexRenderIntent,this.layer.addFeatures([this.radiusHandle],{silent:!0})},setMap:function(e){this.standalone||this.selectControl.setMap(e),this.dragControl.setMap(e),OpenLayers.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"OpenLayers.Control.ModifyFeature"}),OpenLayers.Control.ModifyFeature.RESHAPE=1,OpenLayers.Control.ModifyFeature.RESIZE=2,OpenLayers.Control.ModifyFeature.ROTATE=4,OpenLayers.Control.ModifyFeature.DRAG=8,OpenLayers.Layer.Bing=OpenLayers.Class(OpenLayers.Layer.XYZ,{key:null,serverResolutions:[156543.03390625,78271.516953125,39135.7584765625,19567.87923828125,9783.939619140625,4891.9698095703125,2445.9849047851562,1222.9924523925781,611.4962261962891,305.74811309814453,152.87405654907226,76.43702827453613,38.218514137268066,19.109257068634033,9.554628534317017,4.777314267158508,2.388657133579254,1.194328566789627,.5971642833948135,.29858214169740677,.14929107084870338,.07464553542435169],attributionTemplate:'<span class="olBingAttribution ${type}"><div><a target="_blank" href="http://www.bing.com/maps/"><img src="${logo}" /></a></div>${copyrights}<a style="white-space: nowrap" target="_blank" href="http://www.microsoft.com/maps/product/terms.html">Terms of Use</a></span>',metadata:null,type:"Road",culture:"en-US",metadataParams:null,tileOptions:null,initialize:function(e){e=OpenLayers.Util.applyDefaults({sphericalMercator:!0},e),OpenLayers.Layer.XYZ.prototype.initialize.apply(this,[e.name||"Bing "+(e.type||this.type),null,e]),this.tileOptions=OpenLayers.Util.extend({crossOriginKeyword:"anonymous"},this.options.tileOptions),this.loadMetadata()},loadMetadata:function(){this._callbackId="_callback_"+this.id.replace(/\./g,"_"),window[this._callbackId]=OpenLayers.Function.bind(OpenLayers.Layer.Bing.processMetadata,this);var e=OpenLayers.Util.applyDefaults({key:this.key,jsonp:this._callbackId,include:"ImageryProviders"},this.metadataParams),e="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.type+"?"+OpenLayers.Util.getParameterString(e),t=document.createElement("script");t.type="text/javascript",t.src=e,t.id=this._callbackId,document.getElementsByTagName("head")[0].appendChild(t)},initLayer:function(){var e=this.metadata.resourceSets[0].resources[0],t=e.imageUrl.replace("{quadkey}","${quadkey}"),t=t.replace("{culture}",this.culture);this.url=[];for(var i=0;e.imageUrlSubdomains.length>i;++i)this.url.push(t.replace("{subdomain}",e.imageUrlSubdomains[i]));this.addOptions({maxResolution:Math.min(this.serverResolutions[e.zoomMin],this.maxResolution||Number.POSITIVE_INFINITY),numZoomLevels:Math.min(e.zoomMax+1-e.zoomMin,this.numZoomLevels)},!0)},getURL:function(e){if(this.url){for(var t=this.getXYZ(e),e=t.x,i=t.y,t=t.z,n=[],r=t;r>0;--r){var o="0",s=1<<r-1;0!=(e&s)&&o++,0!=(i&s)&&(o++,o++),n.push(o)}return n=n.join(""),e=this.selectUrl(""+e+i+t,this.url),OpenLayers.String.format(e,{quadkey:n})}},updateAttribution:function(){var e=this.metadata;if(e.resourceSets&&this.map&&this.map.center){var t,i,n,r,o,s,a,l=e.resourceSets[0].resources[0],h=this.map.getExtent().transform(this.map.getProjectionObject(),new OpenLayers.Projection("EPSG:4326")),l=l.imageryProviders,c=OpenLayers.Util.indexOf(this.serverResolutions,this.getServerResolution()),u="";for(i=0,n=l.length;n>i;++i)for(t=l[i],r=0,o=t.coverageAreas.length;o>r;++r)a=t.coverageAreas[r],s=OpenLayers.Bounds.fromArray(a.bbox,!0),h.intersectsBounds(s)&&a.zoomMax>=c&&c>=a.zoomMin&&(u+=t.attribution+" ");this.attribution=OpenLayers.String.format(this.attributionTemplate,{type:this.type.toLowerCase(),logo:e.brandLogoUri,copyrights:u}),this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"attribution"})}},setMap:function(){OpenLayers.Layer.XYZ.prototype.setMap.apply(this,arguments),this.updateAttribution(),this.map.events.register("moveend",this,this.updateAttribution)},clone:function(e){return null==e&&(e=new OpenLayers.Layer.Bing(this.options)),e=OpenLayers.Layer.XYZ.prototype.clone.apply(this,[e])},destroy:function(){this.map&&this.map.events.unregister("moveend",this,this.updateAttribution),OpenLayers.Layer.XYZ.prototype.destroy.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.Bing"}),OpenLayers.Layer.Bing.processMetadata=function(e){this.metadata=e,this.initLayer(),e=document.getElementById(this._callbackId),e.parentNode.removeChild(e),window[this._callbackId]=void 0,delete this._callbackId},OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e},destroy:function(){},read:function(){throw Error("Read not implemented.")},write:function(){throw Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"}),OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")),OpenLayers.Format.prototype.initialize.apply(this,[e]),this.namespaces=OpenLayers.Util.extend({},this.namespaces),this.namespaceAlias={};for(var t in this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null,OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t,this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");return t>0&&(e=e.substring(t)),t=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var t;return t=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom,t.loadXML(e),t},this),function(){return(new DOMParser).parseFromString(e,"text/xml")},function(){var t=new XMLHttpRequest;return t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),t.overrideMimeType&&t.overrideMimeType("text/xml"),t.send(null),t.responseXML}),this.keepData&&(this.data=t),t},write:function(e){if(this.xmldom)e=e.xml;else{var t=new XMLSerializer;if(1==e.nodeType){var i=document.implementation.createDocument("","",null);i.importNode&&(e=i.importNode(e,!0)),i.appendChild(e),e=t.serializeToString(i)}else e=t.serializeToString(e)}return e},createElementNS:function(e,t){return this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t)},createTextNode:function(e){return"string"!=typeof e&&(e=""+e),this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e)},getElementsByTagNameNS:function(e,t,i){var n=[];if(e.getElementsByTagNameNS)n=e.getElementsByTagNameNS(t,i);else for(var r,o,e=e.getElementsByTagName("*"),s=0,a=e.length;a>s;++s)r=e[s],o=r.prefix?r.prefix+":"+i:i,("*"==i||o==r.nodeName)&&("*"==t||t==r.namespaceURI)&&n.push(r);return n},getAttributeNodeNS:function(e,t,i){var n=null;if(e.getAttributeNodeNS)n=e.getAttributeNodeNS(t,i);else for(var r,o,e=e.attributes,s=0,a=e.length;a>s;++s)if(r=e[s],r.namespaceURI==t&&(o=r.prefix?r.prefix+":"+i:i,o==r.nodeName)){n=r;break}return n},getAttributeNS:function(e,t,i){var n="";return e.getAttributeNS?n=e.getAttributeNS(t,i)||"":(e=this.getAttributeNodeNS(e,t,i))&&(n=e.nodeValue),n},getChildValue:function(e,t){var i=t||"";if(e)for(var n=e.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 3:case 4:i+=n.nodeValue}return i},isSimpleContent:function(e){for(var t=!0,e=e.firstChild;e;e=e.nextSibling)if(1===e.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,i=!1,n=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,e=e.firstChild;e;e=e.nextSibling){switch(e.nodeType){case 1:i=!0;break;case 8:break;default:t=!0}if(i&&t)break}if(i&&t)n=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(i)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return n},hasAttributeNS:function(e,t,i){var n=!1;return n=e.hasAttributeNS?e.hasAttributeNS(t,i):!!this.getAttributeNodeNS(e,t,i)},setAttributeNS:function(e,t,i,n){if(e.setAttributeNS)e.setAttributeNS(t,i,n);else{if(!this.xmldom)throw"setAttributeNS not implemented";t?(t=e.ownerDocument.createNode(2,i,t),t.nodeValue=n,e.setAttributeNode(t)):e.setAttribute(i,n)}},createElementNSPlus:function(e,t){var t=t||{},i=t.uri||this.namespaces[t.prefix];i||(i=e.indexOf(":"),i=this.namespaces[e.substring(0,i)]),i||(i=this.namespaces[this.defaultPrefix]),i=this.createElementNS(i,e),t.attributes&&this.setAttributes(i,t.attributes);var n=t.value;return null!=n&&i.appendChild(this.createTextNode(n)),i},setAttributes:function(e,t){var i,n,r;for(r in t)null!=t[r]&&t[r].toString&&(i=""+t[r],n=this.namespaces[r.substring(0,r.indexOf(":"))]||null,this.setAttributeNS(e,n,r,i))},readNode:function(e,t){t||(t={});var i=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(i){var n=e.localName||e.nodeName.split(":").pop();(i=i[n]||i["*"])&&i.apply(this,[e,t])}return t},readChildNodes:function(e,t){t||(t={});for(var i,n=e.childNodes,r=0,o=n.length;o>r;++r)i=n[r],1==i.nodeType&&this.readNode(i,t);return t},writeNode:function(e,t,i){var n,r=e.indexOf(":");return r>0?(n=e.substring(0,r),e=e.substring(r+1)):n=i?this.namespaceAlias[i.namespaceURI]:this.defaultPrefix,t=this.writers[n][e].apply(this,[t]),i&&i.appendChild(t),t},getChildEl:function(e,t,i){return e&&this.getThisOrNextEl(e.firstChild,t,i)},getNextEl:function(e,t,i){return e&&this.getThisOrNextEl(e.nextSibling,t,i)},getThisOrNextEl:function(e,t,i){e:for(;e;e=e.nextSibling)switch(e.nodeType){case 1:if(!(t&&t!==(e.localName||e.nodeName.split(":").pop())||i&&i!==e.namespaceURI))break e;e=null;break e;case 3:if(/^\s*$/.test(e.nodeValue))break;case 4:case 6:case 12:case 10:case 11:e=null;break e}return e||null},lookupNamespaceURI:function(e,t){var i=null;if(e)if(e.lookupNamespaceURI)i=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){i=e.namespaceURI;break e}if(i=e.attributes.length)for(var n,r=0;i>r;++r){if(n=e.attributes[r],"xmlns"===n.prefix&&n.name==="xmlns:"+t){i=n.value||null;break e}if("xmlns"===n.name&&null===t){i=n.value||null;break e}}i=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:i=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:i=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:i=this.lookupNamespaceURI(e.parentNode,t)}return i},getXMLDoc:function(){return!OpenLayers.Format.XML.document&&!this.xmldom&&(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"))),OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"}),OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3},OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype),OpenLayers.Format.XML.document=null,OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(e,t){for(var i,n,r,o,s=null,a=t&&t.mutual,l=[],h=[e],c=0,u=this.components.length;u>c;++c){n=this.components[c],r=!1;for(var d=0;h.length>d;++d)if(i=n.split(h[d],t)){if(a){r=i[0];for(var p=0,f=r.length;f>p;++p)0===p&&l.length?l[l.length-1].addComponent(r[p]):l.push(new OpenLayers.Geometry.MultiLineString([r[p]]));r=!0,i=i[1]}if(i.length){i.unshift(d,1),Array.prototype.splice.apply(h,i);break}}r||(l.length?l[l.length-1].addComponent(n.clone()):l=[new OpenLayers.Geometry.MultiLineString(n.clone())])}return l&&l.length>1?r=!0:l=[],h&&h.length>1?o=!0:h=[],(r||o)&&(s=a?[l,h]:h),s},splitWith:function(e,t){var i,n,r,o,s,a,l=null,h=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){a=[],s=[e];for(var c=0,u=this.components.length;u>c;++c){r=!1,n=this.components[c];for(var d=0;s.length>d;++d)if(i=s[d].split(n,t)){h&&(r=i[0],r.length&&(r.unshift(d,1),Array.prototype.splice.apply(s,r),d+=r.length-2),i=i[1],0===i.length&&(i=[n.clone()])),r=0;for(var p=i.length;p>r;++r)0===r&&a.length?a[a.length-1].addComponent(i[r]):a.push(new OpenLayers.Geometry.MultiLineString([i[r]]));r=!0}r||(a.length?a[a.length-1].addComponent(n.clone()):a=[new OpenLayers.Geometry.MultiLineString([n.clone()])])}}else l=e.split(this);return s&&s.length>1?o=!0:s=[],a&&a.length>1?r=!0:a=[],(o||r)&&(l=h?[s,a]:a),l},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"}),OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&this.components.length>0)for(var e=e+Math.abs(this.components[0].getArea()),t=1,i=this.components.length;i>t;t++)e-=Math.abs(this.components[t].getArea());return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0)for(var t=t+Math.abs(this.components[0].getGeodesicArea(e)),i=1,n=this.components.length;n>i;i++)t-=Math.abs(this.components[i].getGeodesicArea(e));return t},containsPoint:function(e){var t=this.components.length,i=!1;if(t>0&&(i=this.components[0].containsPoint(e),1!==i&&i&&t>1))for(var n,r=1;t>r;++r)if(n=this.components[r].containsPoint(e)){i=1===n?1:!1;break}return i},intersects:function(e){var t,i,n=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)n=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,i=this.components.length;i>t&&!(n=e.intersects(this.components[t]));++t);if(!n)for(t=0,i=e.components.length;i>t&&!(n=this.containsPoint(e.components[t]));++t);}else for(t=0,i=e.components.length;i>t&&!(n=this.intersects(e.components[t]));++t);if(!n&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var r=this.components[0];for(t=0,i=r.components.length;i>t&&!(n=e.containsPoint(r.components[t]));++t);}return n},distanceTo:function(e,t){return t&&!1===t.edge&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t])},CLASS_NAME:"OpenLayers.Geometry.Polygon"}),OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,i,n){var r=Math.PI*(1/i-.5);n&&(r+=n/180*Math.PI);for(var o,s=[],a=0;i>a;++a)o=r+2*a*Math.PI/i,n=e.x+t*Math.cos(o),o=e.y+t*Math.sin(o),s.push(new OpenLayers.Geometry.Point(n,o));return e=new OpenLayers.Geometry.LinearRing(s),new OpenLayers.Geometry.Polygon([e])},OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"}),OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var e=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName),t=[],i=0;e.length>i;i++){var n=this.parseFeature(e[i]);n&&t.push(n)}return t},parseFeature:function(e){for(var t,i,n,r="MultiPolygon Polygon MultiLineString LineString MultiPoint Point Envelope".split(" "),o=0;r.length>o;++o)if(t=r[o],i=this.getElementsByTagNameNS(e,this.gmlns,t),i.length>0){if(!(n=this.parseGeometry[t.toLowerCase()]))throw new TypeError("Unsupported geometry type: "+t);n=n.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection);break}var s;for(t=this.getElementsByTagNameNS(e,this.gmlns,"Box"),o=0;t.length>o;++o)r=t[o],i=this.parseGeometry.box.apply(this,[r]),r=r.parentNode,"boundedBy"===(r.localName||r.nodeName.split(":").pop())?s=i:n=i.toGeometry();var a;this.extractAttributes&&(a=this.parseAttributes(e)),a=new OpenLayers.Feature.Vector(n,a),a.bounds=s,a.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,featureNSPrefix:e.firstChild.prefix};for(var l,e=e.firstChild;e&&(1!=e.nodeType||!(l=e.getAttribute("fid")||e.getAttribute("id")));)e=e.nextSibling;return a.fid=l,a},parseGeometry:{point:function(e){var t,i;return i=[],t=this.getElementsByTagNameNS(e,this.gmlns,"pos"),t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.trimSpace,""),i=i.split(this.regExes.splitSpace)),0==i.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),t.length>0&&(i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.removeSpace,""),i=i.split(","))),0==i.length&&(t=this.getElementsByTagNameNS(e,this.gmlns,"coord"),t.length>0&&(e=this.getElementsByTagNameNS(t[0],this.gmlns,"X"),t=this.getElementsByTagNameNS(t[0],this.gmlns,"Y"),e.length>0&&t.length>0&&(i=[e[0].firstChild.nodeValue,t[0].firstChild.nodeValue]))),2==i.length&&(i[2]=null),this.xy?new OpenLayers.Geometry.Point(i[0],i[1],i[2]):new OpenLayers.Geometry.Point(i[1],i[0],i[2])},multipoint:function(e){var e=this.getElementsByTagNameNS(e,this.gmlns,"Point"),t=[];if(e.length>0)for(var i,n=0;e.length>n;++n)(i=this.parseGeometry.point.apply(this,[e[n]]))&&t.push(i);return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e,t){var i,n;n=[];var r=[];if(i=this.getElementsByTagNameNS(e,this.gmlns,"posList"),i.length>0){n=this.getChildValue(i[0]),n=n.replace(this.regExes.trimSpace,""),n=n.split(this.regExes.splitSpace);var o,s,a,l=parseInt(i[0].getAttribute("dimension"));for(i=0;n.length/l>i;++i)o=i*l,s=n[o],a=n[o+1],o=2==l?null:n[o+2],this.xy?r.push(new OpenLayers.Geometry.Point(s,a,o)):r.push(new OpenLayers.Geometry.Point(a,s,o))}if(0==n.length&&(i=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),i.length>0))for(n=this.getChildValue(i[0]),n=n.replace(this.regExes.trimSpace,""),n=n.replace(this.regExes.trimComma,","),l=n.split(this.regExes.splitSpace),i=0;l.length>i;++i)n=l[i].split(","),2==n.length&&(n[2]=null),this.xy?r.push(new OpenLayers.Geometry.Point(n[0],n[1],n[2])):r.push(new OpenLayers.Geometry.Point(n[1],n[0],n[2]));
return n=null,0!=r.length&&(n=t?new OpenLayers.Geometry.LinearRing(r):new OpenLayers.Geometry.LineString(r)),n},multilinestring:function(e){var e=this.getElementsByTagNameNS(e,this.gmlns,"LineString"),t=[];if(e.length>0)for(var i,n=0;e.length>n;++n)(i=this.parseGeometry.linestring.apply(this,[e[n]]))&&t.push(i);return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){var e=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing"),t=[];if(e.length>0)for(var i,n=0;e.length>n;++n)(i=this.parseGeometry.linestring.apply(this,[e[n],!0]))&&t.push(i);return new OpenLayers.Geometry.Polygon(t)},multipolygon:function(e){var e=this.getElementsByTagNameNS(e,this.gmlns,"Polygon"),t=[];if(e.length>0)for(var i,n=0;e.length>n;++n)(i=this.parseGeometry.polygon.apply(this,[e[n]]))&&t.push(i);return new OpenLayers.Geometry.MultiPolygon(t)},envelope:function(e){var t,i,n=[],r=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(r.length>0){t=[],r.length>0&&(t=r[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),t=t.split(this.regExes.splitSpace)),2==t.length&&(t[2]=null);var o=this.xy?new OpenLayers.Geometry.Point(t[0],t[1],t[2]):new OpenLayers.Geometry.Point(t[1],t[0],t[2])}if(e=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner"),e.length>0){t=[],e.length>0&&(t=e[0].firstChild.nodeValue,t=t.replace(this.regExes.trimSpace,""),t=t.split(this.regExes.splitSpace)),2==t.length&&(t[2]=null);var s=this.xy?new OpenLayers.Geometry.Point(t[0],t[1],t[2]):new OpenLayers.Geometry.Point(t[1],t[0],t[2])}return o&&s&&(n.push(new OpenLayers.Geometry.Point(o.x,o.y)),n.push(new OpenLayers.Geometry.Point(s.x,o.y)),n.push(new OpenLayers.Geometry.Point(s.x,s.y)),n.push(new OpenLayers.Geometry.Point(o.x,s.y)),n.push(new OpenLayers.Geometry.Point(o.x,o.y)),n=new OpenLayers.Geometry.LinearRing(n),i=new OpenLayers.Geometry.Polygon([n])),i},box:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),i=e=null;return t.length>0&&(t=t[0].firstChild.nodeValue,t=t.split(" "),2==t.length&&(e=t[0].split(","),i=t[1].split(","))),null!==e&&null!==i?new OpenLayers.Bounds(parseFloat(e[0]),parseFloat(e[1]),parseFloat(i[0]),parseFloat(i[1])):void 0}},parseAttributes:function(e){for(var t,i,n,r={},e=e.firstChild;e;){if(1==e.nodeType){for(e=e.childNodes,t=0;e.length>t;++t)i=e[t],1==i.nodeType&&(n=i.childNodes,1==n.length?(n=n[0],(3==n.nodeType||4==n.nodeType)&&(i=i.prefix?i.nodeName.split(":")[1]:i.nodeName,n=n.nodeValue.replace(this.regExes.trimSpace,""),r[i]=n)):r[i.nodeName.split(":").pop()]=null);break}e=e.nextSibling}return r},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),i=0;e.length>i;i++)t.appendChild(this.createFeatureXML(e[i]));return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=this.buildGeometryNode(e.geometry),i=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);i.appendChild(t);var t=this.createElementNS(this.gmlns,"gml:"+this.featureName),n=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName);n.setAttribute("fid",e.fid||e.id),n.appendChild(i);for(var r in e.attributes){var i=this.createTextNode(e.attributes[r]),o=this.createElementNS(this.featureNS,this.featurePrefix+":"+r.substring(r.lastIndexOf(":")+1));o.appendChild(i),n.appendChild(o)}return t.appendChild(n),t},buildGeometryNode:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t=e.CLASS_NAME;return this.buildGeometry[t.substring(t.lastIndexOf(".")+1).toLowerCase()].apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiPoint"),e=e.components,r=0;e.length>r;r++)t=this.createElementNS(this.gmlns,"gml:pointMember"),i=this.buildGeometry.point.apply(this,[e[r]]),t.appendChild(i),n.appendChild(t);return n},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiLineString"),e=e.components,r=0;e.length>r;++r)t=this.createElementNS(this.gmlns,"gml:lineStringMember"),i=this.buildGeometry.linestring.apply(this,[e[r]]),t.appendChild(i),n.appendChild(t);return n},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:Polygon"),e=e.components,r=0;e.length>r;++r)t=0==r?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.gmlns,"gml:"+t),i=this.buildGeometry.linearring.apply(this,[e[r]]),t.appendChild(i),n.appendChild(t);return n},multipolygon:function(e){for(var t,i,n=this.createElementNS(this.gmlns,"gml:MultiPolygon"),e=e.components,r=0;e.length>r;++r)t=this.createElementNS(this.gmlns,"gml:polygonMember"),i=this.buildGeometry.polygon.apply(this,[e[r]]),t.appendChild(i),n.appendChild(t);return n},bounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");return t.appendChild(this.buildCoordinatesNode(e)),t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," ");var i=[];if(e instanceof OpenLayers.Bounds)i.push(e.left+","+e.bottom),i.push(e.right+","+e.top);else for(var e=e.components?e.components:[e],n=0;e.length>n;n++)i.push(e[n].x+","+e[n].y);return i=this.createTextNode(i.join(" ")),t.appendChild(i),t},CLASS_NAME:"OpenLayers.Format.GML"}),OpenLayers.Format.GML||(OpenLayers.Format.GML={}),OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),this.setGeometryTypes(),e&&e.featureNS&&this.setNamespace("feature",e.featureNS),this.singleFeatureType=!e||"string"==typeof e.featureType},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var t=[];if(this.readNode(e,{features:t},!0),0==t.length){var i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(i.length)for(var e=0,n=i.length;n>e;++e)this.readNode(i[e],{features:t},!0);else i=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers"),i.length&&this.readNode(i[0],{features:t},!0)}return t},readNode:function(e,t,i){return i===!0&&this.autoConfig===!0&&(this.featureType=null,delete this.namespaceAlias[this.featureNS],delete this.namespaces.feature,this.featureNS=null),this.featureNS||e.prefix in this.namespaces||e.parentNode.namespaceURI!=this.namespaces.gml||!this.regExes.featureMember.test(e.parentNode.nodeName)||(this.featureType=e.nodeName.split(":").pop(),this.setNamespace("feature",e.namespaceURI),this.featureNS=e.namespaceURI,this.autoConfig=!0),OpenLayers.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var i={};this.readChildNodes(e,i),i.components&&i.components.length>0&&(t.bounds=i.components[0])},Point:function(e,t){var i={points:[]};this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(i.points[0])},coordinates:function(e,t){for(var i,n=this.getChildValue(e).replace(this.regExes.trimSpace,""),n=n.replace(this.regExes.trimComma,","),n=n.split(this.regExes.splitSpace),r=n.length,o=Array(r),s=0;r>s;++s)i=n[s].split(","),o[s]=this.xy?new OpenLayers.Geometry.Point(i[0],i[1],i[2]):new OpenLayers.Geometry.Point(i[1],i[0],i[2]);t.points=o},coord:function(e,t){var i={};this.readChildNodes(e,i),t.points||(t.points=[]),t.points.push(new OpenLayers.Geometry.Point(i.x,i.y,i.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var i={components:[]};this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPoint(i.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var i={};this.readChildNodes(e,i),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.LineString(i.points))},MultiLineString:function(e,t){var i={components:[]};this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiLineString(i.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var i={outer:null,inner:[]};this.readChildNodes(e,i),i.inner.unshift(i.outer),t.components||(t.components=[]),t.components.push(new OpenLayers.Geometry.Polygon(i.inner))},LinearRing:function(e,t){var i={};this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.LinearRing(i.points)]},MultiPolygon:function(e,t){var i={components:[]};this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.MultiPolygon(i.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var i={components:[]};this.readChildNodes(e,i),t.components=[new OpenLayers.Geometry.Collection(i.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var i,n=e.localName||e.nodeName.split(":").pop();t.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,n)?n===this.featureType&&(i="_typeName"):i="_typeName":0==e.childNodes.length||1==e.childNodes.length&&3==e.firstChild.nodeType?this.extractAttributes&&(i="_attribute"):i="_geometry",i&&this.readers.feature[i].apply(this,[e,t])},_typeName:function(e,t){var i={components:[],attributes:{}};this.readChildNodes(e,i),i.name&&(i.attributes.name=i.name);var n=new OpenLayers.Feature.Vector(i.components[0],i.attributes);this.singleFeatureType||(n.type=e.nodeName.split(":").pop(),n.namespace=e.namespaceURI);var r=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces.gml,"id");r&&(n.fid=r),this.internalProjection&&this.externalProjection&&n.geometry&&n.geometry.transform(this.externalProjection,this.internalProjection),i.bounds&&(n.bounds=i.bounds),t.features.push(n)},_geometry:function(e,t){this.geometryName||(this.geometryName=e.nodeName.split(":").pop()),this.readChildNodes(e,t)},_attribute:function(e,t){var i=e.localName||e.nodeName.split(":").pop(),n=this.getChildValue(e);t.attributes[i]=n}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){return e=this.writeNode("gml:"+(OpenLayers.Util.isArray(e)?"featureMembers":"featureMember"),e),this.setAttributeNS(e,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[e])},writers:{gml:{featureMember:function(e){var t=this.createElementNSPlus("gml:featureMember");return this.writeNode("feature:_typeName",e,t),t},MultiPoint:function(e){for(var t=this.createElementNSPlus("gml:MultiPoint"),e=e.components||[e],i=0,n=e.length;n>i;++i)this.writeNode("pointMember",e[i],t);return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");return this.writeNode("Point",e,t),t},MultiLineString:function(e){for(var t=this.createElementNSPlus("gml:MultiLineString"),e=e.components||[e],i=0,n=e.length;n>i;++i)this.writeNode("lineStringMember",e[i],t);return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");return this.writeNode("LineString",e,t),t},MultiPolygon:function(e){for(var t=this.createElementNSPlus("gml:MultiPolygon"),e=e.components||[e],i=0,n=e.length;n>i;++i)this.writeNode("polygonMember",e[i],t);return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");return this.writeNode("Polygon",e,t),t},GeometryCollection:function(e){for(var t=this.createElementNSPlus("gml:GeometryCollection"),i=0,n=e.components.length;n>i;++i)this.writeNode("geometryMember",e.components[i],t);return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember"),e=this.writeNode("feature:_geometry",e);return t.appendChild(e.firstChild),t}},feature:{_typeName:function(e){var t=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});e.geometry&&this.writeNode("feature:_geometry",e.geometry,t);for(var i in e.attributes){var n=e.attributes[i];null!=n&&this.writeNode("feature:_attribute",{name:i,value:n},t)}return t},_geometry:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone().transform(this.internalProjection,this.externalProjection));var t=this.createElementNSPlus("feature:"+this.geometryName),e=this.writeNode("gml:"+this.geometryTypes[e.CLASS_NAME],e,t);return this.srsName&&e.setAttribute("srsName",this.srsName),t},_attribute:function(e){return this.createElementNSPlus("feature:"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){for(var t=this.createElementNSPlus("wfs:FeatureCollection"),i=0,n=e.length;n>i;++i)this.writeNode("gml:featureMember",e[i],t);return t}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"}),OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t={exceptionReport:null};return e.documentElement&&(this.readChildNodes(e,t),null===t.exceptionReport&&(t=(new OpenLayers.Format.OWSCommon).read(e))),t},readers:{ogc:{ServiceExceptionReport:function(e,t){t.exceptionReport={exceptions:[]},this.readChildNodes(e,t.exceptionReport)},ServiceException:function(e,t){var i={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};t.exceptions.push(i)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"}),OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,errorProperty:null,name:null,stringifyOutput:!1,parser:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]),e=this.CLASS_NAME,this.name=e.substring(e.lastIndexOf(".")+1)},getVersion:function(e,t){var i;return e?(i=this.version,i||(i=e.getAttribute("version"),i||(i=this.defaultVersion))):i=t&&t.version||this.version||this.defaultVersion,i},getParser:function(e){var e=e||this.defaultVersion,t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var i=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!i)throw"Can't find a "+this.name+" parser for version "+e+t;this.parser=new i(this.options)}return this.parser},write:function(e,t){this.parser=this.getParser(this.getVersion(null,t));var i=this.parser.write(e,t);return!1===this.stringifyOutput?i:OpenLayers.Format.XML.prototype.write.apply(this,[i])},read:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=this.getVersion(e.documentElement);this.parser=this.getParser(i);var n=this.parser.read(e,t);if(null!==this.errorProperty&&void 0===n[this.errorProperty]){var r=new OpenLayers.Format.OGCExceptionReport;n.error=r.read(e)}return n.version=i,n},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"}),OpenLayers.Filter=OpenLayers.Class({initialize:function(e){OpenLayers.Util.extend(this,e)},destroy:function(){},evaluate:function(){return!0},clone:function(){return null},toString:function(){return OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this)},CLASS_NAME:"OpenLayers.Filter"}),OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[],OpenLayers.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,i=this.fids.length;i>t;t++)if((e.fid||e.id)==this.fids[t])return!0;return!1},clone:function(){var e=new OpenLayers.Filter.FeatureId;return OpenLayers.Util.extend(e,this),e.fids=this.fids.slice(),e},CLASS_NAME:"OpenLayers.Filter.FeatureId"}),OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(e){this.filters=[],OpenLayers.Filter.prototype.initialize.apply(this,[e])},destroy:function(){this.filters=null,OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var t,i;switch(this.type){case OpenLayers.Filter.Logical.AND:for(t=0,i=this.filters.length;i>t;t++)if(!1==this.filters[t].evaluate(e))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(t=0,i=this.filters.length;i>t;t++)if(!0==this.filters[t].evaluate(e))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(e)}},clone:function(){for(var e=[],t=0,i=this.filters.length;i>t;++t)e.push(this.filters[t].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"}),OpenLayers.Filter.Logical.AND="&&",OpenLayers.Filter.Logical.OR="||",OpenLayers.Filter.Logical.NOT="!",OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e]),this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===e.matchCase&&(this.matchCase=null)},evaluate:function(e){e instanceof OpenLayers.Feature.Vector&&(e=e.attributes);var t=!1,e=e[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:t=this.value,t=this.matchCase||"string"!=typeof e||"string"!=typeof t?e==t:e.toUpperCase()==t.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:t=this.value,t=this.matchCase||"string"!=typeof e||"string"!=typeof t?e!=t:e.toUpperCase()!=t.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:t=this.value>e;break;case OpenLayers.Filter.Comparison.GREATER_THAN:t=e>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:t=this.value>=e;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:t=e>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:t=e>=this.lowerBoundary&&this.upperBoundary>=e;break;case OpenLayers.Filter.Comparison.LIKE:t=RegExp(this.value,"gi").test(e)}return t},value2regex:function(e,t,i){if("."==e)throw Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");return e=e?e:"*",t=t?t:".",this.value=this.value.replace(RegExp("\\"+(i?i:"!")+"(.|$)","g"),"\\$1"),this.value=this.value.replace(RegExp("\\"+t,"g"),"."),this.value=this.value.replace(RegExp("\\"+e,"g"),".*"),this.value=this.value.replace(RegExp("\\\\.\\*","g"),"\\"+e),this.value=this.value.replace(RegExp("\\\\\\.","g"),"\\"+t)},regex2value:function(){var e=this.value,e=e.replace(/!/g,"!!"),e=e.replace(/(\\)?\\\./g,function(e,t){return t?e:"!."}),e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"!*"}),e=e.replace(/\\\\/g,"\\");return e=e.replace(/\.\*/g,"*")},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"}),OpenLayers.Filter.Comparison.EQUAL_TO="==",OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=",OpenLayers.Filter.Comparison.LESS_THAN="<",OpenLayers.Filter.Comparison.GREATER_THAN=">",OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=",OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=",OpenLayers.Filter.Comparison.BETWEEN="..",OpenLayers.Filter.Comparison.LIKE="~",OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"}),OpenLayers.Format.WFST=function(e){var e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.WFST.DEFAULTS),t=OpenLayers.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFST version: "+e.version;return new t(e)},OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"},OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(e){this.stateName={},this.stateName[OpenLayers.State.INSERT]="wfs:Insert",this.stateName[OpenLayers.State.UPDATE]="wfs:Update",this.stateName[OpenLayers.State.DELETE]="wfs:Delete",OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var i=t&&t.srsName;return i||(i=e&&e.layer?e.layer.projection.getCode():this.srsName),i},read:function(e,t){t=t||{},OpenLayers.Util.applyDefaults(t,{output:"features"}),"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e])),e&&9==e.nodeType&&(e=e.documentElement);var i={};return e&&this.readNode(e,i,!0),i.features&&"features"===t.output&&(i=i.features),i},readers:{wfs:{FeatureCollection:function(e,t){t.features=[],this.readChildNodes(e,t)}}},write:function(e,t){var i=this.writeNode("wfs:Transaction",{features:e,options:t}),n=this.schemaLocationAttr();return n&&this.setAttributeNS(i,this.namespaces.xsi,"xsi:schemaLocation",n),OpenLayers.Format.XML.prototype.write.apply(this,[i])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:e&&e.handle,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType)this.writeNode("Query",e,t);else for(var i=0,n=this.featureType.length;n>i;i++)e.featureType=this.featureType[i],this.writeNode("Query",e,t);return t},Transaction:function(e){var t,e=e||{},i=e.options||{},n=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:i.handle}}),r=e.features;if(r){!0===i.multi&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":!0===this.multiCurve?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":!0===this.multiSurface?"MultiSurface":"MultiPolygon"});var o,s,e=0;for(t=r.length;t>e;++e)s=r[e],(o=this.stateName[s.state])&&this.writeNode(o,{feature:s,options:i},n);!0===i.multi&&this.setGeometryTypes()}if(i.nativeElements)for(e=0,t=i.nativeElements.length;t>e;++e)this.writeNode("wfs:Native",i.nativeElements[e],n);return n},Native:function(e){return this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value})},Insert:function(e){var t=e.feature,e=e.options,e=this.createElementNSPlus("wfs:Insert",{attributes:{handle:e&&e.handle}});return this.srsName=this.getSrsName(t),this.writeNode("feature:_typeName",t,e),e},Update:function(e){var t=e.feature,e=e.options,e=this.createElementNSPlus("wfs:Update",{attributes:{handle:e&&e.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&e.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var i=t.modified;null===this.geometryName||i&&void 0===i.geometry||(this.srsName=this.getSrsName(t),this.writeNode("Property",{name:this.geometryName,value:t.geometry},e));for(var n in t.attributes)void 0!==t.attributes[n]&&(!i||!i.attributes||i.attributes&&void 0!==i.attributes[n])&&this.writeNode("Property",{name:n,value:t.attributes[n]},e);return this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),e),e},Property:function(e){var t=this.createElementNSPlus("wfs:Property");return this.writeNode("Name",e.name,t),null!==e.value&&this.writeNode("Value",e.value,t),t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;return e instanceof OpenLayers.Geometry?(t=this.createElementNSPlus("wfs:Value"),e=this.writeNode("feature:_geometry",e).firstChild,t.appendChild(e)):t=this.createElementNSPlus("wfs:Value",{value:e}),t},Delete:function(e){var t=e.feature,e=e.options,e=this.createElementNSPlus("wfs:Delete",{attributes:{handle:e&&e.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});return this.featureNS&&e.setAttribute("xmlns:"+this.featurePrefix,this.featureNS),this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),e),e}}},schemaLocationAttr:function(e){var e=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e),t=OpenLayers.Util.extend({},this.schemaLocations);e.schema&&(t[e.featurePrefix]=e.schema);var i,n,e=[];for(n in t)(i=this.namespaces[n])&&e.push(i+" "+t[n]);return e.join(" ")||void 0},setFilterProperty:function(e){if(e.filters)for(var t=0,i=e.filters.length;i>t;++t)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[t]);else e instanceof OpenLayers.Filter.Spatial&&!e.property&&(e.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"}),OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.outer=i.components[0]},innerBoundaryIs:function(e,t){var i={};this.readChildNodes(e,i),t.inner.push(i.components[0])},Box:function(e,t){var i={};this.readChildNodes(e,i),t.components||(t.components=[]);var n=i.points[0],i=i.points[1];t.components.push(new OpenLayers.Bounds(n.x,n.y,i.x,i.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){return e=this.writeNode(OpenLayers.Util.isArray(e)?"wfs:FeatureCollection":"gml:featureMember",e),this.setAttributeNS(e,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation),OpenLayers.Format.XML.prototype.write.apply(this,[e])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");return this.writeNode("coordinates",[e],t),t},coordinates:function(e){for(var t,i=e.length,n=Array(i),r=0;i>r;++r)t=e[r],n[r]=this.xy?t.x+","+t.y:t.y+","+t.x,void 0!=t.z&&(n[r]+=","+t.z);return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==i?n[0]:n.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");return this.writeNode("coordinates",e.components,t),t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var i=1;e.components.length>i;++i)this.writeNode("innerBoundaryIs",e.components[i],t);return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");return this.writeNode("LinearRing",e,t),t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");return this.writeNode("LinearRing",e,t),t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");return this.writeNode("coordinates",e.components,t),t},Box:function(e){var t=this.createElementNSPlus("gml:Box");return this.writeNode("coordinates",[{x:e.left,y:e.bottom},{x:e.right,y:e.top}],t),this.srsName&&t.setAttribute("srsName",this.srsName),t}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"}),OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"}),OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};return this.readers.ogc.Filter.apply(this,[e,t]),t.filter},readers:{ogc:{_expression:function(e){for(var t="",i=e.firstChild;i;i=i.nextSibling)switch(i.nodeType){case 1:e=this.readNode(i),e.property?t+="${"+e.property+"}":void 0!==e.value&&(t+=e.value);break;case 3:case 4:t+=i.nodeValue}return t},Filter:function(e,t){var i={fids:[],filters:[]};this.readChildNodes(e,i),i.fids.length>0?t.filter=new OpenLayers.Filter.FeatureId({fids:i.fids}):i.filters.length>0&&(t.filter=i.filters[0])},FeatureId:function(e,t){var i=e.getAttribute("fid");i&&t.fids.push(i)},And:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,i),t.filters.push(i)},Or:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,i),t.filters.push(i)},Not:function(e,t){var i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThan:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLessThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsGreaterThanOrEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsBetween:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,i),t.filters.push(i)},Literal:function(e,t){t.value=OpenLayers.String.numericIf(this.getChildValue(e))},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e))},UpperBoundary:function(e,t){t.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e))},Intersects:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=parseInt(this.getChildValue(e)),t.distanceUnits=e.getAttribute("units")},Function:function(){}}},readSpatial:function(e,t,i){i=new OpenLayers.Filter.Spatial({type:i}),this.readChildNodes(e,i),i.value=i.components[0],delete i.components,t.filters.push(i)},writeOgcExpression:function(e,t){if(e instanceof OpenLayers.Filter.Function){var i=this.writeNode("Function",e,t);t.appendChild(i)}else this.writeNode("Literal",e,t);return t},write:function(e){return this.writers.ogc.Filter.apply(this,[e])
},writeFeatureIdNodes:function(e,t){for(var i=0,n=e.fids.length;n>i;++i)this.writeNode("FeatureId",e.fids[i],t)},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");return"FID"===e.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,e,t):this.writeNode(this.getFilterType(e),e,t),t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){for(var t,i=this.createElementNSPlus("ogc:And"),n=0,r=e.filters.length;r>n;++n)t=e.filters[n],"FID"===t.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,t,i):this.writeNode(this.getFilterType(t),t,i);return i},Or:function(e){for(var t,i=this.createElementNSPlus("ogc:Or"),n=0,r=e.filters.length;r>n;++n)t=e.filters[n],"FID"===t.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,t,i):this.writeNode(this.getFilterType(t),t,i);return i},Not:function(e){var t=this.createElementNSPlus("ogc:Not"),e=e.filters[0];return"FID"===e.type?OpenLayers.Format.Filter.v1.prototype.writeFeatureIdNodes.call(this,e,t):this.writeNode(this.getFilterType(e),e,t),t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");return this.writeNode("PropertyName",e,t),this.writeNode("LowerBoundary",e,t),this.writeNode("UpperBoundary",e,t),t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){return this.createElementNSPlus("ogc:Literal",{value:e})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");return this.writeOgcExpression(e.lowerBoundary,t),t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");return this.writeNode("Literal",e.upperBoundary,t),t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");return this.writeNode("Distance",e,t),t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}}),e=e.params,i=0,n=e.length;n>i;i++)this.writeOgcExpression(e[i],t);return t}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"FeatureId"},CLASS_NAME:"OpenLayers.Format.Filter.v1"}),OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsNotEqualTo:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,i),t.filters.push(i)},PropertyIsLike:function(e,t){var i=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,i);var n=e.getAttribute("wildCard"),r=e.getAttribute("singleChar"),o=e.getAttribute("escape");i.value2regex(n,r,o),t.filters.push(i)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");return this.writeNode("PropertyName",e,t),this.writeOgcExpression(e.value,t),t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});return this.writeNode("PropertyName",e,t),this.writeNode("Literal",e.regex2value(),t),t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var i=this.writeNode("gml:Box",e.value,t);return e.projection&&i.setAttribute("srsName",e.projection),t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,t){var i=this.createElementNSPlus("ogc:"+t);if(this.writeNode("PropertyName",e,i),e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,i);else{var n;n=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value),e.projection&&n.setAttribute("srsName",e.projection),i.appendChild(n)}return i},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"}),OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e]),OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,[e,t])},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(e,t){t.insertIds=[],t.success=!1,this.readChildNodes(e,t)},InsertResult:function(e,t){var i={fids:[]};this.readChildNodes(e,i),t.insertIds.push(i.fids[0])},TransactionResult:function(e,t){this.readChildNodes(e,t)},Status:function(e,t){this.readChildNodes(e,t)},SUCCESS:function(e,t){t.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(e){var e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e),t=e.featurePrefix,i=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType}});if(e.srsNameInQuery&&e.srsName&&i.setAttribute("srsName",e.srsName),e.featureNS&&i.setAttribute("xmlns:"+t,e.featureNS),e.propertyNames)for(var t=0,n=e.propertyNames.length;n>t;t++)this.writeNode("ogc:PropertyName",{property:e.propertyNames[t]},i);return e.filter&&(this.setFilterProperty(e.filter),this.writeNode("ogc:Filter",e.filter,i)),i}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"}),OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var i,n=-1,r=this.order.length;r-n>1;)i=parseInt((n+r)/2),this.compare(this,e,OpenLayers.Util.getElement(this.order[i]))>0?n=i:r=i;return this.order.splice(r,0,t),this.indices[t]=this.getZIndex(e),this.getNextElement(r)},remove:function(e){var e=e.id,t=OpenLayers.Util.indexOf(this.order,e);t>=0&&(this.order.splice(t,1),delete this.indices[e],this.maxZIndex=this.order.length>0?this.indices[this.order[this.order.length-1]]:0)},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;null==t?(t=this.maxZIndex,e._style.graphicZIndex=t):t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){if(e+=1,this.order.length>e){var t=OpenLayers.Util.getElement(this.order[e]);return void 0==t&&(t=this.getNextElement(e)),t}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,i){var t=e.getZIndex(t),n=0;return i&&(e=e.getZIndex(i),n=t-e),n},Z_ORDER_DRAWING_ORDER:function(e,t,i){return e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i),i&&0==e&&(e=1),e},Z_ORDER_Y_ORDER:function(e,t,i){return e=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i),i&&0===e&&(t=i._boundsBottom-t._boundsBottom,e=0===t?1:t),e}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear(),this.xmlns=this.root=this.rendererRoot=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},setExtent:function(e,t){var i=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),n=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var r,o=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/o),o=this.map.getMaxExtent();o.right>e.left&&o.right<e.right?r=!0:o.left>e.left&&o.left<e.right&&(r=!1),(r!==this.rightOfDateLine||t)&&(i=!1,this.xOffset=!0===r?o.getWidth()/n:0),this.rightOfDateLine=r}return i},getNodeType:function(){},drawGeometry:function(e,t,i){var n=e.CLASS_NAME,r=!0;if("OpenLayers.Geometry.Collection"==n||"OpenLayers.Geometry.MultiPoint"==n||"OpenLayers.Geometry.MultiLineString"==n||"OpenLayers.Geometry.MultiPolygon"==n){for(var n=0,o=e.components.length;o>n;n++)r=this.drawGeometry(e.components[n],t,i)&&r;return r}return n=r=!1,"none"!=t.display&&(t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,i):n=!0,r=this.redrawNode(e.id,e,t,i)),!1==r&&(t=document.getElementById(e.id))&&(t._style.backgroundGraphic&&(n=!0),t.parentNode.removeChild(t)),n&&(t=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX))&&t.parentNode.removeChild(t),r},redrawNode:function(e,t,i,n){return i=this.applyDefaultSymbolizer(i),e=this.nodeFactory(e,this.getNodeType(t,i)),e._featureId=n,e._boundsBottom=t.getBounds().bottom,e._geometryClass=t.CLASS_NAME,e._style=i,t=this.drawGeometryNode(e,t,i),!1===t?!1:(e=t.node,this.indexer?(i=this.indexer.insert(e))?this.vectorRoot.insertBefore(e,i):this.vectorRoot.appendChild(e):e.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(e),this.postDraw(e),t.complete)},redrawBackgroundNode:function(e,t,i){return i=OpenLayers.Util.extend({},i),i.externalGraphic=i.backgroundGraphic,i.graphicXOffset=i.backgroundXOffset,i.graphicYOffset=i.backgroundYOffset,i.graphicZIndex=i.backgroundGraphicZIndex,i.graphicWidth=i.backgroundWidth||i.graphicWidth,i.graphicHeight=i.backgroundHeight||i.graphicHeight,i.backgroundGraphic=null,i.backgroundXOffset=null,i.backgroundYOffset=null,i.backgroundGraphicZIndex=null,this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,i,null)},drawGeometryNode:function(e,t,i){var n,i=i||e._style,r={isFilled:void 0===i.fill?!0:i.fill,isStroked:void 0===i.stroke?!!i.strokeWidth:i.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":!1===i.graphic&&(r.isFilled=!1,r.isStroked=!1),n=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":r.isFilled=!1,n=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":n=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":n=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Rectangle":n=this.drawRectangle(e,t)}return e._options=r,!1!=n?{node:this.setStyle(e,i,r,t),complete:n}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t),(e=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX))&&this.textRoot.removeChild(e)},getFeatureIdFromEvent:function(e){var t=e.target,i=t&&t.correspondingUseElement;return(i?i:t||e.srcElement)._featureId},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var i=0,n=e.components.length;n>i;i++)this.eraseGeometry(e.components[i],t);else(i=OpenLayers.Util.getElement(e.id))&&i.parentNode&&(i.geometry&&(i.geometry.destroy(),i.geometry=null),i.parentNode.removeChild(i),this.indexer&&this.indexer.remove(i),i._style.backgroundGraphic&&(i=OpenLayers.Util.getElement(e.id+this.BACKGROUND_ID_SUFFIX))&&i.parentNode&&i.parentNode.removeChild(i))},nodeFactory:function(e,t){var i=OpenLayers.Util.getElement(e);return i?this.nodeTypeCompare(i,t)||(i.parentNode.removeChild(i),i=this.nodeFactory(e,t)):i=this.createNode(t,e),i},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root),t.parentNode.removeChild(t),e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"}),OpenLayers.Control.Panel=OpenLayers.Class(OpenLayers.Control,{controls:null,autoActivate:!0,defaultControl:null,saveState:!1,allowDepress:!1,activeState:null,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]),this.controls=[],this.activeState={}},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick),OpenLayers.Control.prototype.destroy.apply(this,arguments);for(var e,t=this.controls.length-1;t>=0;t--)e=this.controls[t],e.events&&e.events.un({activate:this.iconOn,deactivate:this.iconOff}),e.panel_div=null;this.activeState=null},activate:function(){if(OpenLayers.Control.prototype.activate.apply(this,arguments)){for(var e,t=0,i=this.controls.length;i>t;t++)e=this.controls[t],(e===this.defaultControl||this.saveState&&this.activeState[e.id])&&e.activate();return!0===this.saveState&&(this.defaultControl=null),this.redraw(),!0}return!1},deactivate:function(){if(OpenLayers.Control.prototype.deactivate.apply(this,arguments)){for(var e,t=0,i=this.controls.length;i>t;t++)e=this.controls[t],this.activeState[e.id]=e.deactivate();return this.redraw(),!0}return!1},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.outsideViewport?(this.events.attachToElement(this.div),this.events.register("buttonclick",this,this.onButtonClick)):this.map.events.register("buttonclick",this,this.onButtonClick),this.addControlsToMap(this.controls),this.div},redraw:function(){for(var e=this.div.childNodes.length-1;e>=0;e--)this.div.removeChild(this.div.childNodes[e]);if(this.div.innerHTML="",this.active)for(var e=0,t=this.controls.length;t>e;e++)this.div.appendChild(this.controls[e].panel_div)},activateControl:function(e){if(!this.active)return!1;if(e.type==OpenLayers.Control.TYPE_BUTTON)e.trigger();else if(e.type==OpenLayers.Control.TYPE_TOGGLE)e.active?e.deactivate():e.activate();else if(this.allowDepress&&e.active)e.deactivate();else{for(var t,i=0,n=this.controls.length;n>i;i++)t=this.controls[i],t!=e&&(t.type===OpenLayers.Control.TYPE_TOOL||null==t.type)&&t.deactivate();e.activate()}},addControls:function(e){OpenLayers.Util.isArray(e)||(e=[e]),this.controls=this.controls.concat(e);for(var t=0,i=e.length;i>t;t++){var n=e[t],r=this.createControlMarkup(n);OpenLayers.Element.addClass(r,n.displayClass+"ItemInactive"),OpenLayers.Element.addClass(r,"olButton"),""!=n.title&&!r.title&&(r.title=n.title),n.panel_div=r}this.map&&(this.addControlsToMap(e),this.redraw())},createControlMarkup:function(){return document.createElement("div")},addControlsToMap:function(e){for(var t,i=0,n=e.length;n>i;i++)t=e[i],!0===t.autoActivate?(t.autoActivate=!1,this.map.addControl(t),t.autoActivate=!0):(this.map.addControl(t),t.deactivate()),t.events.on({activate:this.iconOn,deactivate:this.iconOff})},iconOn:function(){var e=this.panel_div;e.className=e.className.replace(RegExp("\\b("+this.displayClass+"Item)Inactive\\b"),"$1Active")},iconOff:function(){var e=this.panel_div;e.className=e.className.replace(RegExp("\\b("+this.displayClass+"Item)Active\\b"),"$1Inactive")},onButtonClick:function(e){for(var t=this.controls,e=e.buttonElement,i=t.length-1;i>=0;--i)if(t[i].panel_div===e){this.activateControl(t[i]);break}},getControlsBy:function(e,t){var i="function"==typeof t.test;return OpenLayers.Array.filter(this.controls,function(n){return n[e]==t||i&&t.test(n[e])})},getControlsByName:function(e){return this.getControlsBy("name",e)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},CLASS_NAME:"OpenLayers.Control.Panel"}),OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e),this.options=e,this.active=!1},destroy:function(){this.deactivate(),this.options=this.layer=null},setLayer:function(e){this.layer=e},activate:function(){return this.active?!1:this.active=!0},deactivate:function(){return this.active?(this.active=!1,!0):!1},CLASS_NAME:"OpenLayers.Strategy"}),OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){return OpenLayers.Strategy.prototype.activate.apply(this,arguments)?(this.layer.events.on({refresh:this.load,scope:this}),!0==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this}),!0):!1},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);return e&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this}),e},load:function(e){var t=this.layer;t.events.triggerEvent("loadstart"),t.protocol.read(OpenLayers.Util.applyDefaults({callback:OpenLayers.Function.bind(this.merge,this,t.map.getProjectionObject()),filter:t.filter},e)),t.events.un({visibilitychanged:this.load,scope:this})},merge:function(e,t){var i=this.layer;i.destroyFeatures();var n=t.features;if(n&&n.length>0){if(!e.equals(i.projection))for(var r,o=0,s=n.length;s>o;++o)(r=n[o].geometry)&&r.transform(i.projection,e);i.addFeatures(n)}i.events.triggerEvent("loadend")},CLASS_NAME:"OpenLayers.Strategy.Fixed"}),OpenLayers.Control.Zoom=OpenLayers.Class(OpenLayers.Control,{zoomInText:"+",zoomInId:"olZoomInLink",zoomOutText:"-",zoomOutId:"olZoomOutLink",draw:function(){var e=OpenLayers.Control.prototype.draw.apply(this),t=this.getOrCreateLinks(e),i=t.zoomIn,t=t.zoomOut,n=this.map.events;return t.parentNode!==e&&(n=this.events,n.attachToElement(t.parentNode)),n.register("buttonclick",this,this.onZoomClick),this.zoomInLink=i,this.zoomOutLink=t,e},getOrCreateLinks:function(e){var t=document.getElementById(this.zoomInId),i=document.getElementById(this.zoomOutId);return t||(t=document.createElement("a"),t.href="#zoomIn",t.appendChild(document.createTextNode(this.zoomInText)),t.className="olControlZoomIn",e.appendChild(t)),OpenLayers.Element.addClass(t,"olButton"),i||(i=document.createElement("a"),i.href="#zoomOut",i.appendChild(document.createTextNode(this.zoomOutText)),i.className="olControlZoomOut",e.appendChild(i)),OpenLayers.Element.addClass(i,"olButton"),{zoomIn:t,zoomOut:i}},onZoomClick:function(e){e=e.buttonElement,e===this.zoomInLink?this.map.zoomIn():e===this.zoomOutLink&&this.map.zoomOut()},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onZoomClick),delete this.zoomInLink,delete this.zoomOutLink,OpenLayers.Control.prototype.destroy.apply(this)},CLASS_NAME:"OpenLayers.Control.Zoom"}),OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{},OpenLayers.Util.extend(this,e),this.options=e},mergeWithDefaultFilter:function(e){return e&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0},destroy:function(){this.format=this.options=null},read:function(e){e=e||{},e.filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(){},createCallback:function(e,t,i){return OpenLayers.Function.bind(function(){e.apply(this,[t,i])},this)},CLASS_NAME:"OpenLayers.Protocol"}),OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"}),OpenLayers.Protocol.Response.SUCCESS=1,OpenLayers.Protocol.Response.FAILURE=0,OpenLayers.Protocol.WFS=function(e){var e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.WFS.DEFAULTS),t=OpenLayers.Protocol.WFS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFS version: "+e.version;return new t(e)},OpenLayers.Protocol.WFS.fromWMSLayer=function(e,t){var i,n;return i=e.params.LAYERS,i=(OpenLayers.Util.isArray(i)?i[0]:i).split(":"),i.length>1&&(n=i[0]),i=i.pop(),n={url:e.url,featureType:i,featurePrefix:n,srsName:e.projection&&e.projection.getCode()||e.map&&e.map.getProjectionObject().getCode(),version:"1.1.0"},new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(t,n))},OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"},OpenLayers.Date={toISOString:function(){if("toISOString"in Date.prototype)return function(e){return e.toISOString()};var e=function(e,t){for(var i=e+"";t>i.length;)i="0"+i;return i};return function(t){return isNaN(t.getTime())?"Invalid Date":t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1,2)+"-"+e(t.getUTCDate(),2)+"T"+e(t.getUTCHours(),2)+":"+e(t.getUTCMinutes(),2)+":"+e(t.getUTCSeconds(),2)+"."+e(t.getUTCMilliseconds(),3)+"Z"}}(),parse:function(e){var t;if((e=e.match(/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/))&&(e[1]||e[7])){t=parseInt(e[1],10)||0;var i=parseInt(e[2],10)-1||0,n=parseInt(e[3],10)||1;if(t=new Date(Date.UTC(t,i,n)),i=e[7]){var n=parseInt(e[4],10),r=parseInt(e[5],10),o=parseFloat(e[6]),s=0|o,o=Math.round(1e3*(o-s));t.setUTCHours(n,r,s,o),"Z"!==i&&(i=parseInt(i,10),e=parseInt(e[8],10)||0,t=new Date(t.getTime()+-1e3*(3600*i+60*e)))}}else t=new Date("invalid");return t}},OpenLayers.ProxyHost="",OpenLayers.Request={DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(e,t){var i=0!==e.indexOf("http"),n=!i&&e.match(this.URL_SPLIT_REGEX);if(n){var r=window.location,i=n[1]==r.protocol&&n[3]==r.hostname,n=n[4],r=r.port;(80!=n&&""!=n||"80"!=r&&""!=r)&&(i=i&&n==r)}return i||(t?e="function"==typeof t?t(e):t+encodeURIComponent(e):OpenLayers.Console.warn(OpenLayers.i18n("proxyNeeded"),{url:e})),e},issue:function(e){var t,i=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost}),e=OpenLayers.Util.applyDefaults(e,i),i=!1;for(t in e.headers)e.headers.hasOwnProperty(t)&&"x-requested-with"===t.toLowerCase()&&(i=!0);!1===i&&(e.headers["X-Requested-With"]="XMLHttpRequest");var n=new OpenLayers.Request.XMLHttpRequest,r=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{})),r=OpenLayers.Request.makeSameOrigin(r,e.proxy);n.open(e.method,r,e.async,e.user,e.password);for(var o in e.headers)n.setRequestHeader(o,e.headers[o]);var s=this.events,a=this;return n.onreadystatechange=function(){n.readyState==OpenLayers.Request.XMLHttpRequest.DONE&&!1!==s.triggerEvent("complete",{request:n,config:e,requestUrl:r})&&a.runCallbacks({request:n,config:e,requestUrl:r})},!1===e.async?n.send(e.data):window.setTimeout(function(){0!==n.readyState&&n.send(e.data)},0),n},runCallbacks:function(e){var t,i=e.request,n=e.config,r=n.scope?OpenLayers.Function.bind(n.callback,n.scope):n.callback;n.success&&(t=n.scope?OpenLayers.Function.bind(n.success,n.scope):n.success);var o;n.failure&&(o=n.scope?OpenLayers.Function.bind(n.failure,n.scope):n.failure),"file:"==OpenLayers.Util.createUrlObject(n.url).protocol&&i.responseText&&(i.status=200),r(i),(!i.status||i.status>=200&&300>i.status)&&(this.events.triggerEvent("success",e),t&&t(i)),i.status&&(200>i.status||i.status>=300)&&(this.events.triggerEvent("failure",e),o&&o(i))},GET:function(e){return e=OpenLayers.Util.extend(e,{method:"GET"}),OpenLayers.Request.issue(e)},POST:function(e){return e=OpenLayers.Util.extend(e,{method:"POST"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},PUT:function(e){return e=OpenLayers.Util.extend(e,{method:"PUT"}),e.headers=e.headers?e.headers:{},"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml"),OpenLayers.Request.issue(e)},DELETE:function(e){return e=OpenLayers.Util.extend(e,{method:"DELETE"}),OpenLayers.Request.issue(e)},HEAD:function(e){return e=OpenLayers.Util.extend(e,{method:"HEAD"}),OpenLayers.Request.issue(e)},OPTIONS:function(e){return e=OpenLayers.Util.extend(e,{method:"OPTIONS"}),OpenLayers.Request.issue(e)}},function(){function e(){this._object=o&&!l?new o:new window.ActiveXObject("Microsoft.XMLHTTP"),this._listeners=[]}function t(){return new e}function i(e){t.onreadystatechange&&t.onreadystatechange.apply(e),e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function n(e){try{e.responseText=e._object.responseText}catch(t){}try{var i,n=e._object,r=n.responseXML,o=n.responseText;a&&o&&r&&!r.documentElement&&n.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)&&(r=new window.ActiveXObject("Microsoft.XMLDOM"),r.async=!1,r.validateOnParse=!1,r.loadXML(o)),i=r&&(a&&0!=r.parseError||!r.documentElement||r.documentElement&&"parsererror"==r.documentElement.tagName)?null:r,e.responseXML=i}catch(s){}try{e.status=e._object.status}catch(l){}try{e.statusText=e._object.statusText}catch(h){}}function r(e){e._object.onreadystatechange=new window.Function}var o=window.XMLHttpRequest,s=!!window.controllers,a=window.document.all&&!window.opera,l=a&&window.navigator.userAgent.match(/MSIE 7.0/);t.prototype=e.prototype,s&&o.wrapped&&(t.wrapped=o.wrapped),t.UNSENT=0,t.OPENED=1,t.HEADERS_RECEIVED=2,t.LOADING=3,t.DONE=4,t.prototype.readyState=t.UNSENT,t.prototype.responseText="",t.prototype.responseXML=null,t.prototype.status=0,t.prototype.statusText="",t.prototype.priority="NORMAL",t.prototype.onreadystatechange=null,t.onreadystatechange=null,t.onopen=null,t.onsend=null,t.onabort=null,t.prototype.open=function(e,o,l,h,c){delete this._headers,3>arguments.length&&(l=!0),this._async=l;var u,d=this,p=this.readyState;a&&l&&(u=function(){p!=t.DONE&&(r(d),d.abort())},window.attachEvent("onunload",u)),t.onopen&&t.onopen.apply(this,arguments),arguments.length>4?this._object.open(e,o,l,h,c):arguments.length>3?this._object.open(e,o,l,h):this._object.open(e,o,l),this.readyState=t.OPENED,i(this),this._object.onreadystatechange=function(){(!s||l)&&(d.readyState=d._object.readyState,n(d),d._aborted?d.readyState=t.UNSENT:(d.readyState==t.DONE&&(delete d._data,r(d),a&&l&&window.detachEvent("onunload",u)),p!=d.readyState&&i(d),p=d.readyState))}},t.prototype.send=function(e){t.onsend&&t.onsend.apply(this,arguments),arguments.length||(e=null),e&&e.nodeType&&(e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml,this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")),this._data=e;e:if(this._object.send(this._data),s&&!this._async)for(this.readyState=t.OPENED,n(this);this.readyState<t.DONE;)if(this.readyState++,i(this),this._aborted)break e},t.prototype.abort=function(){t.onabort&&t.onabort.apply(this,arguments),this.readyState>t.UNSENT&&(this._aborted=!0),this._object.abort(),r(this),this.readyState=t.UNSENT,delete this._data},t.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()},t.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)},t.prototype.setRequestHeader=function(e,t){return this._headers||(this._headers={}),this._headers[e]=t,this._object.setRequestHeader(e,t)},t.prototype.addEventListener=function(e,t,i){for(var n,r=0;n=this._listeners[r];r++)if(n[0]==e&&n[1]==t&&n[2]==i)return;this._listeners.push([e,t,i])},t.prototype.removeEventListener=function(e,t,i){for(var n,r=0;(n=this._listeners[r])&&(n[0]!=e||n[1]!=t||n[2]!=i);r++);n&&this._listeners.splice(r,1)},t.prototype.dispatchEvent=function(e){e={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}},"readystatechange"==e.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[e]);for(var t,i=0;t=this._listeners[i];i++)t[0]==e.type&&!t[2]&&(t[1].handleEvent||t[1]).apply(this,[e])},t.prototype.toString=function(){return"[object XMLHttpRequest]"},t.toString=function(){return"[XMLHttpRequest]"},window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]),e.__func=this,e.__func(t[0],t[1],t[2],t[3],t[4]),delete e.__func}),OpenLayers.Request.XMLHttpRequest=t}(),OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g},this.externalProjection=new OpenLayers.Projection("EPSG:4326"),OpenLayers.Format.XML.prototype.initialize.apply(this,[e])
},read:function(e){return this.features=[],this.styles={},this.fetched={},this.parseData(e,{depth:0,styleBaseUrl:this.styleBaseUrl})},parseData:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var i=["Link","NetworkLink","Style","StyleMap","Placemark"],n=0,r=i.length;r>n;++n){var o=i[n],s=this.getElementsByTagNameNS(e,"*",o);if(0!=s.length)switch(o.toLowerCase()){case"link":case"networklink":this.parseLinks(s,t);break;case"style":this.extractStyles&&this.parseStyles(s,t);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(s,t);break;case"placemark":this.parseFeatures(s,t)}}return this.features},parseLinks:function(e,t){if(t.depth>=this.maxDepth)return!1;var i=OpenLayers.Util.extend({},t);i.depth++;for(var n=0,r=e.length;r>n;n++){var o=this.parseProperty(e[n],"*","href");o&&!this.fetched[o]&&(this.fetched[o]=!0,(o=this.fetchLink(o))&&this.parseData(o,i))}},fetchLink:function(e){return(e=OpenLayers.Request.GET({url:e,async:!1}))?e.responseText:void 0},parseStyles:function(e,t){for(var i=0,n=e.length;n>i;i++){var r=this.parseStyle(e[i]);r&&(this.styles[(t.styleBaseUrl||"")+"#"+r.id]=r)}},parseKmlColor:function(e){var t=null;return e&&(e=e.match(this.regExes.kmlColor))&&(t={color:"#"+e[4]+e[3]+e[2],opacity:parseInt(e[1],16)/255}),t},parseStyle:function(e){for(var t,i,n={},r=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],o=0,s=r.length;s>o;++o)if(t=r[o],i=this.getElementsByTagNameNS(e,"*",t)[0])switch(t.toLowerCase()){case"linestyle":t=this.parseProperty(i,"*","color"),(t=this.parseKmlColor(t))&&(n.strokeColor=t.color,n.strokeOpacity=t.opacity),(t=this.parseProperty(i,"*","width"))&&(n.strokeWidth=t);break;case"polystyle":t=this.parseProperty(i,"*","color"),(t=this.parseKmlColor(t))&&(n.fillOpacity=t.opacity,n.fillColor=t.color),"0"==this.parseProperty(i,"*","fill")&&(n.fillColor="none"),"0"==this.parseProperty(i,"*","outline")&&(n.strokeWidth="0");break;case"iconstyle":var a=parseFloat(this.parseProperty(i,"*","scale")||1);t=32*a;var l=32*a,h=this.getElementsByTagNameNS(i,"*","Icon")[0];if(h){var c=this.parseProperty(h,"*","href");if(c){var u=this.parseProperty(h,"*","w"),d=this.parseProperty(h,"*","h");OpenLayers.String.startsWith(c,"http://maps.google.com/mapfiles/kml")&&!u&&!d&&(d=u=64,a/=2),u=u||d,d=d||u,u&&(t=parseInt(u)*a),d&&(l=parseInt(d)*a),(d=c.match(this.regExes.kmlIconPalette))&&(u=d[1],d=d[2],c=this.parseProperty(h,"*","x"),h=this.parseProperty(h,"*","y"),c="http://maps.google.com/mapfiles/kml/pal"+u+"/icon"+(8*(h?7-h/32:7)+(c?c/32:0))+d),n.graphicOpacity=1,n.externalGraphic=c}}(i=this.getElementsByTagNameNS(i,"*","hotSpot")[0])&&(c=parseFloat(i.getAttribute("x")),h=parseFloat(i.getAttribute("y")),u=i.getAttribute("xunits"),"pixels"==u?n.graphicXOffset=-c*a:"insetPixels"==u?n.graphicXOffset=-t+c*a:"fraction"==u&&(n.graphicXOffset=-t*c),i=i.getAttribute("yunits"),"pixels"==i?n.graphicYOffset=-l+h*a+1:"insetPixels"==i?n.graphicYOffset=-(h*a)+1:"fraction"==i&&(n.graphicYOffset=-l*(1-h)+1)),n.graphicWidth=t,n.graphicHeight=l;break;case"balloonstyle":(i=OpenLayers.Util.getXmlNodeValue(i))&&(n.balloonStyle=i.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":t=this.parseProperty(i,"*","color"),(t=this.parseKmlColor(t))&&(n.fontColor=t.color,n.fontOpacity=t.opacity)}return!n.strokeColor&&n.fillColor&&(n.strokeColor=n.fillColor),(e=e.getAttribute("id"))&&n&&(n.id=e),n},parseStyleMaps:function(e,t){for(var i=0,n=e.length;n>i;i++)for(var r=e[i],o=this.getElementsByTagNameNS(r,"*","Pair"),r=r.getAttribute("id"),s=0,a=o.length;a>s;s++){var l=o[s],h=this.parseProperty(l,"*","key");(l=this.parseProperty(l,"*","styleUrl"))&&"normal"==h&&(this.styles[(t.styleBaseUrl||"")+"#"+r]=this.styles[(t.styleBaseUrl||"")+l])}},parseFeatures:function(e,t){for(var i=[],n=0,r=e.length;r>n;n++){var o=e[n],s=this.parseFeature.apply(this,[o]);if(!s)throw"Bad Placemark: "+n;if(this.extractStyles&&s.attributes&&s.attributes.styleUrl&&(s.style=this.getStyle(s.attributes.styleUrl,t)),this.extractStyles){var a=this.getElementsByTagNameNS(o,"*","Style")[0];a&&(a=this.parseStyle(a))&&(s.style=OpenLayers.Util.extend(s.style,a))}this.extractTracks?(o=this.getElementsByTagNameNS(o,this.namespaces.gx,"Track"))&&o.length>0&&(s={features:[],feature:s},this.readNode(o[0],s),s.features.length>0&&i.push.apply(i,s.features)):i.push(s)}this.features=this.features.concat(i)},readers:{kml:{when:function(e,t){t.whens.push(OpenLayers.Date.parse(this.getChildValue(e)))},_trackPointAttribute:function(e,t){var i=e.nodeName.split(":").pop();t.attributes[i].push(this.getChildValue(e))}},gx:{Track:function(e,t){var i={whens:[],points:[],angles:[]};if(this.trackAttributes){var n;i.attributes={};for(var r=0,o=this.trackAttributes.length;o>r;++r)n=this.trackAttributes[r],i.attributes[n]=[],n in this.readers.kml||(this.readers.kml[n]=this.readers.kml._trackPointAttribute)}if(this.readChildNodes(e,i),i.whens.length!==i.points.length)throw Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:coord ("+i.points.length+") elements.");var s=i.angles.length>0;if(s&&i.whens.length!==i.angles.length)throw Error("gx:Track with unequal number of when ("+i.whens.length+") and gx:angles ("+i.angles.length+") elements.");for(var a,l,r=0,o=i.whens.length;o>r;++r){if(a=t.feature.clone(),a.fid=t.feature.fid||t.feature.id,l=i.points[r],a.geometry=l,"z"in l&&(a.attributes.altitude=l.z),this.internalProjection&&this.externalProjection&&a.geometry.transform(this.externalProjection,this.internalProjection),this.trackAttributes){l=0;for(var h=this.trackAttributes.length;h>l;++l)a.attributes[n]=i.attributes[this.trackAttributes[l]][r]}a.attributes.when=i.whens[r],a.attributes.trackId=t.feature.id,s&&(l=i.angles[r],a.attributes.heading=parseFloat(l[0]),a.attributes.tilt=parseFloat(l[1]),a.attributes.roll=parseFloat(l[2])),t.features.push(a)}},coord:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/),n=new OpenLayers.Geometry.Point(i[0],i[1]);i.length>2&&(n.z=parseFloat(i[2])),t.points.push(n)},angles:function(e,t){var i=this.getChildValue(e).replace(this.regExes.trimSpace,"").split(/\s+/);t.angles.push(i)}}},parseFeature:function(e){for(var t,i,n,r=["MultiGeometry","Polygon","LineString","Point"],o=0,s=r.length;s>o;++o)if(t=r[o],this.internalns=e.namespaceURI?e.namespaceURI:this.kmlns,i=this.getElementsByTagNameNS(e,this.internalns,t),i.length>0){if(!(r=this.parseGeometry[t.toLowerCase()]))throw new TypeError("Unsupported geometry type: "+t);n=r.apply(this,[i[0]]),this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection);break}var a;return this.extractAttributes&&(a=this.parseAttributes(e)),t=new OpenLayers.Feature.Vector(n,a),e=e.getAttribute("id")||e.getAttribute("name"),null!=e&&(t.fid=e),t},getStyle:function(e,t){var i=OpenLayers.Util.removeTail(e),n=OpenLayers.Util.extend({},t);return n.depth++,n.styleBaseUrl=i,!this.styles[e]&&!OpenLayers.String.startsWith(e,"#")&&n.depth<=this.maxDepth&&!this.fetched[i]&&(i=this.fetchLink(i))&&this.parseData(i,n),OpenLayers.Util.extend({},this.styles[e])},parseGeometry:{point:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),e=[];if(t.length>0)var i=t[0].firstChild.nodeValue,i=i.replace(this.regExes.removeSpace,""),e=i.split(",");if(t=null,!(e.length>1))throw"Bad coordinate string: "+i;return 2==e.length&&(e[2]=null),t=new OpenLayers.Geometry.Point(e[0],e[1],e[2])},linestring:function(e,t){var i=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),n=null;if(i.length>0){for(var r,o,i=this.getChildValue(i[0]),i=i.replace(this.regExes.trimSpace,""),i=i.replace(this.regExes.trimComma,","),n=i.split(this.regExes.splitSpace),s=n.length,a=Array(s),l=0;s>l;++l){if(r=n[l].split(","),o=r.length,!(o>1))throw"Bad LineString point coordinates: "+n[l];2==r.length&&(r[2]=null),a[l]=new OpenLayers.Geometry.Point(r[0],r[1],r[2])}if(!s)throw"Bad LineString coordinates: "+i;n=t?new OpenLayers.Geometry.LinearRing(a):new OpenLayers.Geometry.LineString(a)}return n},polygon:function(e){var e=this.getElementsByTagNameNS(e,this.internalns,"LinearRing"),t=e.length,i=Array(t);if(t>0)for(var n=0,r=e.length;r>n;++n){if(!(t=this.parseGeometry.linestring.apply(this,[e[n],!0])))throw"Bad LinearRing geometry: "+n;i[n]=t}return new OpenLayers.Geometry.Polygon(i)},multigeometry:function(e){for(var t,i=[],n=e.childNodes,r=0,o=n.length;o>r;++r)e=n[r],1==e.nodeType&&(t=this.parseGeometry[(e.prefix?e.nodeName.split(":")[1]:e.nodeName).toLowerCase()])&&i.push(t.apply(this,[e]));return new OpenLayers.Geometry.Collection(i)}},parseAttributes:function(e){var t={},i=e.getElementsByTagName("ExtendedData");i.length&&(t=this.parseExtendedData(i[0]));for(var n,r,o,e=e.childNodes,i=0,s=e.length;s>i;++i)if(n=e[i],1==n.nodeType&&(r=n.childNodes,r.length>=1&&3>=r.length)){switch(r.length){case 1:o=r[0];break;case 2:o=r[0],r=r[1],o=3==o.nodeType||4==o.nodeType?o:r;break;default:o=r[1]}(3==o.nodeType||4==o.nodeType)&&(n=n.prefix?n.nodeName.split(":")[1]:n.nodeName,(o=OpenLayers.Util.getXmlNodeValue(o))&&(o=o.replace(this.regExes.trimSpace,""),t[n]=o))}return t},parseExtendedData:function(e){var t,i,n,r,o={},s=e.getElementsByTagName("Data");for(t=0,i=s.length;i>t;t++){n=s[t],r=n.getAttribute("name");var a={},l=n.getElementsByTagName("value");l.length&&(a.value=this.getChildValue(l[0])),this.kvpAttributes?o[r]=a.value:(n=n.getElementsByTagName("displayName"),n.length&&(a.displayName=this.getChildValue(n[0])),o[r]=a)}for(e=e.getElementsByTagName("SimpleData"),t=0,i=e.length;i>t;t++)a={},n=e[t],r=n.getAttribute("name"),a.value=this.getChildValue(n),this.kvpAttributes?o[r]=a.value:(a.displayName=r,o[r]=a);return o},parseProperty:function(e,t,i){var n,e=this.getElementsByTagNameNS(e,t,i);try{n=OpenLayers.Util.getXmlNodeValue(e[0])}catch(r){n=null}return n},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS(this.kmlns,"kml"),i=this.createFolderXML(),n=0,r=e.length;r>n;++n)i.appendChild(this.createPlacemarkXML(e[n]));return t.appendChild(i),OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var t=this.createElementNS(this.kmlns,"name"),i=this.createTextNode(this.foldersName);t.appendChild(i),e.appendChild(t)}return this.foldersDesc&&(t=this.createElementNS(this.kmlns,"description"),i=this.createTextNode(this.foldersDesc),t.appendChild(i),e.appendChild(t)),e},createPlacemarkXML:function(e){var t=this.createElementNS(this.kmlns,"name");t.appendChild(this.createTextNode(e.style&&e.style.label?e.style.label:e.attributes.name||e.id));var i=this.createElementNS(this.kmlns,"description");i.appendChild(this.createTextNode(e.attributes.description||this.placemarksDesc));var n=this.createElementNS(this.kmlns,"Placemark");return null!=e.fid&&n.setAttribute("id",e.fid),n.appendChild(t),n.appendChild(i),t=this.buildGeometryNode(e.geometry),n.appendChild(t),e.attributes&&(e=this.buildExtendedData(e.attributes))&&n.appendChild(e),n},buildGeometryNode:function(e){var t=e.CLASS_NAME,t=this.buildGeometry[t.substring(t.lastIndexOf(".")+1).toLowerCase()],i=null;return t&&(i=t.apply(this,[e])),i},buildGeometry:{point:function(e){var t=this.createElementNS(this.kmlns,"Point");return t.appendChild(this.buildCoordinatesNode(e)),t},multipoint:function(e){return this.buildGeometry.collection.apply(this,[e])},linestring:function(e){var t=this.createElementNS(this.kmlns,"LineString");return t.appendChild(this.buildCoordinatesNode(e)),t},multilinestring:function(e){return this.buildGeometry.collection.apply(this,[e])},linearring:function(e){var t=this.createElementNS(this.kmlns,"LinearRing");return t.appendChild(this.buildCoordinatesNode(e)),t},polygon:function(e){for(var t,i,n=this.createElementNS(this.kmlns,"Polygon"),e=e.components,r=0,o=e.length;o>r;++r)t=0==r?"outerBoundaryIs":"innerBoundaryIs",t=this.createElementNS(this.kmlns,t),i=this.buildGeometry.linearring.apply(this,[e[r]]),t.appendChild(i),n.appendChild(t);return n},multipolygon:function(e){return this.buildGeometry.collection.apply(this,[e])},collection:function(e){for(var t,i=this.createElementNS(this.kmlns,"MultiGeometry"),n=0,r=e.components.length;r>n;++n)(t=this.buildGeometryNode.apply(this,[e.components[n]]))&&i.appendChild(t);return i}},buildCoordinatesNode:function(e){var t,i=this.createElementNS(this.kmlns,"coordinates");if(t=e.components){for(var n=t.length,r=Array(n),o=0;n>o;++o)e=t[o],r[o]=this.buildCoordinates(e);t=r.join(" ")}else t=this.buildCoordinates(e);return t=this.createTextNode(t),i.appendChild(t),i},buildCoordinates:function(e){return this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection)),e.x+","+e.y},buildExtendedData:function(e){var t,i=this.createElementNS(this.kmlns,"ExtendedData");for(t in e)if(e[t]&&"name"!=t&&"description"!=t&&"styleUrl"!=t){var n=this.createElementNS(this.kmlns,"Data");n.setAttribute("name",t);var r=this.createElementNS(this.kmlns,"value");if("object"==typeof e[t]){if(e[t].value&&r.appendChild(this.createTextNode(e[t].value)),e[t].displayName){var o=this.createElementNS(this.kmlns,"displayName");o.appendChild(this.getXMLDoc().createCDATASection(e[t].displayName)),n.appendChild(o)}}else r.appendChild(this.createTextNode(e[t]));n.appendChild(r),i.appendChild(n)}return this.isSimpleContent(i)?null:i},CLASS_NAME:"OpenLayers.Format.KML"}),OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]),e.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions))),!e.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy(),this.format=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=OpenLayers.Util.extend({},e),OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),i=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);return t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:i}),t},setFeatureType:function(e){this.featureType=e,this.format.featureType=e},setGeometryName:function(e){this.geometryName=e,this.format.geometryName=e},handleRead:function(e,t){if(t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options),t.callback){var i=e.priv;i.status>=200&&300>i.status?(i=this.parseResponse(i,t.readOptions))&&!1!==i.success?(t.readOptions&&"object"==t.readOptions.output?OpenLayers.Util.extend(e,i):e.features=i,e.code=OpenLayers.Protocol.Response.SUCCESS):(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=i):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e)}},parseResponse:function(e,t){var i=e.responseXML;if(i&&i.documentElement||(i=e.responseText),!i||0>=i.length)return null;if(i=null!==this.readFormat?this.readFormat.read(i):this.format.read(i,t),!this.featureNS){var n=this.readFormat||this.format;this.featureNS=n.featureNS,n.autoConfig=!1,this.geometryName||this.setGeometryName(n.geometryName)}return i},commit:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options);var i=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});return i.priv=OpenLayers.Request.POST({url:t.url,headers:t.headers,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,i,t)}),i},handleCommit:function(e,t){if(t.callback){var i=e.priv,n=i.responseXML;n&&n.documentElement||(n=i.responseText),i=this.format.read(n)||{},e.insertIds=i.insertIds||[],i.success?e.code=OpenLayers.Protocol.Response.SUCCESS:(e.code=OpenLayers.Protocol.Response.FAILURE,e.error=i),t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=OpenLayers.Util.extend({},t),OpenLayers.Util.applyDefaults(t,this.options),new OpenLayers.Protocol.Response({requestType:"commit"});var i=this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}}),n=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});t.featureNS&&n.setAttribute("xmlns:"+this.featurePrefix,t.featureNS);var r=this.format.writeNode("ogc:Filter",e);return n.appendChild(r),i.appendChild(n),i=OpenLayers.Format.XML.prototype.write.apply(this.format,[i]),OpenLayers.Request.POST({url:this.url,callback:t.callback||function(){},data:i})},abort:function(e){e&&e.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"}),OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,touch:!1,lastTouchPx:null,initialize:function(e,t,i){i&&i.layerOptions&&i.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{})),OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);return this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e),this.map.addLayer(this.layer),!0},createFeature:function(e){e=this.layer.getLonLatFromViewPortPx(e),e=new OpenLayers.Geometry.Point(e.lon,e.lat),this.point=new OpenLayers.Feature.Vector(e),this.callback("create",[this.point.geometry,this.point]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)?(this.cancel(),null!=this.layer.map&&(this.destroyFeature(!0),this.layer.destroy(!1)),this.layer=null,this.touch=!1,!0):!1},destroyFeature:function(e){this.layer&&(e||!this.persist)&&this.layer.destroyFeatures(),this.point=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},finalize:function(e){this.mouseDown=!1,this.lastTouchPx=this.lastUp=this.lastDown=null,this.callback(e?"cancel":"done",[this.geometryClone()]),this.destroyFeature(e)},cancel:function(){this.finalize(!0)},click:function(e){return OpenLayers.Event.stop(e),!1},dblclick:function(e){return OpenLayers.Event.stop(e),!1},modifyFeature:function(e){this.point||this.createFeature(e),e=this.layer.getLonLatFromViewPortPx(e),this.point.geometry.x=e.lon,this.point.geometry.y=e.lat,this.callback("modify",[this.point.geometry,this.point,!1]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPoint([e])),e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){return this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this})),this.lastTouchPx=e.xy,this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){return this.lastTouchPx=e.xy,this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){return e.xy=this.lastTouchPx,this.up(e)},down:function(e){return this.mouseDown=!0,this.lastDown=e.xy,this.touch||this.modifyFeature(e.xy),this.stoppedDown=this.stopDown,!this.stopDown},move:function(e){return!this.touch&&(!this.mouseDown||this.stoppedDown)&&this.modifyFeature(e.xy),!0},up:function(e){return this.mouseDown=!1,this.stoppedDown=this.stopDown,!this.checkModifiers(e)||this.lastUp&&this.lastUp.equals(e.xy)||!this.lastDown||!this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)?!0:(this.touch&&this.modifyFeature(e.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=e.xy,this.finalize(),!this.stopUp)},mouseout:function(e){OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(e,t,i){var n=!0;return null!=i&&e&&t&&e.distanceTo(t)>i&&(n=!1),n},CLASS_NAME:"OpenLayers.Handler.Point"}),OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(e){e=this.layer.getLonLatFromViewPortPx(e),e=new OpenLayers.Geometry.Point(e.lon,e.lat),this.point=new OpenLayers.Feature.Vector(e),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e),this.line=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(e){this.layer.removeFeatures([this.point]),e=this.layer.getLonLatFromViewPortPx(e),this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e.lon,e.lat)),this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length),this.layer.addFeatures([this.point]),this.callback("point",[this.point.geometry,this.getGeometry()]),this.callback("modify",[this.point.geometry,this.getSketch()]),this.drawFeature(),delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex()),this.drawFeature(),delete this.redoStack},insertDeltaXY:function(e,t){var i=this.line.geometry.components[this.getCurrentPointIndex()-1];i&&!isNaN(i.x)&&!isNaN(i.y)&&this.insertXY(i.x+e,i.y+t)},insertDirectionLength:function(e,t){var e=e*(Math.PI/180),i=t*Math.cos(e),n=t*Math.sin(e);this.insertDeltaXY(i,n)},insertDeflectionLength:function(e,t){var i=this.getCurrentPointIndex()-1;if(i>0){var n=this.line.geometry.components[i],i=this.line.geometry.components[i-1];this.insertDirectionLength(180*Math.atan2(n.y-i.y,n.x-i.x)/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,t=e.components,i=this.getCurrentPointIndex()-1,t=t[i];return(e=e.removeComponent(t))&&(this.redoStack||(this.redoStack=[]),this.redoStack.push(t),this.drawFeature()),e},redo:function(){var e=this.redoStack&&this.redoStack.pop();return e&&(this.line.geometry.addComponent(e,this.getCurrentPointIndex()),this.drawFeature()),!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){this.line||this.createFeature(e);var i=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=i.lon,this.point.geometry.y=i.lat,this.callback("modify",[this.point.geometry,this.getSketch(),t]),this.point.geometry.clearBounds(),this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiLineString([e])),e},touchstart:function(e){return this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)?(this.finishGeometry(),window.clearTimeout(this.timerId),this.timerId=null,!1):(this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300),OpenLayers.Handler.Point.prototype.touchstart.call(this,e))},down:function(e){var t=this.stopDown;return this.freehandMode(e)&&(t=!0,this.touch&&(this.modifyFeature(e.xy,!!this.lastUp),OpenLayers.Event.stop(e))),!(this.touch||this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||!this.modifyFeature(e.xy,!!this.lastUp)),this.mouseDown=!0,this.lastDown=e.xy,this.stoppedDown=t,!t},move:function(e){return this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices?(this.removePoint(),this.finalize()):this.addPoint(e.xy),!1):(!this.touch&&(!this.mouseDown||this.stoppedDown)&&this.modifyFeature(e.xy,!!this.lastUp),!0)},up:function(e){return!this.mouseDown||this.lastUp&&this.lastUp.equals(e.xy)||(this.stoppedDown&&this.freehandMode(e)?(this.persist&&this.destroyPersistedFeature(),this.removePoint(),this.finalize()):this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(e.xy),null==this.lastUp&&this.persist&&this.destroyPersistedFeature(),this.addPoint(e.xy),this.lastUp=e.xy,this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry())),this.stoppedDown=this.stopDown,this.mouseDown=!1,!this.stopUp},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-1]),this.removePoint(),this.finalize()},dblclick:function(e){return this.freehandMode(e)||this.finishGeometry(),!1},CLASS_NAME:"OpenLayers.Handler.Path"}),OpenLayers.Control.Attribution=OpenLayers.Class(OpenLayers.Control,{separator:", ",template:"${layers}",destroy:function(){this.map.events.un({removelayer:this.updateAttribution,addlayer:this.updateAttribution,changelayer:this.updateAttribution,changebaselayer:this.updateAttribution,scope:this}),OpenLayers.Control.prototype.destroy.apply(this,arguments)},draw:function(){return OpenLayers.Control.prototype.draw.apply(this,arguments),this.map.events.on({changebaselayer:this.updateAttribution,changelayer:this.updateAttribution,addlayer:this.updateAttribution,removelayer:this.updateAttribution,scope:this}),this.updateAttribution(),this.div},updateAttribution:function(){var e=[];if(this.map&&this.map.layers){for(var t=0,i=this.map.layers.length;i>t;t++){var n=this.map.layers[t];n.attribution&&n.getVisibility()&&-1===OpenLayers.Util.indexOf(e,n.attribution)&&e.push(n.attribution)}this.div.innerHTML=OpenLayers.String.format(this.template,{layers:e.join(this.separator)})}},CLASS_NAME:"OpenLayers.Control.Attribution"}),OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){OpenLayers.Animation.stop(this.timerId),this.timerId=void 0,this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()}),this.points.length>this.nbPoints&&this.points.pop()},end:function(e){for(var t,i,n=(new Date).getTime(),r=0,o=this.points.length;o>r&&(i=this.points[r],!(n-i.tick>this.delay));r++)t=i;return!t||(r=(new Date).getTime()-t.tick,n=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2)),r=n/r,0==r||this.threshold>r)?void 0:(n=Math.asin((e.y-t.xy.y)/n),t.xy.x<=e.x&&(n=Math.PI-n),{speed:r,theta:n})},move:function(e,t){var i=e.speed,n=Math.cos(e.theta),r=-Math.sin(e.theta),o=(new Date).getTime(),s=0,a=0;this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(function(){if(null!=this.timerId){var e,l,h=(new Date).getTime()-o,c=-this.deceleration*Math.pow(h,2)/2+i*h,u=c*n,c=c*r;e=!1,0>=-this.deceleration*h+i&&(OpenLayers.Animation.stop(this.timerId),this.timerId=null,e=!0),h=u-s,l=c-a,s=u,a=c,t(h,l,e)}},this))},CLASS_NAME:"OpenLayers.Kinetic"}),OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(e,t,i,n){var r=[],i=OpenLayers.Util.upperCaseObject(i);parseFloat(i.VERSION)>=1.3&&!i.EXCEPTIONS&&(i.EXCEPTIONS="INIMAGE"),r.push(e,t,i,n),OpenLayers.Layer.Grid.prototype.initialize.apply(this,r),OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS)),!this.noMagic&&this.params.TRANSPARENT&&"true"==(""+this.params.TRANSPARENT).toLowerCase()&&(null!=n&&n.isBaseLayer||(this.isBaseLayer=!1),"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png"))},clone:function(e){return null==e&&(e=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e])},reverseAxisOrder:function(){var e=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!(!this.yx[e]&&!OpenLayers.Projection.defaults[e].yx)},getURL:function(e){var e=this.adjustBounds(e),t=this.getImageSize(),i={},n=this.reverseAxisOrder();return i.BBOX=this.encodeBBOX?e.toBBOX(null,n):e.toArray(n),i.WIDTH=t.w,i.HEIGHT=t.h,this.getFullRequestString(i)},mergeNewParams:function(e){return e=[OpenLayers.Util.upperCaseObject(e)],OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,e)},getFullRequestString:function(e){var t=this.map.getProjectionObject(),t=this.projection&&this.projection.equals(t)?this.projection.getCode():t.getCode(),t="none"==t?null:t;return parseFloat(this.params.VERSION)>=1.3?this.params.CRS=t:this.params.SRS=t,"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE"),OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"}),OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(){this.supported()&&(OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments),this.translationParameters={x:0,y:0},this.symbolMetrics={})},supported:function(){return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#SVG","1.1")||document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"))},inValidRange:function(e,t,i){return e+=i?0:this.translationParameters.x,t+=i?0:this.translationParameters.y,e>=-this.MAX_PIXEL&&this.MAX_PIXEL>=e&&t>=-this.MAX_PIXEL&&this.MAX_PIXEL>=t},setExtent:function(e,t){var i=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),n=this.getResolution(),r=-e.left/n,n=e.top/n;return t?(this.left=r,this.top=n,this.rendererRoot.setAttributeNS(null,"viewBox","0 0 "+this.size.w+" "+this.size.h),this.translate(this.xOffset,0),!0):((r=this.translate(r-this.left+this.xOffset,n-this.top))||this.setExtent(e,!0),i&&r)},translate:function(e,t){if(this.inValidRange(e,t,!0)){var i="";return(e||t)&&(i="translate("+e+","+t+")"),this.root.setAttributeNS(null,"transform",i),this.translationParameters={x:e,y:t},!0}return!1},setSize:function(){OpenLayers.Renderer.prototype.setSize.apply(this,arguments),this.rendererRoot.setAttributeNS(null,"width",this.size.w),this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var i=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":i=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":i="rect";break;
case"OpenLayers.Geometry.LineString":i="polyline";break;case"OpenLayers.Geometry.LinearRing":i="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":i="path"}return i},setStyle:function(e,t,i){var n,t=t||e._style,i=i||e._options,r=parseFloat(e.getAttributeNS(null,"r")),o=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&r){if(e.style.visibility="",!1===t.graphic)e.style.visibility="hidden";else if(t.externalGraphic){n=this.getPosition(e),t.graphicTitle&&(e.setAttributeNS(null,"title",t.graphicTitle),r=e.getElementsByTagName("title"),r.length>0?r[0].firstChild.textContent=t.graphicTitle:(r=this.nodeFactory(null,"title"),r.textContent=t.graphicTitle,e.appendChild(r))),t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var r=t.graphicWidth||t.graphicHeight,s=t.graphicHeight||t.graphicWidth,r=r?r:2*t.pointRadius,s=s?s:2*t.pointRadius,a=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*s),l=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(n.x+(void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*r))).toFixed()),e.setAttributeNS(null,"y",(n.y+a).toFixed()),e.setAttributeNS(null,"width",r),e.setAttributeNS(null,"height",s),e.setAttributeNS(this.xlinkns,"href",t.externalGraphic),e.setAttributeNS(null,"style","opacity: "+l),e.onclick=OpenLayers.Renderer.SVG.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var r=3*t.pointRadius,s=2*r,h=this.importSymbol(t.graphicName);n=this.getPosition(e),o=3*this.symbolMetrics[h.id][0]/s,a=e.parentNode,l=e.nextSibling,a&&a.removeChild(e),e.firstChild&&e.removeChild(e.firstChild),e.appendChild(h.firstChild.cloneNode(!0)),e.setAttributeNS(null,"viewBox",h.getAttributeNS(null,"viewBox")),e.setAttributeNS(null,"width",s),e.setAttributeNS(null,"height",s),e.setAttributeNS(null,"x",n.x-r),e.setAttributeNS(null,"y",n.y-r),l?a.insertBefore(e,l):a&&a.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);r=t.rotation,void 0===r&&void 0===e._rotation||!n||(e._rotation=r,r|=0,"svg"!==e.nodeName?e.setAttributeNS(null,"transform","rotate("+r+" "+n.x+" "+n.y+")"):(n=this.symbolMetrics[h.id],e.firstChild.setAttributeNS(null,"transform","rotate("+r+" "+n[1]+" "+n[2]+")")))}return i.isFilled?(e.setAttributeNS(null,"fill",t.fillColor),e.setAttributeNS(null,"fill-opacity",t.fillOpacity)):e.setAttributeNS(null,"fill","none"),i.isStroked?(e.setAttributeNS(null,"stroke",t.strokeColor),e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity),e.setAttributeNS(null,"stroke-width",t.strokeWidth*o),e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round"),e.setAttributeNS(null,"stroke-linejoin","round"),t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,o))):e.setAttributeNS(null,"stroke","none"),t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents),null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor),e},dashStyle:function(e,t){var i=e.strokeWidth*t,n=e.strokeDashstyle;switch(n){case"solid":return"none";case"dot":return[1,4*i].join();case"dash":return[4*i,4*i].join();case"dashdot":return[4*i,4*i,1,4*i].join();case"longdash":return[8*i,4*i].join();case"longdashdot":return[8*i,4*i,1,4*i].join();default:return OpenLayers.String.trim(n).replace(/\s+/g,",")}},createNode:function(e,t){var i=document.createElementNS(this.xmlns,e);return t&&i.setAttributeNS(null,"id",t),i},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){var e=this.nodeFactory(this.container.id+"_svgRoot","svg");return e.style.display="block",e},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");return this.rendererRoot.appendChild(e),e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,i){var n=this.getResolution(),r=(t.x-this.featureDx)/n+this.left,t=this.top-t.y/n;return this.inValidRange(r,t)?(e.setAttributeNS(null,"cx",r),e.setAttributeNS(null,"cy",t),e.setAttributeNS(null,"r",i),e):!1},drawLineString:function(e,t){var i=this.getComponentsString(t.components);return i.path?(e.setAttributeNS(null,"points",i.path),i.complete?e:null):!1},drawLinearRing:function(e,t){var i=this.getComponentsString(t.components);return i.path?(e.setAttributeNS(null,"points",i.path),i.complete?e:null):!1},drawPolygon:function(e,t){for(var i,n,r="",o=!0,s=!0,a=0,l=t.components.length;l>a;a++)r+=" M",i=this.getComponentsString(t.components[a].components," "),(n=i.path)?(r+=" "+n,s=i.complete&&s):o=!1;return o?(e.setAttributeNS(null,"d",r+" z"),e.setAttributeNS(null,"fill-rule","evenodd"),s?e:null):!1},drawRectangle:function(e,t){var i=this.getResolution(),n=(t.x-this.featureDx)/i+this.left,r=this.top-t.y/i;return this.inValidRange(n,r)?(e.setAttributeNS(null,"x",n),e.setAttributeNS(null,"y",r),e.setAttributeNS(null,"width",t.width/i),e.setAttributeNS(null,"height",t.height/i),e):!1},drawText:function(e,t,i){var n=!!t.labelOutlineWidth;if(n){var r=OpenLayers.Util.extend({},t);r.fontColor=r.labelOutlineColor,r.fontStrokeColor=r.labelOutlineColor,r.fontStrokeWidth=t.labelOutlineWidth,delete r.labelOutlineWidth,this.drawText(e,r,i)}var o=this.getResolution(),r=(i.x-this.featureDx)/o+this.left,s=i.y/o-this.top,n=n?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,o=this.nodeFactory(e+n,"text");o.setAttributeNS(null,"x",r),o.setAttributeNS(null,"y",-s),t.fontColor&&o.setAttributeNS(null,"fill",t.fontColor),t.fontStrokeColor&&o.setAttributeNS(null,"stroke",t.fontStrokeColor),t.fontStrokeWidth&&o.setAttributeNS(null,"stroke-width",t.fontStrokeWidth),t.fontOpacity&&o.setAttributeNS(null,"opacity",t.fontOpacity),t.fontFamily&&o.setAttributeNS(null,"font-family",t.fontFamily),t.fontSize&&o.setAttributeNS(null,"font-size",t.fontSize),t.fontWeight&&o.setAttributeNS(null,"font-weight",t.fontWeight),t.fontStyle&&o.setAttributeNS(null,"font-style",t.fontStyle),!0===t.labelSelect?(o.setAttributeNS(null,"pointer-events","visible"),o._featureId=e):o.setAttributeNS(null,"pointer-events","none"),s=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign,o.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[s[0]]||"middle"),!0===OpenLayers.IS_GECKO&&o.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[s[1]]||"central");for(var a=t.label.split("\n"),l=a.length;o.childNodes.length>l;)o.removeChild(o.lastChild);for(var h=0;l>h;h++){var c=this.nodeFactory(e+n+"_tspan_"+h,"tspan");if(!0===t.labelSelect&&(c._featureId=e,c._geometry=i,c._geometryClass=i.CLASS_NAME),!1===OpenLayers.IS_GECKO&&c.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[s[1]]||"-35%"),c.setAttribute("x",r),0==h){var u=OpenLayers.Renderer.SVG.LABEL_VFACTOR[s[1]];null==u&&(u=-.5),c.setAttribute("dy",u*(l-1)+"em")}else c.setAttribute("dy","1em");c.textContent=""===a[h]?" ":a[h],c.parentNode||o.appendChild(c)}o.parentNode||this.textRoot.appendChild(o)},getComponentsString:function(e,t){for(var i,n=[],r=!0,o=e.length,s=[],a=0;o>a;a++)i=e[a],n.push(i),(i=this.getShortString(i))?s.push(i):(a>0&&this.getShortString(e[a-1])&&s.push(this.clipLine(e[a],e[a-1])),o-1>a&&this.getShortString(e[a+1])&&s.push(this.clipLine(e[a],e[a+1])),r=!1);return{path:s.join(t||","),complete:r}},clipLine:function(e,t){if(t.equals(e))return"";var i,n=this.getResolution(),r=this.MAX_PIXEL-this.translationParameters.x,o=this.MAX_PIXEL-this.translationParameters.y,s=(t.x-this.featureDx)/n+this.left,a=this.top-t.y/n,l=(e.x-this.featureDx)/n+this.left,n=this.top-e.y/n;return(-r>l||l>r)&&(i=(n-a)/(l-s),l=0>l?-r:r,n=a+(l-s)*i),(-o>n||n>o)&&(i=(l-s)/(n-a),n=0>n?-o:o,l=s+(n-a)*i),l+","+n},getShortString:function(e){var t=this.getResolution(),i=(e.x-this.featureDx)/t+this.left,e=this.top-e.y/t;return this.inValidRange(i,e)?i+","+e:!1},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,i=document.getElementById(t);if(null!=i)return i;var n=OpenLayers.Renderer.symbol[e];if(!n)throw Error(e+" is not a valid symbol name");var e=this.nodeFactory(t,"symbol"),r=this.nodeFactory(null,"polygon");e.appendChild(r);for(var o,s,i=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),a=[],l=0;n.length>l;l+=2)o=n[l],s=n[l+1],i.left=Math.min(i.left,o),i.bottom=Math.min(i.bottom,s),i.right=Math.max(i.right,o),i.top=Math.max(i.top,s),a.push(o,",",s);return r.setAttributeNS(null,"points",a.join(" ")),n=i.getWidth(),r=i.getHeight(),e.setAttributeNS(null,"viewBox",[i.left-n,i.bottom-r,3*n,3*r].join(" ")),this.symbolMetrics[t]=[Math.max(n,r),i.getCenterLonLat().lon,i.getCenterLonLat().lat],this.defs.appendChild(e),e},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);return t||(t=e.target,t=t.parentNode&&t!=this.rendererRoot?t.parentNode._featureId:void 0),t},CLASS_NAME:"OpenLayers.Renderer.SVG"}),OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"},OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"},OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1},OpenLayers.Renderer.SVG.preventDefault=function(e){e.preventDefault&&e.preventDefault()},OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(a,b){var c;if(this.nativeJSON)c=JSON.parse(a,b);else try{if(/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))&&(c=eval("("+a+")"),"function"==typeof b)){var d=function(e,t){if(t&&"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(t[i]=d(i,t[i]));return b(e,t)};c=d("",c)}}catch(e){}return this.keepData&&(this.data=c),c},write:function(e,t){this.pretty=!!t;var i=null,n=typeof e;if(this.serialize[n])try{i=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[n].apply(this,[e])}catch(r){OpenLayers.Console.error("Trouble serializing: "+r)}return i},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;this.level>t;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t=["{"];this.level+=1;var i,n,r,o=!1;for(i in e)e.hasOwnProperty(i)&&(n=OpenLayers.Format.JSON.prototype.write.apply(this,[i,this.pretty]),r=OpenLayers.Format.JSON.prototype.write.apply(this,[e[i],this.pretty]),null!=n&&null!=r&&(o&&t.push(","),t.push(this.writeNewline(),this.writeIndent(),n,":",this.writeSpace(),r),o=!0));return this.level-=1,t.push(this.writeNewline(),this.writeIndent(),"}"),t.join("")},array:function(e){var t,i=["["];this.level+=1;for(var n=0,r=e.length;r>n;++n)t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[n],this.pretty]),null!=t&&(n>0&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),t));return this.level-=1,i.push(this.writeNewline(),this.writeIndent(),"]"),i.join("")},string:function(e){var t={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,i){var n=t[i];return n?n:(n=i.charCodeAt(),"\\u00"+Math.floor(n/16).toString(16)+(n%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?""+e:"null"},"boolean":function(e){return""+e},date:function(e){function t(e){return 10>e?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"}),OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,i){var t=t?t:"FeatureCollection",n=null,r=null;if(r="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,i]):e){if("string"!=typeof r.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(r,t))switch(t){case"Geometry":try{n=this.parseGeometry(r)}catch(o){OpenLayers.Console.error(o)}break;case"Feature":try{n=this.parseFeature(r),n.type="Feature"}catch(s){OpenLayers.Console.error(s)}break;case"FeatureCollection":switch(n=[],r.type){case"Feature":try{n.push(this.parseFeature(r))}catch(a){n=null,OpenLayers.Console.error(a)}break;case"FeatureCollection":for(e=0,t=r.features.length;t>e;++e)try{n.push(this.parseFeature(r.features[e]))}catch(l){n=null,OpenLayers.Console.error(l)}break;default:try{var h=this.parseGeometry(r);n.push(new OpenLayers.Feature.Vector(h))}catch(c){n=null,OpenLayers.Console.error(c)}}}}else OpenLayers.Console.error("Bad JSON: "+e);return n},isValidType:function(e,t){var i=!1;switch(t){case"Geometry":-1==OpenLayers.Util.indexOf("Point MultiPoint LineString MultiLineString Polygon MultiPolygon Box GeometryCollection".split(" "),e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):i=!0;break;case"FeatureCollection":i=!0;break;default:e.type==t?i=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}return i},parseFeature:function(e){var t,i,n;i=e.properties?e.properties:{},n=e.geometry&&e.geometry.bbox||e.bbox;try{t=this.parseGeometry(e.geometry)}catch(r){throw r}return t=new OpenLayers.Feature.Vector(t,i),n&&(t.bounds=OpenLayers.Bounds.fromArray(n)),e.id&&(t.fid=e.id),t},parseGeometry:function(e){if(null==e)return null;var t,i=!1;if("GeometryCollection"==e.type){if(!OpenLayers.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;t=e.geometries.length;for(var i=Array(t),n=0;t>n;++n)i[n]=this.parseGeometry.apply(this,[e.geometries[n]]);t=new OpenLayers.Geometry.Collection(i),i=!0}else{if(!OpenLayers.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(r){throw r}}return this.internalProjection&&this.externalProjection&&!i&&t.transform(this.externalProjection,this.internalProjection),t},parseCoords:{point:function(e){if(!1==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],i=null,n=0,r=e.length;r>n;++n){try{i=this.parseCoords.point.apply(this,[e[n]])}catch(o){throw o}t.push(i)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],i=null,n=0,r=e.length;r>n;++n){try{i=this.parseCoords.point.apply(this,[e[n]])}catch(o){throw o}t.push(i)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],i=null,n=0,r=e.length;r>n;++n){try{i=this.parseCoords.linestring.apply(this,[e[n]])}catch(o){throw o}t.push(i)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){for(var t,i,n=[],r=0,o=e.length;o>r;++r){try{i=this.parseCoords.linestring.apply(this,[e[r]])}catch(s){throw s}t=new OpenLayers.Geometry.LinearRing(i.components),n.push(t)}return new OpenLayers.Geometry.Polygon(n)},multipolygon:function(e){for(var t=[],i=null,n=0,r=e.length;r>n;++n){try{i=this.parseCoords.polygon.apply(this,[e[n]])}catch(o){throw o}t.push(i)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var i={type:null};if(OpenLayers.Util.isArray(e)){i.type="FeatureCollection";var n=e.length;i.features=Array(n);for(var r=0;n>r;++r){var o=e[r];if(!o instanceof OpenLayers.Feature.Vector)throw"FeatureCollection only supports collections of features: "+o;i.features[r]=this.extract.feature.apply(this,[o])}}else 0==e.CLASS_NAME.indexOf("OpenLayers.Geometry")?i=this.extract.geometry.apply(this,[e]):e instanceof OpenLayers.Feature.Vector&&(i=this.extract.feature.apply(this,[e]),e.layer&&e.layer.projection&&(i.crs=this.createCRSObject(e)));return OpenLayers.Format.JSON.prototype.write.apply(this,[i,t])},createCRSObject:function(e){var e=""+e.layer.projection,t={};return e.match(/epsg:/i)&&(e=parseInt(e.substring(e.indexOf(":")+1)),t=4326==e?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+e}}),t},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),t={type:"Feature",properties:e.attributes,geometry:t};return null!=e.fid&&(t.id=e.fid),t},geometry:function(e){if(null==e)return null;this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t=e.CLASS_NAME.split(".")[2],e=this.extract[t.toLowerCase()].apply(this,[e]);return"Collection"==t?{type:"GeometryCollection",geometries:e}:{type:t,coordinates:e}},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},linestring:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.point.apply(this,[e.components[i]]));return t},multilinestring:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},polygon:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.linestring.apply(this,[e.components[i]]));return t},multipolygon:function(e){for(var t=[],i=0,n=e.components.length;n>i;++i)t.push(this.extract.polygon.apply(this,[e.components[i]]));return t},collection:function(e){for(var t=e.components.length,i=Array(t),n=0;t>n;++n)i[n]=this.extract.geometry.apply(this,[e.components[n]]);return i}},CLASS_NAME:"OpenLayers.Format.GeoJSON"}),OpenLayers.Control.DrawFeature=OpenLayers.Class(OpenLayers.Control,{layer:null,callbacks:null,multi:!1,featureAdded:function(){},handlerOptions:null,initialize:function(e,t,i){OpenLayers.Control.prototype.initialize.apply(this,[i]),this.callbacks=OpenLayers.Util.extend({done:this.drawFeature,modify:function(e,t){this.layer.events.triggerEvent("sketchmodified",{vertex:e,feature:t})},create:function(e,t){this.layer.events.triggerEvent("sketchstarted",{vertex:e,feature:t})}},this.callbacks),this.layer=e,this.handlerOptions=this.handlerOptions||{},this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{renderers:e.renderers,rendererOptions:e.rendererOptions}),"multi"in this.handlerOptions||(this.handlerOptions.multi=this.multi),(e=this.layer.styleMap&&this.layer.styleMap.styles.temporary)&&(this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new OpenLayers.StyleMap({"default":e})})),this.handler=new t(this,this.callbacks,this.handlerOptions)},drawFeature:function(e){e=new OpenLayers.Feature.Vector(e),!1!==this.layer.events.triggerEvent("sketchcomplete",{feature:e})&&(e.state=OpenLayers.State.INSERT,this.layer.addFeatures([e]),this.featureAdded(e),this.events.triggerEvent("featureadded",{feature:e}))},insertXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertXY(e,t)},insertDeltaXY:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeltaXY(e,t)},insertDirectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDirectionLength(e,t)},insertDeflectionLength:function(e,t){this.handler&&this.handler.line&&this.handler.insertDeflectionLength(e,t)},undo:function(){return this.handler.undo&&this.handler.undo()},redo:function(){return this.handler.redo&&this.handler.redo()},finishSketch:function(){this.handler.finishGeometry()},cancel:function(){this.handler.cancel()},CLASS_NAME:"OpenLayers.Control.DrawFeature"}),OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(e){var t=!0;return this.pinching=!1,OpenLayers.Event.isMultiTouch(e)?(this.started=!0,this.last=this.start={distance:this.getDistance(e.touches),delta:0,scale:1},this.callback("start",[e,this.start]),t=!this.stopDown):(this.started=!1,this.last=this.start=null),OpenLayers.Event.stop(e),t},touchmove:function(e){if(this.started&&OpenLayers.Event.isMultiTouch(e)){this.pinching=!0;var t=this.getPinchData(e);this.callback("move",[e,t]),this.last=t,OpenLayers.Event.stop(e)}return!0},touchend:function(e){return this.started&&(this.pinching=this.started=!1,this.callback("done",[e,this.start,this.last]),this.last=this.start=null),!0},activate:function(){var e=!1;return OpenLayers.Handler.prototype.activate.apply(this,arguments)&&(this.pinching=!1,e=!0),e},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.pinching=this.started=!1,this.last=this.start=null,e=!0),e},getDistance:function(e){var t=e[0],e=e[1];return Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))},getPinchData:function(e){return e=this.getDistance(e.touches),{distance:e,delta:this.last.distance-e,scale:e/this.start.distance}},CLASS_NAME:"OpenLayers.Handler.Pinch"}),OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(e){e=this.layer.getLonLatFromViewPortPx(e),e=new OpenLayers.Geometry.Point(e.lon,e.lat),this.point=new OpenLayers.Feature.Vector(e),this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry])),this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry])),this.callback("create",[this.point.geometry,this.getSketch()]),this.point.geometry.clearBounds(),this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var e,t=this.point.geometry,i=this.control.layer.features,n=i.length-1;n>=0;--n)if(e=i[n].geometry,(e instanceof OpenLayers.Geometry.Polygon||e instanceof OpenLayers.Geometry.MultiPolygon)&&e.intersects(t)){t=i[n],this.control.layer.removeFeatures([t],{silent:!0}),this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology),t.geometry.addComponent(this.line.geometry),this.polygon=t,this.drawingHole=!0;break}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){var e=e.vertex,t=this.line.geometry.components;this.polygon.geometry.intersects(e)||(t=t[t.length-3],e.x=t.x,e.y=t.y)},finishGeometry:function(){this.line.geometry.removeComponent(this.line.geometry.components[this.line.geometry.components.length-2]),this.removePoint(),this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry,t=0!==e.getArea();if(t){for(var i=this.polygon.geometry.components,n=i.length-2;n>=0;--n)if(e.intersects(i[n])){t=!1;break}if(t){n=i.length-2;e:for(;n>0;--n)for(var r=i[n].components,o=0,s=r.length;s>o;++o)if(e.containsPoint(r[o])){t=!1;break e}}}return t?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(e),this.restoreFeature(),!1},cancel:function(){return this.drawingHole&&(this.polygon.geometry.removeComponent(this.line.geometry),this.restoreFeature(!0)),OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing),this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology),this.layer.removeFeatures([this.polygon],{silent:!0}),this.control.layer.addFeatures([this.polygon],{silent:!0}),this.drawingHole=!1,e||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e),this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style),this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;return e&&this.multi&&(e=new OpenLayers.Geometry.MultiPolygon([e])),e},CLASS_NAME:"OpenLayers.Handler.Polygon"}),OpenLayers.Control.Geolocate=OpenLayers.Class(OpenLayers.Control,{geolocation:navigator.geolocation,bind:!0,watch:!1,geolocationOptions:null,destroy:function(){this.deactivate(),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return this.geolocation?OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.watch?this.watchId=this.geolocation.watchPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions):this.getCurrentLocation(),!0):!1:(this.events.triggerEvent("locationuncapable"),!1)},deactivate:function(){return this.active&&null!==this.watchId&&this.geolocation.clearWatch(this.watchId),OpenLayers.Control.prototype.deactivate.apply(this,arguments)},geolocate:function(e){var t=new OpenLayers.LonLat(e.coords.longitude,e.coords.latitude).transform(new OpenLayers.Projection("EPSG:4326"),this.map.getProjectionObject());this.bind&&this.map.setCenter(t),this.events.triggerEvent("locationupdated",{position:e,point:new OpenLayers.Geometry.Point(t.lon,t.lat)})},getCurrentLocation:function(){return!this.active||this.watch?!1:(this.geolocation.getCurrentPosition(OpenLayers.Function.bind(this.geolocate,this),OpenLayers.Function.bind(this.failure,this),this.geolocationOptions),!0)},failure:function(e){this.events.triggerEvent("locationfailed",{error:e})},CLASS_NAME:"OpenLayers.Control.Geolocate"}),OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){if(e=e||{},this.params={},this.headers={},OpenLayers.Protocol.prototype.initialize.apply(this,arguments),!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,i){return t.write(e,i)}}},destroy:function(){this.headers=this.params=null,OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments),e=e||{},e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params),e=OpenLayers.Util.applyDefaults(e,this.options),e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,i=new OpenLayers.Protocol.Response({requestType:"read"});return t?(t=e.headers||{},t["Content-Type"]="application/x-www-form-urlencoded",i.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,i,e),data:OpenLayers.Util.getParameterString(e.params),headers:t})):i.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,i,e),params:e.params,headers:e.headers}),i},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){var t=OpenLayers.Util.applyDefaults(t,this.options),i=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});return i.priv=OpenLayers.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,i,t),headers:t.headers,data:this.format.write(e)}),i},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){var t=t||{},i=t.url||e.url||this.options.url+"/"+e.fid,t=OpenLayers.Util.applyDefaults(t,this.options),n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"});return n.priv=OpenLayers.Request[this.updateWithPOST?"POST":"PUT"]({url:i,callback:this.createCallback(this.handleUpdate,n,t),headers:t.headers,data:this.format.write(e)}),n},handleUpdate:function(e,t){this.handleResponse(e,t)},"delete":function(e,t){var t=t||{},i=t.url||e.url||this.options.url+"/"+e.fid,t=OpenLayers.Util.applyDefaults(t,this.options),n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"delete"}),r=this.deleteWithPOST?"POST":"DELETE",i={url:i,callback:this.createCallback(this.handleDelete,n,t),headers:t.headers};return this.deleteWithPOST&&(i.data=this.format.write(e)),n.priv=OpenLayers.Request[r](i),n},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var i=e.priv;t.callback&&(i.status>=200&&300>i.status?("delete"!=e.requestType&&(e.features=this.parseFeatures(i)),e.code=OpenLayers.Protocol.Response.SUCCESS):e.code=OpenLayers.Protocol.Response.FAILURE,t.callback.call(t.scope,e))},parseFeatures:function(e){var t=e.responseXML;return t&&t.documentElement||(t=e.responseText),!t||0>=t.length?null:this.format.read(t)},commit:function(e,t){function i(e){for(var t=e.features?e.features.length:0,i=Array(t),r=0;t>r;++r)i[r]=e.features[r].fid;f.insertIds=i,n.apply(this,[e])}function n(e){this.callUserCallback(e,t),p=p&&e.success(),o++,o>=d&&t.callback&&(f.code=p?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE,t.callback.apply(t.scope,[f]))}var t=OpenLayers.Util.applyDefaults(t,this.options),r=[],o=0,s={};s[OpenLayers.State.INSERT]=[],s[OpenLayers.State.UPDATE]=[],s[OpenLayers.State.DELETE]=[];for(var a,l,h=[],c=0,u=e.length;u>c;++c)a=e[c],(l=s[a.state])&&(l.push(a),h.push(a));var d=(s[OpenLayers.State.INSERT].length>0?1:0)+s[OpenLayers.State.UPDATE].length+s[OpenLayers.State.DELETE].length,p=!0,f=new OpenLayers.Protocol.Response({reqFeatures:h});for(a=s[OpenLayers.State.INSERT],a.length>0&&r.push(this.create(a,OpenLayers.Util.applyDefaults({callback:i,scope:this},t.create))),a=s[OpenLayers.State.UPDATE],c=a.length-1;c>=0;--c)r.push(this.update(a[c],OpenLayers.Util.applyDefaults({callback:n,scope:this},t.update)));for(a=s[OpenLayers.State.DELETE],c=a.length-1;c>=0;--c)r.push(this["delete"](a[c],OpenLayers.Util.applyDefaults({callback:n,scope:this},t["delete"])));return r},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var i=t[e.requestType];i&&i.callback&&i.callback.call(i.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"}),OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:1,documentDrag:!1,kinetic:null,enableKinetic:!1,kineticInterval:10,draw:function(){if(this.enableKinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic)),this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(e){this.kinetic&&this.kinetic.update(e),this.panned=!0,this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;if(this.kinetic&&(t=this.kinetic.end(e)),this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:!1}),t){var i=this;this.kinetic.move(t,function(e,t,n){i.map.pan(e,t,{dragging:!n,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"}),OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,containerCenter:null,pinchOrigin:null,currentCenter:null,autoActivate:!0,initialize:function(){OpenLayers.Control.prototype.initialize.apply(this,arguments),this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)
},activate:function(){var e=OpenLayers.Control.prototype.activate.apply(this,arguments);return e&&(this.map.events.on({moveend:this.updateContainerCenter,scope:this}),this.updateContainerCenter()),e},deactivate:function(){var e=OpenLayers.Control.prototype.deactivate.apply(this,arguments);return this.map&&this.map.events&&this.map.events.un({moveend:this.updateContainerCenter,scope:this}),e},updateContainerCenter:function(){var e=this.map.layerContainerDiv;this.containerCenter={x:parseInt(e.style.left,10)+50,y:parseInt(e.style.top,10)+50}},pinchStart:function(e){this.currentCenter=this.pinchOrigin=e.xy},pinchMove:function(e,t){var i=t.scale,n=this.containerCenter,r=this.pinchOrigin,o=e.xy,s=Math.round(o.x-r.x+(i-1)*(n.x-r.x)),n=Math.round(o.y-r.y+(i-1)*(n.y-r.y));this.applyTransform("translate("+s+"px, "+n+"px) scale("+i+")"),this.currentCenter=o},applyTransform:function(e){var t=this.map.layerContainerDiv.style;t["-webkit-transform"]=e,t["-moz-transform"]=e},pinchDone:function(e,t,i){if(this.applyTransform(""),e=this.map.getZoomForResolution(this.map.getResolution()/i.scale,!0),e!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var t=this.map.getResolutionForZoom(e),i=this.map.getLonLatFromPixel(this.pinchOrigin),n=this.currentCenter,r=this.map.getSize();i.lon+=t*(r.w/2-n.x),i.lat-=t*(r.h/2-n.y),this.map.div.clientWidth=this.map.div.clientWidth,this.map.setCenter(i,e)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"}),OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,touch:!1,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(e){return this.touch||(this.unregisterMouseListeners(),this.touch=!0),this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},touchmove:function(e){return this.last=this.getEventInfo(e),!0},touchend:function(e){return this.down&&(e.xy=this.last.xy,e.lastTouches=this.last.touches,this.handleSingle(e),this.down=null),!0},unregisterMouseListeners:function(){this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,click:this.click,dblclick:this.dblclick,scope:this})},mousedown:function(e){return this.down=this.getEventInfo(e),this.last=this.getEventInfo(e),!0},mouseup:function(e){var t=!0;return this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)&&(t=this.rightclick(e)),t},rightclick:function(e){if(this.passesTolerance(e)){if(null!=this.rightclickTimerId)return this.clearTimer(),this.callback("dblrightclick",[e]),!this.stopDouble;e=this["double"]?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]),e=OpenLayers.Function.bind(this.delayedRightCall,this,e),this.rightclickTimerId=window.setTimeout(e,this.delay)}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null,e&&this.callback("rightclick",[e])},click:function(e){return this.last||(this.last=this.getEventInfo(e)),this.handleSingle(e),!this.stopSingle},dblclick:function(e){return this.handleDouble(e),!this.stopDouble},handleDouble:function(e){this.passesDblclickTolerance(e)&&(this["double"]&&this.callback("dblclick",[e]),this.clearTimer())},handleSingle:function(e){this.passesTolerance(e)&&(null!=this.timerId?(this.last.touches&&1===this.last.touches.length&&(this["double"]&&OpenLayers.Event.stop(e),this.handleDouble(e)),(!this.last.touches||2!==this.last.touches.length)&&this.clearTimer()):(this.first=this.getEventInfo(e),this.queuePotentialClick(this.single?OpenLayers.Util.extend({},e):null)))},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy&&(t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy))&&this.touch&&this.down.touches.length===this.last.touches.length)for(var e=0,i=this.down.touches.length;i>e;++e)if(this.getTouchDistance(this.down.touches[e],this.last.touches[e])>this.pixelTolerance){t=!1;break}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(){var e=!0;return this.down&&this.first&&(e=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance),e},clearTimer:function(){null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=null),null!=this.rightclickTimerId&&(window.clearTimeout(this.rightclickTimerId),this.rightclickTimerId=null)},delayedCall:function(e){this.timerId=null,e&&this.callback("click",[e])},getEventInfo:function(e){var t;if(e.touches){var i=e.touches.length;t=Array(i);for(var n,r=0;i>r;r++)n=e.touches[r],t[r]={clientX:n.clientX,clientY:n.clientY}}return{xy:e.xy,touches:t}},deactivate:function(){var e=!1;return OpenLayers.Handler.prototype.deactivate.apply(this,arguments)&&(this.clearTimer(),this.last=this.first=this.down=null,this.touch=!1,e=!0),e},CLASS_NAME:"OpenLayers.Handler.Click"}),OpenLayers.Control.TouchNavigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,clickHandlerOptions:null,documentDrag:!1,autoActivate:!0,initialize:function(){this.handlers={},OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate(),this.dragPan&&this.dragPan.destroy(),this.dragPan=null,this.pinchZoom&&(this.pinchZoom.destroy(),delete this.pinchZoom),OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){return OpenLayers.Control.prototype.activate.apply(this,arguments)?(this.dragPan.activate(),this.handlers.click.activate(),this.pinchZoom.activate(),!0):!1},deactivate:function(){return OpenLayers.Control.prototype.deactivate.apply(this,arguments)?(this.dragPan.deactivate(),this.handlers.click.deactivate(),this.pinchZoom.deactivate(),!0):!1},draw:function(){var e={click:this.defaultClick,dblclick:this.defaultDblClick},t=OpenLayers.Util.extend({"double":!0,stopDouble:!0,pixelTolerance:2},this.clickHandlerOptions);this.handlers.click=new OpenLayers.Handler.Click(this,e,t),this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions)),this.dragPan.draw(),this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){this.map.setCenter(this.map.getLonLatFromViewPortPx(e.xy),this.map.zoom+1)},CLASS_NAME:"OpenLayers.Control.TouchNavigation"}),OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});