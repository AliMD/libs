OpenLayers.Tile.Image.IFrame={useIFrame:null,draw:function(){var e=OpenLayers.Tile.Image.prototype.shouldDraw.call(this);if(e){var t=this.layer.getURL(this.bounds),i=this.useIFrame;this.useIFrame=null!==this.maxGetUrlLength&&!this.layer.async&&t.length>this.maxGetUrlLength;var n=i&&!this.useIFrame,r=!i&&this.useIFrame;(n||r)&&(this.imgDiv&&this.imgDiv.parentNode===this.frame&&this.frame.removeChild(this.imgDiv),this.imgDiv=null,n?(this.blankImageUrl=this._blankImageUrl,this.frame.removeChild(this.frame.firstChild)):(this._blankImageUrl=this.blankImageUrl,this.blankImageUrl="about:blank"))}return OpenLayers.Tile.Image.prototype.draw.apply(this,arguments)},getImage:function(){if(this.useIFrame===!0){if(!this.frame.childNodes.length){var e=document.createElement("div"),t=e.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex=1,t.backgroundImage="url("+this._blankImageUrl+")",this.frame.appendChild(e)}var i,n=this.id+"_iFrame";return 9>parseFloat(navigator.appVersion.split("MSIE")[1])?(i=document.createElement('<iframe name="'+n+'">'),i.style.backgroundColor="#FFFFFF",i.style.filter="chroma(color=#FFFFFF)"):(i=document.createElement("iframe"),i.style.backgroundColor="transparent",i.name=n),i.scrolling="no",i.marginWidth="0px",i.marginHeight="0px",i.frameBorder="0",i.style.position="absolute",i.style.width="100%",i.style.height="100%",1>this.layer.opacity&&OpenLayers.Util.modifyDOMElement(i,null,null,null,null,null,null,this.layer.opacity),this.frame.appendChild(i),this.imgDiv=i,i}return OpenLayers.Tile.Image.prototype.getImage.apply(this,arguments)},createRequestForm:function(){var e=document.createElement("form");e.method="POST";var t=this.layer.params._OLSALT;t=(t?t+"_":"")+this.bounds.toBBOX(),e.action=OpenLayers.Util.urlAppend(this.layer.url,t),e.target=this.id+"_iFrame";var i,n=(this.layer.getImageSize(),OpenLayers.Util.getParameters(this.url));for(var r in n)i=document.createElement("input"),i.type="hidden",i.name=r,i.value=n[r],e.appendChild(i);return e},setImgSrc:function(e){if(this.useIFrame===!0)if(e){var t=this.createRequestForm();this.frame.appendChild(t),t.submit(),this.frame.removeChild(t)}else this.imgDiv.parentNode===this.frame&&(this.frame.removeChild(this.imgDiv),this.imgDiv=null);else OpenLayers.Tile.Image.prototype.setImgSrc.apply(this,arguments)},onImageLoad:function(){OpenLayers.Tile.Image.prototype.onImageLoad.apply(this,arguments),this.useIFrame===!0&&(this.imgDiv.style.opacity=1,this.frame.style.opacity=this.layer.opacity)},createBackBuffer:function(){var e;return this.useIFrame===!1&&(e=OpenLayers.Tile.Image.prototype.createBackBuffer.call(this)),e}};