OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER,this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var i,n=-1,r=this.order.length;r-n>1;){i=parseInt((n+r)/2);var s=this.compare(this,e,OpenLayers.Util.getElement(this.order[i]));s>0?n=i:r=i}return this.order.splice(r,0,t),this.indices[t]=this.getZIndex(e),this.getNextElement(r)},remove:function(e){var t=e.id,i=OpenLayers.Util.indexOf(this.order,t);if(i>=0)if(this.order.splice(i,1),delete this.indices[t],this.order.length>0){var n=this.order[this.order.length-1];this.maxZIndex=this.indices[n]}else this.maxZIndex=0},clear:function(){this.order=[],this.indices={},this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;null==t?(t=this.maxZIndex,e._style.graphicZIndex=t):t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){var t=e+1;if(this.order.length>t){var i=OpenLayers.Util.getElement(this.order[t]);return void 0==i&&(i=this.getNextElement(t)),i}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"}),OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,i){var n=e.getZIndex(t),r=0;if(i){var s=e.getZIndex(i);r=n-s}return r},Z_ORDER_DRAWING_ORDER:function(e,t,i){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);return i&&0==n&&(n=1),n},Z_ORDER_Y_ORDER:function(e,t,i){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,i);if(i&&0===n){var r=i._boundsBottom-t._boundsBottom;n=0===r?1:r}return n}},OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments),this.rendererRoot=this.createRenderRoot(),this.root=this.createRoot("_root"),this.vectorRoot=this.createRoot("_vroot"),this.textRoot=this.createRoot("_troot"),this.root.appendChild(this.vectorRoot),this.root.appendChild(this.textRoot),this.rendererRoot.appendChild(this.root),this.container.appendChild(this.rendererRoot),t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear(),this.rendererRoot=null,this.root=null,this.xmlns=null,OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);if(t=this.textRoot)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},setExtent:function(e,t){var i=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),n=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var r,s=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/s),o=this.map.getMaxExtent();o.right>e.left&&o.right<e.right?r=!0:o.left>e.left&&o.left<e.right&&(r=!1),(r!==this.rightOfDateLine||t)&&(i=!1,this.xOffset=r===!0?o.getWidth()/n:0),this.rightOfDateLine=r}return i},getNodeType:function(){},drawGeometry:function(e,t,i){var n=e.CLASS_NAME,r=!0;if("OpenLayers.Geometry.Collection"==n||"OpenLayers.Geometry.MultiPoint"==n||"OpenLayers.Geometry.MultiLineString"==n||"OpenLayers.Geometry.MultiPolygon"==n){for(var s=0,o=e.components.length;o>s;s++)r=this.drawGeometry(e.components[s],t,i)&&r;return r}r=!1;var a=!1;if("none"!=t.display&&(t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,i):a=!0,r=this.redrawNode(e.id,e,t,i)),0==r){var l=document.getElementById(e.id);l&&(l._style.backgroundGraphic&&(a=!0),l.parentNode.removeChild(l))}if(a){var l=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX);l&&l.parentNode.removeChild(l)}return r},redrawNode:function(e,t,i,n){i=this.applyDefaultSymbolizer(i);var r=this.nodeFactory(e,this.getNodeType(t,i));r._featureId=n,r._boundsBottom=t.getBounds().bottom,r._geometryClass=t.CLASS_NAME,r._style=i;var s=this.drawGeometryNode(r,t,i);if(s===!1)return!1;if(r=s.node,this.indexer){var o=this.indexer.insert(r);o?this.vectorRoot.insertBefore(r,o):this.vectorRoot.appendChild(r)}else r.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(r);return this.postDraw(r),s.complete},redrawBackgroundNode:function(e,t,i){var n=OpenLayers.Util.extend({},i);return n.externalGraphic=n.backgroundGraphic,n.graphicXOffset=n.backgroundXOffset,n.graphicYOffset=n.backgroundYOffset,n.graphicZIndex=n.backgroundGraphicZIndex,n.graphicWidth=n.backgroundWidth||n.graphicWidth,n.graphicHeight=n.backgroundHeight||n.graphicHeight,n.backgroundGraphic=null,n.backgroundXOffset=null,n.backgroundYOffset=null,n.backgroundGraphicZIndex=null,this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,n,null)},drawGeometryNode:function(e,t,i){i=i||e._style;var n,r={isFilled:void 0===i.fill?!0:i.fill,isStroked:void 0===i.stroke?!!i.strokeWidth:i.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":i.graphic===!1&&(r.isFilled=!1,r.isStroked=!1),n=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":r.isFilled=!1,n=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":n=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":n=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Rectangle":n=this.drawRectangle(e,t);break;default:}return e._options=r,0!=n?{node:this.setStyle(e,i,r,t),complete:n}:!1},postDraw:function(){},drawPoint:function(){},drawLineString:function(){},drawLinearRing:function(){},drawPolygon:function(){},drawRectangle:function(){},drawCircle:function(){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t);var i=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX);i&&this.textRoot.removeChild(i)},getFeatureIdFromEvent:function(e){var t=e.target,i=t&&t.correspondingUseElement,n=i?i:t||e.srcElement;return n._featureId},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var i=0,n=e.components.length;n>i;i++)this.eraseGeometry(e.components[i],t);else{var r=OpenLayers.Util.getElement(e.id);if(r&&r.parentNode&&(r.geometry&&(r.geometry.destroy(),r.geometry=null),r.parentNode.removeChild(r),this.indexer&&this.indexer.remove(r),r._style.backgroundGraphic)){var s=e.id+this.BACKGROUND_ID_SUFFIX,o=OpenLayers.Util.getElement(s);o&&o.parentNode&&o.parentNode.removeChild(o)}}},nodeFactory:function(e,t){var i=OpenLayers.Util.getElement(e);return i?this.nodeTypeCompare(i,t)||(i.parentNode.removeChild(i),i=this.nodeFactory(e,t)):i=this.createNode(t,e),i},nodeTypeCompare:function(){},createNode:function(){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root),t.parentNode.removeChild(t),e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"});