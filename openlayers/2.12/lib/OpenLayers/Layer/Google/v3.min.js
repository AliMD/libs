OpenLayers.Layer.Google.v3={DEFAULTS:{sphericalMercator:!0,projection:"EPSG:900913"},animationEnabled:!0,loadMapObject:function(){this.type||(this.type=google.maps.MapTypeId.ROADMAP);var e,t=OpenLayers.Layer.Google.cache[this.map.id];if(t)e=t.mapObject,++t.count;else{var i=this.map.viewPortDiv,n=document.createElement("div");n.id=this.map.id+"_GMapContainer",n.style.position="absolute",n.style.width="100%",n.style.height="100%",i.appendChild(n);var r=this.map.getCenter();e=new google.maps.Map(n,{center:r?new google.maps.LatLng(r.lat,r.lon):new google.maps.LatLng(0,0),zoom:this.map.getZoom()||0,mapTypeId:this.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1}),t={mapObject:e,count:1},OpenLayers.Layer.Google.cache[this.map.id]=t,this.repositionListener=google.maps.event.addListenerOnce(e,"center_changed",OpenLayers.Function.bind(this.repositionMapElements,this))}this.mapObject=e,this.setGMapVisibility(this.visibility)},repositionMapElements:function(){google.maps.event.trigger(this.mapObject,"resize");var e=this.mapObject.getDiv().firstChild;if(!e||3>e.childNodes.length)return this.repositionTimer=window.setTimeout(OpenLayers.Function.bind(this.repositionMapElements,this),250),!1;for(var t=OpenLayers.Layer.Google.cache[this.map.id],i=this.map.viewPortDiv,n=e.children.length-1;n>=0;--n){if(1000001==e.children[n].style.zIndex){var r=e.children[n];i.appendChild(r),r.style.zIndex="1100",r.style.bottom="",r.className="olLayerGoogleCopyright olLayerGoogleV3",r.style.display="",t.termsOfUse=r}if(1e6==e.children[n].style.zIndex){var s=e.children[n];i.appendChild(s),s.style.zIndex="1100",s.style.bottom="",s.className="olLayerGooglePoweredBy olLayerGoogleV3 gmnoprint",s.style.display="",t.poweredBy=s}10000002==e.children[n].style.zIndex&&i.appendChild(e.children[n])}this.setGMapVisibility(this.visibility)},onMapResize:function(){if(this.visibility)google.maps.event.trigger(this.mapObject,"resize");else{var e=OpenLayers.Layer.Google.cache[this.map.id];if(!e.resized){var t=this;google.maps.event.addListenerOnce(this.mapObject,"tilesloaded",function(){google.maps.event.trigger(t.mapObject,"resize"),t.moveTo(t.map.getCenter(),t.map.getZoom()),delete e.resized})}e.resized=!0}},setGMapVisibility:function(e){var t=OpenLayers.Layer.Google.cache[this.map.id];if(t){for(var i,n=this.type,r=this.map.layers,s=r.length-1;s>=0;--s)if(i=r[s],i instanceof OpenLayers.Layer.Google&&i.visibility===!0&&i.inRange===!0){n=i.type,e=!0;break}var o=this.mapObject.getDiv();e===!0?(this.mapObject.setMapTypeId(n),o.style.left="",t.termsOfUse&&t.termsOfUse.style&&(t.termsOfUse.style.left="",t.termsOfUse.style.display="",t.poweredBy.style.display=""),t.displayed=this.id):(delete t.displayed,o.style.left="-9999px",t.termsOfUse&&t.termsOfUse.style&&(t.termsOfUse.style.display="none",t.termsOfUse.style.left="-9999px",t.poweredBy.style.display="none"))}},getMapContainer:function(){return this.mapObject.getDiv()},getMapObjectBoundsFromOLBounds:function(e){var t=null;if(null!=e){var i=this.sphericalMercator?this.inverseMercator(e.bottom,e.left):new OpenLayers.LonLat(e.bottom,e.left),n=this.sphericalMercator?this.inverseMercator(e.top,e.right):new OpenLayers.LonLat(e.top,e.right);t=new google.maps.LatLngBounds(new google.maps.LatLng(i.lat,i.lon),new google.maps.LatLng(n.lat,n.lon))}return t},getMapObjectLonLatFromMapObjectPixel:function(e){var t=this.map.getSize(),i=this.getLongitudeFromMapObjectLonLat(this.mapObject.center),n=this.getLatitudeFromMapObjectLonLat(this.mapObject.center),r=this.map.getResolution(),s=e.x-t.w/2,o=e.y-t.h/2,a=new OpenLayers.LonLat(i+s*r,n-o*r);return this.wrapDateLine&&(a=a.wrapDateLine(this.maxExtent)),this.getMapObjectLonLatFromLonLat(a.lon,a.lat)},getMapObjectPixelFromMapObjectLonLat:function(e){var t=this.getLongitudeFromMapObjectLonLat(e),i=this.getLatitudeFromMapObjectLonLat(e),n=this.map.getResolution(),r=this.map.getExtent();return this.getMapObjectPixelFromXY(1/n*(t-r.left),1/n*(r.top-i))},setMapObjectCenter:function(e,t){if(this.animationEnabled===!1&&t!=this.mapObject.zoom){var i=this.getMapContainer();google.maps.event.addListenerOnce(this.mapObject,"idle",function(){i.style.visibility=""}),i.style.visibility="hidden"}this.mapObject.setOptions({center:e,zoom:t})},getMapObjectZoomFromMapObjectBounds:function(e){return this.mapObject.getBoundsZoomLevel(e)},getMapObjectLonLatFromLonLat:function(e,t){var i;if(this.sphericalMercator){var n=this.inverseMercator(e,t);i=new google.maps.LatLng(n.lat,n.lon)}else i=new google.maps.LatLng(t,e);return i},getMapObjectPixelFromXY:function(e,t){return new google.maps.Point(e,t)},destroy:function(){this.repositionListener&&google.maps.event.removeListener(this.repositionListener),this.repositionTimer&&window.clearTimeout(this.repositionTimer),OpenLayers.Layer.Google.prototype.destroy.apply(this,arguments)}};