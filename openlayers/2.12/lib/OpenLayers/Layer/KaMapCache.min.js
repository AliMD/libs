OpenLayers.Layer.KaMapCache=OpenLayers.Class(OpenLayers.Layer.KaMap,{IMAGE_EXTENSIONS:{jpeg:"jpg",gif:"gif",png:"png",png8:"png",png24:"png",dithered:"png"},DEFAULT_FORMAT:"jpeg",initialize:function(){OpenLayers.Layer.KaMap.prototype.initialize.apply(this,arguments),this.extension=this.IMAGE_EXTENSIONS[this.params.i.toLowerCase()||this.DEFAULT_FORMAT]},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round(1e4*this.map.getScale())/1e4,n=Math.round(e.left/t),r=-Math.round(e.top/t),s=Math.floor(n/this.tileSize.w/this.params.metaTileSize.w)*this.tileSize.w*this.params.metaTileSize.w,o=Math.floor(r/this.tileSize.h/this.params.metaTileSize.h)*this.tileSize.h*this.params.metaTileSize.h,a=["/",this.params.map,"/",i,"/",this.params.g.replace(/\s/g,"_"),"/def/t",o,"/l",s,"/t",r,"l",n,".",this.extension],l=this.url;return OpenLayers.Util.isArray(l)&&(l=this.selectUrl(a.join(""),l)),l+a.join("")},CLASS_NAME:"OpenLayers.Layer.KaMapCache"});