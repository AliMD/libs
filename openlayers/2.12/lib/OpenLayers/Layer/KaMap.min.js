OpenLayers.Layer.KaMap=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,DEFAULT_PARAMS:{i:"jpeg",map:""},initialize:function(){OpenLayers.Layer.Grid.prototype.initialize.apply(this,arguments),this.params=OpenLayers.Util.applyDefaults(this.params,this.DEFAULT_PARAMS)},getURL:function(e){e=this.adjustBounds(e);var t=this.map.getResolution(),i=Math.round(1e4*this.map.getScale())/1e4,n=Math.round(e.left/t),r=-Math.round(e.top/t);return this.getFullRequestString({t:r,l:n,s:i})},calculateGridLayout:function(e,t,i){var n=i*this.tileSize.w,r=i*this.tileSize.h,s=e.left,o=Math.floor(s/n)-this.buffer,a=s/n-o,l=-a*this.tileSize.w,h=o*n,c=e.top,u=Math.ceil(c/r)+this.buffer,d=u-c/r,p=-(d+1)*this.tileSize.h,f=u*r;return{tilelon:n,tilelat:r,tileoffsetlon:h,tileoffsetlat:f,tileoffsetx:l,tileoffsety:p}},clone:function(e){return null==e&&(e=new OpenLayers.Layer.KaMap(this.name,this.url,this.params,this.getOptions())),e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]),null!=this.tileSize&&(e.tileSize=this.tileSize.clone()),e.grid=[],e},getTileBounds:function(e){var t=this.getResolution(),i=t*this.tileSize.w,n=t*this.tileSize.h,r=this.getLonLatFromViewPortPx(e),s=i*Math.floor(r.lon/i),o=n*Math.floor(r.lat/n);return new OpenLayers.Bounds(s,o,s+i,o+n)},CLASS_NAME:"OpenLayers.Layer.KaMap"});