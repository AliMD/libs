OpenLayers.Format.GeoRSS=OpenLayers.Class(OpenLayers.Format.XML,{rssns:"http://backend.userland.com/rss2",featureNS:"http://mapserver.gis.umn.edu/mapserver",georssns:"http://www.georss.org/georss",geons:"http://www.w3.org/2003/01/geo/wgs84_pos#",featureTitle:"Untitled",featureDescription:"No Description",gmlParser:null,xy:!1,createGeometryFromItem:function(e){var t=this.getElementsByTagNameNS(e,this.georssns,"point"),i=this.getElementsByTagNameNS(e,this.geons,"lat"),n=this.getElementsByTagNameNS(e,this.geons,"long"),r=this.getElementsByTagNameNS(e,this.georssns,"line"),o=this.getElementsByTagNameNS(e,this.georssns,"polygon"),s=this.getElementsByTagNameNS(e,this.georssns,"where"),a=this.getElementsByTagNameNS(e,this.georssns,"box");if(t.length>0||i.length>0&&n.length>0){var l;t.length>0?(l=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s+/),2!=l.length&&(l=OpenLayers.String.trim(t[0].firstChild.nodeValue).split(/\s*,\s*/))):l=[parseFloat(i[0].firstChild.nodeValue),parseFloat(n[0].firstChild.nodeValue)];var h=new OpenLayers.Geometry.Point(l[1],l[0])}else if(r.length>0){for(var t,c=OpenLayers.String.trim(this.getChildValue(r[0])).split(/\s+/),u=[],d=0,p=c.length;p>d;d+=2)t=new OpenLayers.Geometry.Point(c[d+1],c[d]),u.push(t);h=new OpenLayers.Geometry.LineString(u)}else if(o.length>0){for(var t,c=OpenLayers.String.trim(this.getChildValue(o[0])).split(/\s+/),u=[],d=0,p=c.length;p>d;d+=2)t=new OpenLayers.Geometry.Point(c[d+1],c[d]),u.push(t);h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(u)])}else if(s.length>0){this.gmlParser||(this.gmlParser=new OpenLayers.Format.GML({xy:this.xy}));var f=this.gmlParser.parseFeature(s[0]);h=f.geometry}else if(a.length>0){var t,c=OpenLayers.String.trim(a[0].firstChild.nodeValue).split(/\s+/),u=[];c.length>3&&(t=new OpenLayers.Geometry.Point(c[1],c[0]),u.push(t),t=new OpenLayers.Geometry.Point(c[1],c[2]),u.push(t),t=new OpenLayers.Geometry.Point(c[3],c[2]),u.push(t),t=new OpenLayers.Geometry.Point(c[3],c[0]),u.push(t),t=new OpenLayers.Geometry.Point(c[1],c[0]),u.push(t)),h=new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(u)])}return h&&this.internalProjection&&this.externalProjection&&h.transform(this.externalProjection,this.internalProjection),h},createFeatureFromItem:function(e){var t=this.createGeometryFromItem(e),i=this._getChildValue(e,"*","title",this.featureTitle),n=this._getChildValue(e,"*","description",this._getChildValue(e,"*","content",this._getChildValue(e,"*","summary",this.featureDescription))),r=this._getChildValue(e,"*","link");if(!r)try{r=this.getElementsByTagNameNS(e,"*","link")[0].getAttribute("href")}catch(o){r=null}var s=this._getChildValue(e,"*","id",null),a={title:i,description:n,link:r},l=new OpenLayers.Feature.Vector(t,a);return l.fid=s,l},_getChildValue:function(e,t,i,n){var r,o=this.getElementsByTagNameNS(e,t,i);return r=o&&o[0]&&o[0].firstChild&&o[0].firstChild.nodeValue?this.getChildValue(o[0]):void 0==n?"":n},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=null;t=this.getElementsByTagNameNS(e,"*","item"),0==t.length&&(t=this.getElementsByTagNameNS(e,"*","entry"));for(var i=t.length,n=Array(i),r=0;i>r;r++)n[r]=this.createFeatureFromItem(t[r]);return n},write:function(e){var t;if(OpenLayers.Util.isArray(e)){t=this.createElementNS(this.rssns,"rss");for(var i=0,n=e.length;n>i;i++)t.appendChild(this.createFeatureXML(e[i]))}else t=this.createFeatureXML(e);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=this.buildGeometryNode(e.geometry),i=this.createElementNS(this.rssns,"item"),n=this.createElementNS(this.rssns,"title");n.appendChild(this.createTextNode(e.attributes.title?e.attributes.title:""));var r=this.createElementNS(this.rssns,"description");if(r.appendChild(this.createTextNode(e.attributes.description?e.attributes.description:"")),i.appendChild(n),i.appendChild(r),e.attributes.link){var o=this.createElementNS(this.rssns,"link");o.appendChild(this.createTextNode(e.attributes.link)),i.appendChild(o)}for(var s in e.attributes)if("link"!=s&&"title"!=s&&"description"!=s){var a=this.createTextNode(e.attributes[s]),l=s;-1!=s.search(":")&&(l=s.split(":")[1]);var h=this.createElementNS(this.featureNS,"feature:"+l);h.appendChild(a),i.appendChild(h)}return i.appendChild(t),i},buildGeometryNode:function(e){this.internalProjection&&this.externalProjection&&(e=e.clone(),e.transform(this.internalProjection,this.externalProjection));var t;if("OpenLayers.Geometry.Polygon"==e.CLASS_NAME)t=this.createElementNS(this.georssns,"georss:polygon"),t.appendChild(this.buildCoordinatesNode(e.components[0]));else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=this.createElementNS(this.georssns,"georss:line"),t.appendChild(this.buildCoordinatesNode(e));else{if("OpenLayers.Geometry.Point"!=e.CLASS_NAME)throw"Couldn't parse "+e.CLASS_NAME;t=this.createElementNS(this.georssns,"georss:point"),t.appendChild(this.buildCoordinatesNode(e))}return t},buildCoordinatesNode:function(e){var t=null;e.components&&(t=e.components);var i;if(t){for(var n=t.length,r=Array(n),o=0;n>o;o++)r[o]=t[o].y+" "+t[o].x;i=r.join(" ")}else i=e.y+" "+e.x;return this.createTextNode(i)},CLASS_NAME:"OpenLayers.Format.GeoRSS"});