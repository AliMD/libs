OpenLayers.Format.Context=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{layerOptions:null,layerParams:null,read:function(e,t){var i,n=OpenLayers.Format.XML.VersionedOGC.prototype.read.apply(this,arguments);if(t&&t.map)if(this.context=n,t.map instanceof OpenLayers.Map)i=this.mergeContextToMap(n,t.map);else{var r=t.map;(OpenLayers.Util.isElement(r)||"string"==typeof r)&&(r={div:r}),i=this.contextToMap(n,r)}else i=n;return i},getLayerFromContext:function(e){var t,i,n={queryable:e.queryable,visibility:e.visibility,maxExtent:e.maxExtent,metadata:OpenLayers.Util.applyDefaults(e.metadata,{styles:e.styles,formats:e.formats,"abstract":e["abstract"],dataURL:e.dataURL}),numZoomLevels:e.numZoomLevels,units:e.units,isBaseLayer:e.isBaseLayer,opacity:e.opacity,displayInLayerSwitcher:e.displayInLayerSwitcher,singleTile:e.singleTile,tileSize:e.tileSize?new OpenLayers.Size(e.tileSize.width,e.tileSize.height):void 0,minScale:e.minScale||e.maxScaleDenominator,maxScale:e.maxScale||e.minScaleDenominator,srs:e.srs,dimensions:e.dimensions,metadataURL:e.metadataURL};this.layerOptions&&OpenLayers.Util.applyDefaults(n,this.layerOptions);var r={layers:e.name,transparent:e.transparent,version:e.version};if(e.formats&&e.formats.length>0)for(r.format=e.formats[0].value,t=0,i=e.formats.length;i>t;t++){var o=e.formats[t];if(1==o.current){r.format=o.value;break}}if(e.styles&&e.styles.length>0)for(t=0,i=e.styles.length;i>t;t++){var s=e.styles[t];if(1==s.current){s.href?r.sld=s.href:s.body?r.sld_body=s.body:r.styles=s.name;break}}this.layerParams&&OpenLayers.Util.applyDefaults(r,this.layerParams);var a=null,l=e.service;return l==OpenLayers.Format.Context.serviceTypes.WFS?(n.strategies=[new OpenLayers.Strategy.BBOX],n.protocol=new OpenLayers.Protocol.WFS({url:e.url,featurePrefix:e.name.split(":")[0],featureType:e.name.split(":").pop()}),a=new OpenLayers.Layer.Vector(e.title||e.name,n)):l==OpenLayers.Format.Context.serviceTypes.KML?(n.strategies=[new OpenLayers.Strategy.Fixed],n.protocol=new OpenLayers.Protocol.HTTP({url:e.url,format:new OpenLayers.Format.KML}),a=new OpenLayers.Layer.Vector(e.title||e.name,n)):l==OpenLayers.Format.Context.serviceTypes.GML?(n.strategies=[new OpenLayers.Strategy.Fixed],n.protocol=new OpenLayers.Protocol.HTTP({url:e.url,format:new OpenLayers.Format.GML}),a=new OpenLayers.Layer.Vector(e.title||e.name,n)):e.features?(a=new OpenLayers.Layer.Vector(e.title||e.name,n),a.addFeatures(e.features)):e.categoryLayer!==!0&&(a=new OpenLayers.Layer.WMS(e.title||e.name,e.url,r,n)),a},getLayersFromContext:function(e){for(var t=[],i=0,n=e.length;n>i;i++){var r=this.getLayerFromContext(e[i]);null!==r&&t.push(r)}return t},contextToMap:function(e,t){t=OpenLayers.Util.applyDefaults({maxExtent:e.maxExtent,projection:e.projection,units:e.units},t),t.maxExtent&&(t.maxResolution=t.maxExtent.getWidth()/OpenLayers.Map.TILE_WIDTH);var i={contactInformation:e.contactInformation,"abstract":e["abstract"],keywords:e.keywords,logo:e.logo,descriptionURL:e.descriptionURL};t.metadata=i;var n=new OpenLayers.Map(t);return n.addLayers(this.getLayersFromContext(e.layersContext)),n.setCenter(e.bounds.getCenterLonLat(),n.getZoomForExtent(e.bounds,!0)),n},mergeContextToMap:function(e,t){return t.addLayers(this.getLayersFromContext(e.layersContext)),t},write:function(e){return e=this.toContext(e),OpenLayers.Format.XML.VersionedOGC.prototype.write.apply(this,arguments)},CLASS_NAME:"OpenLayers.Format.Context"}),OpenLayers.Format.Context.serviceTypes={WMS:"urn:ogc:serviceType:WMS",WFS:"urn:ogc:serviceType:WFS",WCS:"urn:ogc:serviceType:WCS",GML:"urn:ogc:serviceType:GML",SLD:"urn:ogc:serviceType:SLD",FES:"urn:ogc:serviceType:FES",KML:"urn:ogc:serviceType:KML"};