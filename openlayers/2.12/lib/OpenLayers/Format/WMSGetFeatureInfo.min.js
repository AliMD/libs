OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var i=e.documentElement;if(i){var n=this["read_"+i.nodeName];t=n?n.call(this,i):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],i=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(i)for(var n=0,r=i.length;r>n;++n){var s=i[n],o=s.nodeName;s.prefix&&(o=o.split(":")[1]);var o=o.replace(this.layerIdentifier,""),a=this.getSiblingNodesByTagCriteria(s,this.featureIdentifier);if(a)for(var l=0;a.length>l;l++){var h=a[l],c=this.parseGeometry(h),u=this.parseAttributes(h),d=new OpenLayers.Feature.Vector(c.geometry,u,null);d.bounds=c.bounds,d.type=o,t.push(d)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],i=this.getElementsByTagNameNS(e,"*","FIELDS"),n=0,r=i.length;r>n;n++){var s,o=i[n],a=null,l={},h=o.attributes.length;if(h>0)for(s=0;h>s;s++){var c=o.attributes[s];l[c.nodeName]=c.nodeValue}else{var u=o.childNodes;for(s=0,h=u.length;h>s;++s){var d=u[s];3!=d.nodeType&&(l[d.getAttribute("name")]=d.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(a,l,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var i,n,r,s,o,a=[];if(e&&e.hasChildNodes()){i=e.childNodes,r=i.length;for(var l=0;r>l;l++){for(o=i[l];o&&1!=o.nodeType;)o=o.nextSibling,l++;n=o?o.nodeName:"",n.length>0&&n.indexOf(t)>-1?a.push(o):(s=this.getSiblingNodesByTagCriteria(o,t),s.length>0&&(0==a.length?a=s:a.push(s)))}}return a},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var i=e.childNodes,n=i.length,r=0;n>r;++r){var s=i[r];if(1==s.nodeType){var o=s.childNodes,a=s.prefix?s.nodeName.split(":")[1]:s.nodeName;if(0==o.length)t[a]=null;else if(1==o.length){var l=o[0];if(3==l.nodeType||4==l.nodeType){var h=l.nodeValue.replace(this.regExes.trimSpace,"");t[a]=h}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,i=this.gmlFormat.parseFeature(e),n=null;return i&&(t=i.geometry&&i.geometry.clone(),n=i.bounds&&i.bounds.clone(),i.destroy()),{geometry:t,bounds:n}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});