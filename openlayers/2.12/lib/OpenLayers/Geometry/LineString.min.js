OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(){var e=this.components&&this.components.length>2;return e&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments),e},intersects:function(e){var t=!1,i=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==i||"OpenLayers.Geometry.LinearRing"==i||"OpenLayers.Geometry.Point"==i){var n,r=this.getSortedSegments();n="OpenLayers.Geometry.Point"==i?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var s,o,a,l,h,c,u,d;e:for(var p=0,f=r.length;f>p;++p){s=r[p],o=s.x1,a=s.x2,l=s.y1,h=s.y2;for(var m=0,g=n.length;g>m&&(c=n[m],!(c.x1>a));++m)if(!(o>c.x2||(u=c.y1,d=c.y2,Math.min(u,d)>Math.max(l,h)||Math.max(u,d)<Math.min(l,h)||!OpenLayers.Geometry.segmentsIntersect(s,c)))){t=!0;break e}}}else t=e.intersects(this);return t},getSortedSegments:function(){function e(e,t){return e.x1-t.x1}for(var t,i,n=this.components.length-1,r=Array(n),s=0;n>s;++s)t=this.components[s],i=this.components[s+1],r[s]=t.x<i.x?{x1:t.x,y1:t.y,x2:i.x,y2:i.y}:{x1:i.x,y1:i.y,x2:t.x,y2:t.y};return r.sort(e)},splitWithSegment:function(e,t){for(var i,n,r,s,o,a=!(t&&t.edge===!1),l=t&&t.tolerance,h=[],c=this.getVertices(),u=[],d=[],p=!1,f={point:!0,tolerance:l},m=null,g=0,y=c.length-2;y>=g;++g)if(i=c[g],u.push(i.clone()),n=c[g+1],o={x1:i.x,y1:i.y,x2:n.x,y2:n.y},r=OpenLayers.Geometry.segmentsIntersect(e,o,f),r instanceof OpenLayers.Geometry.Point&&(s=r.x===e.x1&&r.y===e.y1||r.x===e.x2&&r.y===e.y2||r.equals(i)||r.equals(n)?!0:!1,s||a)){if(r.equals(d[d.length-1])||d.push(r.clone()),0===g&&r.equals(i))continue;if(r.equals(n))continue;p=!0,r.equals(i)||u.push(r),h.push(new OpenLayers.Geometry.LineString(u)),u=[r.clone()]}if(p&&(u.push(n.clone()),h.push(new OpenLayers.Geometry.LineString(u))),d.length>0){var v=e.x1<e.x2?1:-1,b=e.y1<e.y2?1:-1;m={lines:h,points:d.sort(function(e,t){return v*e.x-v*t.x||b*e.y-b*t.y})}}return m},split:function(e,t){var i,n,r,s,o=null,a=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,h,c,u,d,p,f=this.getVertices(),m=[];r=[];for(var g=0,y=f.length-2;y>=g;++g){l=f[g],h=f[g+1],c={x1:l.x,y1:l.y,x2:h.x,y2:h.y},s=s||[e],a&&m.push(l.clone());for(var v=0;s.length>v;++v)if(u=s[v].splitWithSegment(c,t),u&&(d=u.lines,d.length>0&&(d.unshift(v,1),Array.prototype.splice.apply(s,d),v+=d.length-2),a))for(var b=0,L=u.points.length;L>b;++b)p=u.points[b],p.equals(l)||(m.push(p),r.push(new OpenLayers.Geometry.LineString(m)),m=p.equals(h)?[]:[p.clone()])}a&&r.length>0&&m.length>0&&(m.push(h.clone()),r.push(new OpenLayers.Geometry.LineString(m)))}else o=e.splitWith(this,t);return s&&s.length>1?n=!0:s=[],r&&r.length>1?i=!0:r=[],(n||i)&&(o=a?[r,s]:s),o},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){var t;return t=e===!0?[this.components[0],this.components[this.components.length-1]]:e===!1?this.components.slice(1,this.components.length-1):this.components.slice()},distanceTo:function(e,t){var i,n=!(t&&t.edge===!1),r=n&&t&&t.details,s={},o=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var a,l=this.getSortedSegments(),h=e.x,c=e.y,u=0,d=l.length;d>u;++u)if(a=l[u],i=OpenLayers.Geometry.distanceToSegment(e,a),o>i.distance){if(o=i.distance,s=i,0===o)break}else if(a.x2>h&&(c>a.y1&&a.y2>c||a.y1>c&&c>a.y2))break;s=r?{distance:s.distance,x0:s.x,y0:s.y,x1:h,y1:c}:s.distance}else if(e instanceof OpenLayers.Geometry.LineString){var p,f,m,g,y,v=this.getSortedSegments(),b=e.getSortedSegments(),L=b.length,x={point:!0};e:for(var u=0,d=v.length;d>u;++u){p=v[u],g=p.x1,y=p.y1;for(var C=0;L>C;++C){if(f=b[C],m=OpenLayers.Geometry.segmentsIntersect(p,f,x)){o=0,s={distance:0,x0:m.x,y0:m.y,x1:m.x,y1:m.y};break e}i=OpenLayers.Geometry.distanceToSegment({x:g,y:y},f),o>i.distance&&(o=i.distance,s={distance:o,x0:g,y0:y,x1:i.x,y1:i.y})}}if(r||(s=s.distance),0!==o&&p){i=e.distanceTo(new OpenLayers.Geometry.Point(p.x2,p.y2),t);var w=r?i.distance:i;o>w&&(s=r?{distance:o,x0:i.x1,y0:i.y1,x1:i.x0,y1:i.y0}:w)}}else s=e.distanceTo(this,t),r&&(s={distance:s.distance,x0:s.x1,y0:s.y1,x1:s.x0,y1:s.y0});return s},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(3>t.length)return this;var i=function(e,t){return e-t},n=function(e,t,i,s){for(var o,l=0,h=0,c=t;i>c;c++)o=r(e[t],e[i],e[c]),o>l&&(l=o,h=c);l>s&&h!=t&&(a.push(h),n(e,t,h,s),n(e,h,i,s))},r=function(e,t,i){var n=Math.abs(.5*(e.x*t.y+t.x*i.y+i.x*e.y-t.x*e.y-i.x*t.y-e.x*i.y)),r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),s=2*(n/r);return s},s=0,o=t.length-1,a=[];for(a.push(s),a.push(o);t[s].equals(t[o]);)o--,a.push(o);n(t,s,o,e);var l=[];a.sort(i);for(var h=0;a.length>h;h++)l.push(t[a[h]]);return new OpenLayers.Geometry.LineString(l)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"});