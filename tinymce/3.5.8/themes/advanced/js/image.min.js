var ImageDialog={preInit:function(){var e;tinyMCEPopup.requireLangPack(),(e=tinyMCEPopup.getParam("external_image_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(e)+'"></script>')},init:function(){var t=document.forms[0],i=tinyMCEPopup.editor;document.getElementById("srcbrowsercontainer").innerHTML=getBrowserHTML("srcbrowser","src","image","theme_advanced_image"),isVisible("srcbrowser")&&(document.getElementById("src").style.width="180px"),e=i.selection.getNode(),this.fillFileList("image_list",tinyMCEPopup.getParam("external_image_list","tinyMCEImageList")),"IMG"==e.nodeName&&(t.src.value=i.dom.getAttrib(e,"src"),t.alt.value=i.dom.getAttrib(e,"alt"),t.border.value=this.getAttrib(e,"border"),t.vspace.value=this.getAttrib(e,"vspace"),t.hspace.value=this.getAttrib(e,"hspace"),t.width.value=i.dom.getAttrib(e,"width"),t.height.value=i.dom.getAttrib(e,"height"),t.insert.value=i.getLang("update"),this.styleVal=i.dom.getAttrib(e,"style"),selectByValue(t,"image_list",t.src.value),selectByValue(t,"align",this.getAttrib(e,"align")),this.updateStyle())},fillFileList:function(e,t){var i=tinyMCEPopup.dom,n=i.get(e);t="function"==typeof t?t():window[t],t&&t.length>0?(n.options[n.options.length]=new Option("",""),tinymce.each(t,function(e){n.options[n.options.length]=new Option(e[0],e[1])})):i.remove(i.getParent(e,"tr"))},update:function(){var e,t=document.forms[0],i=t.elements,n=tinyMCEPopup.editor,r={};return tinyMCEPopup.restoreSelection(),""===t.src.value?("IMG"==n.selection.getNode().nodeName&&(n.dom.remove(n.selection.getNode()),n.execCommand("mceRepaint")),tinyMCEPopup.close(),void 0):(n.settings.inline_styles?r.style=this.styleVal:r=tinymce.extend(r,{vspace:i.vspace.value,hspace:i.hspace.value,border:i.border.value,align:getSelectValue(t,"align")}),tinymce.extend(r,{src:t.src.value.replace(/ /g,"%20"),alt:t.alt.value,width:t.width.value,height:t.height.value}),e=n.selection.getNode(),e&&"IMG"==e.nodeName?(n.dom.setAttribs(e,r),tinyMCEPopup.editor.execCommand("mceRepaint"),tinyMCEPopup.editor.focus()):(tinymce.each(r,function(e,t){""===e&&delete r[t]}),n.execCommand("mceInsertContent",!1,tinyMCEPopup.editor.dom.createHTML("img",r),{skip_undo:1}),n.undoManager.add()),tinyMCEPopup.close(),void 0)},updateStyle:function(){var e,t=tinyMCEPopup.dom,i={},n=document.forms[0];tinyMCEPopup.editor.settings.inline_styles&&(tinymce.each(tinyMCEPopup.dom.parseStyle(this.styleVal),function(e,t){i[t]=e}),e=getSelectValue(n,"align"),e?"left"==e||"right"==e?(i["float"]=e,delete i["vertical-align"]):(i["vertical-align"]=e,delete i["float"]):(delete i["float"],delete i["vertical-align"]),e=n.border.value,e||"0"==e?i.border="0"==e?"0":e+"px solid black":delete i.border,e=n.hspace.value,e?(delete i.margin,i["margin-left"]=e+"px",i["margin-right"]=e+"px"):(delete i["margin-left"],delete i["margin-right"]),e=n.vspace.value,e?(delete i.margin,i["margin-top"]=e+"px",i["margin-bottom"]=e+"px"):(delete i["margin-top"],delete i["margin-bottom"]),i=tinyMCEPopup.dom.parseStyle(t.serializeStyle(i),"img"),this.styleVal=t.serializeStyle(i,"img"))},getAttrib:function(e,t){var i,n,r=tinyMCEPopup.editor,s=r.dom;if(r.settings.inline_styles)switch(t){case"align":if(i=s.getStyle(e,"float"))return i;if(i=s.getStyle(e,"vertical-align"))return i;break;case"hspace":if(i=s.getStyle(e,"margin-left"),n=s.getStyle(e,"margin-right"),i&&i==n)return parseInt(i.replace(/[^0-9]/g,""));break;case"vspace":if(i=s.getStyle(e,"margin-top"),n=s.getStyle(e,"margin-bottom"),i&&i==n)return parseInt(i.replace(/[^0-9]/g,""));break;case"border":if(i=0,tinymce.each(["top","right","bottom","left"],function(t){return t=s.getStyle(e,"border-"+t+"-width"),!t||t!=i&&0!==i?(i=0,!1):(t&&(i=t),void 0)}),i)return parseInt(i.replace(/[^0-9]/g,""))}return(i=s.getAttrib(e,t))?i:""},resetImageData:function(){var e=document.forms[0];e.width.value=e.height.value=""},updateImageData:function(){var e=document.forms[0],t=ImageDialog;""==e.width.value&&(e.width.value=t.preloadImg.width),""==e.height.value&&(e.height.value=t.preloadImg.height)},getImageData:function(){var e=document.forms[0];this.preloadImg=new Image,this.preloadImg.onload=this.updateImageData,this.preloadImg.onerror=this.resetImageData,this.preloadImg.src=tinyMCEPopup.editor.documentBaseURI.toAbsolute(e.src.value)}};ImageDialog.preInit(),tinyMCEPopup.onInit.add(ImageDialog.init,ImageDialog);