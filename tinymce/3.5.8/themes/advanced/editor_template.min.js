(function(e){function t(e,t){function i(e){return e.replace(/%(\w+)/g,"")}var n,r,s,a=e.dom,l="";return previewStyles=e.settings.preview_styles,previewStyles===!1?"":(previewStyles||(previewStyles="font-family font-size font-weight text-decoration text-transform color background-color"),n=t.block||t.inline||"span",r=a.create(n),o(t.styles,function(e,t){e=i(e),e&&a.setStyle(r,t,e)}),o(t.attributes,function(e,t){e=i(e),e&&a.setAttrib(r,t,e)}),o(t.classes,function(e){e=i(e),a.hasClass(r,e)||a.addClass(r,e)}),a.setStyles(r,{position:"absolute",left:-65535}),e.getBody().appendChild(r),s=a.getStyle(e.getBody(),"fontSize",!0),s=/px$/.test(s)?parseInt(s,10):0,o(previewStyles.split(" "),function(t){var i=a.getStyle(r,t,!0);if("background-color"!=t||!/transparent|rgba\s*\([^)]+,\s*0\)/.test(i)||(i=a.getStyle(e.getBody(),t,!0),"#ffffff"!=a.toHex(i).toLowerCase())){if("font-size"==t&&/em|%$/.test(i)){if(0===s)return;i=parseFloat(i,10)/(/%$/.test(i)?100:1),i=i*s+"px"}l+=t+":"+i+";"}}),a.remove(r),l)}var i,n=e.DOM,r=e.dom.Event,s=e.extend,o=e.each,a=e.util.Cookie,l=e.explode;e.ThemeManager.requireLangPack("advanced"),e.create("tinymce.themes.AdvancedTheme",{sizes:[8,10,12,14,18,24,36],controls:{bold:["bold_desc","Bold"],italic:["italic_desc","Italic"],underline:["underline_desc","Underline"],strikethrough:["striketrough_desc","Strikethrough"],justifyleft:["justifyleft_desc","JustifyLeft"],justifycenter:["justifycenter_desc","JustifyCenter"],justifyright:["justifyright_desc","JustifyRight"],justifyfull:["justifyfull_desc","JustifyFull"],bullist:["bullist_desc","InsertUnorderedList"],numlist:["numlist_desc","InsertOrderedList"],outdent:["outdent_desc","Outdent"],indent:["indent_desc","Indent"],cut:["cut_desc","Cut"],copy:["copy_desc","Copy"],paste:["paste_desc","Paste"],undo:["undo_desc","Undo"],redo:["redo_desc","Redo"],link:["link_desc","mceLink"],unlink:["unlink_desc","unlink"],image:["image_desc","mceImage"],cleanup:["cleanup_desc","mceCleanup"],help:["help_desc","mceHelp"],code:["code_desc","mceCodeEditor"],hr:["hr_desc","InsertHorizontalRule"],removeformat:["removeformat_desc","RemoveFormat"],sub:["sub_desc","subscript"],sup:["sup_desc","superscript"],forecolor:["forecolor_desc","ForeColor"],forecolorpicker:["forecolor_desc","mceForeColor"],backcolor:["backcolor_desc","HiliteColor"],backcolorpicker:["backcolor_desc","mceBackColor"],charmap:["charmap_desc","mceCharMap"],visualaid:["visualaid_desc","mceToggleVisualAid"],anchor:["anchor_desc","mceInsertAnchor"],newdocument:["newdocument_desc","mceNewDocument"],blockquote:["blockquote_desc","mceBlockQuote"]},stateControls:["bold","italic","underline","strikethrough","bullist","numlist","justifyleft","justifycenter","justifyright","justifyfull","sub","sup","blockquote"],init:function(t,i){var r,a,l,c=this;c.editor=t,c.url=i,c.onResolveName=new e.util.Dispatcher(this),r=t.settings,t.forcedHighContrastMode=t.settings.detect_highcontrast&&c._isHighContrast(),t.settings.skin=t.forcedHighContrastMode?"highcontrast":t.settings.skin,r.theme_advanced_buttons1||(r=s({theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,|,styleselect,formatselect",theme_advanced_buttons2:"bullist,numlist,|,outdent,indent,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code",theme_advanced_buttons3:"hr,removeformat,visualaid,|,sub,sup,|,charmap"},r)),c.settings=r=s({theme_advanced_path:!0,theme_advanced_toolbar_location:"top",theme_advanced_blockformats:"p,address,pre,h1,h2,h3,h4,h5,h6",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",theme_advanced_fonts:"Andale Mono=andale mono,times;Arial=arial,helvetica,sans-serif;Arial Black=arial black,avant garde;Book Antiqua=book antiqua,palatino;Comic Sans MS=comic sans ms,sans-serif;Courier New=courier new,courier;Georgia=georgia,palatino;Helvetica=helvetica;Impact=impact,chicago;Symbol=symbol;Tahoma=tahoma,arial,helvetica,sans-serif;Terminal=terminal,monaco;Times New Roman=times new roman,times;Trebuchet MS=trebuchet ms,geneva;Verdana=verdana,geneva;Webdings=webdings;Wingdings=wingdings,zapf dingbats",theme_advanced_more_colors:1,theme_advanced_row_height:23,theme_advanced_resize_horizontal:1,theme_advanced_resizing_use_cookie:1,theme_advanced_font_sizes:"1,2,3,4,5,6,7",theme_advanced_font_selector:"span",theme_advanced_show_current_color:0,readonly:t.settings.readonly},r),r.font_size_style_values||(r.font_size_style_values="8pt,10pt,12pt,14pt,18pt,24pt,36pt"),e.is(r.theme_advanced_font_sizes,"string")&&(r.font_size_style_values=e.explode(r.font_size_style_values),r.font_size_classes=e.explode(r.font_size_classes||""),l={},t.settings.theme_advanced_font_sizes=r.theme_advanced_font_sizes,o(t.getParam("theme_advanced_font_sizes","","hash"),function(e,t){var i;t==e&&e>=1&&7>=e&&(t=e+" ("+c.sizes[e-1]+"pt)",i=r.font_size_classes[e-1],e=r.font_size_style_values[e-1]||c.sizes[e-1]+"pt"),/^\s*\./.test(e)&&(i=e.replace(/\./g,"")),l[t]=i?{"class":i}:{fontSize:e}}),r.theme_advanced_font_sizes=l),(a=r.theme_advanced_path_location)&&"none"!=a&&(r.theme_advanced_statusbar_location=r.theme_advanced_path_location),"none"==r.theme_advanced_statusbar_location&&(r.theme_advanced_statusbar_location=0),t.settings.content_css!==!1&&t.contentCSS.push(t.baseURI.toAbsolute(i+"/skins/"+t.settings.skin+"/content.css")),t.onInit.add(function(){t.settings.readonly||(t.onNodeChange.add(c._nodeChanged,c),t.onKeyUp.add(c._updateUndoStatus,c),t.onMouseUp.add(c._updateUndoStatus,c),t.dom.bind(t.dom.getRoot(),"dragend",function(){c._updateUndoStatus(t)}))}),t.onSetProgressState.add(function(e,t,i){var r,s,o=e.id;t?c.progressTimer=setTimeout(function(){r=e.getContainer(),r=r.insertBefore(n.create("DIV",{style:"position:relative"}),r.firstChild),s=n.get(e.id+"_tbl"),n.add(r,"div",{id:o+"_blocker","class":"mceBlocker",style:{width:s.clientWidth+2,height:s.clientHeight+2}}),n.add(r,"div",{id:o+"_progress","class":"mceProgress",style:{left:s.clientWidth/2,top:s.clientHeight/2}})},i||0):(n.remove(o+"_blocker"),n.remove(o+"_progress"),clearTimeout(c.progressTimer))}),n.loadCSS(r.editor_css?t.documentBaseURI.toAbsolute(r.editor_css):i+"/skins/"+t.settings.skin+"/ui.css"),r.skin_variant&&n.loadCSS(i+"/skins/"+t.settings.skin+"/ui_"+r.skin_variant+".css")},_isHighContrast:function(){var e,t=n.add(n.getRoot(),"div",{style:"background-color: rgb(171,239,86);"});return e=(n.getStyle(t,"background-color",!0)+"").toLowerCase().replace(/ /g,""),n.remove(t),"rgb(171,239,86)"!=e&&"#abef56"!=e},createControl:function(e,t){var i,n;if(n=t.createControl(e))return n;switch(e){case"styleselect":return this._createStyleSelect();case"formatselect":return this._createBlockFormats();case"fontselect":return this._createFontSelect();case"fontsizeselect":return this._createFontSizeSelect();case"forecolor":return this._createForeColorMenu();case"backcolor":return this._createBackColorMenu()}return(i=this.controls[e])?t.createButton(e,{title:"advanced."+i[0],cmd:i[1],ui:i[2],value:i[3]}):void 0},execCommand:function(e,t,i){var n=this["_"+e];return n?(n.call(this,t,i),!0):!1},_importClasses:function(){var e=this.editor,i=e.controlManager.get("styleselect");0==i.getLength()&&o(e.dom.getClasses(),function(n,r){var s,o="style_"+r;s={inline:"span",attributes:{"class":n["class"]},selector:"*"},e.formatter.register(o,s),i.add(n["class"],o,{style:function(){return t(e,s)}})})},_createStyleSelect:function(){var i,n=this,s=n.editor,a=s.controlManager;return i=a.createListBox("styleselect",{title:"advanced.style_select",onselect:function(t){var n,r,a=[];return o(i.items,function(e){a.push(e.value)}),s.focus(),s.undoManager.add(),n=s.formatter.matchAll(a),e.each(n,function(e){t&&e!=t||(e&&s.formatter.remove(e),r=!0)}),r||s.formatter.apply(t),s.undoManager.add(),s.nodeChanged(),!1}}),s.onPreInit.add(function(){var e=0,r=s.getParam("style_formats");r?o(r,function(n){var r,a=0;o(n,function(){a++}),a>1?(r=n.name=n.name||"style_"+e++,s.formatter.register(r,n),i.add(n.title,r,{style:function(){return t(s,n)}})):i.add(n.title)}):o(s.getParam("theme_advanced_styles","","hash"),function(r,o){var a,l;r&&(a="style_"+e++,l={inline:"span",classes:r,selector:"*"},s.formatter.register(a,l),i.add(n.editor.translate(o),a,{style:function(){return t(s,l)}}))})}),0==i.getLength()&&i.onPostRender.add(function(e,t){i.NativeListBox?r.add(t.id,"focus",n._importClasses,n):(r.add(t.id+"_text","focus",n._importClasses,n),r.add(t.id+"_text","mousedown",n._importClasses,n),r.add(t.id+"_open","focus",n._importClasses,n),r.add(t.id+"_open","mousedown",n._importClasses,n))}),i},_createFontSelect:function(){var e,t=this,i=t.editor;return e=i.controlManager.createListBox("fontselect",{title:"advanced.fontdefault",onselect:function(t){var n=e.items[e.selectedIndex];return!t&&n?(i.execCommand("FontName",!1,n.value),void 0):(i.execCommand("FontName",!1,t),e.select(function(e){return t==e}),n&&n.value==t&&e.select(null),!1)}}),e&&o(i.getParam("theme_advanced_fonts",t.settings.theme_advanced_fonts,"hash"),function(t,n){e.add(i.translate(n),t,{style:-1==t.indexOf("dings")?"font-family:"+t:""})}),e},_createFontSizeSelect:function(){var e,t=this,i=t.editor,n=0;return e=i.controlManager.createListBox("fontsizeselect",{title:"advanced.font_size",onselect:function(t){var n=e.items[e.selectedIndex];return!t&&n?(n=n.value,n["class"]?(i.formatter.toggle("fontsize_class",{value:n["class"]}),i.undoManager.add(),i.nodeChanged()):i.execCommand("FontSize",!1,n.fontSize),void 0):(t["class"]?(i.focus(),i.undoManager.add(),i.formatter.toggle("fontsize_class",{value:t["class"]}),i.undoManager.add(),i.nodeChanged()):i.execCommand("FontSize",!1,t.fontSize),e.select(function(e){return t==e}),n&&(n.value.fontSize==t.fontSize||n.value["class"]&&n.value["class"]==t["class"])&&e.select(null),!1)}}),e&&o(t.settings.theme_advanced_font_sizes,function(i,r){var s=i.fontSize;s>=1&&7>=s&&(s=t.sizes[parseInt(s)-1]+"pt"),e.add(r,i,{style:"font-size:"+s,"class":"mceFontSize"+n++ +(" "+(i["class"]||""))})}),e},_createBlockFormats:function(){var e,i={p:"advanced.paragraph",address:"advanced.address",pre:"advanced.pre",h1:"advanced.h1",h2:"advanced.h2",h3:"advanced.h3",h4:"advanced.h4",h5:"advanced.h5",h6:"advanced.h6",div:"advanced.div",blockquote:"advanced.blockquote",code:"advanced.code",dt:"advanced.dt",dd:"advanced.dd",samp:"advanced.samp"},n=this;return e=n.editor.controlManager.createListBox("formatselect",{title:"advanced.block",onselect:function(e){return n.editor.execCommand("FormatBlock",!1,e),!1}}),e&&o(n.editor.getParam("theme_advanced_blockformats",n.settings.theme_advanced_blockformats,"hash"),function(r,s){e.add(n.editor.translate(s!=r?s:i[r]),r,{"class":"mce_formatPreview mce_"+r,style:function(){return t(n.editor,{block:r})}})}),e},_createForeColorMenu:function(){var e,t,i=this,n=i.settings,r={};return n.theme_advanced_more_colors&&(r.more_colors_func=function(){i._mceColorPicker(0,{color:e.value,func:function(t){e.setColor(t)}})}),(t=n.theme_advanced_text_colors)&&(r.colors=t),n.theme_advanced_default_foreground_color&&(r.default_color=n.theme_advanced_default_foreground_color),r.title="advanced.forecolor_desc",r.cmd="ForeColor",r.scope=this,e=i.editor.controlManager.createColorSplitButton("forecolor",r)},_createBackColorMenu:function(){var e,t,i=this,n=i.settings,r={};return n.theme_advanced_more_colors&&(r.more_colors_func=function(){i._mceColorPicker(0,{color:e.value,func:function(t){e.setColor(t)}})}),(t=n.theme_advanced_background_colors)&&(r.colors=t),n.theme_advanced_default_background_color&&(r.default_color=n.theme_advanced_default_background_color),r.title="advanced.backcolor_desc",r.cmd="HiliteColor",r.scope=this,e=i.editor.controlManager.createColorSplitButton("backcolor",r)},renderUI:function(t){var i,s,a,l,c,h,u=this,d=u.editor,p=u.settings;switch(d.settings&&(d.settings.aria_label=p.aria_label+d.getLang("advanced.help_shortcut")),i=c=n.create("span",{role:"application","aria-labelledby":d.id+"_voice",id:d.id+"_parent","class":"mceEditor "+d.settings.skin+"Skin"+(p.skin_variant?" "+d.settings.skin+"Skin"+u._ufirst(p.skin_variant):"")+("rtl"==d.settings.directionality?" mceRtl":"")}),n.add(i,"span",{"class":"mceVoiceLabel",style:"display:none;",id:d.id+"_voice"},p.aria_label),n.boxModel||(i=n.add(i,"div",{"class":"mceOldBoxModel"})),i=l=n.add(i,"table",{role:"presentation",id:d.id+"_tbl","class":"mceLayout",cellSpacing:0,cellPadding:0}),i=a=n.add(i,"tbody"),(p.theme_advanced_layout_manager||"").toLowerCase()){case"rowlayout":s=u._rowLayout(p,a,t);break;case"customlayout":s=d.execCallback("theme_advanced_custom_layout",p,a,t,c);break;default:s=u._simpleLayout(p,a,t,c)}return i=t.targetNode,h=l.rows,n.addClass(h[0],"mceFirst"),n.addClass(h[h.length-1],"mceLast"),o(n.select("tr",a),function(e){n.addClass(e.firstChild,"mceFirst"),n.addClass(e.childNodes[e.childNodes.length-1],"mceLast")}),n.get(p.theme_advanced_toolbar_container)?n.get(p.theme_advanced_toolbar_container).appendChild(c):n.insertAfter(c,i),r.add(d.id+"_path_row","click",function(e){return e=e.target,"A"==e.nodeName?(u._sel(e.className.replace(/^.*mcePath_([0-9]+).*$/,"$1")),!1):void 0}),d.getParam("accessibility_focus")||r.add(n.add(c,"a",{href:"#"},"<!-- IE -->"),"focus",function(){tinyMCE.get(d.id).focus()}),"external"==p.theme_advanced_toolbar_location&&(t.deltaHeight=0),u.deltaHeight=t.deltaHeight,t.targetNode=null,d.onKeyDown.add(function(t,i){var s=121,o=122;if(i.altKey){if(i.keyCode===s)return e.isWebKit&&window.focus(),u.toolbarGroup.focus(),r.cancel(i);if(i.keyCode===o)return n.get(t.id+"_path_row").focus(),r.cancel(i)}}),d.addShortcut("alt+0","","mceShortcuts",u),{iframeContainer:s,editorContainer:d.id+"_parent",sizeContainer:l,deltaHeight:t.deltaHeight}},getInfo:function(){return{longname:"Advanced theme",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",version:e.majorVersion+"."+e.minorVersion}},resizeBy:function(e,t){var i=n.get(this.editor.id+"_ifr");this.resizeTo(i.clientWidth+e,i.clientHeight+t)},resizeTo:function(e,t,i){var r=this.editor,s=this.settings,o=n.get(r.id+"_tbl"),l=n.get(r.id+"_ifr");e=Math.max(s.theme_advanced_resizing_min_width||100,e),t=Math.max(s.theme_advanced_resizing_min_height||100,t),e=Math.min(s.theme_advanced_resizing_max_width||65535,e),t=Math.min(s.theme_advanced_resizing_max_height||65535,t),n.setStyle(o,"height",""),n.setStyle(l,"height",t),s.theme_advanced_resize_horizontal&&(n.setStyle(o,"width",""),n.setStyle(l,"width",e),o.clientWidth>e&&(e=o.clientWidth,n.setStyle(l,"width",o.clientWidth))),i&&s.theme_advanced_resizing_use_cookie&&a.setHash("TinyMCE_"+r.id+"_size",{cw:e,ch:t})},destroy:function(){var e=this.editor.id;r.clear(e+"_resize"),r.clear(e+"_path_row"),r.clear(e+"_external_close")},_simpleLayout:function(e,t,s,o){var a,l,c,h,u=this,d=u.editor,p=e.theme_advanced_toolbar_location,f=e.theme_advanced_statusbar_location;return e.readonly?(a=n.add(t,"tr"),a=l=n.add(a,"td",{"class":"mceIframeContainer"}),l):("top"==p&&u._addToolbars(t,s),"external"==p&&(a=h=n.create("div",{style:"position:relative"}),a=n.add(a,"div",{id:d.id+"_external","class":"mceExternalToolbar"}),n.add(a,"a",{id:d.id+"_external_close",href:"javascript:;","class":"mceExternalClose"}),a=n.add(a,"table",{id:d.id+"_tblext",cellSpacing:0,cellPadding:0}),c=n.add(a,"tbody"),"mceOldBoxModel"==o.firstChild.className?o.firstChild.appendChild(h):o.insertBefore(h,o.firstChild),u._addToolbars(c,s),d.onMouseUp.add(function(){var e=n.get(d.id+"_external");n.show(e),n.hide(i);var t=r.add(d.id+"_external_close","click",function(){return n.hide(d.id+"_external"),r.remove(d.id+"_external_close","click",t),!1});n.show(e),n.setStyle(e,"top",0-n.getRect(d.id+"_tblext").h-1),n.hide(e),n.show(e),e.style.filter="",i=d.id+"_external",e=null})),"top"==f&&u._addStatusBar(t,s),e.theme_advanced_toolbar_container||(a=n.add(t,"tr"),a=l=n.add(a,"td",{"class":"mceIframeContainer"})),"bottom"==p&&u._addToolbars(t,s),"bottom"==f&&u._addStatusBar(t,s),l)},_rowLayout:function(e,t,i){var r,s,a,c,h,u,d=this,p=d.editor,f=p.controlManager;return r=e.theme_advanced_containers_default_class||"",s=e.theme_advanced_containers_default_align||"center",o(l(e.theme_advanced_containers||""),function(o,l){var p=e["theme_advanced_container_"+o]||"";switch(o.toLowerCase()){case"mceeditor":a=n.add(t,"tr"),a=c=n.add(a,"td",{"class":"mceIframeContainer"});break;case"mceelementpath":d._addStatusBar(t,i);break;default:u=(e["theme_advanced_container_"+o+"_align"]||s).toLowerCase(),u="mce"+d._ufirst(u),a=n.add(n.add(t,"tr"),"td",{"class":"mceToolbar "+(e["theme_advanced_container_"+o+"_class"]||r)+" "+u||s}),h=f.createToolbar("toolbar"+l),d._addControls(p,h),n.setHTML(a,h.renderHTML()),i.deltaHeight-=e.theme_advanced_row_height}}),c},_addControls:function(e,t){var i,n=this,r=n.settings,s=n.editor.controlManager;r.theme_advanced_disable&&!n._disabled?(i={},o(l(r.theme_advanced_disable),function(e){i[e]=1}),n._disabled=i):i=n._disabled,o(l(e),function(e){var r;if(!i||!i[e]){if("tablecontrols"==e)return o(["table","|","row_props","cell_props","|","row_before","row_after","delete_row","|","col_before","col_after","delete_col","|","split_cells","merge_cells"],function(e){e=n.createControl(e,s),e&&t.add(e)}),void 0;r=n.createControl(e,s),r&&t.add(r)}})},_addToolbars:function(e,t){var i,r,s,o,a,l,c=this,h=c.editor,u=c.settings,d=h.controlManager,p=[],f=!1;for(l=d.createToolbarGroup("toolbargroup",{name:h.getLang("advanced.toolbar"),tab_focus_toolbar:h.getParam("theme_advanced_tab_focus_toolbar")}),c.toolbarGroup=l,a=u.theme_advanced_toolbar_align.toLowerCase(),a="mce"+c._ufirst(a),o=n.add(n.add(e,"tr",{role:"presentation"}),"td",{"class":"mceToolbar "+a,role:"toolbar"}),i=1;s=u["theme_advanced_buttons"+i];i++)f=!0,r=d.createToolbar("toolbar"+i,{"class":"mceToolbarRow"+i}),u["theme_advanced_buttons"+i+"_add"]&&(s+=","+u["theme_advanced_buttons"+i+"_add"]),u["theme_advanced_buttons"+i+"_add_before"]&&(s=u["theme_advanced_buttons"+i+"_add_before"]+","+s),c._addControls(s,r),l.add(r),t.deltaHeight-=u.theme_advanced_row_height;f||(t.deltaHeight-=u.theme_advanced_row_height),p.push(l.renderHTML()),p.push(n.createHTML("a",{href:"#",accesskey:"z",title:h.getLang("advanced.toolbar_focus"),onfocus:"tinyMCE.getInstanceById('"+h.id+"').focus();"},"<!-- IE -->")),n.setHTML(o,p.join(""))},_addStatusBar:function(e,t){var i,s,o=this,l=o.editor,c=o.settings;i=n.add(e,"tr"),i=s=n.add(i,"td",{"class":"mceStatusbar"}),i=n.add(i,"div",{id:l.id+"_path_row",role:"group","aria-labelledby":l.id+"_path_voice"}),c.theme_advanced_path?(n.add(i,"span",{id:l.id+"_path_voice"},l.translate("advanced.path")),n.add(i,"span",{},": ")):n.add(i,"span",{},"&#160;"),c.theme_advanced_resizing&&(n.add(s,"a",{id:l.id+"_resize",href:"javascript:;",onclick:"return false;","class":"mceResize",tabIndex:"-1"}),c.theme_advanced_resizing_use_cookie&&l.onPostRender.add(function(){var e=a.getHash("TinyMCE_"+l.id+"_size");n.get(l.id+"_tbl"),e&&o.resizeTo(e.cw,e.ch)}),l.onPostRender.add(function(){r.add(l.id+"_resize","click",function(e){e.preventDefault()}),r.add(l.id+"_resize","mousedown",function(e){function t(e){e.preventDefault(),m=p+(e.screenX-u),g=f+(e.screenY-d),o.resizeTo(m,g)}function i(e){r.remove(n.doc,"mousemove",s),r.remove(l.getDoc(),"mousemove",a),r.remove(n.doc,"mouseup",c),r.remove(l.getDoc(),"mouseup",h),m=p+(e.screenX-u),g=f+(e.screenY-d),o.resizeTo(m,g,!0),l.nodeChanged()}var s,a,c,h,u,d,p,f,m,g,y;e.preventDefault(),u=e.screenX,d=e.screenY,y=n.get(o.editor.id+"_ifr"),p=m=y.clientWidth,f=g=y.clientHeight,s=r.add(n.doc,"mousemove",t),a=r.add(l.getDoc(),"mousemove",t),c=r.add(n.doc,"mouseup",i),h=r.add(l.getDoc(),"mouseup",i)})})),t.deltaHeight-=21,i=e=null},_updateUndoStatus:function(e){var t=e.controlManager,i=e.undoManager;t.setDisabled("undo",!i.hasUndo()&&!i.typing),t.setDisabled("redo",!i.hasRedo())},_nodeChanged:function(t,i,r,s,a){function l(e){var t,i=a.parents,n=e;for("string"==typeof e&&(n=function(t){return t.nodeName==e}),t=0;i.length>t;t++)if(n(i[t]))return i[t]}function c(e,t){(d=i.get(e))&&(t||(t=d.settings.default_color),t!==d.value&&d.displayColor(t))}function c(e,t){(d=i.get(e))&&(t||(t=d.settings.default_color),t!==d.value&&d.displayColor(t))}var h,u,d,p,f,m,g,y,v,b,x=this,L=0,w=x.settings;e.each(x.stateControls,function(e){i.setActive(e,t.queryCommandState(x.controls[e][1]))}),i.setActive("visualaid",t.hasVisual),x._updateUndoStatus(t),i.setDisabled("outdent",!t.queryCommandState("Outdent")),h=l("A"),(d=i.get("link"))&&(d.setDisabled(!h&&s||h&&!h.href),d.setActive(!!h&&!h.name&&!h.id)),(d=i.get("unlink"))&&(d.setDisabled(!h&&s),d.setActive(!!h&&!h.name&&!h.id)),(d=i.get("anchor"))&&d.setActive(!s&&!!h&&(h.name||h.id&&!h.href)),h=l("IMG"),(d=i.get("image"))&&d.setActive(!s&&!!h&&-1==r.className.indexOf("mceItem")),(d=i.get("styleselect"))&&(x._importClasses(),v=[],o(d.items,function(e){v.push(e.value)}),b=t.formatter.matchAll(v),d.select(b[0]),e.each(b,function(e,t){t>0&&d.mark(e)})),(d=i.get("formatselect"))&&(h=l(t.dom.isBlock),h&&d.select(h.nodeName.toLowerCase())),l(function(e){return"SPAN"===e.nodeName&&!p&&e.className&&(p=e.className),t.dom.is(e,w.theme_advanced_font_selector)&&(!f&&e.style.fontSize&&(f=e.style.fontSize),!m&&e.style.fontFamily&&(m=e.style.fontFamily.replace(/[\"\']+/g,"").replace(/^([^,]+).*/,"$1").toLowerCase()),!g&&e.style.color&&(g=e.style.color),!y&&e.style.backgroundColor&&(y=e.style.backgroundColor)),!1}),(d=i.get("fontselect"))&&d.select(function(e){return e.replace(/^([^,]+).*/,"$1").toLowerCase()==m}),(d=i.get("fontsizeselect"))&&(!w.theme_advanced_runtime_fontsize||f||p||(f=t.dom.getStyle(r,"fontSize",!0)),d.select(function(e){return e.fontSize&&e.fontSize===f?!0:e["class"]&&e["class"]===p?!0:void 0})),w.theme_advanced_show_current_color&&(c("forecolor",g),c("backcolor",y)),w.theme_advanced_show_current_color&&(c("forecolor",g),c("backcolor",y)),w.theme_advanced_path&&w.theme_advanced_statusbar_location&&(h=n.get(t.id+"_path")||n.add(t.id+"_path_row","span",{id:t.id+"_path"}),x.statusKeyboardNavigation&&(x.statusKeyboardNavigation.destroy(),x.statusKeyboardNavigation=null),n.setHTML(h,""),l(function(i){var r,s=i.nodeName.toLowerCase(),o="";if(!(1!=i.nodeType||"br"===s||i.getAttribute("data-mce-bogus")||n.hasClass(i,"mceItemHidden")||n.hasClass(i,"mceItemRemoved"))){switch(e.isIE&&"HTML"!==i.scopeName&&i.scopeName&&(s=i.scopeName+":"+s),s=s.replace(/mce\:/g,"")){case"b":s="strong";break;case"i":s="em";break;case"img":(u=n.getAttrib(i,"src"))&&(o+="src: "+u+" ");break;case"a":(u=n.getAttrib(i,"name"))&&(o+="name: "+u+" ",s+="#"+u),(u=n.getAttrib(i,"href"))&&(o+="href: "+u+" ");break;case"font":(u=n.getAttrib(i,"face"))&&(o+="font: "+u+" "),(u=n.getAttrib(i,"size"))&&(o+="size: "+u+" "),(u=n.getAttrib(i,"color"))&&(o+="color: "+u+" ");break;case"span":(u=n.getAttrib(i,"style"))&&(o+="style: "+u+" ")}(u=n.getAttrib(i,"id"))&&(o+="id: "+u+" "),(u=i.className)&&(u=u.replace(/\b\s*(webkit|mce|Apple-)\w+\s*\b/g,""),u&&(o+="class: "+u+" ",(t.dom.isBlock(i)||"img"==s||"span"==s)&&(s+="."+u))),s=s.replace(/(html:)/g,""),s={name:s,node:i,title:o},x.onResolveName.dispatch(x,s),o=s.title,s=s.name,r=n.create("a",{href:"javascript:;",role:"button",onmousedown:"return false;",title:o,"class":"mcePath_"+L++},s),h.hasChildNodes()?(h.insertBefore(n.create("span",{"aria-hidden":"true"}," » "),h.firstChild),h.insertBefore(r,h.firstChild)):h.appendChild(r)}},t.getBody()),n.select("a",h).length>0&&(x.statusKeyboardNavigation=new e.ui.KeyboardNavigation({root:t.id+"_path_row",items:n.select("a",h),excludeFromTabOrder:!0,onCancel:function(){t.focus()}},n)))},_sel:function(e){this.editor.execCommand("mceSelectNodeDepth",!1,e)},_mceInsertAnchor:function(){var e=this.editor;e.windowManager.open({url:this.url+"/anchor.htm",width:320+parseInt(e.getLang("advanced.anchor_delta_width",0)),height:90+parseInt(e.getLang("advanced.anchor_delta_height",0)),inline:!0},{theme_url:this.url})},_mceCharMap:function(){var e=this.editor;e.windowManager.open({url:this.url+"/charmap.htm",width:550+parseInt(e.getLang("advanced.charmap_delta_width",0)),height:265+parseInt(e.getLang("advanced.charmap_delta_height",0)),inline:!0},{theme_url:this.url})},_mceHelp:function(){var e=this.editor;e.windowManager.open({url:this.url+"/about.htm",width:480,height:380,inline:!0},{theme_url:this.url})},_mceShortcuts:function(){var e=this.editor;e.windowManager.open({url:this.url+"/shortcuts.htm",width:480,height:380,inline:!0},{theme_url:this.url})},_mceColorPicker:function(e,t){var i=this.editor;t=t||{},i.windowManager.open({url:this.url+"/color_picker.htm",width:375+parseInt(i.getLang("advanced.colorpicker_delta_width",0)),height:250+parseInt(i.getLang("advanced.colorpicker_delta_height",0)),close_previous:!1,inline:!0},{input_color:t.color,func:t.func,theme_url:this.url})},_mceCodeEditor:function(){var e=this.editor;e.windowManager.open({url:this.url+"/source_editor.htm",width:parseInt(e.getParam("theme_advanced_source_editor_width",720)),height:parseInt(e.getParam("theme_advanced_source_editor_height",580)),inline:!0,resizable:!0,maximizable:!0},{theme_url:this.url})},_mceImage:function(){var e=this.editor;-1==e.dom.getAttrib(e.selection.getNode(),"class","").indexOf("mceItem")&&e.windowManager.open({url:this.url+"/image.htm",width:355+parseInt(e.getLang("advanced.image_delta_width",0)),height:275+parseInt(e.getLang("advanced.image_delta_height",0)),inline:!0},{theme_url:this.url})},_mceLink:function(){var e=this.editor;e.windowManager.open({url:this.url+"/link.htm",width:310+parseInt(e.getLang("advanced.link_delta_width",0)),height:200+parseInt(e.getLang("advanced.link_delta_height",0)),inline:!0},{theme_url:this.url})},_mceNewDocument:function(){var e=this.editor;e.windowManager.confirm("advanced.newdocument",function(t){t&&e.execCommand("mceSetContent",!1,"")})},_mceForeColor:function(){var e=this;this._mceColorPicker(0,{color:e.fgColor,func:function(t){e.fgColor=t,e.editor.execCommand("ForeColor",!1,t)}})},_mceBackColor:function(){var e=this;this._mceColorPicker(0,{color:e.bgColor,func:function(t){e.bgColor=t,e.editor.execCommand("HiliteColor",!1,t)}})},_ufirst:function(e){return e.substring(0,1).toUpperCase()+e.substring(1)}}),e.ThemeManager.add("advanced",e.themes.AdvancedTheme)})(tinymce);