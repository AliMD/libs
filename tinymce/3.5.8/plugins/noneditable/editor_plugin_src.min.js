(function(){function e(e){function i(e){var t;if(1===e.nodeType){if(t=e.getAttribute(n),t&&"inherit"!==t)return t;if(t=e.contentEditable,"inherit"!==t)return t}return null}function s(e){for(var t;e;){if(t=i(e))return"false"===t?e:null;e=e.parentNode}}function o(e){for(;e;){if(e.id===m)return e;e=e.parentNode}}function a(e){var i;if(e)for(i=new t(e,e),e=i.current();e;e=i.next())if(3===e.nodeType)return e}function l(t,n){var r,s;return"false"===i(t)&&p.isBlock(t)?(f.select(t),void 0):(s=p.createRng(),"true"===i(t)&&(t.firstChild||t.appendChild(e.getDoc().createTextNode(" ")),t=t.firstChild,n=!0),r=p.create("span",{id:m,"data-mce-bogus":!0},d),n?t.parentNode.insertBefore(r,t):p.insertAfter(r,t),s.setStart(r.firstChild,1),s.collapse(!0),f.setRng(s),r)}function h(e){var t,i,n;if(e)rng=f.getRng(!0),rng.setStartBefore(e),rng.setEndBefore(e),t=a(e),t&&t.nodeValue.charAt(0)==d&&(t=t.deleteData(0,1)),p.remove(e,!0),f.setRng(rng);else for(i=o(f.getStart());(e=p.get(m))&&e!==n;)i!==e&&(t=a(e),t&&t.nodeValue.charAt(0)==d&&(t=t.deleteData(0,1)),p.remove(e,!0)),n=e}function c(){function e(e,n){var r,s,o,l,h;if(r=a.startContainer,s=a.startOffset,3==r.nodeType){if(h=r.nodeValue.length,s>0&&h>s||(n?s==h:0==s))return}else{if(!(r.childNodes.length>s))return n?null:e;var c=!n&&s>0?s-1:s;r=r.childNodes[c],r.hasChildNodes()&&(r=r.firstChild)}for(o=new t(r,e);l=o[n?"prev":"next"]();){if(3===l.nodeType&&l.nodeValue.length>0)return;if("true"===i(l))return l}return e}var n,r,o,a,c;h(),o=f.isCollapsed(),n=s(f.getStart()),r=s(f.getEnd()),(n||r)&&(a=f.getRng(!0),o?(n=n||r,f.getStart(),(c=e(n,!0))?l(c,!0):(c=e(n,!1))?l(c,!1):f.select(n)):(a=f.getRng(!0),n&&a.setStartBefore(n),r&&a.setEndAfter(r),f.setRng(a)))}function u(e,n){function a(e,t){for(;e=e[t?"previousSibling":"nextSibling"];)if(3!==e.nodeType||e.nodeValue.length>0)return e}function l(e,t){f.select(e),f.collapse(t)}function u(t){function n(e){for(var t=l;t;){if(t===e)return;t=t.parentNode}p.remove(e),c()}function r(){var r,o,a=e.schema.getNonEmptyElements();for(o=new tinymce.dom.TreeWalker(l,e.getBody());(r=t?o.prev():o.next())&&!a[r.nodeName.toLowerCase()]&&!(3===r.nodeType&&tinymce.trim(r.nodeValue).length>0);)if("false"===i(r))return n(r),!0;return s(r)?!0:!1}var a,l,h,u;if(f.isCollapsed()){if(a=f.getRng(!0),l=a.startContainer,h=a.startOffset,l=o(l)||l,u=s(l))return n(u),!1;if(3==l.nodeType&&(t?h>0:l.nodeValue.length>h))return!0;if(1==l.nodeType&&(l=l.childNodes[h]||l),r())return!1}return!0}var d,m,g,y,v=n.keyCode;if(g=f.getStart(),y=f.getEnd(),d=s(g)||s(y),d&&(112>v||v>124)&&v!=r.DELETE&&v!=r.BACKSPACE){if((tinymce.isMac?n.metaKey:n.ctrlKey)&&(67==v||88==v||86==v))return;if(n.preventDefault(),v==r.LEFT||v==r.RIGHT){var b=v==r.LEFT;if(e.dom.isBlock(d)){var x=b?d.previousSibling:d.nextSibling,L=new t(x,x),w=b?L.prev():L.next();l(w,!b)}else l(d,b)}}else if(v==r.LEFT||v==r.RIGHT||v==r.BACKSPACE||v==r.DELETE){if(m=o(g)){if(v==r.LEFT||v==r.BACKSPACE)if(d=a(m,!0),d&&"false"===i(d)){if(n.preventDefault(),v!=r.LEFT)return p.remove(d),void 0;l(d,!0)}else h(m);if(v==r.RIGHT||v==r.DELETE)if(d=a(m),d&&"false"===i(d)){if(n.preventDefault(),v!=r.RIGHT)return p.remove(d),void 0;l(d,!1)}else h(m)}if((v==r.BACKSPACE||v==r.DELETE)&&!u(v==r.BACKSPACE))return n.preventDefault(),!1}}var d,p=e.dom,f=e.selection,m="mce_noneditablecaret",d="﻿";e.onMouseDown.addToTop(function(e,t){var n=e.selection.getNode();"false"===i(n)&&n==t.target&&c()}),e.onMouseUp.addToTop(c),e.onKeyDown.addToTop(u),e.onKeyUp.addToTop(c)}var t=tinymce.dom.TreeWalker,i="contenteditable",n="data-mce-"+i,r=tinymce.VK;tinymce.create("tinymce.plugins.NonEditablePlugin",{init:function(t){function r(e,t){var i=a.length,n=t.content,r=tinymce.trim(o);if("raw"!=t.format){for(;i--;)n=n.replace(a[i],function(t){var i=arguments,s=i[i.length-2];return s>0&&'"'==n.charAt(s-1)?t:'<span class="'+r+'" data-mce-content="'+e.dom.encode(i[0])+'">'+e.dom.encode("string"==typeof i[1]?i[1]:i[0])+"</span>"});t.content=n}}var s,o,a;s=" "+tinymce.trim(t.getParam("noneditable_editable_class","mceEditable"))+" ",o=" "+tinymce.trim(t.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",a=t.getParam("noneditable_regexp"),a&&!a.length&&(a=[a]),t.onPreInit.add(function(){e(t),a&&(t.selection.onBeforeSetContent.add(r),t.onBeforeSetContent.add(r)),t.parser.addAttributeFilter("class",function(e){for(var t,i,r=e.length;r--;)i=e[r],t=" "+i.attr("class")+" ",-1!==t.indexOf(s)?i.attr(n,"true"):-1!==t.indexOf(o)&&i.attr(n,"false")}),t.serializer.addAttributeFilter(n,function(e){for(var t,r=e.length;r--;)t=e[r],a&&t.attr("data-mce-content")?(t.name="#text",t.type=3,t.raw=!0,t.value=t.attr("data-mce-content")):(t.attr(i,null),t.attr(n,null))}),t.parser.addAttributeFilter(i,function(e){for(var t,r=e.length;r--;)t=e[r],t.attr(n,t.attr(i)),t.attr(i,null)})})},getInfo:function(){return{longname:"Non editable elements",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/noneditable",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("noneditable",tinymce.plugins.NonEditablePlugin)})();