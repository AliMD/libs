(function(){function e(e,t){for(;e&&(8===e.nodeType||3===e.nodeType&&/^[ \t\n\r]*$/.test(e.nodeValue));)e=t(e);return e}function t(t){return e(t,function(e){return e.previousSibling})}function i(t){return e(t,function(e){return e.nextSibling})}function n(e,t,i){return e.dom.getParent(t,function(e){return-1!==tinymce.inArray(i,e)})}function r(e){return e&&("OL"===e.tagName||"UL"===e.tagName)}function s(e,i){var n,s,o;for(n=t(e.lastChild);r(n);)s=n,n=t(s.previousSibling);return s&&(o=i.create("li",{style:"list-style-type: none;"}),i.split(e,s),i.insertAfter(o,s),o.appendChild(s),o.appendChild(s),e=o.previousSibling),e}function o(e,t,i){return e=a(e,t,i),l(e,t,i)}function a(e,i,n){var r=t(e.previousSibling);return r?h(r,e,i?r:!1,n):e}function l(e,t,n){var r=i(e.nextSibling);return r?h(e,r,t?r:!1,n):e}function h(e,t,i,n){return c(e,t,!!i,n)?p(e,t,i):(e&&"LI"===e.tagName&&r(t)&&e.appendChild(t),t)}function c(e,t,i,n){return e&&t?"LI"===e.tagName&&"LI"===t.tagName?"none"===t.style.listStyleType||d(t):r(e)?e.tagName===t.tagName&&(i||e.style.listStyleType===t.style.listStyleType)||u(t):n&&"P"===e.tagName&&"P"===t.tagName:!1}function u(e){var n=i(e.firstChild),s=t(e.lastChild);return n&&s&&r(e)&&n===s&&(r(n)||"none"===n.style.listStyleType||d(n))}function d(e){var n=i(e.firstChild),s=t(e.lastChild);return n&&s&&n===s&&r(n)}function p(e,n,r){var s=t(e.lastChild),o=i(n.firstChild);for("P"===e.tagName&&e.appendChild(e.ownerDocument.createElement("br"));n.firstChild;)e.appendChild(n.firstChild);return r&&(e.style.listStyleType=r.style.listStyleType),n.parentNode.removeChild(n),h(s,o,!1),e}function f(e,t){var i;return t.is(e,"li,ol,ul")||(i=t.getParent(e,"li"),i&&(e=i)),e}var m,g=tinymce.each,y=tinymce.dom.Event;tinymce.create("tinymce.plugins.Lists",{init:function(e){function t(t){return t.keyCode===tinymce.VK.TAB&&!(t.altKey||t.ctrlKey)&&(e.queryCommandState("InsertUnorderedList")||e.queryCommandState("InsertOrderedList"))}function i(){var e=o(),t=e.parentNode.parentNode,i=e.parentNode.lastChild===e;return i&&!n(t)&&a(e)}function n(e){return r(e)?e.parentNode&&"LI"===e.parentNode.tagName:"LI"===e.tagName}function s(){return e.selection.isCollapsed()&&a(o())}function o(){var t=e.selection.getStart();return"BR"!=t.tagName&&""!=t.tagName||"LI"!=t.parentNode.tagName?t:t.parentNode}function a(e){var t=e.childNodes.length;return"LI"===e.tagName?0==t?!0:1==t&&(""==e.firstChild.tagName||"BR"==e.firstChild.tagName||l(e)):!1}function l(e){var t=tinymce.grep(e.parentNode.childNodes,function(e){return"LI"==e.tagName}),i=e==t[t.length-1],n=e.firstChild;return tinymce.isIE9&&i&&(n.nodeValue==String.fromCharCode(160)||n.nodeValue==String.fromCharCode(32))}function h(e){return e.keyCode===tinymce.VK.ENTER}function c(e){return h(e)&&!e.shiftKey}function u(e){return t(e)?S:c(e)&&i()?_:c(e)&&s()?E:_}function d(e,t){(T==S||T==E||tinymce.isGecko&&T==O)&&y.cancel(t)}function p(){var t=e.selection.getRng(!0),i=t.startContainer;if(3==i.nodeType){var n=i.nodeValue;return tinymce.isIE9&&n.length>1&&32==n.charCodeAt(n.length-1)?t.endOffset==n.length-1:t.endOffset==n.length}return 1==i.nodeType?t.endOffset==i.childNodes.length:!1}function f(){var t=e.selection.getNode(),i="h1,h2,h3,h4,h5,h6,p,div",n=e.dom.is(t,i)&&"LI"===t.parentNode.tagName&&t.parentNode.lastChild===t;return e.selection.isCollapsed()&&n&&p()}function m(e,t){if(c(t)&&f()){var i=e.selection.getNode(),n=e.dom.create("li"),r=e.dom.getParent(i,"li");e.dom.insertAfter(n,r),tinymce.isIE6||tinymce.isIE7||tinyMCE.isIE8?e.selection.setCursorLocation(n,1):e.selection.setCursorLocation(n,0),t.preventDefault()}}function g(e,t){function i(e){var t=e.firstChild,i=null;do{if(!t)break;"LI"===t.tagName&&(i=t)}while(t=t.nextSibling);return i}function n(e,t){for(;e.childNodes.length>0;)t.appendChild(e.childNodes[0])}var r;if(tinymce.isGecko){var s=e.selection.getStart();if(t.keyCode==tinymce.VK.BACKSPACE&&"IMG"===s.tagName&&(r=s.parentNode.previousSibling)){var o;if("UL"===r.tagName||"OL"===r.tagName)o=r;else{if(!r.previousSibling||"UL"!==r.previousSibling.tagName&&"OL"!==r.previousSibling.tagName)return;o=r.previousSibling}var a=i(o),l=e.dom.createRng();l.setStart(a,1),l.setEnd(a,1),e.selection.setRng(l),e.selection.collapse(!0);var h=e.selection.getBookmark(),c=s.parentNode.cloneNode(!0);"P"===c.tagName||"DIV"===c.tagName?n(c,a):a.appendChild(c),s.parentNode.parentNode.removeChild(s.parentNode),e.selection.moveToBookmark(h)}}}function v(t){var i=e.dom.getParent(t,"ol,ul");if(null!=i){var n=i.lastChild;e.selection.setCursorLocation(n,0)}}function b(t,i){var n=e.getDoc().createTextNode("﻿");t.insertBefore(n,i),e.selection.setCursorLocation(n,0),e.execCommand("mceRepaint")}function x(e,t){if(h(t)){var i=o();if(i){var n=i.parentNode,r=n&&n.parentNode;r&&"LI"==r.nodeName&&r.firstChild==n&&i==n.firstChild&&b(r,n)}}}function L(e,t){if(h(t)){var i=o();if(1===e.dom.select("ul li",i).length){var n=i.firstChild;b(i,n)}}}function w(e,t){function i(t){for(var i=[],n=new tinymce.dom.TreeWalker(t.firstChild,t),r=n.current();r;r=n.next())e.dom.is(r,"ol,ul,li")&&i.push(r);return i}if(t.keyCode==tinymce.VK.BACKSPACE){var n=o();if(n){var r=e.dom.getParent(n,"ol,ul"),s=e.selection.getRng();if(r&&r.firstChild===n&&0==s.startOffset){var a=i(n);return a.unshift(n),e.execCommand("Outdent",!1,a),e.undoManager.add(),y.cancel(t)}}}}function C(e,t){var i=o();if(t.keyCode===tinymce.VK.BACKSPACE&&e.dom.is(i,"li")&&i.parentNode.firstChild!==i&&1===e.dom.select("ul,ol",i).length){var n=i.previousSibling;e.dom.remove(e.dom.select("br",i)),e.dom.remove(i,!0);var r=tinymce.grep(n.childNodes,function(e){return 3===e.nodeType});if(1===r.length){var s=r[0];e.selection.setCursorLocation(s,s.length)}return e.undoManager.add(),y.cancel(t)}}var S="TABBING",E="EMPTY",O="ESCAPE",_="UNKNOWN",T=_;this.ed=e,e.addCommand("Indent",this.indent,this),e.addCommand("Outdent",this.outdent,this),e.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this),e.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this),e.onInit.add(function(){e.editorCommands.addCommands({outdent:function(){function t(t){return t=n.getParent(t,n.isBlock),t&&parseInt(e.dom.getStyle(t,"margin-left")||0,10)+parseInt(e.dom.getStyle(t,"padding-left")||0,10)>0}var i=e.selection,n=e.dom;return t(i.getStart())||t(i.getEnd())||e.queryCommandState("InsertOrderedList")||e.queryCommandState("InsertUnorderedList")}},"state")}),e.onKeyUp.add(function(e,t){if(T==S)return e.execCommand(t.shiftKey?"Outdent":"Indent",!0,null),T=_,y.cancel(t);if(T==E){var i=o(),n=e.settings.list_outdent_on_enter===!0||t.shiftKey;return e.execCommand(n?"Outdent":"Indent",!0,null),tinymce.isIE&&v(i),y.cancel(t)}if(T==O)if(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8){var r=e.getDoc().createTextNode("﻿");e.selection.getNode().appendChild(r)}else if(tinymce.isIE9||tinymce.isGecko)return e.execCommand("Outdent"),y.cancel(t)}),e.onKeyDown.add(function(e,t){T=u(t)}),e.onKeyDown.add(d),e.onKeyDown.add(g),e.onKeyDown.add(m),tinymce.isGecko&&e.onKeyUp.add(x),tinymce.isIE8&&e.onKeyUp.add(L),(tinymce.isGecko||tinymce.isWebKit)&&e.onKeyDown.add(w),tinymce.isWebKit&&e.onKeyDown.add(C)},applyList:function(e,t){function i(e){e&&"BR"===e.tagName&&v.remove(e)}function n(t){function n(e){(e.style.marginLeft||e.style.paddingLeft)&&p.adjustPaddingFunction(!1)(e)}var s,l=v.create(e);if("LI"===t.tagName);else{if("P"===t.tagName||"DIV"===t.tagName||"BODY"===t.tagName)return a(t,function(e,o){r(e,o,"BODY"===t.tagName?null:e.parentNode),s=e.parentNode,n(s),i(o)}),s&&("LI"===s.tagName&&("P"===t.tagName||C.length>1)&&v.split(s.parentNode.parentNode,s.parentNode),o(s.parentNode,!0)),void 0;s=v.create("li"),v.insertAfter(s,t),s.appendChild(t),n(t),t=s}v.insertAfter(l,t),l.appendChild(t),o(l,!0),b.push(t)}function r(e,t,i){for(var r,s,o=e;!v.isBlock(e.parentNode)&&e.parentNode!==v.getRoot();)e=v.split(e.parentNode,e.previousSibling),e=e.nextSibling,o=e;if(i){for(r=i.cloneNode(!0),e.parentNode.insertBefore(r,e);r.firstChild;)v.remove(r.firstChild);r=v.rename(r,"li")}else r=v.create("li"),e.parentNode.insertBefore(r,e);for(;o&&o!=t;)s=o.nextSibling,r.appendChild(o),o=s;0===r.childNodes.length&&(r.innerHTML='<br _mce_bogus="1" />'),n(r)}function a(e,t){function i(e,t){var i,n=v.createRng();return m.keep=!0,y.selection.moveToBookmark(m),m.keep=!1,i=y.selection.getRng(!0),t||(t=e.parentNode.lastChild),n.setStartBefore(e),n.setEndAfter(t),!(n.compareBoundaryPoints(o,i)>0||0>=n.compareBoundaryPoints(a,i))}function n(e){return e.nextSibling?e.nextSibling:v.isBlock(e.parentNode)||e.parentNode===v.getRoot()?void 0:n(e.parentNode)}var r,s,o=3,a=1,l="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";r=e.firstChild;var h=!1;g(v.select(l,e),function(e){return e.hasAttribute&&e.hasAttribute("_mce_bogus")?!0:(i(r,e)&&(v.addClass(e,"_mce_tagged_br"),r=n(e)),void 0)}),h=r&&i(r,void 0),r=e.firstChild,g(v.select(l,e),function(e){var i=n(e);return e.hasAttribute&&e.hasAttribute("_mce_bogus")?!0:(v.hasClass(e,"_mce_tagged_br")?(t(r,e,s),s=null):s=e,r=i,void 0)}),h&&t(r,void 0,s)}function h(e){a(e,function(e,t,n){r(e,t),i(t),i(n)})}function c(e){-1===tinymce.inArray(b,e)&&(e.parentNode.tagName===t&&(v.split(e.parentNode,e),n(e),l(e.parentNode,!1)),b.push(e))}function u(e){var t,i,n,r;if(-1===tinymce.inArray(b,e)){for(e=s(e,v);v.is(e.parentNode,"ol,ul,li");)v.split(e.parentNode,e);if(b.push(e),e=v.rename(e,"p"),n=o(e,!1,y.settings.force_br_newlines),n===e)for(t=e.firstChild;t;)v.isBlock(t)?(t=v.split(t.parentNode,t),r=!0,i=t.nextSibling&&t.nextSibling.firstChild):(i=t.nextSibling,r&&"BR"===t.tagName&&v.remove(t),r=!1),t=i}}var d,p=this,y=p.ed,v=y.dom,b=[],x=!1,L=!1,w=!1,C=y.selection.getSelectedBlocks();g(C,function(i){i=f(i,v),i.tagName===t||"LI"===i.tagName&&i.parentNode.tagName===t?L=!0:i.tagName===e||"LI"===i.tagName&&i.parentNode.tagName===e?x=!0:w=!0}),d=w&&!x||L||0===C.length?{LI:c,H1:n,H2:n,H3:n,H4:n,H5:n,H6:n,P:n,BODY:n,DIV:C.length>1?n:h,defaultAction:h,elements:this.selectedBlocks()}:{defaultAction:u,elements:this.selectedBlocks(),processEvenIfEmpty:!0},this.process(d)},indent:function(){function e(e){var t=a.create("li",{style:"list-style-type: none;"});return a.insertAfter(t,e),t}function t(t){var i,n=e(t),r=a.getParent(t,"ol,ul"),s=r.tagName,o=a.getStyle(r,"list-style-type"),l={};return""!==o&&(l.style="list-style-type: "+o+";"),i=a.create(s,l),n.appendChild(i),i}function i(e){if(!n(r,e,l)){e=s(e,a);var i=t(e);i.appendChild(e),o(i.parentNode,!1),o(i,!1),l.push(e)}}var r=this.ed,a=r.dom,l=[];this.process({LI:i,defaultAction:this.adjustPaddingFunction(!0),elements:this.selectedBlocks()})},outdent:function(e,t){function i(e){var t,i,o;if(!n(a,e,h)){if(""!==l.getStyle(e,"margin-left")||""!==l.getStyle(e,"padding-left"))return r.adjustPaddingFunction(!1)(e);if(o=l.getStyle(e,"text-align",!0),"center"===o||"right"===o)return l.setStyle(e,"text-align","left"),void 0;e=s(e,l),t=e.parentNode,i=e.parentNode.parentNode,"P"===i.tagName?l.split(i,e.parentNode):(l.split(t,e),"LI"===i.tagName?l.split(i,e):l.is(i,"ol,ul")||l.rename(e,"p")),h.push(e)}}var r=this,a=r.ed,l=a.dom,h=[],c=t&&tinymce.is(t,"array")?t:this.selectedBlocks();this.process({LI:i,defaultAction:this.adjustPaddingFunction(!1),elements:c}),g(h,o)},process:function(e){function t(e){var t=tinymce.grep(e.childNodes,function(e){return!("BR"===e.nodeName||"SPAN"===e.nodeName&&"bookmark"==c.getAttrib(e,"data-mce-type")||3==e.nodeType&&(e.nodeValue==String.fromCharCode(160)||""==e.nodeValue))});return 0===t.length}function i(i){if(c.removeClass(i,"_mce_act_on"),i&&1===i.nodeType&&!(!e.processEvenIfEmpty&&o.length>1&&t(i))){i=f(i,c);var n=e[i.tagName];n||(n=e.defaultAction),n(i)}}function n(e){l.splitSafeEach(e.childNodes,i,!0)}function r(e,t){return t>=0&&e.hasChildNodes()&&e.childNodes.length>t&&"BR"===e.childNodes[t].tagName}function s(){var e=h.getNode(),t=c.getParent(e,"td");return null!==t}var o,a,l=this,h=l.ed.selection,c=l.ed.dom;if(o=e.elements,a=h.getRng(!0),a.collapsed||(r(a.endContainer,a.endOffset-1)&&(a.setEnd(a.endContainer,a.endOffset-1),h.setRng(a)),r(a.startContainer,a.startOffset)&&(a.setStart(a.startContainer,a.startOffset+1),h.setRng(a))),tinymce.isIE8){var u=l.ed.selection.getNode();if("LI"===u.tagName&&u.parentNode.lastChild!==u){var d=l.ed.getDoc().createTextNode("﻿");u.appendChild(d)}}m=h.getBookmark(),e.OL=e.UL=n,l.splitSafeEach(o,i),h.moveToBookmark(m),m=null,s()||l.ed.execCommand("mceRepaint")},splitSafeEach:function(e,t,i){i||tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))?this.classBasedEach(e,t):g(e,t)},classBasedEach:function(e,t){var i,n,r=this.ed.dom;for(g(e,function(e){r.addClass(e,"_mce_act_on")}),i=r.select("._mce_act_on");i.length>0;)n=i.shift(),r.removeClass(n,"_mce_act_on"),t(n),i=r.select("._mce_act_on")},adjustPaddingFunction:function(e){var t,i,n=this.ed;return t=n.settings.indentation,i=/[a-z%]+/i.exec(t),t=parseInt(t,10),function(r){var s,o;s=parseInt(n.dom.getStyle(r,"margin-left")||0,10)+parseInt(n.dom.getStyle(r,"padding-left")||0,10),o=e?s+t:s-t,n.dom.setStyle(r,"padding-left",""),n.dom.setStyle(r,"margin-left",o>0?o+i:"")}},selectedBlocks:function(){var e=this.ed,t=e.selection.getSelectedBlocks();return 0==t.length?[e.dom.getRoot()]:t},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("lists",tinymce.plugins.Lists)})();