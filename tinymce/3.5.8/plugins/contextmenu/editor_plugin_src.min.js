(function(){var e=tinymce.dom.Event,t=(tinymce.each,tinymce.DOM);tinymce.create("tinymce.plugins.ContextMenu",{init:function(t){function i(t,i){return s=0,i&&2==i.button?(s=i.ctrlKey,void 0):(a._menu&&(a._menu.removeAll(),a._menu.destroy(),e.remove(t.getDoc(),"click",o),a._menu=null),void 0)}var n,r,s,o,a=this;a.editor=t,r=t.settings.contextmenu_never_use_native,a.onContextMenu=new tinymce.util.Dispatcher(this),o=function(e){i(t,e)},n=t.onContextMenu.add(function(t,i){(0!==s?s:i.ctrlKey)&&!r||(e.cancel(i),"IMG"==i.target.nodeName&&t.selection.select(i.target),a._getMenu(t).showMenu(i.clientX||i.pageX,i.clientY||i.pageY),e.add(t.getDoc(),"click",o),t.nodeChanged())}),t.onRemove.add(function(){a._menu&&a._menu.removeAll()}),t.onMouseDown.add(i),t.onKeyDown.add(i),t.onKeyDown.add(function(t,i){!i.shiftKey||i.ctrlKey||i.altKey||121!==i.keyCode||(e.cancel(i),n(t,i))})},getInfo:function(){return{longname:"Contextmenu",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/contextmenu",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_getMenu:function(e){var i,n,r=this,s=r._menu,o=e.selection,a=o.isCollapsed(),l=o.getNode()||e.getBody();return s&&(s.removeAll(),s.destroy()),n=t.getPos(e.getContentAreaContainer()),s=e.controlManager.createDropMenu("contextmenu",{offset_x:n.x+e.getParam("contextmenu_offset_x",0),offset_y:n.y+e.getParam("contextmenu_offset_y",0),constrain:1,keyboard_focus:!0}),r._menu=s,s.add({title:"advanced.cut_desc",icon:"cut",cmd:"Cut"}).setDisabled(a),s.add({title:"advanced.copy_desc",icon:"copy",cmd:"Copy"}).setDisabled(a),s.add({title:"advanced.paste_desc",icon:"paste",cmd:"Paste"}),("A"==l.nodeName&&!e.dom.getAttrib(l,"name")||!a)&&(s.addSeparator(),s.add({title:"advanced.link_desc",icon:"link",cmd:e.plugins.advlink?"mceAdvLink":"mceLink",ui:!0}),s.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"})),s.addSeparator(),s.add({title:"advanced.image_desc",icon:"image",cmd:e.plugins.advimage?"mceAdvImage":"mceImage",ui:!0}),s.addSeparator(),i=s.addMenu({title:"contextmenu.align"}),i.add({title:"contextmenu.left",icon:"justifyleft",cmd:"JustifyLeft"}),i.add({title:"contextmenu.center",icon:"justifycenter",cmd:"JustifyCenter"}),i.add({title:"contextmenu.right",icon:"justifyright",cmd:"JustifyRight"}),i.add({title:"contextmenu.full",icon:"justifyfull",cmd:"JustifyFull"}),r.onContextMenu.dispatch(r,s,l,a),s}}),tinymce.PluginManager.add("contextmenu",tinymce.plugins.ContextMenu)})();