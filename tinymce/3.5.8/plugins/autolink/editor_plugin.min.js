(function(){tinymce.create("tinymce.plugins.AutolinkPlugin",{init:function(e){var t=this;e.onKeyDown.addToTop(function(e,i){return 13==i.keyCode?t.handleEnter(e):void 0}),tinyMCE.isIE||(e.onKeyPress.add(function(e,i){return 41==i.which?t.handleEclipse(e):void 0}),e.onKeyUp.add(function(e,i){return 32==i.keyCode?t.handleSpacebar(e):void 0}))},handleEclipse:function(e){this.parseCurrentLine(e,-1,"(",!0)},handleSpacebar:function(e){this.parseCurrentLine(e,0,"",!0)},handleEnter:function(e){this.parseCurrentLine(e,-1,"",!1)},parseCurrentLine:function(e,t,i){var n,r,s,o,a,l,h,c,u;if(n=e.selection.getRng(!0).cloneRange(),5>n.startOffset){if(c=n.endContainer.previousSibling,null==c){if(null==n.endContainer.firstChild||null==n.endContainer.firstChild.nextSibling)return;c=n.endContainer.firstChild.nextSibling}if(u=c.length,n.setStart(c,u),n.setEnd(c,u),5>n.endOffset)return;r=n.endOffset,o=c}else{if(o=n.endContainer,3!=o.nodeType&&o.firstChild){for(;3!=o.nodeType&&o.firstChild;)o=o.firstChild;3==o.nodeType&&(n.setStart(o,0),n.setEnd(o,o.nodeValue.length))}r=1==n.endOffset?2:n.endOffset-1-t}s=r;do n.setStart(o,r>=2?r-2:0),n.setEnd(o,r>=1?r-1:0),r-=1;while(" "!=""+n&&""!=""+n&&160!=(""+n).charCodeAt(0)&&r-2>=0&&""+n!=i);""+n==i||160==(""+n).charCodeAt(0)?(n.setStart(o,r),n.setEnd(o,s),r+=1):0==n.startOffset?(n.setStart(o,0),n.setEnd(o,s)):(n.setStart(o,r),n.setEnd(o,s));var l=""+n;if("."==l.charAt(l.length-1)&&n.setEnd(o,s-1),l=""+n,h=l.match(/^(https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.|(?:mailto:)?[A-Z0-9._%+-]+@)(.+)$/i),h&&("www."==h[1]?h[1]="http://www.":/@$/.test(h[1])&&!/^mailto:/.test(h[1])&&(h[1]="mailto:"+h[1]),a=e.selection.getBookmark(),e.selection.setRng(n),tinyMCE.execCommand("createlink",!1,h[1]+h[2]),e.selection.moveToBookmark(a),e.nodeChanged(),tinyMCE.isWebKit)){e.selection.collapse(!1);var d=Math.min(o.length,s+1);n.setStart(o,d),n.setEnd(o,d),e.selection.setRng(n)}},getInfo:function(){return{longname:"Autolink",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/autolink",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("autolink",tinymce.plugins.AutolinkPlugin)})();