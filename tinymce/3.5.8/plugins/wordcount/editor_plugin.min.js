(function(){tinymce.create("tinymce.plugins.WordCount",{block:0,id:null,countre:null,cleanre:null,init:function(e){function t(e){return e!==r&&(e===s.ENTER||r===s.SPACEBAR||i(r))}function i(e){return e===s.DELETE||e===s.BACKSPACE}var n=this,r=0,s=tinymce.VK;n.countre=e.getParam("wordcount_countregex",/[\w\u2019\'-]+/g),n.cleanre=e.getParam("wordcount_cleanregex",/[0-9.(),;:!?%#$?\'\"_+=\\\/-]*/g),n.update_rate=e.getParam("wordcount_update_rate",2e3),n.update_on_delete=e.getParam("wordcount_update_on_delete",!1),n.id=e.id+"-word-count",e.onPostRender.add(function(e){var t,i;i=e.getParam("wordcount_target_id"),i?tinymce.DOM.add(i,"span",{},'<span id="'+n.id+'">0</span>'):(t=tinymce.DOM.get(e.id+"_path_row"),t&&tinymce.DOM.add(t.parentNode,"div",{style:"float: right"},e.getLang("wordcount.words","Words: ")+'<span id="'+n.id+'">0</span>'))}),e.onInit.add(function(e){e.selection.onSetContent.add(function(){n._count(e)}),n._count(e)}),e.onSetContent.add(function(e){n._count(e)}),e.onKeyUp.add(function(e,s){(t(s.keyCode)||n.update_on_delete&&i(s.keyCode))&&n._count(e),r=s.keyCode})},_getCount:function(e){var t=0,i=e.getContent({format:"raw"});if(i){i=i.replace(/\.\.\./g," "),i=i.replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," "),i=i.replace(/(\w+)(&.+?;)+(\w+)/,"$1$3").replace(/&.+?;/g," "),i=i.replace(this.cleanre,"");var n=i.match(this.countre);n&&(t=n.length)}return t},_count:function(e){var t=this;t.block||(t.block=1,setTimeout(function(){if(!e.destroyed){var i=t._getCount(e);tinymce.DOM.setHTML(t.id,""+i),setTimeout(function(){t.block=0},t.update_rate)}},1))},getInfo:function(){return{longname:"Word Count plugin",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/wordcount",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("wordcount",tinymce.plugins.WordCount)})();