function init(){tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var e=tinyMCEPopup.editor,t=e.dom,i=t.getParent(e.selection.getStart(),"tr"),n=document.forms[0],r=t.parseStyle(t.getAttrib(i,"style")),s=i.parentNode.nodeName.toLowerCase(),o=t.getAttrib(i,"align"),a=t.getAttrib(i,"valign"),l=trimSize(getStyle(i,"height","height")),c=t.getAttrib(i,"class"),h=convertRGBToHex(getStyle(i,"bgcolor","backgroundColor")),u=getStyle(i,"background","backgroundImage").replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),d=t.getAttrib(i,"id"),p=t.getAttrib(i,"lang"),f=t.getAttrib(i,"dir");selectByValue(n,"rowtype",s),setActionforRowType(n,s),0==t.select("td.mceSelected,th.mceSelected",i).length?(addClassesToList("class","table_row_styles"),TinyMCE_EditableSelects.init(),n.bgcolor.value=h,n.backgroundimage.value=u,n.height.value=l,n.id.value=d,n.lang.value=p,n.style.value=t.serializeStyle(r),selectByValue(n,"align",o),selectByValue(n,"valign",a),selectByValue(n,"class",c,!0,!0),selectByValue(n,"dir",f),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),updateColor("bgcolor_pick","bgcolor")):tinyMCEPopup.dom.hide("action")}function updateAction(){var e,t,i=tinyMCEPopup.editor,n=i.dom,r=document.forms[0],s=getSelectValue(r,"action");if(!AutoValidator.validate(r))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(r).join(". ")+"."),!1;if(tinyMCEPopup.restoreSelection(),e=n.getParent(i.selection.getStart(),"tr"),t=n.getParent(i.selection.getStart(),"table"),n.select("td.mceSelected,th.mceSelected",e).length>0)return tinymce.each(t.rows,function(e){var t;for(t=0;e.cells.length>t;t++)if(n.hasClass(e.cells[t],"mceSelected"))return updateRow(e,!0),void 0}),i.addVisual(),i.nodeChanged(),i.execCommand("mceEndUndoLevel"),tinyMCEPopup.close(),void 0;switch(s){case"row":updateRow(e);break;case"all":for(var o=t.getElementsByTagName("tr"),a=0;o.length>a;a++)updateRow(o[a],!0);break;case"odd":case"even":for(var o=t.getElementsByTagName("tr"),a=0;o.length>a;a++)(0==a%2&&"odd"==s||0!=a%2&&"even"==s)&&updateRow(o[a],!0,!0)}i.addVisual(),i.nodeChanged(),i.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function updateRow(e,t,i){var n=tinyMCEPopup.editor,r=document.forms[0],s=n.dom,o=e.parentNode.nodeName.toLowerCase(),a=getSelectValue(r,"rowtype"),l=n.getDoc();if(t||s.setAttrib(e,"id",r.id.value),s.setAttrib(e,"align",getSelectValue(r,"align")),s.setAttrib(e,"vAlign",getSelectValue(r,"valign")),s.setAttrib(e,"lang",r.lang.value),s.setAttrib(e,"dir",getSelectValue(r,"dir")),s.setAttrib(e,"style",s.serializeStyle(s.parseStyle(r.style.value))),s.setAttrib(e,"class",getSelectValue(r,"class")),s.setAttrib(e,"background",""),s.setAttrib(e,"bgColor",""),s.setAttrib(e,"height",""),e.style.height=getCSSSize(r.height.value),e.style.backgroundColor=r.bgcolor.value,e.style.backgroundImage=""!=r.backgroundimage.value?"url('"+r.backgroundimage.value+"')":"",o!=a&&!i){for(var c=e.cloneNode(1),h=s.getParent(e,"table"),u=a,d=null,p=0;h.childNodes.length>p;p++)h.childNodes[p].nodeName.toLowerCase()==u&&(d=h.childNodes[p]);null==d&&(d=l.createElement(u),"CAPTION"==h.firstChild.nodeName?n.dom.insertAfter(d,h.firstChild):h.insertBefore(d,h.firstChild)),d.appendChild(c),e.parentNode.removeChild(e),e=c}s.setAttrib(e,"style",s.serializeStyle(s.parseStyle(e.style.cssText)))}function changedBackgroundImage(){var e=document.forms[0],t=tinyMCEPopup.editor.dom,i=t.parseStyle(e.style.value);i["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=t.serializeStyle(i)}function changedStyle(){var e=document.forms[0],t=tinyMCEPopup.editor.dom,i=t.parseStyle(e.style.value);e.backgroundimage.value=i["background-image"]?i["background-image"].replace(RegExp("url\\('?([^']*)'?\\)","gi"),"$1"):"",i.height&&(e.height.value=trimSize(i.height)),i["background-color"]&&(e.bgcolor.value=i["background-color"],updateColor("bgcolor_pick","bgcolor"))}function changedSize(){var e=document.forms[0],t=tinyMCEPopup.editor.dom,i=t.parseStyle(e.style.value),n=e.height.value;i.height=""!=n?getCSSSize(n):"",e.style.value=t.serializeStyle(i)}function changedColor(){var e=document.forms[0],t=tinyMCEPopup.editor.dom,i=t.parseStyle(e.style.value);i["background-color"]=e.bgcolor.value,e.style.value=t.serializeStyle(i)}function changedRowType(){var e=document.forms[0],t=getSelectValue(e,"rowtype");setActionforRowType(e,t)}function setActionforRowType(e,t){"tbody"===t?e.action.disabled=!1:(selectByValue(e,"action","row"),e.action.disabled=!0)}tinyMCEPopup.requireLangPack(),tinyMCEPopup.onInit.add(init);