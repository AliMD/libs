function insertTable(){var e,t,i,n,r,s,o,a,l,c,h,u,d=document.forms[0],p=tinyMCEPopup.editor,f=p.dom,m=2,g=2,y=0,v=-1,b=-1,x="";if(tinyMCEPopup.restoreSelection(),!AutoValidator.validate(d))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(d).join(". ")+"."),!1;if(l=f.getParent(p.selection.getNode(),"table"),m=d.elements.cols.value,g=d.elements.rows.value,y=""!=d.elements.border.value?d.elements.border.value:0,v=""!=d.elements.cellpadding.value?d.elements.cellpadding.value:"",b=""!=d.elements.cellspacing.value?d.elements.cellspacing.value:"",e=getSelectValue(d,"align"),s=getSelectValue(d,"tframe"),o=getSelectValue(d,"rules"),t=d.elements.width.value,i=d.elements.height.value,bordercolor=d.elements.bordercolor.value,bgcolor=d.elements.bgcolor.value,n=getSelectValue(d,"class"),id=d.elements.id.value,summary=d.elements.summary.value,style=d.elements.style.value,dir=d.elements.dir.value,lang=d.elements.lang.value,background=d.elements.backgroundimage.value,r=d.elements.caption.checked,c=tinyMCEPopup.getParam("table_cell_limit",!1),h=tinyMCEPopup.getParam("table_row_limit",!1),u=tinyMCEPopup.getParam("table_col_limit",!1),u&&m>u)return tinyMCEPopup.alert(p.getLang("table_dlg.col_limit").replace(/\{\$cols\}/g,u)),!1;if(h&&g>h)return tinyMCEPopup.alert(p.getLang("table_dlg.row_limit").replace(/\{\$rows\}/g,h)),!1;if(c&&m*g>c)return tinyMCEPopup.alert(p.getLang("table_dlg.cell_limit").replace(/\{\$cells\}/g,c)),!1;if("update"==action)return f.setAttrib(l,"cellPadding",v,!0),f.setAttrib(l,"cellSpacing",b,!0),isCssSize(y)?f.setAttrib(l,"border",""):f.setAttrib(l,"border",y),""==y&&(f.setStyle(l,"border-width",""),f.setStyle(l,"border",""),f.setAttrib(l,"border","")),f.setAttrib(l,"align",e),f.setAttrib(l,"frame",s),f.setAttrib(l,"rules",o),f.setAttrib(l,"class",n),f.setAttrib(l,"style",style),f.setAttrib(l,"id",id),f.setAttrib(l,"summary",summary),f.setAttrib(l,"dir",dir),f.setAttrib(l,"lang",lang),a=p.dom.select("caption",l)[0],a&&!r&&a.parentNode.removeChild(a),!a&&r&&(a=l.ownerDocument.createElement("caption"),tinymce.isIE||(a.innerHTML='<br data-mce-bogus="1"/>'),l.insertBefore(a,l.firstChild)),t&&p.settings.inline_styles?(f.setStyle(l,"width",t),f.setAttrib(l,"width","")):(f.setAttrib(l,"width",t,!0),f.setStyle(l,"width","")),f.setAttrib(l,"borderColor",""),f.setAttrib(l,"bgColor",""),f.setAttrib(l,"background",""),i&&p.settings.inline_styles?(f.setStyle(l,"height",i),f.setAttrib(l,"height","")):(f.setAttrib(l,"height",i,!0),f.setStyle(l,"height","")),l.style.backgroundImage=""!=background?"url('"+background+"')":"",""!=bordercolor?(l.style.borderColor=bordercolor,l.style.borderStyle=""==l.style.borderStyle?"solid":l.style.borderStyle,l.style.borderWidth=cssSize(y)):l.style.borderColor="",l.style.backgroundColor=bgcolor,l.style.height=getCSSSize(i),p.addVisual(),p.nodeChanged(),p.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),(d.width.value!=orgTableWidth||d.height.value!=orgTableHeight)&&p.execCommand("mceRepaint"),tinyMCEPopup.close(),!0;x+="<table",x+=makeAttrib("id",id),isCssSize(y)||(x+=makeAttrib("border",y)),x+=makeAttrib("cellpadding",v),x+=makeAttrib("cellspacing",b),x+=makeAttrib("data-mce-new","1"),t&&p.settings.inline_styles?(style&&(style+="; "),/^[0-9\.]+$/.test(t)&&(t+="px"),style+="width: "+t):x+=makeAttrib("width",t),x+=makeAttrib("align",e),x+=makeAttrib("frame",s),x+=makeAttrib("rules",o),x+=makeAttrib("class",n),x+=makeAttrib("style",style),x+=makeAttrib("summary",summary),x+=makeAttrib("dir",dir),x+=makeAttrib("lang",lang),x+=">",r&&(x+=tinymce.isIE?"<caption></caption>":'<caption><br data-mce-bogus="1"/></caption>');for(var L=0;g>L;L++){x+="<tr>";for(var w=0;m>w;w++)x+=tinymce.isIE?"<td></td>":'<td><br data-mce-bogus="1"/></td>';x+="</tr>"}if(x+="</table>",p.settings.fix_table_elements){var C="";p.focus(),p.selection.setContent('<br class="_mce_marker" />'),tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(e){C&&(C+=","),C+=e+" ._mce_marker"}),tinymce.each(p.dom.select(C),function(e){p.dom.split(p.dom.getParent(e,"h1,h2,h3,h4,h5,h6,p"),e)}),f.setOuterHTML(f.select("br._mce_marker")[0],x)}else p.execCommand("mceInsertContent",!1,x);tinymce.each(f.select("table[data-mce-new]"),function(e){var t=f.select("td,th",e);tinymce.isIE&&null==e.nextSibling&&(p.settings.forced_root_block?f.insertAfter(f.create(p.settings.forced_root_block),e):f.insertAfter(f.create("br",{"data-mce-bogus":"1"}),e));try{p.selection.setCursorLocation(t[0],0)}catch(i){}f.setAttrib(e,"data-mce-new","")}),p.addVisual(),p.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),tinyMCEPopup.close()}function makeAttrib(e,t){var i=document.forms[0],n=i.elements[e];return(t===void 0||null==t)&&(t="",n&&(t=n.value)),""==t?"":(t=t.replace(/&/g,"&amp;"),t=t.replace(/\"/g,"&quot;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;")," "+e+'="'+t+'"')}function init(){tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var e=2,t=2,i=tinyMCEPopup.getParam("table_default_border","0"),n=tinyMCEPopup.getParam("table_default_cellpadding",""),r=tinyMCEPopup.getParam("table_default_cellspacing",""),s="",o="",a="",l="",c="",h="",u="",d="",p="",f="",m="",g="",c="",l="",y="",v="",b=tinyMCEPopup.editor,x=b.dom,L=document.forms[0],w=x.getParent(b.selection.getNode(),"table");if(tinymce.each("summary id rules dir style frame".split(" "),function(e){var t=tinyMCEPopup.dom.getParent(e,"tr")||tinyMCEPopup.dom.getParent("t"+e,"tr");t&&!tinyMCEPopup.editor.schema.isValid("table",e)&&(t.style.display="none")}),action=tinyMCEPopup.getWindowArg("action"),action||(action=w?"update":"insert"),w&&"insert"!=action){for(var C=w.rows,e=0,S=0;C.length>S;S++)C[S].cells.length>e&&(e=C[S].cells.length);e=e,t=C.length,st=x.parseStyle(x.getAttrib(w,"style")),i=trimSize(getStyle(w,"border","borderWidth")),n=x.getAttrib(w,"cellpadding",""),r=x.getAttrib(w,"cellspacing",""),o=trimSize(getStyle(w,"width","width")),a=trimSize(getStyle(w,"height","height")),l=convertRGBToHex(getStyle(w,"bordercolor","borderLeftColor")),c=convertRGBToHex(getStyle(w,"bgcolor","backgroundColor")),s=x.getAttrib(w,"align",s),v=x.getAttrib(w,"frame"),y=x.getAttrib(w,"rules"),h=tinymce.trim(x.getAttrib(w,"class").replace(/mceItem.+/g,"")),u=x.getAttrib(w,"id"),d=x.getAttrib(w,"summary"),p=x.serializeStyle(st),f=x.getAttrib(w,"dir"),m=x.getAttrib(w,"lang"),g=getStyle(w,"background","backgroundImage").replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),L.caption.checked=w.getElementsByTagName("caption").length>0,orgTableWidth=o,orgTableHeight=a,action="update",L.insert.value=b.getLang("update")}addClassesToList("class","table_styles"),TinyMCE_EditableSelects.init(),selectByValue(L,"align",s),selectByValue(L,"tframe",v),selectByValue(L,"rules",y),selectByValue(L,"class",h,!0,!0),L.cols.value=e,L.rows.value=t,L.border.value=i,L.cellpadding.value=n,L.cellspacing.value=r,L.width.value=o,L.height.value=a,L.bordercolor.value=l,L.bgcolor.value=c,L.id.value=u,L.summary.value=d,L.style.value=p,L.dir.value=f,L.lang.value=m,L.backgroundimage.value=g,updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),"update"==action&&(L.cols.disabled=!0,L.rows.disabled=!0)}function changedSize(){var e=document.forms[0],t=dom.parseStyle(e.style.value),i=e.height.value;t.height=""!=i?getCSSSize(i):"",e.style.value=dom.serializeStyle(t)}function isCssSize(e){return/^[0-9.]+(%|in|cm|mm|em|ex|pt|pc|px)$/.test(e)}function cssSize(e,t){return e=tinymce.trim(e||t),isCssSize(e)?e:parseInt(e,10)+"px"}function changedBackgroundImage(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=dom.serializeStyle(t)}function changedBorder(){var e=document.forms[0],t=dom.parseStyle(e.style.value);""==e.border.value||!isCssSize(e.border.value)&&""==e.bordercolor.value?e.border.value||(t.border="",t["border-width"]=""):t["border-width"]=cssSize(e.border.value),e.style.value=dom.serializeStyle(t)}function changedColor(){var e=document.forms[0],t=dom.parseStyle(e.style.value);t["background-color"]=e.bgcolor.value,""!=e.bordercolor.value&&(t["border-color"]=e.bordercolor.value,t["border-width"]||(t["border-width"]=cssSize(e.border.value,1))),e.style.value=dom.serializeStyle(t)}function changedStyle(){var e=document.forms[0],t=dom.parseStyle(e.style.value);e.backgroundimage.value=t["background-image"]?t["background-image"].replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"):"",t.width&&(e.width.value=trimSize(t.width)),t.height&&(e.height.value=trimSize(t.height)),t["background-color"]&&(e.bgcolor.value=t["background-color"],updateColor("bgcolor_pick","bgcolor")),t["border-color"]&&(e.bordercolor.value=t["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var action,orgTableWidth,orgTableHeight,dom=tinyMCEPopup.editor.dom;tinyMCEPopup.onInit.add(init);