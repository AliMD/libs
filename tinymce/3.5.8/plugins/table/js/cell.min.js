function init(){ed=tinyMCEPopup.editor,tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var e=ed.dom.getParent(ed.selection.getStart(),"td,th"),t=document.forms[0],i=ed.dom.parseStyle(ed.dom.getAttrib(e,"style")),n=e.nodeName.toLowerCase(),r=ed.dom.getAttrib(e,"align"),s=ed.dom.getAttrib(e,"valign"),o=trimSize(getStyle(e,"width","width")),a=trimSize(getStyle(e,"height","height")),l=convertRGBToHex(getStyle(e,"bordercolor","borderLeftColor")),c=convertRGBToHex(getStyle(e,"bgcolor","backgroundColor")),h=ed.dom.getAttrib(e,"class"),u=getStyle(e,"background","backgroundImage").replace(RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),d=ed.dom.getAttrib(e,"id"),p=ed.dom.getAttrib(e,"lang"),f=ed.dom.getAttrib(e,"dir"),m=ed.dom.getAttrib(e,"scope");addClassesToList("class","table_cell_styles"),TinyMCE_EditableSelects.init(),ed.dom.hasClass(e,"mceSelected")?tinyMCEPopup.dom.hide("action"):(t.bordercolor.value=l,t.bgcolor.value=c,t.backgroundimage.value=u,t.width.value=o,t.height.value=a,t.id.value=d,t.lang.value=p,t.style.value=ed.dom.serializeStyle(i),selectByValue(t,"align",r),selectByValue(t,"valign",s),selectByValue(t,"class",h,!0,!0),selectByValue(t,"celltype",n),selectByValue(t,"dir",f),selectByValue(t,"scope",m),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"))}function updateAction(){function e(e){e&&(updateCell(i),ed.addVisual(),ed.nodeChanged(),s.execCommand("mceEndUndoLevel"),tinyMCEPopup.close())}var t,i,n,r,s=ed,o=document.forms[0];if(!AutoValidator.validate(o))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(o).join(". ")+"."),!1;if(tinyMCEPopup.restoreSelection(),t=ed.selection.getStart(),i=ed.dom.getParent(t,"td,th"),n=ed.dom.getParent(t,"tr"),r=ed.dom.getParent(t,"table"),ed.dom.hasClass(i,"mceSelected"))return tinymce.each(ed.dom.select("td.mceSelected,th.mceSelected"),function(e){updateCell(e)}),ed.addVisual(),ed.nodeChanged(),s.execCommand("mceEndUndoLevel"),tinyMCEPopup.close(),void 0;switch(getSelectValue(o,"action")){case"cell":var a=getSelectValue(o,"celltype"),l=getSelectValue(o,"scope");if(ed.getParam("accessibility_warnings",1))return"th"==a&&""==l?tinyMCEPopup.confirm(ed.getLang("table_dlg.missing_scope","",!0),e):e(1),void 0;updateCell(i);break;case"row":var c=n.firstChild;"TD"!=c.nodeName&&"TH"!=c.nodeName&&(c=nextCell(c));do c=updateCell(c,!0);while(null!=(c=nextCell(c)));break;case"col":var h,u=0,c=n.firstChild,d=r.getElementsByTagName("tr");"TD"!=c.nodeName&&"TH"!=c.nodeName&&(c=nextCell(c));do{if(c==i)break;u+=c.getAttribute("colspan")?c.getAttribute("colspan"):1}while(null!=(c=nextCell(c)));for(var p=0;d.length>p;p++){c=d[p].firstChild,"TD"!=c.nodeName&&"TH"!=c.nodeName&&(c=nextCell(c)),h=0;do{if(h==u){c=updateCell(c,!0);break}h+=c.getAttribute("colspan")?c.getAttribute("colspan"):1}while(null!=(c=nextCell(c)))}break;case"all":for(var d=r.getElementsByTagName("tr"),p=0;d.length>p;p++){var c=d[p].firstChild;"TD"!=c.nodeName&&"TH"!=c.nodeName&&(c=nextCell(c));do c=updateCell(c,!0);while(null!=(c=nextCell(c)))}}ed.addVisual(),ed.nodeChanged(),s.execCommand("mceEndUndoLevel"),tinyMCEPopup.close()}function nextCell(e){for(;null!=(e=e.nextSibling);)if("TD"==e.nodeName||"TH"==e.nodeName)return e;return null}function updateCell(e,t){var i=ed,n=document.forms[0],r=e.nodeName.toLowerCase(),s=getSelectValue(n,"celltype"),o=i.getDoc(),a=ed.dom;if(t||a.setAttrib(e,"id",n.id.value),a.setAttrib(e,"align",n.align.value),a.setAttrib(e,"vAlign",n.valign.value),a.setAttrib(e,"lang",n.lang.value),a.setAttrib(e,"dir",getSelectValue(n,"dir")),a.setAttrib(e,"style",ed.dom.serializeStyle(ed.dom.parseStyle(n.style.value))),a.setAttrib(e,"scope",n.scope.value),a.setAttrib(e,"class",getSelectValue(n,"class")),ed.dom.setAttrib(e,"width",""),ed.dom.setAttrib(e,"height",""),ed.dom.setAttrib(e,"bgColor",""),ed.dom.setAttrib(e,"borderColor",""),ed.dom.setAttrib(e,"background",""),e.style.width=getCSSSize(n.width.value),e.style.height=getCSSSize(n.height.value),""!=n.bordercolor.value?(e.style.borderColor=n.bordercolor.value,e.style.borderStyle=""==e.style.borderStyle?"solid":e.style.borderStyle,e.style.borderWidth=""==e.style.borderWidth?"1px":e.style.borderWidth):e.style.borderColor="",e.style.backgroundColor=n.bgcolor.value,e.style.backgroundImage=""!=n.backgroundimage.value?"url('"+n.backgroundimage.value+"')":"",r!=s){for(var l=o.createElement(s),c=0;e.childNodes.length>c;c++)l.appendChild(e.childNodes[c].cloneNode(1));for(var h=0;e.attributes.length>h;h++)ed.dom.setAttrib(l,e.attributes[h].name,ed.dom.getAttrib(e,e.attributes[h].name));e.parentNode.replaceChild(l,e),e=l}return a.setAttrib(e,"style",a.serializeStyle(a.parseStyle(e.style.cssText))),e}function changedBackgroundImage(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-image"]="url('"+e.backgroundimage.value+"')",e.style.value=ed.dom.serializeStyle(t)}function changedSize(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value),i=e.width.value;t.width=""!=i?getCSSSize(i):"";var n=e.height.value;t.height=""!=n?getCSSSize(n):"",e.style.value=ed.dom.serializeStyle(t)}function changedColor(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);t["background-color"]=e.bgcolor.value,t["border-color"]=e.bordercolor.value,e.style.value=ed.dom.serializeStyle(t)}function changedStyle(){var e=document.forms[0],t=ed.dom.parseStyle(e.style.value);e.backgroundimage.value=t["background-image"]?t["background-image"].replace(RegExp("url\\('?([^']*)'?\\)","gi"),"$1"):"",t.width&&(e.width.value=trimSize(t.width)),t.height&&(e.height.value=trimSize(t.height)),t["background-color"]&&(e.bgcolor.value=t["background-color"],updateColor("bgcolor_pick","bgcolor")),t["border-color"]&&(e.bordercolor.value=t["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var ed;tinyMCEPopup.onInit.add(init);