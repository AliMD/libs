(function(){var e=tinymce.each;tinymce.create("tinymce.plugins.TemplatePlugin",{init:function(t,i){var n=this;n.editor=t,t.addCommand("mceTemplate",function(){t.windowManager.open({file:i+"/template.htm",width:t.getParam("template_popup_width",750),height:t.getParam("template_popup_height",600),inline:1},{plugin_url:i})}),t.addCommand("mceInsertTemplate",n._insertTemplate,n),t.addButton("template",{title:"template.desc",cmd:"mceTemplate"}),t.onPreProcess.add(function(t,i){var r=t.dom;e(r.select("div",i.node),function(i){r.hasClass(i,"mceTmpl")&&(e(r.select("*",i),function(e){r.hasClass(e,t.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(e.innerHTML=n._getDateTime(new Date,t.getParam("template_mdate_format",t.getLang("template.mdate_format"))))}),n._replaceVals(i))})})},getInfo:function(){return{longname:"Template plugin",author:"Moxiecode Systems AB",authorurl:"http://www.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/template",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_insertTemplate:function(t,i){function r(e,t){return RegExp("\\b"+t+"\\b","g").test(e.className)}var s,o,a=this,l=a.editor,c=l.dom,h=l.selection.getContent();s=i.content,e(a.editor.getParam("template_replace_values"),function(e,t){"function"!=typeof e&&(s=s.replace(RegExp("\\{\\$"+t+"\\}","g"),e))}),o=c.create("div",null,s),n=c.select(".mceTmpl",o),n&&n.length>0&&(o=c.create("div",null),o.appendChild(n[0].cloneNode(!0))),e(c.select("*",o),function(e){r(e,l.getParam("template_cdate_classes","cdate").replace(/\s+/g,"|"))&&(e.innerHTML=a._getDateTime(new Date,l.getParam("template_cdate_format",l.getLang("template.cdate_format")))),r(e,l.getParam("template_mdate_classes","mdate").replace(/\s+/g,"|"))&&(e.innerHTML=a._getDateTime(new Date,l.getParam("template_mdate_format",l.getLang("template.mdate_format")))),r(e,l.getParam("template_selected_content_classes","selcontent").replace(/\s+/g,"|"))&&(e.innerHTML=h)}),a._replaceVals(o),l.execCommand("mceInsertContent",!1,o.innerHTML),l.addVisual()},_replaceVals:function(t){var i=this.editor.dom,n=this.editor.getParam("template_replace_values");e(i.select("*",t),function(t){e(n,function(e,r){i.hasClass(t,r)&&"function"==typeof n[r]&&n[r](t)})})},_getDateTime:function(e,t){function i(e,t){var i;if(e=""+e,t>e.length)for(i=0;t-e.length>i;i++)e="0"+e;return e}return t?(t=t.replace("%D","%m/%d/%y"),t=t.replace("%r","%I:%M:%S %p"),t=t.replace("%Y",""+e.getFullYear()),t=t.replace("%y",""+e.getYear()),t=t.replace("%m",i(e.getMonth()+1,2)),t=t.replace("%d",i(e.getDate(),2)),t=t.replace("%H",""+i(e.getHours(),2)),t=t.replace("%M",""+i(e.getMinutes(),2)),t=t.replace("%S",""+i(e.getSeconds(),2)),t=t.replace("%I",""+((e.getHours()+11)%12+1)),t=t.replace("%p",""+(12>e.getHours()?"AM":"PM")),t=t.replace("%B",""+this.editor.getLang("template_months_long").split(",")[e.getMonth()]),t=t.replace("%b",""+this.editor.getLang("template_months_short").split(",")[e.getMonth()]),t=t.replace("%A",""+this.editor.getLang("template_day_long").split(",")[e.getDay()]),t=t.replace("%a",""+this.editor.getLang("template_day_short").split(",")[e.getDay()]),t=t.replace("%%","%")):""}}),tinymce.PluginManager.add("template",tinymce.plugins.TemplatePlugin)})();