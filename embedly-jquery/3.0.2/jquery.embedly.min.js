/*! Embedly jQuery - v3.0.2 - 2013-02-28
 * https://github.com/embedly/embedly-jquery
 * Copyright (c) 2013 Sean Creeley
 * Licensed BSD
 */ 
(function(t){function e(t){return null===t||void 0===t}function i(e,i){var r=[],s=[];return t.each(e,function(t,e){s.push(e),s.length===i&&(r.push(s),s=[])}),0!==s.length&&r.push(s),r}function r(i){return e(i)?[]:t.isArray(i)?i:[i]}function s(t){return t[0].map(function(e,i){return t.map(function(t){return t[i]})})}var n={key:null,endpoint:"oembed",secure:null,query:{},method:"replace",addImageStyles:!0,wrapElement:"div",className:"embed",batch:20,urlRe:null},o=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,h=function(t,e,i){this.init(t,e,i)};h.prototype={init:function(e){this.urls=e,this.count=0,this.results={},this._deferred=t.Deferred()},notify:function(t){if(this.results[t.original_url]=t,this.count++,this._deferred.notify.apply(this._deferred,[t]),this.count===this.urls.length){var e=this,i=this.urls.map(function(t){return e.results[t]});this._deferred.resolve(i)}return this},state:function(){return this._deferred.state.apply(this._deferred,arguments)}},window.Keeper=h;var a=function(){};a.prototype={defaults:{},log:function(t,i){e(window.console)||e(window.console[t])||window.console[t].apply(window.console,[i])},build:function(i,r,s){s=e(s)?{}:s;var n=s.secure;e(n)&&(n="https:"===window.location.protocol?!0:!1);var o=(n?"https":"http")+"://api.embed.ly/"+("objectify"===i?"2/":"1/")+i,h=e(s.query)?{}:s.query;return h.key=s.key,o+="?"+t.param(h),o+="&urls="+r.map(encodeURIComponent).join(",")},ajax:function(a,l,u){if(u=t.extend({},n,t.embedly.defaults,"object"==typeof u&&u),e(u.key))return this.log("error","Embedly jQuery requires an API Key. Please sign up for one at http://embed.ly"),null;l=r(l);var d,p=new h(l),c=[],f=[];t.each(l,function(t,e){d=!1,o.test(e)&&(d=!0,null!==u.urlRe&&u.urlRe.test&&!u.urlRe.test(e)&&(d=!1)),d===!0?c.push(e):f.push({url:e,original_url:e,error:!0,invalid:!0,type:"error",error_message:'Invalid URL "'+e+'"'})});var y=i(c,u.batch),m=this;return t.each(y,function(e,i){t.ajax({url:m.build(a,i,u),dataType:"jsonp",success:function(e){t.each(s([i,e]),function(t,e){var i=e[1];i.original_url=e[0],i.invalid=!1,p.notify(i)})}})}),f.length&&setTimeout(function(){t.each(f,function(t,e){p.notify(e)})},1),p._deferred},oembed:function(t,e){return this.ajax("oembed",t,e)},preview:function(t,e){return this.ajax("preview",t,e)},objectify:function(t,e){return this.ajax("objectify",t,e)}};var l=function(t,e,i){this.init(t,e,i)};l.prototype={init:function(e,i,r){this.elem=e,this.$elem=t(e),this.original_url=i,this.options=r,this.loaded=t.Deferred();var s=this;this.loaded.done(function(){s.$elem.trigger("loaded",[s])}),this.$elem.trigger("initialized",[this])},progress:function(e){t.extend(this,e),this.options.display?this.options.display.apply(this.elem,[this,this.elem]):"oembed"===this.options.endpoint&&this.display(),this.loaded.resolve(this)},imageStyle:function(){var t,e=[];return this.options.addImageStyles&&(this.options.query.maxwidth&&(t=isNaN(parseInt(this.options.query.maxwidth,10))?"":"px",e.push("max-width: "+this.options.query.maxwidth+t)),this.options.query.maxheight&&(t=isNaN(parseInt(this.options.query.maxheight,10))?"":"px",e.push("max-height: "+this.options.query.maxheight+t))),e.join(";")},display:function(){if("error"===this.type)return!1;this.style=this.imageStyle();var t;"photo"===this.type?(t="<a href='"+this.original_url+"' target='_blank'>",t+="<img style='"+this.style+"' src='"+this.url+"' alt='"+this.title+"' /></a>"):"video"===this.type||"rich"===this.type?t=this.html:(this.title=this.title||this.url,t=this.thumbnail_url?"<img src='"+this.thumbnail_url+"' class='thumb' style='"+this.style+"'/>":"",t+="<a href='"+this.original_url+"'>"+this.title+"</a>",t+=this.provider_name?"<a href='"+this.provider_url+"' class='provider'>"+this.provider_name+"</a>":"",t+=this.description?'<div class="description">'+this.description+"</div>":""),this.options.wrapElement&&(t="<"+this.options.wrapElement+' class="'+this.options.className+'">'+t+"</"+this.options.wrapElement+">"),this.code=t,"replace"===this.options.method?this.$elem.replaceWith(this.code):"after"===this.options.method?this.$elem.after(this.code):"afterParent"===this.options.method?this.$elem.parent().after(this.code):"replaceParent"===this.options.method&&this.$elem.parent().replaceWith(this.code),this.$elem.trigger("displayed",[this])}},t.embedly=new a,t.fn.embedly=function(i){if(void 0===i||"object"==typeof i){if(i=t.extend({},n,t.embedly.defaults,"object"==typeof i&&i),e(i.key))return t.embedly.log("error","Embedly jQuery requires an API Key. Please sign up for one at http://embed.ly"),this.each(t.noop);var r={},s=function(e){if(!t.data(t(e),"embedly")){var s=t(e).attr("href"),n=new l(e,s,i);t.data(e,"embedly",n),r.hasOwnProperty(s)?r[s].push(n):r[s]=[n]}},o=this.each(function(){e(t(this).attr("href"))?t(this).find("a").each(function(){e(t(this).attr("href"))||s(this)}):s(this)}),h=t.embedly.ajax(i.endpoint,t.map(r,function(t,e){return e}),i).progress(function(e){t.each(r[e.original_url],function(t,i){i.progress(e)})});return i.progress&&h.progress(i.progress),i.done&&h.done(i.done),o}},t.expr[":"].embedly=function(i){return!e(t(i).data("embedly"))}})(jQuery);