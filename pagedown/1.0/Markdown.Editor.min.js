(function(){function e(){}function t(e){this.buttonBar=u.getElementById("wmd-button-bar"+e),this.preview=u.getElementById("wmd-preview"+e),this.input=u.getElementById("wmd-input"+e)}function i(e,t){var i,r,s,o=this,a=[],h=0,c="none",u=function(e,t){c!=e&&(c=e,t||p()),m.isIE&&"moving"==c?s=null:r=setTimeout(d,1)},d=function(e){s=new n(t,e),r=void 0};this.setCommandMode=function(){c="command",p(),r=setTimeout(d,0)},this.canUndo=function(){return h>1},this.canRedo=function(){return a[h+1]?!0:!1},this.undo=function(){o.canUndo()&&(i?(i.restore(),i=null):(a[h]=new n(t),a[--h].restore(),e&&e())),c="none",t.input.focus(),d()},this.redo=function(){o.canRedo()&&(a[++h].restore(),e&&e()),c="none",t.input.focus(),d()};var p=function(){var r=s||new n(t);return r?"moving"==c?(i||(i=r),void 0):(i&&(a[h-1].text!=i.text&&(a[h++]=i),i=null),a[h++]=r,a[h+1]=null,e&&e(),void 0):!1},f=function(e){var t=!1;if(e.ctrlKey||e.metaKey){var i=e.charCode||e.keyCode,n=String.fromCharCode(i);switch(n){case"y":o.redo(),t=!0;break;case"z":e.shiftKey?o.redo():o.undo(),t=!0}}return t?(e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1),void 0):void 0},g=function(e){if(!e.ctrlKey&&!e.metaKey){var t=e.keyCode;t>=33&&40>=t||t>=63232&&63235>=t?u("moving"):8==t||46==t||127==t?u("deleting"):13==t?u("newlines"):27==t?u("escape"):(16>t||t>20)&&91!=t&&u("typing")}},y=function(){l.addEvent(t.input,"keypress",function(e){!e.ctrlKey&&!e.metaKey||89!=e.keyCode&&90!=e.keyCode||e.preventDefault()});var e=function(){(m.isIE||s&&s.text!=t.input.value)&&void 0==r&&(c="paste",p(),d())};l.addEvent(t.input,"keydown",f),l.addEvent(t.input,"keydown",g),l.addEvent(t.input,"mousedown",function(){u("moving")}),t.input.onpaste=e,t.input.ondrop=e},v=function(){y(),d(!0),p()};v()}function n(t,i){var n=this,r=t.input;this.init=function(){l.isVisible(r)&&(i||!u.activeElement||u.activeElement===r)&&(this.setInputAreaSelectionStartEnd(),this.scrollTop=r.scrollTop,(!this.text&&r.selectionStart||0===r.selectionStart)&&(this.text=r.value))},this.setInputAreaSelection=function(){if(l.isVisible(r))if(void 0===r.selectionStart||m.isOpera){if(u.selection){if(u.activeElement&&u.activeElement!==r)return;r.focus();var e=r.createTextRange();e.moveStart("character",-r.value.length),e.moveEnd("character",-r.value.length),e.moveEnd("character",n.end),e.moveStart("character",n.start),e.select()}}else r.focus(),r.selectionStart=n.start,r.selectionEnd=n.end,r.scrollTop=n.scrollTop},this.setInputAreaSelectionStartEnd=function(){if(t.ieCachedRange||!r.selectionStart&&0!==r.selectionStart){if(u.selection){n.text=l.fixEolChars(r.value);var e=t.ieCachedRange||u.selection.createRange(),i=l.fixEolChars(e.text),s="",o=s+i+s;e.text=o;var a=l.fixEolChars(r.value);e.moveStart("character",-o.length),e.text=i,n.start=a.indexOf(s),n.end=a.lastIndexOf(s)-s.length;var h=n.text.length-l.fixEolChars(r.value).length;if(h){for(e.moveStart("character",-i.length);h--;)i+="\n",n.end+=1;e.text=i}t.ieCachedRange&&(n.scrollTop=t.ieCachedScrollTop),t.ieCachedRange=null,this.setInputAreaSelection()}}else n.start=r.selectionStart,n.end=r.selectionEnd},this.restore=function(){void 0!=n.text&&n.text!=r.value&&(r.value=n.text),this.setInputAreaSelection(),r.scrollTop=n.scrollTop},this.getChunks=function(){var t=new e;return t.before=l.fixEolChars(n.text.substring(0,n.start)),t.startTag="",t.selection=l.fixEolChars(n.text.substring(n.start,n.end)),t.endTag="",t.after=l.fixEolChars(n.text.substring(n.end)),t.scrollTop=n.scrollTop,t},this.setChunks=function(e){e.before=e.before+e.startTag,e.after=e.endTag+e.after,this.start=e.before.length,this.end=e.before.length+e.selection.length,this.text=e.before+e.selection+e.after,this.scrollTop=e.scrollTop},this.init()}function r(e,t,i){var n,r,s,o=3e3,a="delayed",c=function(e,t){l.addEvent(e,"input",t),e.onpaste=t,e.ondrop=t,l.addEvent(e,"keypress",t),l.addEvent(e,"keydown",t)},d=function(){var e=0;return window.innerHeight?e=window.pageYOffset:u.documentElement&&u.documentElement.scrollTop?e=u.documentElement.scrollTop:u.body&&(e=u.body.scrollTop),e},p=function(){if(t.preview){var i=t.input.value;if(!i||i!=s){s=i;var n=(new Date).getTime();i=e.makeHtml(i);var o=(new Date).getTime();r=o-n,w(i)}}},f=function(){if(n&&(clearTimeout(n),n=void 0),"manual"!==a){var e=0;"delayed"===a&&(e=r),e>o&&(e=o),n=setTimeout(p,e)}},g=function(e){return e.scrollHeight<=e.clientHeight?1:e.scrollTop/(e.scrollHeight-e.clientHeight)},y=function(){t.preview&&(t.preview.scrollTop=(t.preview.scrollHeight-t.preview.clientHeight)*g(t.preview))};this.refresh=function(e){e?(s="",p()):f()},this.processingTime=function(){return r};var v,b=!0,L=function(e){var i=t.preview,n=i.parentNode,r=i.nextSibling;n.removeChild(i),i.innerHTML=e,r?n.insertBefore(i,r):n.appendChild(i)},x=function(e){t.preview.innerHTML=e},C=function(e){if(v)return v(e);try{x(e),v=x}catch(t){v=L,v(e)}},w=function(e){var n=h.getTop(t.input)-d();if(t.preview&&(C(e),i()),y(),b)return b=!1,void 0;var r=h.getTop(t.input)-d();m.isIE?setTimeout(function(){window.scrollBy(0,r-n)},0):window.scrollBy(0,r-n)},S=function(){c(t.input,f),p(),t.preview&&(t.preview.scrollTop=0)};S()}function s(e,t,i,r,s,o){function a(e){if(g.focus(),e.textOp){i&&i.setCommandMode();var s=new n(t);if(!s)return;var o=s.getChunks(),a=function(){g.focus(),o&&s.setChunks(o),s.restore(),r.refresh()},l=e.textOp(o,a);l||a()}e.execute&&e.execute(i)}function h(e,i){var n="0px",r="-20px",s="-40px",o=e.getElementsByTagName("span")[0];i?(o.style.backgroundPosition=e.XShift+" "+n,e.onmouseover=function(){o.style.backgroundPosition=this.XShift+" "+s},e.onmouseout=function(){o.style.backgroundPosition=this.XShift+" "+n},m.isIE&&(e.onmousedown=function(){u.activeElement&&u.activeElement!==t.input||(t.ieCachedRange=document.selection.createRange(),t.ieCachedScrollTop=t.input.scrollTop)}),e.isHelp||(e.onclick=function(){return this.onmouseout&&this.onmouseout(),a(this),!1})):(o.style.backgroundPosition=e.XShift+" "+r,e.onmouseover=e.onmouseout=e.onclick=function(){})}function c(e){return"string"==typeof e&&(e=s[e]),function(){e.apply(s,arguments)}}function d(){var i=t.buttonBar,n=document.createElement("ul");n.id="wmd-button-row"+e,n.className="wmd-button-row",n=i.appendChild(n);var r=0,s=function(t,i,s,o){var a=document.createElement("li");a.className="wmd-button",a.style.left=r+"px",r+=25;var l=document.createElement("span");return a.id=t+e,a.appendChild(l),a.title=i,a.XShift=s,o&&(a.textOp=o),h(a,!0),n.appendChild(a),a},a=function(t){var i=document.createElement("li");i.className="wmd-spacer wmd-spacer"+t,i.id="wmd-spacer"+t+e,n.appendChild(i),r+=25};y.bold=s("wmd-bold-button","Strong <strong> Ctrl+B","0px",c("doBold")),y.italic=s("wmd-italic-button","Emphasis <em> Ctrl+I","-20px",c("doItalic")),a(1),y.link=s("wmd-link-button","Hyperlink <a> Ctrl+L","-40px",c(function(e,t){return this.doLinkOrImage(e,t,!1)})),y.quote=s("wmd-quote-button","Blockquote <blockquote> Ctrl+Q","-60px",c("doBlockquote")),y.code=s("wmd-code-button","Code Sample <pre><code> Ctrl+K","-80px",c("doCode")),y.image=s("wmd-image-button","Image <img> Ctrl+G","-100px",c(function(e,t){return this.doLinkOrImage(e,t,!0)})),a(2),y.olist=s("wmd-olist-button","Numbered List <ol> Ctrl+O","-120px",c(function(e,t){this.doList(e,t,!0)})),y.ulist=s("wmd-ulist-button","Bulleted List <ul> Ctrl+U","-140px",c(function(e,t){this.doList(e,t,!1)})),y.heading=s("wmd-heading-button","Heading <h1>/<h2> Ctrl+H","-160px",c("doHeading")),y.hr=s("wmd-hr-button","Horizontal Rule <hr> Ctrl+R","-180px",c("doHorizontalRule")),a(3),y.undo=s("wmd-undo-button","Undo - Ctrl+Z","-200px",null),y.undo.execute=function(e){e&&e.undo()};var l=/win/.test(p.platform.toLowerCase())?"Redo - Ctrl+Y":"Redo - Ctrl+Shift+Z";if(y.redo=s("wmd-redo-button",l,"-220px",null),y.redo.execute=function(e){e&&e.redo()},o){var u=document.createElement("li"),d=document.createElement("span");u.appendChild(d),u.className="wmd-button wmd-help-button",u.id="wmd-help-button"+e,u.XShift="-240px",u.isHelp=!0,u.style.right="0px",u.title=o.title||L,u.onclick=o.handler,h(u,!0),n.appendChild(u),y.help=u}f()}function f(){i&&(h(y.undo,i.canUndo()),h(y.redo,i.canRedo()))}var g=t.input,y={};d();var v="keydown";m.isOpera&&(v="keypress"),l.addEvent(g,v,function(e){if((e.ctrlKey||e.metaKey)&&!e.altKey){var t=e.charCode||e.keyCode,i=String.fromCharCode(t).toLowerCase();switch(i){case"b":a(y.bold);break;case"i":a(y.italic);break;case"l":a(y.link);break;case"q":a(y.quote);break;case"k":a(y.code);break;case"g":a(y.image);break;case"o":a(y.olist);break;case"u":a(y.ulist);break;case"h":a(y.heading);break;case"r":a(y.hr);break;case"y":a(y.redo);break;case"z":e.shiftKey?a(y.redo):a(y.undo);break;default:return}e.preventDefault&&e.preventDefault(),window.event&&(window.event.returnValue=!1)}}),l.addEvent(g,"keyup",function(e){if(e.shiftKey&&!e.ctrlKey&&!e.metaKey){var t=e.charCode||e.keyCode;13===t&&(fakeButton={},fakeButton.textOp=c("doAutoindent"),a(fakeButton))}}),m.isIE&&l.addEvent(g,"keydown",function(e){var t=e.keyCode;return 27===t?!1:void 0}),this.setUndoRedoButtonStates=f}function o(e){this.hooks=e}function a(e){return e.replace(/^\s*(.*?)(?:\s+"(.+)")?\s*$/,function(e,t,i){return t=t.replace(/\?.*$/,function(e){return e.replace(/\+/g," ")}),t=decodeURIComponent(t),t=encodeURI(t).replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29"),t=t.replace(/\?.*$/,function(e){return e.replace(/\+/g,"%2b")}),i&&(i=i.trim?i.trim():i.replace(/^\s*/,"").replace(/\s*$/,""),i=$.trim(i).replace(/"/g,"quot;").replace(/\(/g,"&#40;").replace(/\)/g,"&#41;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),i?t+' "'+i+'"':t})}var l={},h={},c={},u=window.document,d=window.RegExp,p=window.navigator,f={lineLength:72},m={isIE:/msie/.test(p.userAgent.toLowerCase()),isIE_5or6:/msie 6/.test(p.userAgent.toLowerCase())||/msie 5/.test(p.userAgent.toLowerCase()),isOpera:/opera/.test(p.userAgent.toLowerCase())},g='<p><b>Insert Hyperlink</b></p><p>http://example.com/ "optional title"</p>',y="<p><b>Insert Image</b></p><p>http://example.com/images/diagram.jpg \"optional title\"<br><br>Need <a href='http://www.google.com/search?q=free+image+hosting' target='_blank'>free image hosting?</a></p>",v="http://",b="http://",L="Markdown Editing Help";Markdown.Editor=function(e,n,a){n=n||"";var l=this.hooks=new Markdown.HookCollection;l.addNoop("onPreviewRefresh"),l.addNoop("postBlockquoteCreation"),l.addFalse("insertImageDialog"),this.getConverter=function(){return e};var h,c=this;this.run=function(){if(!h){h=new t(n);var d,p,f=new o(l),m=new r(e,h,function(){l.onPreviewRefresh()});/\?noundo/.test(u.location.href)||(d=new i(function(){m.refresh(),p&&p.setUndoRedoButtonStates()},h)),p=new s(n,h,d,m,f,a),p.setUndoRedoButtonStates();var g=c.refreshPreview=function(){m.refresh(!0)};g()}}},e.prototype.findTags=function(e,t){var i,n=this;e&&(i=l.extendRegExp(e,"","$"),this.before=this.before.replace(i,function(e){return n.startTag=n.startTag+e,""}),i=l.extendRegExp(e,"^",""),this.selection=this.selection.replace(i,function(e){return n.startTag=n.startTag+e,""})),t&&(i=l.extendRegExp(t,"","$"),this.selection=this.selection.replace(i,function(e){return n.endTag=e+n.endTag,""}),i=l.extendRegExp(t,"^",""),this.after=this.after.replace(i,function(e){return n.endTag=e+n.endTag,""}))},e.prototype.trimWhitespace=function(e){var t,i,n=this;e?t=i="":(t=function(e){return n.before+=e,""},i=function(e){return n.after=e+n.after,""}),this.selection=this.selection.replace(/^(\s*)/,t).replace(/(\s*)$/,i)},e.prototype.skipLines=function(e,t,i){void 0===e&&(e=1),void 0===t&&(t=1),e++,t++;var n,r;if(navigator.userAgent.match(/Chrome/)&&"X".match(/()./),this.selection=this.selection.replace(/(^\n*)/,""),this.startTag=this.startTag+d.$1,this.selection=this.selection.replace(/(\n*$)/,""),this.endTag=this.endTag+d.$1,this.startTag=this.startTag.replace(/(^\n*)/,""),this.before=this.before+d.$1,this.endTag=this.endTag.replace(/(\n*$)/,""),this.after=this.after+d.$1,this.before){for(n=r="";e--;)n+="\\n?",r+="\n";i&&(n="\\n*"),this.before=this.before.replace(new d(n+"$",""),r)}if(this.after){for(n=r="";t--;)n+="\\n?",r+="\n";i&&(n="\\n*"),this.after=this.after.replace(new d(n,""),r)}},l.isVisible=function(e){return window.getComputedStyle?"none"!==window.getComputedStyle(e,null).getPropertyValue("display"):e.currentStyle?"none"!==e.currentStyle.display:void 0},l.addEvent=function(e,t,i){e.attachEvent?e.attachEvent("on"+t,i):e.addEventListener(t,i,!1)},l.removeEvent=function(e,t,i){e.detachEvent?e.detachEvent("on"+t,i):e.removeEventListener(t,i,!1)},l.fixEolChars=function(e){return e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n")},l.extendRegExp=function(e,t,i){(null===t||void 0===t)&&(t=""),(null===i||void 0===i)&&(i="");var n,r=""+e;return r=r.replace(/\/([gim]*)$/,""),n=d.$1,r=r.replace(/(^\/|\/$)/g,""),r=t+r+i,new d(r,n)},h.getTop=function(e,t){var i=e.offsetTop;if(!t)for(;e=e.offsetParent;)i+=e.offsetTop;return i},h.getHeight=function(e){return e.offsetHeight||e.scrollHeight},h.getWidth=function(e){return e.offsetWidth||e.scrollWidth},h.getPageSize=function(){var e,t,i,n;self.innerHeight&&self.scrollMaxY?(e=u.body.scrollWidth,t=self.innerHeight+self.scrollMaxY):u.body.scrollHeight>u.body.offsetHeight?(e=u.body.scrollWidth,t=u.body.scrollHeight):(e=u.body.offsetWidth,t=u.body.offsetHeight),self.innerHeight?(i=self.innerWidth,n=self.innerHeight):u.documentElement&&u.documentElement.clientHeight?(i=u.documentElement.clientWidth,n=u.documentElement.clientHeight):u.body&&(i=u.body.clientWidth,n=u.body.clientHeight);var r=Math.max(e,i),s=Math.max(t,n);return[r,s,i,n]},c.createBackground=function(){var e=u.createElement("div"),t=e.style;e.className="wmd-prompt-background",t.position="absolute",t.top="0",t.zIndex="1000",m.isIE?t.filter="alpha(opacity=50)":t.opacity="0.5";var i=h.getPageSize();return t.height=i[1]+"px",m.isIE?(t.left=u.documentElement.scrollLeft,t.width=u.documentElement.clientWidth):(t.left="0",t.width="100%"),u.body.appendChild(e),e},c.prompt=function(e,t,i){var n,r;void 0===t&&(t="");var s=function(e){var t=e.charCode||e.keyCode;27===t&&o(!0)},o=function(e){l.removeEvent(u.body,"keydown",s);var t=r.value;return e?t=null:(t=t.replace("http://http://","http://"),t=t.replace("http://https://","https://"),t=t.replace("http://ftp://","ftp://"),-1===t.indexOf("http://")&&-1===t.indexOf("ftp://")&&-1===t.indexOf("https://")&&(t="http://"+t)),n.parentNode.removeChild(n),i(t),!1},a=function(){n=u.createElement("div"),n.className="wmd-prompt-dialog",n.style.padding="10px;",n.style.position="fixed",n.style.width="400px",n.style.zIndex="1001";var i=u.createElement("div");i.innerHTML=e,i.style.padding="5px",n.appendChild(i);var a=u.createElement("form"),c=a.style;a.onsubmit=function(){return o(!1)},c.padding="0",c.margin="0",c.cssFloat="left",c.width="100%",c.textAlign="center",c.position="relative",n.appendChild(a),r=u.createElement("input"),r.type="text",r.value=t,c=r.style,c.display="block",c.width="80%",c.marginLeft=c.marginRight="auto",a.appendChild(r);var d=u.createElement("input");d.type="button",d.onclick=function(){return o(!1)},d.value="OK",c=d.style,c.margin="10px",c.display="inline",c.width="7em";var p=u.createElement("input");p.type="button",p.onclick=function(){return o(!0)},p.value="Cancel",c=p.style,c.margin="10px",c.display="inline",c.width="7em",a.appendChild(d),a.appendChild(p),l.addEvent(u.body,"keydown",s),n.style.top="50%",n.style.left="50%",n.style.display="block",m.isIE_5or6&&(n.style.position="absolute",n.style.top=u.documentElement.scrollTop+200+"px",n.style.left="50%"),u.body.appendChild(n),n.style.marginTop=-(h.getHeight(n)/2)+"px",n.style.marginLeft=-(h.getWidth(n)/2)+"px"};setTimeout(function(){a();var e=t.length;if(void 0!==r.selectionStart)r.selectionStart=0,r.selectionEnd=e;else if(r.createTextRange){var i=r.createTextRange();i.collapse(!1),i.moveStart("character",-e),i.moveEnd("character",e),i.select()}r.focus()},0)};var x=o.prototype;x.prefixes="(?:\\s{4,}|\\s*>|\\s*-\\s+|\\s*\\d+\\.|=|\\+|-|_|\\*|#|\\s*\\[[^\n]]+\\]:)",x.unwrap=function(e){var t=new d("([^\\n])\\n(?!(\\n|"+this.prefixes+"))","g");e.selection=e.selection.replace(t,"$1 $2")},x.wrap=function(e,t){this.unwrap(e);var i=new d("(.{1,"+t+"})( +|$\\n?)","gm"),n=this;e.selection=e.selection.replace(i,function(e,t){return new d("^"+n.prefixes,"").test(e)?e:t+"\n"}),e.selection=e.selection.replace(/\s+$/,"")},x.doBold=function(e,t){return this.doBorI(e,t,2,"strong text")},x.doItalic=function(e,t){return this.doBorI(e,t,1,"emphasized text")},x.doBorI=function(e,t,i,n){e.trimWhitespace(),e.selection=e.selection.replace(/\n{2,}/g,"\n");var r=/(\**$)/.exec(e.before)[0],s=/(^\**)/.exec(e.after)[0],o=Math.min(r.length,s.length);if(o>=i&&(2!=o||1!=i))e.before=e.before.replace(d("[*]{"+i+"}$",""),""),e.after=e.after.replace(d("^[*]{"+i+"}",""),"");else if(!e.selection&&s){e.after=e.after.replace(/^([*_]*)/,""),e.before=e.before.replace(/(\s?)$/,"");var a=d.$1;e.before=e.before+s+a}else{e.selection||s||(e.selection=n);var l=1>=i?"*":"**";e.before=e.before+l,e.after=l+e.after}},x.stripLinkDefs=function(e,t){return e=e.replace(/^[ ]{0,3}\[(\d+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|$)/gm,function(e,i,n,r,s){return t[i]=e.replace(/\s*$/,""),r?(t[i]=e.replace(/["(](.+?)[")]$/,""),r+s):""})},x.addLinkDef=function(e,t){var i=0,n={};e.before=this.stripLinkDefs(e.before,n),e.selection=this.stripLinkDefs(e.selection,n),e.after=this.stripLinkDefs(e.after,n);var r="",s=/(\[)((?:\[[^\]]*\]|[^\[\]])*)(\][ ]?(?:\n[ ]*)?\[)(\d+)(\])/g,o=function(e){i++,e=e.replace(/^[ ]{0,3}\[(\d+)\]:/,"  ["+i+"]:"),r+="\n"+e},a=function(e,t,r,l,h,c){return r=r.replace(s,a),n[h]?(o(n[h]),t+r+l+i+c):e};e.before=e.before.replace(s,a),t?o(t):e.selection=e.selection.replace(s,a);var l=i;return e.after=e.after.replace(s,a),e.after&&(e.after=e.after.replace(/\n*$/,"")),e.after||(e.selection=e.selection.replace(/\n*$/,"")),e.after+="\n\n"+r,l},x.doLinkOrImage=function(e,t,i){e.trimWhitespace(),e.findTags(/\s*!?\[/,/\][ ]?(?:\n[ ]*)?(\[.*?\])?/);var n;if(!(e.endTag.length>1&&e.startTag.length>0)){if(e.selection=e.startTag+e.selection+e.endTag,e.startTag=e.endTag="",/\n\n/.test(e.selection))return this.addLinkDef(e,null),void 0;var r=this,s=function(s){if(n.parentNode.removeChild(n),null!==s){e.selection=(" "+e.selection).replace(/([^\\](?:\\\\)*)(?=[[\]])/g,"$1\\").substr(1);var o=" [999]: "+a(s),l=r.addLinkDef(e,o);e.startTag=i?"![":"[",e.endTag="]["+l+"]",e.selection||(e.selection=i?"enter image description here":"enter link description here")}t()};return n=c.createBackground(),i?this.hooks.insertImageDialog(s)||c.prompt(y,v,s):c.prompt(g,b,s),!0}e.startTag=e.startTag.replace(/!?\[/,""),e.endTag="",this.addLinkDef(e,null)},x.doAutoindent=function(e){var t=this;e.before=e.before.replace(/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ ]{0,3}>[ \t]*\n$/,"\n\n"),e.before=e.before.replace(/(\n|^)[ \t]+\n$/,"\n\n"),/(\n|^)[ ]{0,3}([*+-]|\d+[.])[ \t]+.*\n$/.test(e.before)&&t.doList&&t.doList(e),/(\n|^)[ ]{0,3}>[ \t]+.*\n$/.test(e.before)&&t.doBlockquote&&t.doBlockquote(e),/(\n|^)(\t|[ ]{4,}).*\n$/.test(e.before)&&t.doCode&&t.doCode(e)},x.doBlockquote=function(e){e.selection=e.selection.replace(/^(\n*)([^\r]+?)(\n*)$/,function(t,i,n,r){return e.before+=i,e.after=r+e.after,n}),e.before=e.before.replace(/(>[ \t]*)$/,function(t,i){return e.selection=i+e.selection,""}),e.selection=e.selection.replace(/^(\s|>)+$/,""),e.selection=e.selection||"Blockquote";var t,i="",n="";if(e.before){for(var r=e.before.replace(/\n$/,"").split("\n"),s=!1,o=0;r.length>o;o++){var a=!1;t=r[o],s=s&&t.length>0,/^>/.test(t)?(a=!0,!s&&t.length>1&&(s=!0)):a=/^[ \t]*$/.test(t)?!0:s,a?i+=t+"\n":(n+=i+t,i="\n")}/(^|\n)>/.test(i)||(n+=i,i="")}e.startTag=i,e.before=n,e.after&&(e.after=e.after.replace(/^\n?/,"\n")),e.after=e.after.replace(/^(((\n|^)(\n[ \t]*)*>(.+\n)*.*)+(\n[ \t]*)*)/,function(t){return e.endTag=t,""});var l=function(t){var i=t?"> ":"";e.startTag&&(e.startTag=e.startTag.replace(/\n((>|\s)*)\n$/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,i)+"\n"})),e.endTag&&(e.endTag=e.endTag.replace(/^\n((>|\s)*)\n/,function(e,t){return"\n"+t.replace(/^[ ]{0,3}>?[ \t]*$/gm,i)+"\n"}))};/^(?![ ]{0,3}>)/m.test(e.selection)?(this.wrap(e,f.lineLength-2),e.selection=e.selection.replace(/^/gm,"> "),l(!0),e.skipLines()):(e.selection=e.selection.replace(/^[ ]{0,3}> ?/gm,""),this.unwrap(e),l(!1),!/^(\n|^)[ ]{0,3}>/.test(e.selection)&&e.startTag&&(e.startTag=e.startTag.replace(/\n{0,2}$/,"\n\n")),!/(\n|^)[ ]{0,3}>.*$/.test(e.selection)&&e.endTag&&(e.endTag=e.endTag.replace(/^\n{0,2}/,"\n\n"))),e.selection=this.hooks.postBlockquoteCreation(e.selection),/\n/.test(e.selection)||(e.selection=e.selection.replace(/^(> *)/,function(t,i){return e.startTag+=i,""}))},x.doCode=function(e){var t=/\S[ ]*$/.test(e.before),i=/^[ ]*\S/.test(e.after);if(!i&&!t||/\n/.test(e.selection)){e.before=e.before.replace(/[ ]{4}$/,function(t){return e.selection=t+e.selection,""});var n=1,r=1;/\n(\t|[ ]{4,}).*\n$/.test(e.before)&&(n=0),/^\n(\t|[ ]{4,})/.test(e.after)&&(r=0),e.skipLines(n,r),e.selection?e.selection=/^[ ]{0,3}\S/m.test(e.selection)?e.selection.replace(/^/gm,"    "):e.selection.replace(/^[ ]{4}/gm,""):(e.startTag="    ",e.selection="enter code here")}else e.trimWhitespace(),e.findTags(/`/,/`/),e.startTag||e.endTag?e.endTag&&!e.startTag?(e.before+=e.endTag,e.endTag=""):e.startTag=e.endTag="":(e.startTag=e.endTag="`",e.selection||(e.selection="enter code here"))},x.doList=function(e,t,i){var n=/(\n|^)(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*$/,r=/^\n*(([ ]{0,3}([*+-]|\d+[.])[ \t]+.*)(\n.+|\n{2,}([*+-].*|\d+[.])[ \t]+.*|\n{2,}[ \t]+\S.*)*)\n*/,s="-",o=1,a=function(){var e;return i?(e=" "+o+". ",o++):e=" "+s+" ",e},l=function(e){return void 0===i&&(i=/^\s*\d/.test(e)),e=e.replace(/^[ ]{0,3}([*+-]|\d+[.])\s/gm,function(){return a()})};if(e.findTags(/(\n|^)*[ ]{0,3}([*+-]|\d+[.])\s+/,null),!e.before||/\n$/.test(e.before)||/^\n/.test(e.startTag)||(e.before+=e.startTag,e.startTag=""),e.startTag){var h=/\d+[.]/.test(e.startTag);if(e.startTag="",e.selection=e.selection.replace(/\n[ ]{4}/g,"\n"),this.unwrap(e),e.skipLines(),h&&(e.after=e.after.replace(r,l)),i==h)return}var c=1;e.before=e.before.replace(n,function(e){return/^\s*([*+-])/.test(e)&&(s=d.$1),c=/[^\n]\n\n[^\n]/.test(e)?1:0,l(e)}),e.selection||(e.selection="List item");var u=a(),p=1;e.after=e.after.replace(r,function(e){return p=/[^\n]\n\n[^\n]/.test(e)?1:0,l(e)}),e.trimWhitespace(!0),e.skipLines(c,p,!0),e.startTag=u;var m=u.replace(/./g," ");this.wrap(e,f.lineLength-m.length),e.selection=e.selection.replace(/\n/g,"\n"+m)},x.doHeading=function(e){if(e.selection=e.selection.replace(/\s+/g," "),e.selection=e.selection.replace(/(^\s+|\s+$)/g,""),!e.selection)return e.startTag="## ",e.selection="Heading",e.endTag=" ##",void 0;var t=0;e.findTags(/#+[ ]*/,/[ ]*#+/),/#+/.test(e.startTag)&&(t=d.lastMatch.length),e.startTag=e.endTag="",e.findTags(null,/\s?(-+|=+)/),/=+/.test(e.endTag)&&(t=1),/-+/.test(e.endTag)&&(t=2),e.startTag=e.endTag="",e.skipLines(1,1);var i=0==t?2:t-1;if(i>0){var n=i>=2?"-":"=",r=e.selection.length;for(r>f.lineLength&&(r=f.lineLength),e.endTag="\n";r--;)e.endTag+=n}},x.doHorizontalRule=function(e){e.startTag="----------\n",e.selection="",e.skipLines(2,1,!0)}})();