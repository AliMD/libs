Proj4js.Proj.stere={ssfn_:function(e,t,i){return t*=i,Math.tan(.5*(Proj4js.common.HALF_PI+e))*Math.pow((1-t)/(1+t),.5*i)},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var e=Math.abs(this.lat0);if(this.mode=Math.abs(e)-Proj4js.common.HALF_PI<Proj4js.common.EPSLN?0>this.lat0?this.S_POLE:this.N_POLE:e>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT,this.phits=Math.abs(this.phits),this.es){var t;switch(this.mode){case this.N_POLE:case this.S_POLE:Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e)):(e=Math.sin(this.phits),this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,e),e*=this.e,this.akm1/=Math.sqrt(1-e*e));break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:e=Math.sin(this.lat0),t=2*Math.atan(this.ssfn_(this.lat0,e,this.e))-Proj4js.common.HALF_PI,e*=this.e,this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-e*e),this.sinX1=Math.sin(t),this.cosX1=Math.cos(t)}}else switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0),this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2*this.k0}},forward:function(e){var t=e.x;t=Proj4js.common.adjust_lon(t-this.long0);var i,n,r=e.y;if(this.sphere){var s,o,a,l;switch(s=Math.sin(r),o=Math.cos(r),a=Math.cos(t),l=Math.sin(t),this.mode){case this.EQUIT:n=1+o*a,Proj4js.common.EPSLN>=n&&Proj4js.reportError("stere:forward:Equit"),n=this.akm1/n,i=n*o*l,n*=s;break;case this.OBLIQ:n=1+this.sinph0*s+this.cosph0*o*a,Proj4js.common.EPSLN>=n&&Proj4js.reportError("stere:forward:Obliq"),n=this.akm1/n,i=n*o*l,n*=this.cosph0*s-this.sinph0*o*a;break;case this.N_POLE:a=-a,r=-r;case this.S_POLE:Math.abs(r-Proj4js.common.HALF_PI)<this.TOL&&Proj4js.reportError("stere:forward:S_POLE"),n=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*r),i=l*n,n*=a}}else{a=Math.cos(t),l=Math.sin(t),s=Math.sin(r);var h,c;if(this.mode==this.OBLIQ||this.mode==this.EQUIT){var u=2*Math.atan(this.ssfn_(r,s,this.e));h=Math.sin(u-Proj4js.common.HALF_PI),c=Math.cos(u)}switch(this.mode){case this.OBLIQ:var d=this.akm1/(this.cosX1*(1+this.sinX1*h+this.cosX1*c*a));n=d*(this.cosX1*h-this.sinX1*c*a),i=d*c;break;case this.EQUIT:var d=2*this.akm1/(1+c*a);n=d*h,i=d*c;break;case this.S_POLE:r=-r,a=-a,s=-s;case this.N_POLE:i=this.akm1*Proj4js.common.tsfnz(this.e,r,s),n=-i*a}i*=l}return e.x=i*this.a+this.x0,e.y=n*this.a+this.y0,e},inverse:function(e){var t,i,n,r,s,o,a=(e.x-this.x0)/this.a,l=(e.y-this.y0)/this.a,h=0,c=0,u=0,d=0;if(this.sphere){var p,f,m,g;switch(f=Math.sqrt(a*a+l*l),p=2*Math.atan(f/this.akm1),m=Math.sin(p),g=Math.cos(p),t=0,this.mode){case this.EQUIT:i=Math.abs(f)<=Proj4js.common.EPSLN?0:Math.asin(l*m/f),(0!=g||0!=a)&&(t=Math.atan2(a*m,g*f));break;case this.OBLIQ:i=Math.abs(f)<=Proj4js.common.EPSLN?this.phi0:Math.asin(g*this.sinph0+l*m*this.cosph0/f),p=g-this.sinph0*Math.sin(i),(0!=p||0!=a)&&(t=Math.atan2(a*m*this.cosph0,p*f));break;case this.N_POLE:l=-l;case this.S_POLE:i=Math.abs(f)<=Proj4js.common.EPSLN?this.phi0:Math.asin(this.mode==this.S_POLE?-g:g),t=0==a&&0==l?0:Math.atan2(a,l)}e.x=Proj4js.common.adjust_lon(t+this.long0),e.y=i}else{switch(s=Math.sqrt(a*a+l*l),this.mode){case this.OBLIQ:case this.EQUIT:h=2*Math.atan2(s*this.cosX1,this.akm1),n=Math.cos(h),r=Math.sin(h),c=0==s?Math.asin(n*this.sinX1):Math.asin(n*this.sinX1+l*r*this.cosX1/s),h=Math.tan(.5*(Proj4js.common.HALF_PI+c)),a*=r,l=s*this.cosX1*n-l*this.sinX1*r,d=Proj4js.common.HALF_PI,u=.5*this.e;break;case this.N_POLE:l=-l;case this.S_POLE:h=-s/this.akm1,c=Proj4js.common.HALF_PI-2*Math.atan(h),d=-Proj4js.common.HALF_PI,u=-.5*this.e}for(o=this.NITER;o--;c=i)if(r=this.e*Math.sin(c),i=2*Math.atan(h*Math.pow((1+r)/(1-r),u))-d,Math.abs(c-i)<this.CONV)return this.mode==this.S_POLE&&(i=-i),t=0==a&&0==l?0:Math.atan2(a,l),e.x=Proj4js.common.adjust_lon(t+this.long0),e.y=i,e}}};