(function(e,t,n,r,i,a){function o(e,t){var n=typeof e[t];return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function s(e,t){return!("object"!=typeof e[t]||!e[t])}function l(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(){var e="Shockwave Flash",t="application/x-shockwave-flash";if(!y(navigator.plugins)&&"object"==typeof navigator.plugins[e]){var n=navigator.plugins[e].description;n&&!y(navigator.mimeTypes)&&navigator.mimeTypes[t]&&navigator.mimeTypes[t].enabledPlugin&&(A=n.match(/\d+/g))}if(!A){var r;try{r=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),A=Array.prototype.slice.call(r.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),r=null}catch(i){}}if(!A)return!1;var a=parseInt(A[0],10),o=parseInt(A[1],10);return R=a>9&&o>0,!0}function u(){if(!q){q=!0,H("firing dom_onReady");for(var e=0;W.length>e;e++)W[e]();W.length=0}}function d(e,t){return q?(e.call(t),void 0):(W.push(function(){e.call(t)}),void 0)}function p(){var e=parent;if(""!==M)for(var t=0,n=M.split(".");n.length>t;t++){if(!e)throw Error(n.slice(0,t+1).join(".")+" is not an object");e=e[n[t]]}if(!e||!e.easyXDM)throw Error("Could not find easyXDM in parent."+M);return e.easyXDM}function h(t){if("string"!=typeof t||!t)throw Error("namespace must be a non-empty string");return H("Settings namespace to '"+t+"'"),e.easyXDM=j,M=t,M&&(K="easyXDM_"+M.replace(".","_")+"_"),z}function m(e){if(!e)throw Error("url is undefined or empty");return e.match(F)[3]}function g(e){if(!e)throw Error("url is undefined or empty");return e.match(F)[4]||""}function f(e){if(!e)throw Error("url is undefined or empty");if(/^file/.test(e))throw Error("The file:// protocol is not supported");var t=e.toLowerCase().match(F),n=t[2],r=t[3],i=t[4]||"";return("http:"==n&&":80"==i||"https:"==n&&":443"==i)&&(i=""),n+"//"+r+i}function b(e){if(!e)throw Error("url is undefined or empty");if(e=e.replace(B,"$1/"),!e.match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":n.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=n.protocol+"//"+n.host+t+e}for(;P.test(e);)e=e.replace(P,"");return H("resolved url '"+e+"'"),e}function v(e,t){if(!t)throw Error("parameters is undefined or null");var n="",r=e.indexOf("#");-1!==r&&(n=e.substring(r),e=e.substring(0,r));var i=[];for(var o in t)t.hasOwnProperty(o)&&i.push(o+"="+a(t[o]));return e+($?"#":-1==e.indexOf("?")?"?":"&")+i.join("&")+n}function y(e){return e===void 0}function _(e,t,n){var r;for(var i in t)t.hasOwnProperty(i)&&(i in e?(r=t[i],"object"==typeof r?_(e[i],r,n):n||(e[i]=t[i])):e[i]=t[i]);return e}function k(){var e=t.body.appendChild(t.createElement("form")),n=e.appendChild(t.createElement("input"));n.name=K+"TEST"+L,S=n!==e.elements[n.name],t.body.removeChild(e),H("HAS_NAME_PROPERTY_BUG: "+S)}function w(e){H("creating frame: "+e.props.src),y(S)&&k();var n;S?n=t.createElement('<iframe name="'+e.props.name+'"/>'):(n=t.createElement("IFRAME"),n.name=e.props.name),n.id=n.name=e.props.name,delete e.props.name,"string"==typeof e.container&&(e.container=t.getElementById(e.container)),e.container||(_(n.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=t.body);var r=e.props.src;if(e.props.src="javascript:false",_(n,e.props),n.border=n.frameBorder=0,n.allowTransparency=!0,e.container.appendChild(n),e.onLoad&&I(n,"load",e.onLoad),e.usePost){var i,a=e.container.appendChild(t.createElement("form"));if(a.target=n.name,a.action=r,a.method="POST","object"==typeof e.usePost)for(var o in e.usePost)e.usePost.hasOwnProperty(o)&&(S?i=t.createElement('<input name="'+o+'"/>'):(i=t.createElement("INPUT"),i.name=o),i.value=e.usePost[o],a.appendChild(i));a.submit(),a.parentNode.removeChild(a)}else n.src=r;return e.props.src=r,n}function E(e,t){"string"==typeof e&&(e=[e]);for(var n,r=e.length;r--;)if(n=e[r],n=RegExp("^"==n.substr(0,1)?n:"^"+n.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),n.test(t))return!0;return!1}function C(r){var i,a=r.protocol;if(r.isHost=r.isHost||y(G.xdm_p),$=r.hash||!1,H("preparing transport stack"),r.props||(r.props={}),r.isHost)r.remote=b(r.remote),r.channel=r.channel||"default"+L++,r.secret=Math.random().toString(16).substring(2),y(a)?(a=f(n.href)==f(r.remote)?"4":o(e,"postMessage")||o(t,"postMessage")?"1":r.swf&&o(e,"ActiveXObject")&&c()?"6":"Gecko"===navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?"5":r.remoteHelper?"2":"0",H("selecting protocol: "+a)):H("using protocol: "+a);else if(H("using parameters from query"),r.channel=G.xdm_c.replace(/["'<>\\]/g,""),r.secret=G.xdm_s,r.remote=G.xdm_e.replace(/["'<>\\]/g,""),a=G.xdm_p,r.acl&&!E(r.acl,r.remote))throw Error("Access denied for "+r.remote);switch(r.protocol=a,a){case"0":if(_(r,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),r.isHost){if(!r.local){H("looking for image to use as local");for(var s,l=n.protocol+"//"+n.host,u=t.body.getElementsByTagName("img"),d=u.length;d--;)if(s=u[d],s.src.substring(0,l.length)===l){r.local=s.src;break}r.local||(H("no image found, defaulting to using the window"),r.local=e)}var p={xdm_c:r.channel,xdm_p:0};r.local===e?(r.usePolling=!0,r.useParent=!0,r.local=n.protocol+"//"+n.host+n.pathname+n.search,p.xdm_e=r.local,p.xdm_pa=1):p.xdm_e=b(r.local),r.container&&(r.useResize=!1,p.xdm_po=1),r.remote=v(r.remote,p)}else _(r,{channel:G.xdm_c,remote:G.xdm_e,useParent:!y(G.xdm_pa),usePolling:!y(G.xdm_po),useResize:r.useParent?!1:r.useResize});i=[new z.stack.HashTransport(r),new z.stack.ReliableBehavior({}),new z.stack.QueueBehavior({encode:!0,maxLength:4e3-r.remote.length}),new z.stack.VerifyBehavior({initiate:r.isHost})];break;case"1":i=[new z.stack.PostMessageTransport(r)];break;case"2":r.remoteHelper=b(r.remoteHelper),i=[new z.stack.NameTransport(r),new z.stack.QueueBehavior,new z.stack.VerifyBehavior({initiate:r.isHost})];break;case"3":i=[new z.stack.NixTransport(r)];break;case"4":i=[new z.stack.SameOriginTransport(r)];break;case"5":i=[new z.stack.FrameElementTransport(r)];break;case"6":A||c(),i=[new z.stack.FlashTransport(r)]}return i.push(new z.stack.QueueBehavior({lazy:r.lazy,remove:!0})),i}function T(e){for(var t,n={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},r=0,i=e.length;i>r;r++)t=e[r],_(t,n,!0),0!==r&&(t.down=e[r-1]),r!==i-1&&(t.up=e[r+1]);return t}function x(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var S,A,R,I,D,O=this,L=Math.floor(1e4*Math.random()),N=Function.prototype,F=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,P=/[\-\w]+\/\.\.\//,B=/([^:])\/\//g,M="",z={},j=e.easyXDM,K="easyXDM_",$=!1,H=N;if(o(e,"addEventListener"))I=function(e,t,n){H("adding listener "+t),e.addEventListener(t,n,!1)},D=function(e,t,n){H("removing listener "+t),e.removeEventListener(t,n,!1)};else{if(!o(e,"attachEvent"))throw Error("Browser not supported");I=function(e,t,n){H("adding listener "+t),e.attachEvent("on"+t,n)},D=function(e,t,n){H("removing listener "+t),e.detachEvent("on"+t,n)}}var U,q=!1,W=[];if("readyState"in t?(U=t.readyState,q="complete"==U||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==U||"interactive"==U)):q=!!t.body,!q){if(o(e,"addEventListener"))I(t,"DOMContentLoaded",u);else if(I(t,"readystatechange",function(){"complete"==t.readyState&&u()}),t.documentElement.doScroll&&e===top){var V=function(){if(!q){try{t.documentElement.doScroll("left")}catch(e){return r(V,1),void 0}u()}};V()}I(e,"load",u)}var G=function(e){e=e.substring(1).split("&");for(var t,n={},r=e.length;r--;)t=e[r].split("="),n[t[0]]=i(t[1]);return n}(/xdm_e=/.test(n.search)?n.search:n.hash),Y=function(){var e={},t={a:[1,2,3]},n='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(t).replace(/\s/g,"")===n?JSON:(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")===n&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(t=n.evalJSON(),t.a&&3===t.a.length&&3===t.a[2]&&(e.parse=function(e){return e.evalJSON()})),e.stringify&&e.parse?(Y=function(){return e},e):null)};_(z,{version:"2.4.17.1",query:G,stack:{},apply:_,getJSONObject:Y,whenReady:d,noConflict:h}),_(z,{checkAcl:E,getDomainName:m,getLocation:f,appendQueryParameters:v});var J={_deferred:[],flush:function(){this.trace("... deferred messages ...");for(var e=0,t=this._deferred.length;t>e;e++)this.trace(this._deferred[e]);this._deferred.length=0,this.trace("... end of deferred messages ...")},getTime:function(){var e=new Date,t=e.getHours()+"",n=e.getMinutes()+"",r=e.getSeconds()+"",i=e.getMilliseconds()+"",a="000";return 1==t.length&&(t="0"+t),1==n.length&&(n="0"+n),1==r.length&&(r="0"+r),i=a.substring(i.length)+i,t+":"+n+":"+r+"."+i},log:function(t){this.log=!s(e,"console")||y(console.log)?N:function(e){console.log(n.host+(M?":"+M:"")+" - "+this.getTime()+": "+e)},this.log(t)},trace:function(r){if(q){var i=t.getElementById("log");if(i)this.trace=function(e){try{i.appendChild(t.createElement("div")).appendChild(t.createTextNode(n.host+(M?":"+M:"")+" - "+this.getTime()+":"+e)),i.scrollTop=i.scrollHeight}catch(r){}};else if(s(e,"console")&&!y(console.info))this.trace=function(e){console.info(n.host+(M?":"+M:"")+" - "+this.getTime()+":"+e)};else{var a,o=n.host,l=o.replace(/[\-.:]/g,"")+"easyxdm_log";try{a=e.open("",l,"width=800,height=200,status=0,navigation=0,scrollbars=1")}catch(c){}if(a){var u=a.document;i=u.getElementById("log"),i||(u.write("<html><head><title>easyXDM log "+o+"</title></head>"),u.write('<body><div id="log"></div></body></html>'),u.close(),i=u.getElementById("log")),this.trace=function(e){try{i.appendChild(u.createElement("div")).appendChild(u.createTextNode(n.host+(M?":"+M:"")+" - "+this.getTime()+":"+e)),i.scrollTop=i.scrollHeight}catch(t){}},this.trace("---- new logger at "+n.href)}i||(this.trace=N)}this.trace(r)}else 0===this._deferred.length&&z.whenReady(J.flush,J),this._deferred.push(r),this.log(r)},getTracer:function(e){return function(t){J.trace(e+": "+t)}}};J.log("easyXDM present on '"+n.href),z.Debug=J,H=J.getTracer("{Private}"),z.DomHelper={on:I,un:D,requiresJSON:function(n){s(e,"JSON")?J.log("native JSON found"):(J.log("loading external JSON"),t.write('<script type="text/javascript" src="'+n+'"><'+"/script>"))}},function(){var e={};z.Fn={set:function(t,n){this._trace("storing function "+t),e[t]=n},get:function(t,n){this._trace("retrieving function "+t);var r=e[t];return r||this._trace(t+" not found"),n&&delete e[t],r}},z.Fn._trace=J.getTracer("easyXDM.Fn")}(),z.Socket=function(e){var t=J.getTracer("easyXDM.Socket");t("constructor");var n=T(C(e).concat([{incoming:function(t,n){e.onMessage(t,n)},callback:function(t){e.onReady&&e.onReady(t)}}])),r=f(e.remote);this.origin=f(e.remote),this.destroy=function(){n.destroy()},this.postMessage=function(e){n.outgoing(e,r)},n.init()},z.Rpc=function(e,t){var n=J.getTracer("easyXDM.Rpc");if(n("constructor"),t.local)for(var r in t.local)if(t.local.hasOwnProperty(r)){var i=t.local[r];"function"==typeof i&&(t.local[r]={method:i})}var a=T(C(e).concat([new z.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=f(e.remote),this.destroy=function(){a.destroy()},a.init()},z.stack.SameOriginTransport=function(e){var t=J.getTracer("easyXDM.stack.SameOriginTransport");t("constructor");var i,a,o,s;return i={outgoing:function(e,t,n){o(e),n&&n()},destroy:function(){t("destroy"),a&&(a.parentNode.removeChild(a),a=null)},onDOMReady:function(){t("init"),s=f(e.remote),e.isHost?(_(e.props,{src:v(e.remote,{xdm_e:n.protocol+"//"+n.host+n.pathname,xdm_c:e.channel,xdm_p:4}),name:K+e.channel+"_provider"}),a=w(e),z.Fn.set(e.channel,function(e){return o=e,r(function(){i.up.callback(!0)},0),function(e){i.up.incoming(e,s)}})):(o=p().Fn.get(e.channel,!0)(function(e){i.up.incoming(e,s)}),r(function(){i.up.callback(!0)},0))},init:function(){d(i.onDOMReady,i)}}},z.stack.FlashTransport=function(e){function i(e){r(function(){o("received message"),s.up.incoming(e,c)},0)}function a(n){o("creating factory with SWF from "+n);var r=e.swf+"?host="+e.isHost,i="easyXDM_swf_"+Math.floor(1e4*Math.random());z.Fn.set("flash_loaded"+n.replace(/[\-.]/g,"_"),function(){z.stack.FlashTransport[n].swf=u=p.firstChild;for(var e=z.stack.FlashTransport[n].queue,t=0;e.length>t;t++)e[t]();e.length=0}),e.swfContainer?p="string"==typeof e.swfContainer?t.getElementById(e.swfContainer):e.swfContainer:(p=t.createElement("div"),_(p.style,R&&e.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),t.body.appendChild(p));var a="callback=flash_loaded"+n.replace(/[\-.]/g,"_")+"&proto="+O.location.protocol+"&domain="+m(O.location.href)+"&port="+g(O.location.href)+"&ns="+M;a+="&log=true",p.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+i+"' data='"+r+"'>"+"<param name='allowScriptAccess' value='always'></param>"+"<param name='wmode' value='transparent'>"+"<param name='movie' value='"+r+"'></param>"+"<param name='flashvars' value='"+a+"'></param>"+"<embed type='application/x-shockwave-flash' FlashVars='"+a+"' allowScriptAccess='always' wmode='transparent' src='"+r+"' height='1' width='1'></embed>"+"</object>"}var o=J.getTracer("easyXDM.stack.FlashTransport");if(o("constructor"),!e.swf)throw Error("Path to easyxdm.swf is missing");var s,l,c,u,p;return s={outgoing:function(t,n,r){u.postMessage(e.channel,""+t),r&&r()},destroy:function(){o("destroy");try{u.destroyChannel(e.channel)}catch(t){}u=null,l&&(l.parentNode.removeChild(l),l=null)},onDOMReady:function(){o("init"),c=e.remote,z.Fn.set("flash_"+e.channel+"_init",function(){r(function(){o("firing onReady"),s.up.callback(!0)})}),z.Fn.set("flash_"+e.channel+"_onMessage",i),e.swf=b(e.swf);var t=m(e.swf),d=function(){z.stack.FlashTransport[t].init=!0,u=z.stack.FlashTransport[t].swf,u.createChannel(e.channel,e.secret,f(e.remote),e.isHost),e.isHost&&(R&&e.swfNoThrottle&&_(e.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),_(e.props,{src:v(e.remote,{xdm_e:f(n.href),xdm_c:e.channel,xdm_p:6,xdm_s:e.secret}),name:K+e.channel+"_provider"}),l=w(e))};z.stack.FlashTransport[t]&&z.stack.FlashTransport[t].init?d():z.stack.FlashTransport[t]?z.stack.FlashTransport[t].queue.push(d):(z.stack.FlashTransport[t]={queue:[d]},a(t))},init:function(){d(s.onDOMReady,s)}}},z.stack.PostMessageTransport=function(t){function i(e){if(e.origin)return f(e.origin);if(e.uri)return f(e.uri);if(e.domain)return n.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}function a(e){var n=i(e);o("received message '"+e.data+"' from "+n),n==u&&e.data.substring(0,t.channel.length+1)==t.channel+" "&&s.up.incoming(e.data.substring(t.channel.length+1),n)}var o=J.getTracer("easyXDM.stack.PostMessageTransport");o("constructor");var s,l,c,u;return s={outgoing:function(e,n,r){c.postMessage(t.channel+" "+e,n||u),r&&r()},destroy:function(){o("destroy"),D(e,"message",a),l&&(c=null,l.parentNode.removeChild(l),l=null)},onDOMReady:function(){if(o("init"),u=f(t.remote),t.isHost){var i=function(n){n.data==t.channel+"-ready"&&(o("firing onReady"),c="postMessage"in l.contentWindow?l.contentWindow:l.contentWindow.document,D(e,"message",i),I(e,"message",a),r(function(){s.up.callback(!0)},0))};I(e,"message",i),_(t.props,{src:v(t.remote,{xdm_e:f(n.href),xdm_c:t.channel,xdm_p:1}),name:K+t.channel+"_provider"}),l=w(t)}else I(e,"message",a),c="postMessage"in e.parent?e.parent:e.parent.document,c.postMessage(t.channel+"-ready",u),r(function(){s.up.callback(!0)},0)},init:function(){d(s.onDOMReady,s)}}},z.stack.FrameElementTransport=function(i){var a=J.getTracer("easyXDM.stack.FrameElementTransport");a("constructor");var o,s,l,c;return o={outgoing:function(e,t,n){l.call(this,e),n&&n()},destroy:function(){a("destroy"),s&&(s.parentNode.removeChild(s),s=null)},onDOMReady:function(){a("init"),c=f(i.remote),i.isHost?(_(i.props,{src:v(i.remote,{xdm_e:f(n.href),xdm_c:i.channel,xdm_p:5}),name:K+i.channel+"_provider"}),s=w(i),s.fn=function(e){return delete s.fn,l=e,r(function(){o.up.callback(!0)},0),function(e){o.up.incoming(e,c)}}):(t.referrer&&f(t.referrer)!=G.xdm_e&&(e.top.location=G.xdm_e),l=e.frameElement.fn(function(e){o.up.incoming(e,c)}),o.up.callback(!0))},init:function(){d(o.onDOMReady,o)}}},z.stack.NameTransport=function(e){function t(t){var n=e.remoteHelper+(l?"#_3":"#_2")+e.channel;o("sending message "+t),o("navigating to  '"+n+"'"),c.contentWindow.sendMessage(t,n)}function n(){l?2!==++p&&l||s.up.callback(!0):(t("ready"),o("calling onReady"),s.up.callback(!0))}function i(e){o("received message "+e),s.up.incoming(e,m)}function a(){h&&r(function(){h(!0)},0)}var o=J.getTracer("easyXDM.stack.NameTransport");if(o("constructor"),e.isHost&&y(e.remoteHelper))throw o("missing remoteHelper"),Error("missing remoteHelper");var s,l,c,u,p,h,m,g;return s={outgoing:function(e,n,r){h=r,t(e)},destroy:function(){o("destroy"),c.parentNode.removeChild(c),c=null,l&&(u.parentNode.removeChild(u),u=null)},onDOMReady:function(){o("init"),l=e.isHost,p=0,m=f(e.remote),e.local=b(e.local),l?(z.Fn.set(e.channel,function(t){o("received initial message "+t),l&&"ready"===t&&(z.Fn.set(e.channel,i),n())}),g=v(e.remote,{xdm_e:e.local,xdm_c:e.channel,xdm_p:2}),_(e.props,{src:g+"#"+e.channel,name:K+e.channel+"_provider"}),u=w(e)):(e.remoteHelper=e.remote,z.Fn.set(e.channel,i));var t=function(){var i=c||this;D(i,"load",t),z.Fn.set(e.channel+"_load",a),function o(){"function"==typeof i.contentWindow.sendMessage?n():r(o,50)}()};c=w({props:{src:e.local+"#_4"+e.channel},onLoad:t})},init:function(){d(s.onDOMReady,s)}}},z.stack.HashTransport=function(t){function n(e){if(s("sending message '"+(m+1)+" "+e+"' to "+y),!b)return s("no caller window"),void 0;var n=t.remote+"#"+m++ +"_"+e;(c||!v?b.contentWindow:b).location=n}function i(e){h=e,s("received message '"+h+"' from "+y),l.up.incoming(h.substring(h.indexOf("_")+1),y)}function a(){if(g){var e=g.location.href,t="",n=e.indexOf("#");-1!=n&&(t=e.substring(n)),t&&t!=h&&(s("poll: new message"),i(t))}}function o(){s("starting polling"),u=setInterval(a,p)}var s=J.getTracer("easyXDM.stack.HashTransport");s("constructor");var l,c,u,p,h,m,g,b,v,y;return l={outgoing:function(e){n(e)},destroy:function(){e.clearInterval(u),(c||!v)&&b.parentNode.removeChild(b),b=null},onDOMReady:function(){if(c=t.isHost,p=t.interval,h="#"+t.channel,m=0,v=t.useParent,y=f(t.remote),c){if(_(t.props,{src:t.remote,name:K+t.channel+"_provider"}),v)t.onLoad=function(){g=e,o(),l.up.callback(!0)};else{var n=0,i=t.delay/50;(function a(){if(++n>i)throw s("unable to get reference to _listenerWindow, giving up"),Error("Unable to reference listenerwindow");try{g=b.contentWindow.frames[K+t.channel+"_consumer"]}catch(e){}g?(o(),s("got a reference to _listenerWindow"),l.up.callback(!0)):r(a,50)})()}b=w(t)}else g=e,o(),v?(b=parent,l.up.callback(!0)):(_(t,{props:{src:t.remote+"#"+t.channel+new Date,name:K+t.channel+"_consumer"},onLoad:function(){l.up.callback(!0)}}),b=w(t))},init:function(){d(l.onDOMReady,l)}}},z.stack.ReliableBehavior=function(){var e=J.getTracer("easyXDM.stack.ReliableBehavior");e("constructor");var t,n,r=0,i=0,a="";return t={incoming:function(o,s){e("incoming: "+o);var l=o.indexOf("_"),c=o.substring(0,l).split(",");o=o.substring(l+1),c[0]==r&&(e("message delivered"),a="",n&&(n(!0),n=null)),o.length>0&&(e("sending ack, and passing on "+o),t.down.outgoing(c[1]+","+r+"_"+a,s),i!=c[1]&&(i=c[1],t.up.incoming(o,s)))},outgoing:function(e,o,s){a=e,n=s,t.down.outgoing(i+","+ ++r+"_"+e,o)}}},z.stack.QueueBehavior=function(e){function t(){if(e.remove&&0===l.length)return n("removing myself from the stack"),x(o),void 0;if(!c&&0!==l.length&&!s){n("dispatching from queue"),c=!0;var i=l.shift();o.down.outgoing(i.data,i.origin,function(e){c=!1,i.callback&&r(function(){i.callback(e)},0),t()})}}var n=J.getTracer("easyXDM.stack.QueueBehavior");n("constructor");var o,s,l=[],c=!0,u="",d=0,p=!1,h=!1;return o={init:function(){y(e)&&(e={}),e.maxLength&&(d=e.maxLength,h=!0),e.lazy?p=!0:o.down.init()},callback:function(e){c=!1;var n=o.up;t(),n.callback(e)},incoming:function(t,r){if(h){var a=t.indexOf("_"),s=parseInt(t.substring(0,a),10);u+=t.substring(a+1),0===s?(n("received the last fragment"),e.encode&&(u=i(u)),o.up.incoming(u,r),u=""):n("waiting for more fragments, seq="+t)}else o.up.incoming(t,r)},outgoing:function(r,i,s){e.encode&&(r=a(r));var c,u=[];if(h){for(;0!==r.length;)c=r.substring(0,d),r=r.substring(c.length),u.push(c);for(;c=u.shift();)n("enqueuing"),l.push({data:u.length+"_"+c,origin:i,callback:0===u.length?s:null})}else l.push({data:r,origin:i,callback:s});p?o.down.init():t()},destroy:function(){n("destroy"),s=!0,o.down.destroy()}}},z.stack.VerifyBehavior=function(e){function t(){n("requesting verification"),i=Math.random().toString(16).substring(2),r.down.outgoing(i)}var n=J.getTracer("easyXDM.stack.VerifyBehavior");if(n("constructor"),y(e.initiate))throw Error("settings.initiate is not set");var r,i,a;return r={incoming:function(o,s){var l=o.indexOf("_");-1===l?o===i?(n("verified, calling callback"),r.up.callback(!0)):a||(n("returning secret"),a=o,e.initiate||t(),r.down.outgoing(o)):o.substring(0,l)===a&&r.up.incoming(o.substring(l+1),s)},outgoing:function(e,t,n){r.down.outgoing(i+"_"+e,t,n)},callback:function(){e.initiate&&t()}}},z.stack.RpcBehavior=function(e,t){function n(e){e.jsonrpc="2.0",a.down.outgoing(s.stringify(e))}function r(e,t){var r=Array.prototype.slice;return o("creating method "+t),function(){o("executing method "+t);var i,a=arguments.length,s={method:t};a>0&&"function"==typeof arguments[a-1]?(a>1&&"function"==typeof arguments[a-2]?(i={success:arguments[a-2],error:arguments[a-1]},s.params=r.call(arguments,0,a-2)):(i={success:arguments[a-1]},s.params=r.call(arguments,0,a-1)),u[""+ ++c]=i,s.id=c):s.params=r.call(arguments,0),e.namedParams&&1===s.params.length&&(s.params=s.params[0]),n(s)}}function i(e,t,r,i){if(!r)return o("requested to execute non-existent procedure "+e),t&&n({id:t,error:{code:-32601,message:"Procedure not found."}}),void 0;o("requested to execute procedure "+e);var a,s;t?(a=function(e){a=N,n({id:t,result:e})},s=function(e,r){s=N;var i={id:t,error:{code:-32099,message:e}};r&&(i.error.data=r),n(i)}):a=s=N,l(i)||(i=[i]);try{var c=r.method.apply(r.scope,i.concat([a,s]));y(c)||a(c)}catch(u){s(u.message)}}var a,o=J.getTracer("easyXDM.stack.RpcBehavior"),s=t.serializer||Y(),c=0,u={};return a={incoming:function(e){var r=s.parse(e);if(r.method)o("received request to execute method "+r.method+(r.id?" using callback id "+r.id:"")),t.handle?t.handle(r,n):i(r.method,r.id,t.local[r.method],r.params);else{o("received return value destined to callback with id "+r.id);var a=u[r.id];r.error?a.error?a.error(r.error):o("unhandled error returned."):a.success&&a.success(r.result),delete u[r.id]}},init:function(){if(o("init"),t.remote){o("creating stubs");for(var n in t.remote)t.remote.hasOwnProperty(n)&&(e[n]=r(t.remote[n],n))}a.down.init()},destroy:function(){o("destroy");for(var n in t.remote)t.remote.hasOwnProperty(n)&&e.hasOwnProperty(n)&&delete e[n];a.down.destroy()}}},O.easyXDM=z})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);