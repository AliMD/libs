easyXDM.WidgetManager=function(e){function t(t,n){e.listeners&&e.listeners[t]&&e.listeners[t](o,n)}function n(e,t){t in d||(d[t]=[]),d[t].push(e)}function r(e,r){e.initialize(p,function(i){if(i.isInitialized){u[r]=e;for(var a=i.subscriptions.length;a--;)n(r,i.subscriptions[a]);t(c.WidgetInitialized,{url:r})}else e.destroy(),t(c.WidgetFailed,{url:r})})}function i(e,t,n){var r=d[t];if(r)for(var i,a=r.length;a--;)i=r[a],i!==e&&u[i].send(e,t,n)}function a(t,a){var o=new easyXDM.Rpc({channel:"widget"+l++,local:s,remote:t,container:a.container||h,swf:e.swf,onReady:function(){r(o,t,a)}},{local:{subscribe:{isVoid:!0,method:function(e){n(t,e)}},publish:{isVoid:!0,method:function(e,n){i(t,e,n)}}},remote:{initialize:{},send:{isVoid:!0}}})}var o=this,s=e.local,l=0,c={WidgetInitialized:"widgetinitialized",WidgetFailed:"widgetfailed"},u={},d={},p={hosturl:location.href};easyXDM.apply(p,e.widgetSettings);var h=e.container||document.body;this.addWidget=function(e,t){if(e in u)throw Error("A widget with this url has already been initialized");a(e,t)},this.removeWidget=function(e){if(e in u){for(var t in d)if(d.hasOwnProperty(t))for(var n=d[t],r=n.length;r--;)if(n[r]===e){n.splice(r,1);break}u[e].destroy(),delete u[e]}},this.publish=function(e,t){i("",e,t)},this.broadcast=function(e){for(var t in u)u.hasOwnPropert(t)&&u[t].send({url:"",topic:"broadcast",data:e})}},easyXDM.Widget=function(e){var t,n=this,r=new easyXDM.Rpc({swf:e.swf},{remote:{subscribe:{isVoid:!0},publish:{isVoid:!0}},local:{initialize:{method:function(){return e.initialized(n,r),{isInitialized:!0,subscriptions:e.subscriptions}}},send:{isVoid:!0,method:function(e,n,r){t(e,n,r)}}}});window.onunload=function(){r.destroy()},this.publish=function(e,t){r.publish(e,t)},this.subscribe=function(e){r.subscribe(e)},this.registerMessageHandler=function(e){t=e},e.initialize(this,r)};