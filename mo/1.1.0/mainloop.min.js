define("mo/mainloop",["mo/lang"],function(e){function t(e){for(var t,i=0,n=l.length;n>i;i++)t=l[i],t&&e-t.lastLoop>=s&&(t.lastLoop=e,t.renders.call(t,e))}var i="RequestAnimationFrame",n=4e12,r=window["webkit"+i]||window["moz"+i]||window["o"+i]||window["ms"+i],o=1,a=1,s=0,l=[],c={},h={},u={linear:function(e,t,i,n){return i+n*e},easeIn:function(e,t,i,n,r){return n*(t/=r)*t+i},easeOut:function(e,t,i,n,r){return-n*(t/=r)*(t-2)+i},easeInOut:function(e,t,i,n,r){return 1>(t/=r/2)?n/2*t*t+i:-n/2*(--t*(t-2)-1)+i}},d={fps:0,easing:u},p={config:function(t){return e.config(this,t,d),t.fps&&(s=this.fps?1e3/this.fps:0),t.easing&&(this.easing=e.mix(this.easing||{},t.easing)),this},run:function(e){function i(){if(o===p){var e=+new Date;d(e),s.globalSignal?c&&c(i):u(a)}}if(e){var n=h[e];if(n||(this.addStage(e),n=h[e]),n&&!n.state&&(n.state=1,l.push(n),n.renders.forEach(function(e){var t=this.delays[e._rid];t&&(t[3]=+new Date,t[0]=setTimeout(t[1],t[2]))},n)),this.globalSignal)return this}var a,s=this,c=r,u=clearInterval,d=t,p=++o;return this.globalSignal=1,c?c(i):a=setInterval(i,15),this},pause:function(e){if(e){var t=l.indexOf(h[e]);if(t>=0){var i=h[e];l.splice(t,1),i.state=0,i.pauseTime=+new Date,i.renders.forEach(function(e){var t=this.delays[e._rid];t&&(clearTimeout(t[0]),t[2]-=this.pauseTime-t[3])},i)}}else this.globalSignal=0;return this},complete:function(e){var t=h[e];return t&&t.state?(t.renders.forEach(function(e){var i=t.delays[e._rid];i&&(clearTimeout(i[0]),i[1]()),e.call(t,this)},n),this.remove(e)):this},remove:function(e,t){if(t){var i=h[e];i&&(clearTimeout((i.delays[t._rid]||[])[0]),i.renders.clear(t))}else this.pause(e),delete h[e];return this},info:function(e){return h[e]},isRunning:function(e){return!!(h[e]||{}).state},addStage:function(t,i){return t&&(h[t]={name:t,ctx:i,state:0,lastLoop:0,pauseTime:0,delays:{},renders:e.fnQueue()}),this},addRender:function(e,t,i){return h[e]||this.addStage(e,i),this._lastestRender=t,h[e].renders.push(t),this},getRender:function(e){return c[e]||this._lastestRender},addTween:function(e,t,i,n,r){function o(a){g!==this.pauseTime&&this.pauseTime>l&&(g=this.pauseTime,l+=+new Date-g);var s,c=a-l,h=c/n;0>=c||(1>h&&(f&&(h=d.easing[f](h,c,0,1,n)),0>m?(h=1-h,s=i+-1*m*h):s=t+m*h),c>=n?(r.step(i,n),d.remove(e,o),r.callback&&r.callback()):r.step(s,c))}function s(){return u&&delete u[p],n?(r.step(t,0),l=+new Date,d.addRender(e,o),void 0):(r.step(i,0),r.callback&&setTimeout(function(){r.callback()},0),void 0)}var l,u,d=this,p=r.renderId,f=r.easing,g=0,m=i-t;if(r.delay){h[e]||this.addStage(e),p||(p=r.renderId="_oz_mainloop_"+a++),u=h[e].delays;var v=setTimeout(s,r.delay);u[p]=[v,s,r.delay,+new Date]}else s();return p&&(o._rid=p,c[p]=o),this}};return p.config(d),p});