define("mo/key",["jquery","mo/lang"],function(e,t){function i(e){e=e||{};var t=this;this.target=e.target||document,this.keyHandlers={},this.globalKeyHandlers={},this.rules=[],this.sequence={},this.sequenceNums=[],this.history=[],this.trace=e.trace,this.traceStack=e.traceStack||[],this.forTextarea=e.forTextarea||!1,this._handler=function(e){if((!t.forTextarea||/textarea|input/i.test(e.target.nodeName)||"text"===e.target.type)&&(t.forTextarea||this===e.target||!/textarea|select/i.test(e.target.nodeName)&&"text"!==e.target.type)){var i,r=t.lock||!t.check(this,e),o=t.keyHandlers[e.type],a=t.globalKeyHandlers[e.type];if(o){var s,l,c=n(e);for(var h in c)if(s=o[h])break;if(t.sequenceNums.length&&!r){var u=t.history;if(u.push(h),u.length>10&&u.shift(),u.length>1)for(var d=t.sequenceNums.length-1;d>=0;d--)if(l=o[u.slice(0-t.sequenceNums[d]).join("->")])return t.trace&&t._trace(d),i=l.apply(this,arguments),u.length=0,i||e.preventDefault(),i}if(s){if(r)return!1;t.trace&&t._trace(h),i=s.apply(this,arguments),i||e.preventDefault()}}if(a){if(r)return!1;i=a.apply(this,arguments),i||e.preventDefault()}return i}}}function n(e){var t="keypress"!==e.type&&o[e.which],i=String.fromCharCode(e.which).toLowerCase(),n="",r={};if(e.altKey&&"alt"!==t&&(n+="alt+"),e.ctrlKey&&"ctrl"!==t&&(n+="ctrl+"),e.metaKey&&!e.ctrlKey&&"meta"!==t&&(n+="meta+"),e.shiftKey&&"shift"!==t&&(n+="shift+"),t)r[n+t]=!0;else{var s=n+i;s&&(r[s]=!0),s=a[i],s&&(r[n+s]=!0,"shift+"===n&&(s=a[i],s&&(r[s]=!0)))}return r}function r(e){return new i(e)}var o={8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},a={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};return i.prototype={addHandler:function(i,n,r){function o(e){if(e){var n=e.split("->");if(n.length>1){a.sequence[n.length]=1;var o=[];for(var l in a.sequence)o.push(parseInt(l,10));a.sequenceNums=o.sort(function(e,t){return e-t})}var c=e.toLowerCase();s[c]||(s[c]=t.fnQueue()),s[c].push(r)}else{var h=a.globalKeyHandlers[i];h||(h=a.globalKeyHandlers[i]=t.fnQueue()),h.push(r)}}var a=this,s=this.keyHandlers[i];return r||(r=n,n=""),s||(s=this.keyHandlers[i]={},e(this.target).bind(i,this._handler)),Array.isArray(n)?n.forEach(function(e){o(e)}):o(n),this},_trace:function(e){this.traceStack.unshift("["+e+"]"),this.traceStack.length>this.trace&&this.traceStack.pop()},reset:function(){for(var t in this.keyHandlers)e(this.target).unbind(t,this._handler);this.keyHandlers={},this.rules=[],this.history=[],delete this._handler,this.lock=!1},addRule:function(e){return this.rules.push(e),this},enable:function(){this.lock=!1},disable:function(){this.lock=!0},check:function(e,t){for(var i=!0,n=this.rules,r=0,o=n.length;o>r;r++)if(!n[r].call(e,t)){i=!1;break}return i}},["down","up","press"].forEach(function(e){this[e]=function(t,i){return this.addHandler("key"+e,t,i),this}},i.prototype),r.KEYS_CODE=o,r});