define("mo/network/ajax",["mo/browsers"],function(browsers,require,exports){var httpParam=function(e){var t=[];if(e.constructor==Array)for(var i=0;e.length>i;i++)t.push(e[i].name+"="+encodeURIComponent(e[i].value));else for(var n in e)t.push(n+"="+encodeURIComponent(e[n]));return t.join("&").replace(/%20/g,"+")},ajax=function(s){function httpSuccess(e){try{return!e.status&&"file:"==location.protocol||e.status>=200&&300>e.status||304==e.status||1223==e.status||browsers.safari&&void 0==e.status}catch(t){}return!1}function httpData(r,type){var ct=r.getResponseHeader("content-type"),xml="xml"==type||!type&&ct&&ct.indexOf("xml")>=0,data=xml?r.responseXML:r.responseText;if(xml&&"parsererror"==data.documentElement.tagName)throw"parsererror";return"script"==type&&eval.call(window,data),"json"==type&&(data=eval("("+data+")")),data}var options={type:s.type||"GET",url:s.url||"",data:s.data||null,dataType:s.dataType,contentType:s.contentType||"application/x-www-form-urlencoded",username:s.username||null,password:s.password||null,timeout:s.timeout||0,processData:void 0===s.processData?!0:s.processData,beforeSend:s.beforeSend||function(){},complete:s.complete||function(){},handleError:s.handleError||function(){},success:s.success||function(){},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}};options.data&&options.processData&&"string"!=typeof options.data&&(options.data=httpParam(options.data)),options.data&&"get"==options.type.toLowerCase()&&(options.url+=(options.url.match(/\?/)?"&":"?")+options.data,options.data=null);var status,data,requestDone=!1,xhr=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest;xhr.open(options.type,options.url,!0,options.username,options.password);try{options.data&&xhr.setRequestHeader("Content-Type",options.contentType),xhr.setRequestHeader("X-Requested-With","XMLHttpRequest"),xhr.setRequestHeader("Accept",s.dataType&&options.accepts[s.dataType]?options.accepts[s.dataType]+", */*":options.accepts._default)}catch(e){}options.beforeSend&&options.beforeSend(xhr);var onreadystatechange=function(e){if(!requestDone&&xhr&&(4==xhr.readyState||"timeout"==e)){if(requestDone=!0,ival&&(clearInterval(ival),ival=null),status="timeout"==e&&"timeout"||!httpSuccess(xhr)&&"error"||"success","success"==status){try{data=httpData(xhr,options.dataType)}catch(t){status="parsererror"}options.success(data,status)}else options.handleError(xhr,status);options.complete(xhr,status),xhr=null}},ival=setInterval(onreadystatechange,13);return options.timeout>0&&setTimeout(function(){xhr&&(xhr.abort(),requestDone||onreadystatechange("timeout"))},options.timeout),xhr.send(options.data),xhr};exports.ajax=ajax,exports.params=httpParam});