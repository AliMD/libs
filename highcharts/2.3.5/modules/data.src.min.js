(function(e){var t=e.each,n=function(e){this.init(e)};e.extend(n.prototype,{init:function(e){this.options=e,this.columns=e.columns||this.rowsToColumns(e.rows)||[],this.columns.length?this.dataFound():(this.parseCSV(),this.parseTable(),this.parseGoogleSpreadsheet())},dataFound:function(){this.parseTypes(),this.findHeaderRow(),this.parsed(),this.complete()},parseCSV:function(){var e,n=this.options,i=n.csv,r=this.columns,o=n.startRow||0,a=n.endRow||Number.MAX_VALUE,s=n.startColumn||0,l=n.endColumn||Number.MAX_VALUE;i&&(e=i.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split(n.lineDelimiter||"\n"),t(e,function(e,i){if(i>=o&&a>=i){var c=e.split(n.itemDelimiter||",");t(c,function(e,t){t>=s&&l>=t&&(r[t-s]||(r[t-s]=[]),r[t-s][i-o]=e)})}}),this.dataFound())},parseTable:function(){var e,n=this.options,i=n.table,r=this.columns,o=n.startRow||0,a=n.endRow||Number.MAX_VALUE,s=n.startColumn||0,l=n.endColumn||Number.MAX_VALUE;i&&("string"==typeof i&&(i=document.getElementById(i)),t(i.getElementsByTagName("tr"),function(n,i){e=0,i>=o&&a>=i&&t(n.childNodes,function(t){("TD"===t.tagName||"TH"===t.tagName)&&e>=s&&l>=e&&(r[e]||(r[e]=[]),r[e][i-o]=t.innerHTML,e+=1)})}),this.dataFound())},parseGoogleSpreadsheet:function(){var e=this,t=this.options,n=t.googleSpreadsheetKey,i=this.columns;n&&jQuery.getJSON("https://spreadsheets.google.com/feeds/cells/"+n+"/"+(t.googleSpreadsheetWorksheet||"od6")+"/public/values?alt=json-in-script&callback=?",function(t){var n,r,o=t.feed.entry,a=o.length,s=0,l=0;for(r=0;a>r;r++)n=o[r],s=Math.max(s,n.gs$cell.col),l=Math.max(l,n.gs$cell.row);for(r=0;s>r;r++)i[r]=Array(l);for(r=0;a>r;r++)n=o[r],i[n.gs$cell.col-1][n.gs$cell.row-1]=n.content.$t;e.dataFound()})},findHeaderRow:function(){var e=0;t(this.columns,function(t){"string"!=typeof t[0]&&(e=null)}),this.headerRow=0},trim:function(e){return"string"==typeof e?e.replace(/^\s+|\s+$/g,""):e},parseTypes:function(){for(var e,t,n,i,r,o=this.columns,a=o.length;a--;)for(e=o[a].length;e--;)t=o[a][e],n=parseFloat(t),i=this.trim(t),i==n?(o[a][e]=n,n>31536e6?o[a].isDatetime=!0:o[a].isNumeric=!0):(r=this.parseDate(t),0!==a||"number"!=typeof r||isNaN(r)?o[a][e]=i:(o[a][e]=r,o[a].isDatetime=!0))},dateFormats:{"YYYY-mm-dd":{regex:"^([0-9]{4})-([0-9]{2})-([0-9]{2})$",parser:function(e){return Date.UTC(+e[1],e[2]-1,+e[3])}}},parseDate:function(e){var t,n,i,r,o=this.options.parseDate;if(o&&(t=o),"string"==typeof e)for(n in this.dateFormats)i=this.dateFormats[n],r=e.match(i.regex),r&&(t=i.parser(r));return t},rowsToColumns:function(e){var t,n,i,r,o;if(e)for(o=[],n=e.length,t=0;n>t;t++)for(r=e[t].length,i=0;r>i;i++)o[i]||(o[i]=[]),o[i][t]=e[t][i];return o},parsed:function(){this.options.parsed&&this.options.parsed.call(this,this.columns)},complete:function(){var e,t,n,i,r,o,a,s,l,c=this.columns,u=this.options;if(u.complete){for(c.length>1&&(n=c.shift(),0===this.headerRow&&n.shift(),e=n.isNumeric||n.isDatetime,e||(t=n),n.isDatetime&&(i="datetime")),r=[],s=0;c.length>s;s++){for(0===this.headerRow&&(a=c[s].shift()),o=[],l=0;c[s].length>l;l++)o[l]=void 0!==c[s][l]?e?[n[l],c[s][l]]:c[s][l]:null;r[s]={name:a,data:o}}u.complete({xAxis:{categories:t,type:i},series:r})}}}),e.Data=n,e.data=function(e){return new n(e)},e.wrap(e.Chart.prototype,"init",function(n,i,r){var o=this;i&&i.data?e.data(e.extend(i.data,{complete:function(a){var s=[];t(a.series,function(e,t){s[t]=e.data,e.data=null}),i=e.merge(a,i),t(s,function(e,t){i.series[t].data=e}),n.call(o,i,r)}})):n.call(o,i,r)})})(Highcharts);