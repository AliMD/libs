(function(e){e.fn.jqm=function(i){var r={overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:o,ajaxText:"",target:o,modal:o,toTop:o,onShow:o,onHide:o,onLoad:o};return this.each(function(){return this._jqm?n[this._jqm].c=e.extend({},n[this._jqm].c,i):(t++,this._jqm=t,n[t]={c:e.extend(r,e.jqm.params,i),a:o,w:e(this).addClass("jqmID"+t),s:t},r.trigger&&e(this).jqmAddTrigger(r.trigger),void 0)})},e.fn.jqmAddClose=function(e){return d(this,e,"jqmHide")},e.fn.jqmAddTrigger=function(e){return d(this,e,"jqmShow")},e.fn.jqmShow=function(t){return this.each(function(){t=t||window.event,e.jqm.open(this._jqm,t)})},e.fn.jqmHide=function(t){return this.each(function(){t=t||window.event,e.jqm.close(this._jqm,t)})},e.jqm={hash:{},open:function(t,a){var l=n[t],u=l.c,d="."+u.closeClass,h=parseInt(l.w.css("z-index")),h=h>0?h:3e3,p=e("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":h-1,opacity:u.overlay/100});if(l.a)return o;if(l.t=a,l.a=!0,l.w.css("z-index",h),u.modal?(i[0]||c("bind"),i.push(t)):u.overlay>0?l.w.jqmAddClose(p):p=o,l.o=p?p.addClass(u.overlayClass).prependTo("body"):o,r&&(e("html,body").css({height:"100%",width:"100%"}),p)){p=p.css({position:"absolute"})[0];for(var f in{Top:1,Left:1})p.style.setExpression(f.toLowerCase(),"(_=(document.documentElement.scroll"+f+" || document.body.scroll"+f+"))+'px'")}if(u.ajax){var g=u.target||l.w,m=u.ajax,g="string"==typeof g?e(g,l.w):e(g),m="@"==m.substr(0,1)?e(a).attr(m.substring(1)):m;g.html(u.ajaxText).load(m,function(){u.onLoad&&u.onLoad.call(this,l),d&&l.w.jqmAddClose(e(d,l.w)),s(l)})}else d&&l.w.jqmAddClose(e(d,l.w));return u.toTop&&l.o&&l.w.before('<span id="jqmP'+l.w[0]._jqm+'"></span>').insertAfter(l.o),u.onShow?u.onShow(l):l.w.show(),s(l),o},close:function(t){var r=n[t];return r.a?(r.a=o,i[0]&&(i.pop(),i[0]||c("unbind")),r.c.toTop&&r.o&&e("#jqmP"+r.w[0]._jqm).after(r.w).remove(),r.c.onHide?r.c.onHide(r):(r.w.hide(),r.o&&r.o.remove()),o):o},params:{}};var t=0,n=e.jqm.hash,i=[],r=e.browser.msie&&"6.0"==e.browser.version,o=!1,a=e('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),s=function(t){r&&(t.o?t.o.html('<p style="width:100%;height:100%"/>').prepend(a):e("iframe.jqm",t.w)[0]||t.w.prepend(a)),l(t)},l=function(t){try{e(":input:visible",t.w)[0].focus()}catch(n){}},c=function(t){e()[t]("keypress",u)[t]("keydown",u)[t]("mousedown",u)},u=function(t){var r=n[i[i.length-1]],o=!e(t.target).parents(".jqmID"+r.s)[0];return o&&l(r),!o},d=function(t,i,r){return t.each(function(){var t=this._jqm;e(i).each(function(){this[r]||(this[r]=[],e(this).click(function(){for(var e in{jqmShow:1,jqmHide:1})for(var t in this[e])n[this[e][t]]&&n[this[e][t]].w[e](this);return o})),this[r].push(t)})})}})(jQuery);