(function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("knockout"),exports):"function"==typeof define&&define.amd?define(["knockout","exports"],e):e(ko,ko.mapping={})})(function(e,t){function i(e,n){var r,o;for(o in n)if(n.hasOwnProperty(o)&&n[o])if(r=t.getType(e[o]),o&&e[o]&&"array"!==r&&"string"!==r)i(e[o],n[o]);else if("array"===t.getType(e[o])&&"array"===t.getType(n[o])){r=e;for(var a=o,s=e[o],l=n[o],c={},u=s.length-1;u>=0;--u)c[s[u]]=s[u];for(u=l.length-1;u>=0;--u)c[l[u]]=l[u];s=[],l=void 0;for(l in c)s.push(c[l]);r[a]=s}else e[o]=n[o]}function n(e,t){var n={};return i(n,e),i(n,t),n}function r(e,t){for(var i=n({},e),r=x.length-1;r>=0;r--){var a=x[r];i[a]&&(i[""]instanceof Object||(i[""]={}),i[""][a]=i[a],delete i[a])}return t&&(i.ignore=o(t.ignore,i.ignore),i.include=o(t.include,i.include),i.copy=o(t.copy,i.copy),i.observe=o(t.observe,i.observe)),i.ignore=o(i.ignore,k.ignore),i.include=o(i.include,k.include),i.copy=o(i.copy,k.copy),i.observe=o(i.observe,k.observe),i.mappedProperties=i.mappedProperties||{},i.copiedProperties=i.copiedProperties||{},i}function o(i,n){return"array"!==t.getType(i)&&(i="undefined"===t.getType(i)?[]:[i]),"array"!==t.getType(n)&&(n="undefined"===t.getType(n)?[]:[n]),e.utils.arrayGetDistinctValues(i.concat(n))}function a(i,r,o,l,p,f,y){var x="array"===t.getType(e.utils.unwrapObservable(r)),f=f||"";if(t.isMapped(i))var w=e.utils.unwrapObservable(i)[b],o=n(w,o);var k=y||p,_=function(){return o[l]&&o[l].create instanceof Function},E=function(t){var i=g,n=e.dependentObservable;return e.dependentObservable=function(t,n,r){r=r||{},t&&"object"==typeof t&&(r=t);var o=r.deferEvaluation,a=!1;if(r.deferEvaluation=!0,t=new v(t,n,r),!o){var s=t,o=e.dependentObservable;e.dependentObservable=v,t=e.isWriteableObservable(s),e.dependentObservable=o,t=v({read:function(){return a||(e.utils.arrayRemoveItem(i,s),a=!0),s.apply(s,arguments)},write:t&&function(e){return s(e)},deferEvaluation:!0}),i.push(t)}return t},e.dependentObservable.fn=v.fn,e.computed=e.dependentObservable,t=e.utils.unwrapObservable(p)instanceof Array?o[l].create({data:t||r,parent:k,skip:C}):o[l].create({data:t||r,parent:k}),e.dependentObservable=n,e.computed=e.dependentObservable,t},T=function(){return o[l]&&o[l].update instanceof Function},S=function(t,i){var n={data:i||r,parent:k,target:e.utils.unwrapObservable(t)};return e.isWriteableObservable(t)&&(n.observable=t),o[l].update(n)};if(y=m.get(r))return y;if(l=l||"",x){var x=[],A=!1,O=function(e){return e};o[l]&&o[l].key&&(O=o[l].key,A=!0),e.isObservable(i)||(i=e.observableArray([]),i.mappedRemove=function(e){var t="function"==typeof e?e:function(t){return t===O(e)};return i.remove(function(e){return t(O(e))})},i.mappedRemoveAll=function(t){var n=u(t,O);return i.remove(function(t){return-1!=e.utils.arrayIndexOf(n,O(t))})},i.mappedDestroy=function(e){var t="function"==typeof e?e:function(t){return t===O(e)};return i.destroy(function(e){return t(O(e))})},i.mappedDestroyAll=function(t){var n=u(t,O);return i.destroy(function(t){return-1!=e.utils.arrayIndexOf(n,O(t))})},i.mappedIndexOf=function(t){var n=u(i(),O),t=O(t);return e.utils.arrayIndexOf(n,t)},i.mappedCreate=function(t){if(-1!==i.mappedIndexOf(t))throw Error("There already is an object with the key that you specified.");var n=_()?E(t):t;return T()&&(t=S(n,t),e.isWriteableObservable(n)?n(t):n=t),i.push(n),n}),y=u(e.utils.unwrapObservable(i),O).sort(),w=u(r,O),A&&w.sort();var P,A=e.utils.compareArrays(y,w),y={},R=e.utils.unwrapObservable(r),I={},L=!0,w=0;for(P=R.length;P>w;w++){var G=O(R[w]);if(void 0===G||G instanceof Object){L=!1;break}I[G]=R[w]}var R=[],X=0,w=0;for(P=A.length;P>w;w++){var D,G=A[w],M=f+"["+w+"]";switch(G.status){case"added":var N=L?I[G.value]:c(e.utils.unwrapObservable(r),G.value,O);D=a(void 0,N,o,l,i,M,p),_()||(D=e.utils.unwrapObservable(D)),M=s(e.utils.unwrapObservable(r),N,y),D===C?X++:R[M-X]=D,y[M]=!0;break;case"retained":N=L?I[G.value]:c(e.utils.unwrapObservable(r),G.value,O),D=c(i,G.value,O),a(D,N,o,l,i,M,p),M=s(e.utils.unwrapObservable(r),N,y),R[M]=D,y[M]=!0;break;case"deleted":D=c(i,G.value,O)}x.push({event:G.status,item:D})}i(R),o[l]&&o[l].arrayChanged&&e.utils.arrayForEach(x,function(e){o[l].arrayChanged(e.event,e.item)})}else if(h(r)){if(i=e.utils.unwrapObservable(i),!i){if(_())return A=E(),T()&&(A=S(A)),A;if(T())return S(A);i={}}if(T()&&(i=S(i)),m.save(r,i),T())return i;d(r,function(t){var n=f.length?f+"."+t:t;if(-1==e.utils.arrayIndexOf(o.ignore,n))if(-1!=e.utils.arrayIndexOf(o.copy,n))i[t]=r[t];else if("object"!=typeof r[t]&&"array"!=typeof r[t]&&o.observe.length>0&&-1==e.utils.arrayIndexOf(o.observe,n))i[t]=r[t],o.copiedProperties[n]=!0;else{var s=m.get(r[t]),l=a(i[t],r[t],o,t,i,n,i),s=s||l;o.observe.length>0&&-1==e.utils.arrayIndexOf(o.observe,n)?(i[t]=s(),o.copiedProperties[n]=!0):(e.isWriteableObservable(i[t])?i[t](e.utils.unwrapObservable(s)):(s=void 0===i[t]?s:e.utils.unwrapObservable(s),i[t]=s),o.mappedProperties[n]=!0)}})}else switch(t.getType(r)){case"function":T()?e.isWriteableObservable(r)?(r(S(r)),i=r):i=S(r):i=r;break;default:if(e.isWriteableObservable(i))return D=T()?S(i):e.utils.unwrapObservable(r),i(D),D;_()||T(),i=_()?E():e.observable(e.utils.unwrapObservable(r)),T()&&i(S(i))}return i}function s(e,t,i){for(var n=0,r=e.length;r>n;n++)if(!0!==i[n]&&e[n]===t)return n;return null}function l(i,n){var r;return n&&(r=n(i)),"undefined"===t.getType(r)&&(r=i),e.utils.unwrapObservable(r)}function c(t,i,n){for(var t=e.utils.unwrapObservable(t),r=0,o=t.length;o>r;r++){var a=t[r];if(l(a,n)===i)return a}throw Error("When calling ko.update*, the key '"+i+"' was not found!")}function u(t,i){return e.utils.arrayMap(e.utils.unwrapObservable(t),function(e){return i?l(e,i):e})}function d(e,i){if("array"===t.getType(e))for(var n=0;e.length>n;n++)i(n);else for(n in e)i(n)}function h(e){var i=t.getType(e);return("object"===i||"array"===i)&&null!==e}function p(){var t=[],i=[];this.save=function(n,r){var o=e.utils.arrayIndexOf(t,n);o>=0?i[o]=r:(t.push(n),i.push(r))},this.get=function(n){return n=e.utils.arrayIndexOf(t,n),n>=0?i[n]:void 0}}function f(){var e={},t=function(t){var i;try{i=t}catch(n){i="$$$"}return t=e[i],void 0===t&&(t=new p,e[i]=t),t};this.save=function(e,i){t(e).save(e,i)},this.get=function(e){return t(e).get(e)}}var g,m,b="__ko_mapping__",v=e.dependentObservable,y=0,x=["create","update","key","arrayChanged"],C={},w={include:["_destroy"],ignore:[],copy:[],observe:[]},k=w;t.isMapped=function(t){return(t=e.utils.unwrapObservable(t))&&t[b]},t.fromJS=function(e){if(0==arguments.length)throw Error("When calling ko.fromJS, pass the object you want to convert.");window.setTimeout(function(){y=0},0),y++||(g=[],m=new f);var t,i;2==arguments.length&&(arguments[1][b]?i=arguments[1]:t=arguments[1]),3==arguments.length&&(t=arguments[1],i=arguments[2]),i&&(t=n(t,i[b])),t=r(t);var o=a(i,e,t);return i&&(o=i),--y||window.setTimeout(function(){for(;g.length;){var e=g.pop();e&&e()}},0),o[b]=n(o[b],t),o},t.fromJSON=function(i){var n=e.utils.parseJson(i);return arguments[0]=n,t.fromJS.apply(this,arguments)},t.updateFromJS=function(){throw Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!")},t.updateFromJSON=function(){throw Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!")},t.toJS=function(i,n){if(k||t.resetDefaultOptions(),0==arguments.length)throw Error("When calling ko.mapping.toJS, pass the object you want to convert.");if("array"!==t.getType(k.ignore))throw Error("ko.mapping.defaultOptions().ignore should be an array.");if("array"!==t.getType(k.include))throw Error("ko.mapping.defaultOptions().include should be an array.");if("array"!==t.getType(k.copy))throw Error("ko.mapping.defaultOptions().copy should be an array.");return n=r(n,i[b]),t.visitModel(i,function(t){return e.utils.unwrapObservable(t)},n)},t.toJSON=function(i,n){var r=t.toJS(i,n);return e.utils.stringifyJson(r)},t.defaultOptions=function(){return arguments.length>0?(k=arguments[0],void 0):k},t.resetDefaultOptions=function(){k={include:w.include.slice(0),ignore:w.ignore.slice(0),copy:w.copy.slice(0)}},t.getType=function(e){if(e&&"object"==typeof e){if(e.constructor==(new Date).constructor)return"date";if("[object Array]"===Object.prototype.toString.call(e))return"array"}return typeof e},t.visitModel=function(i,n,o){o=o||{},o.visitedObjects=o.visitedObjects||new f;var a,s=e.utils.unwrapObservable(i);if(!h(s))return n(i,o.parentName);o=r(o,s[b]),n(i,o.parentName),a="array"===t.getType(s)?[]:{},o.visitedObjects.save(i,a);var l=o.parentName;return d(s,function(i){if(!o.ignore||-1==e.utils.arrayIndexOf(o.ignore,i)){var r=s[i],c=o,u=l||"";if("array"===t.getType(s)?l&&(u+="["+i+"]"):(l&&(u+="."),u+=i),c.parentName=u,-1!==e.utils.arrayIndexOf(o.copy,i)||-1!==e.utils.arrayIndexOf(o.include,i)||!s[b]||!s[b].mappedProperties||s[b].mappedProperties[i]||!s[b].copiedProperties||s[b].copiedProperties[i]||"array"===t.getType(s))switch(t.getType(e.utils.unwrapObservable(r))){case"object":case"array":case"undefined":c=o.visitedObjects.get(r),a[i]="undefined"!==t.getType(c)?c:t.visitModel(r,n,o);break;default:a[i]=n(r,o.parentName)}}}),a}});